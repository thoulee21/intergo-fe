function e(e, t, r) {
  return (
    (t = o(t)),
    (function (e, t) {
      if (t && ("object" == typeof t || "function" == typeof t)) return t;
      if (void 0 !== t)
        throw new TypeError(
          "Derived constructors may only return object or undefined",
        );
      return (function (e) {
        if (void 0 === e)
          throw new ReferenceError(
            "this hasn't been initialised - super() hasn't been called",
          );
        return e;
      })(e);
    })(e, s() ? Reflect.construct(t, r || [], o(e).constructor) : t.apply(e, r))
  );
}
function t(e, t) {
  if (!(e instanceof t))
    throw new TypeError("Cannot call a class as a function");
}
function r(e, t) {
  for (var r = 0; r < t.length; r++) {
    var i = t[r];
    ((i.enumerable = i.enumerable || !1),
      (i.configurable = !0),
      "value" in i && (i.writable = !0),
      Object.defineProperty(e, l(i.key), i));
  }
}
function i(e, t, i) {
  return (
    t && r(e.prototype, t),
    i && r(e, i),
    Object.defineProperty(e, "prototype", { writable: !1 }),
    e
  );
}
function n() {
  return (
    (n =
      "undefined" != typeof Reflect && Reflect.get
        ? Reflect.get.bind()
        : function (e, t, r) {
            var i = (function (e, t) {
              for (; !{}.hasOwnProperty.call(e, t) && null !== (e = o(e)); );
              return e;
            })(e, t);
            if (i) {
              var n = Object.getOwnPropertyDescriptor(i, t);
              return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value;
            }
          }),
    n.apply(null, arguments)
  );
}
function o(e) {
  return (
    (o = Object.setPrototypeOf
      ? Object.getPrototypeOf.bind()
      : function (e) {
          return e.__proto__ || Object.getPrototypeOf(e);
        }),
    o(e)
  );
}
function a(e, t) {
  if ("function" != typeof t && null !== t)
    throw new TypeError("Super expression must either be null or a function");
  ((e.prototype = Object.create(t && t.prototype, {
    constructor: { value: e, writable: !0, configurable: !0 },
  })),
    Object.defineProperty(e, "prototype", { writable: !1 }),
    t && u(e, t));
}
function s() {
  try {
    var e = !Boolean.prototype.valueOf.call(
      Reflect.construct(Boolean, [], function () {}),
    );
  } catch (e) {}
  return (s = function () {
    return !!e;
  })();
}
function c() {
  c = function () {
    return t;
  };
  var e,
    t = {},
    r = Object.prototype,
    i = r.hasOwnProperty,
    n =
      Object.defineProperty ||
      function (e, t, r) {
        e[t] = r.value;
      },
    o = "function" == typeof Symbol ? Symbol : {},
    a = o.iterator || "@@iterator",
    s = o.asyncIterator || "@@asyncIterator",
    u = o.toStringTag || "@@toStringTag";
  function d(e, t, r) {
    return (
      Object.defineProperty(e, t, {
        value: r,
        enumerable: !0,
        configurable: !0,
        writable: !0,
      }),
      e[t]
    );
  }
  try {
    d({}, "");
  } catch (e) {
    d = function (e, t, r) {
      return (e[t] = r);
    };
  }
  function l(e, t, r, i) {
    var o = t && t.prototype instanceof y ? t : y,
      a = Object.create(o.prototype),
      s = new A(i || []);
    return (n(a, "_invoke", { value: k(e, r, s) }), a);
  }
  function h(e, t, r) {
    try {
      return { type: "normal", arg: e.call(t, r) };
    } catch (e) {
      return { type: "throw", arg: e };
    }
  }
  t.wrap = l;
  var p = "suspendedStart",
    f = "suspendedYield",
    m = "executing",
    v = "completed",
    g = {};
  function y() {}
  function b() {}
  function S() {}
  var E = {};
  d(E, a, function () {
    return this;
  });
  var C = Object.getPrototypeOf,
    T = C && C(C(L([])));
  T && T !== r && i.call(T, a) && (E = T);
  var R = (S.prototype = y.prototype = Object.create(E));
  function I(e) {
    ["next", "throw", "return"].forEach(function (t) {
      d(e, t, function (e) {
        return this._invoke(t, e);
      });
    });
  }
  function _(e, t) {
    function r(n, o, a, s) {
      var c = h(e[n], e, o);
      if ("throw" !== c.type) {
        var u = c.arg,
          d = u.value;
        return d && "object" == typeof d && i.call(d, "__await")
          ? t.resolve(d.__await).then(
              function (e) {
                r("next", e, a, s);
              },
              function (e) {
                r("throw", e, a, s);
              },
            )
          : t.resolve(d).then(
              function (e) {
                ((u.value = e), a(u));
              },
              function (e) {
                return r("throw", e, a, s);
              },
            );
      }
      s(c.arg);
    }
    var o;
    n(this, "_invoke", {
      value: function (e, i) {
        function n() {
          return new t(function (t, n) {
            r(e, i, t, n);
          });
        }
        return (o = o ? o.then(n, n) : n());
      },
    });
  }
  function k(t, r, i) {
    var n = p;
    return function (o, a) {
      if (n === m) throw Error("Generator is already running");
      if (n === v) {
        if ("throw" === o) throw a;
        return { value: e, done: !0 };
      }
      for (i.method = o, i.arg = a; ; ) {
        var s = i.delegate;
        if (s) {
          var c = w(s, i);
          if (c) {
            if (c === g) continue;
            return c;
          }
        }
        if ("next" === i.method) i.sent = i._sent = i.arg;
        else if ("throw" === i.method) {
          if (n === p) throw ((n = v), i.arg);
          i.dispatchException(i.arg);
        } else "return" === i.method && i.abrupt("return", i.arg);
        n = m;
        var u = h(t, r, i);
        if ("normal" === u.type) {
          if (((n = i.done ? v : f), u.arg === g)) continue;
          return { value: u.arg, done: i.done };
        }
        "throw" === u.type && ((n = v), (i.method = "throw"), (i.arg = u.arg));
      }
    };
  }
  function w(t, r) {
    var i = r.method,
      n = t.iterator[i];
    if (n === e)
      return (
        (r.delegate = null),
        ("throw" === i &&
          t.iterator.return &&
          ((r.method = "return"),
          (r.arg = e),
          w(t, r),
          "throw" === r.method)) ||
          ("return" !== i &&
            ((r.method = "throw"),
            (r.arg = new TypeError(
              "The iterator does not provide a '" + i + "' method",
            )))),
        g
      );
    var o = h(n, t.iterator, r.arg);
    if ("throw" === o.type)
      return ((r.method = "throw"), (r.arg = o.arg), (r.delegate = null), g);
    var a = o.arg;
    return a
      ? a.done
        ? ((r[t.resultName] = a.value),
          (r.next = t.nextLoc),
          "return" !== r.method && ((r.method = "next"), (r.arg = e)),
          (r.delegate = null),
          g)
        : a
      : ((r.method = "throw"),
        (r.arg = new TypeError("iterator result is not an object")),
        (r.delegate = null),
        g);
  }
  function O(e) {
    var t = { tryLoc: e[0] };
    (1 in e && (t.catchLoc = e[1]),
      2 in e && ((t.finallyLoc = e[2]), (t.afterLoc = e[3])),
      this.tryEntries.push(t));
  }
  function P(e) {
    var t = e.completion || {};
    ((t.type = "normal"), delete t.arg, (e.completion = t));
  }
  function A(e) {
    ((this.tryEntries = [{ tryLoc: "root" }]),
      e.forEach(O, this),
      this.reset(!0));
  }
  function L(t) {
    if (t || "" === t) {
      var r = t[a];
      if (r) return r.call(t);
      if ("function" == typeof t.next) return t;
      if (!isNaN(t.length)) {
        var n = -1,
          o = function r() {
            for (; ++n < t.length; )
              if (i.call(t, n)) return ((r.value = t[n]), (r.done = !1), r);
            return ((r.value = e), (r.done = !0), r);
          };
        return (o.next = o);
      }
    }
    throw new TypeError(typeof t + " is not iterable");
  }
  return (
    (b.prototype = S),
    n(R, "constructor", { value: S, configurable: !0 }),
    n(S, "constructor", { value: b, configurable: !0 }),
    (b.displayName = d(S, u, "GeneratorFunction")),
    (t.isGeneratorFunction = function (e) {
      var t = "function" == typeof e && e.constructor;
      return (
        !!t && (t === b || "GeneratorFunction" === (t.displayName || t.name))
      );
    }),
    (t.mark = function (e) {
      return (
        Object.setPrototypeOf
          ? Object.setPrototypeOf(e, S)
          : ((e.__proto__ = S), d(e, u, "GeneratorFunction")),
        (e.prototype = Object.create(R)),
        e
      );
    }),
    (t.awrap = function (e) {
      return { __await: e };
    }),
    I(_.prototype),
    d(_.prototype, s, function () {
      return this;
    }),
    (t.AsyncIterator = _),
    (t.async = function (e, r, i, n, o) {
      void 0 === o && (o = Promise);
      var a = new _(l(e, r, i, n), o);
      return t.isGeneratorFunction(r)
        ? a
        : a.next().then(function (e) {
            return e.done ? e.value : a.next();
          });
    }),
    I(R),
    d(R, u, "Generator"),
    d(R, a, function () {
      return this;
    }),
    d(R, "toString", function () {
      return "[object Generator]";
    }),
    (t.keys = function (e) {
      var t = Object(e),
        r = [];
      for (var i in t) r.push(i);
      return (
        r.reverse(),
        function e() {
          for (; r.length; ) {
            var i = r.pop();
            if (i in t) return ((e.value = i), (e.done = !1), e);
          }
          return ((e.done = !0), e);
        }
      );
    }),
    (t.values = L),
    (A.prototype = {
      constructor: A,
      reset: function (t) {
        if (
          ((this.prev = 0),
          (this.next = 0),
          (this.sent = this._sent = e),
          (this.done = !1),
          (this.delegate = null),
          (this.method = "next"),
          (this.arg = e),
          this.tryEntries.forEach(P),
          !t)
        )
          for (var r in this)
            "t" === r.charAt(0) &&
              i.call(this, r) &&
              !isNaN(+r.slice(1)) &&
              (this[r] = e);
      },
      stop: function () {
        this.done = !0;
        var e = this.tryEntries[0].completion;
        if ("throw" === e.type) throw e.arg;
        return this.rval;
      },
      dispatchException: function (t) {
        if (this.done) throw t;
        var r = this;
        function n(i, n) {
          return (
            (s.type = "throw"),
            (s.arg = t),
            (r.next = i),
            n && ((r.method = "next"), (r.arg = e)),
            !!n
          );
        }
        for (var o = this.tryEntries.length - 1; o >= 0; --o) {
          var a = this.tryEntries[o],
            s = a.completion;
          if ("root" === a.tryLoc) return n("end");
          if (a.tryLoc <= this.prev) {
            var c = i.call(a, "catchLoc"),
              u = i.call(a, "finallyLoc");
            if (c && u) {
              if (this.prev < a.catchLoc) return n(a.catchLoc, !0);
              if (this.prev < a.finallyLoc) return n(a.finallyLoc);
            } else if (c) {
              if (this.prev < a.catchLoc) return n(a.catchLoc, !0);
            } else {
              if (!u) throw Error("try statement without catch or finally");
              if (this.prev < a.finallyLoc) return n(a.finallyLoc);
            }
          }
        }
      },
      abrupt: function (e, t) {
        for (var r = this.tryEntries.length - 1; r >= 0; --r) {
          var n = this.tryEntries[r];
          if (
            n.tryLoc <= this.prev &&
            i.call(n, "finallyLoc") &&
            this.prev < n.finallyLoc
          ) {
            var o = n;
            break;
          }
        }
        o &&
          ("break" === e || "continue" === e) &&
          o.tryLoc <= t &&
          t <= o.finallyLoc &&
          (o = null);
        var a = o ? o.completion : {};
        return (
          (a.type = e),
          (a.arg = t),
          o
            ? ((this.method = "next"), (this.next = o.finallyLoc), g)
            : this.complete(a)
        );
      },
      complete: function (e, t) {
        if ("throw" === e.type) throw e.arg;
        return (
          "break" === e.type || "continue" === e.type
            ? (this.next = e.arg)
            : "return" === e.type
              ? ((this.rval = this.arg = e.arg),
                (this.method = "return"),
                (this.next = "end"))
              : "normal" === e.type && t && (this.next = t),
          g
        );
      },
      finish: function (e) {
        for (var t = this.tryEntries.length - 1; t >= 0; --t) {
          var r = this.tryEntries[t];
          if (r.finallyLoc === e)
            return (this.complete(r.completion, r.afterLoc), P(r), g);
        }
      },
      catch: function (e) {
        for (var t = this.tryEntries.length - 1; t >= 0; --t) {
          var r = this.tryEntries[t];
          if (r.tryLoc === e) {
            var i = r.completion;
            if ("throw" === i.type) {
              var n = i.arg;
              P(r);
            }
            return n;
          }
        }
        throw Error("illegal catch attempt");
      },
      delegateYield: function (t, r, i) {
        return (
          (this.delegate = { iterator: L(t), resultName: r, nextLoc: i }),
          "next" === this.method && (this.arg = e),
          g
        );
      },
    }),
    t
  );
}
function u(e, t) {
  return (
    (u = Object.setPrototypeOf
      ? Object.setPrototypeOf.bind()
      : function (e, t) {
          return ((e.__proto__ = t), e);
        }),
    u(e, t)
  );
}
function d(e, t, r, i) {
  var a = n(o(1 & i ? e.prototype : e), t, r);
  return 2 & i && "function" == typeof a
    ? function (e) {
        return a.apply(r, e);
      }
    : a;
}
function l(e) {
  var t = (function (e, t) {
    if ("object" != typeof e || !e) return e;
    var r = e[Symbol.toPrimitive];
    if (void 0 !== r) {
      var i = r.call(e, t || "default");
      if ("object" != typeof i) return i;
      throw new TypeError("@@toPrimitive must return a primitive value.");
    }
    return ("string" === t ? String : Number)(e);
  })(e, "string");
  return "symbol" == typeof t ? t : t + "";
}
function h(e) {
  return (
    (h =
      "function" == typeof Symbol && "symbol" == typeof Symbol.iterator
        ? function (e) {
            return typeof e;
          }
        : function (e) {
            return e &&
              "function" == typeof Symbol &&
              e.constructor === Symbol &&
              e !== Symbol.prototype
              ? "symbol"
              : typeof e;
          }),
    h(e)
  );
}
function p(e) {
  var t = "function" == typeof Map ? new Map() : void 0;
  return (
    (p = function (e) {
      if (
        null === e ||
        !(function (e) {
          try {
            return -1 !== Function.toString.call(e).indexOf("[native code]");
          } catch (t) {
            return "function" == typeof e;
          }
        })(e)
      )
        return e;
      if ("function" != typeof e)
        throw new TypeError(
          "Super expression must either be null or a function",
        );
      if (void 0 !== t) {
        if (t.has(e)) return t.get(e);
        t.set(e, r);
      }
      function r() {
        return (function (e, t, r) {
          if (s()) return Reflect.construct.apply(null, arguments);
          var i = [null];
          i.push.apply(i, t);
          var n = new (e.bind.apply(e, i))();
          return (r && u(n, r.prototype), n);
        })(e, arguments, o(this).constructor);
      }
      return (
        (r.prototype = Object.create(e.prototype, {
          constructor: {
            value: r,
            enumerable: !1,
            writable: !0,
            configurable: !0,
          },
        })),
        u(r, e)
      );
    }),
    p(e)
  );
}
function f(e, t, r, i) {
  return new (r || (r = Promise))(function (n, o) {
    function a(e) {
      try {
        c(i.next(e));
      } catch (e) {
        o(e);
      }
    }
    function s(e) {
      try {
        c(i.throw(e));
      } catch (e) {
        o(e);
      }
    }
    function c(e) {
      var t;
      e.done
        ? n(e.value)
        : ((t = e.value),
          t instanceof r
            ? t
            : new r(function (e) {
                e(t);
              })).then(a, s);
    }
    c((i = i.apply(e, t || [])).next());
  });
}
function m(e, t, r, i) {
  if ("a" === r && !i)
    throw new TypeError("Private accessor was defined without a getter");
  if ("function" == typeof t ? e !== t || !i : !t.has(e))
    throw new TypeError(
      "Cannot read private member from an object whose class did not declare it",
    );
  return "m" === r ? i : "a" === r ? i.call(e) : i ? i.value : t.get(e);
}
function v(e, t, r, i, n) {
  if ("m" === i) throw new TypeError("Private method is not writable");
  if ("a" === i && !n)
    throw new TypeError("Private accessor was defined without a setter");
  if ("function" == typeof t ? e !== t || !n : !t.has(e))
    throw new TypeError(
      "Cannot write private member to an object whose class did not declare it",
    );
  return ("a" === i ? n.call(e, r) : n ? (n.value = r) : t.set(e, r), r);
}
var g, y, b, S, E;
"function" == typeof SuppressedError && SuppressedError;
var C,
  T,
  R,
  I = 0,
  _ = (function () {
    return i(
      function e(r) {
        var i,
          n = this;
        (t(this, e),
          g.set(this, I),
          y.set(this, {}),
          b.set(this, []),
          S.set(this, function (e, t, r) {
            if ("function" != typeof t)
              throw TypeError("listener must be a function");
            (-1 === m(n, b, "f").indexOf(e) && m(n, b, "f").push(e),
              (m(n, y, "f")[e] = m(n, y, "f")[e] || []),
              m(n, y, "f")[e].push({ once: r || !1, fn: t }));
          }),
          E.set(this, function (e, t) {
            var r = m(n, y, "f")[e],
              i = [];
            (null == r ||
              r.forEach(function (e, r) {
                (e.fn.apply(null, t), e.once && i.unshift(r));
              }),
              null == i ||
                i.forEach(function (e) {
                  r.splice(e, 1);
                }));
          }),
          v(
            this,
            g,
            null !== (i = null == r ? void 0 : r.emitDelay) && void 0 !== i
              ? i
              : I,
            "f",
          ));
      },
      [
        {
          key: "on",
          value: function (e, t) {
            return (m(this, S, "f").call(this, e, t, !1), this);
          },
        },
        {
          key: "once",
          value: function (e, t) {
            return (m(this, S, "f").call(this, e, t, !0), this);
          },
        },
        {
          key: "off",
          value: function (e, t) {
            var r = m(this, b, "f").indexOf(e);
            if (e && -1 !== r)
              if (t) {
                var i = [],
                  n = m(this, y, "f")[e];
                (null == n ||
                  n.forEach(function (e, r) {
                    e.fn === t && i.unshift(r);
                  }),
                  null == i ||
                    i.forEach(function (e) {
                      n.splice(e, 1);
                    }),
                  n.length ||
                    (m(this, b, "f").splice(r, 1), delete m(this, y, "f")[e]));
              } else (delete m(this, y, "f")[e], m(this, b, "f").splice(r, 1));
            return this;
          },
        },
        {
          key: "removeAllListeners",
          value: function () {
            return (v(this, y, {}, "f"), v(this, b, [], "f"), this);
          },
        },
        {
          key: "emit",
          value: function (e) {
            for (
              var t = this,
                r = arguments.length,
                i = new Array(r > 1 ? r - 1 : 0),
                n = 1;
              n < r;
              n++
            )
              i[n - 1] = arguments[n];
            m(this, g, "f")
              ? setTimeout(
                  function () {
                    m(t, E, "f").call(t, e, i);
                  },
                  m(this, g, "f"),
                )
              : m(this, E, "f").call(this, e, i);
          },
        },
        {
          key: "emitSync",
          value: function (e) {
            for (
              var t = arguments.length, r = new Array(t > 1 ? t - 1 : 0), i = 1;
              i < t;
              i++
            )
              r[i - 1] = arguments[i];
            m(this, E, "f").call(this, e, r);
          },
        },
        {
          key: "destroy",
          value: function () {
            (v(this, y, {}, "f"), v(this, b, [], "f"));
          },
        },
      ],
    );
  })();
((g = new WeakMap()),
  (y = new WeakMap()),
  (b = new WeakMap()),
  (S = new WeakMap()),
  (E = new WeakMap()),
  (function (e) {
    ((e.connected = "connected"),
      (e.disconnected = "disconnected"),
      (e.frameBegin = "frameBegin"),
      (e.frameEnd = "frameEnd"),
      (e.duration = "duration"),
      (e.actionBegin = "actionBegin"),
      (e.actionEnd = "actionEnd"),
      (e.nlp = "nlp"),
      (e.asr = "asr"),
      (e.error = "error"),
      (e.extend = "extend"));
  })(C || (C = {})),
  (function (e) {
    ((e.play = "play"),
      (e.waiting = "waiting"),
      (e.playing = "playing"),
      (e.stop = "stop"),
      (e.playNotAllowed = "not-allowed"),
      (e.error = "error"));
  })(T || (T = {})),
  (function (e) {
    ((e.InvalidParam = "InvalidParam"),
      (e.InvalidResponse = "InvalidResponse"),
      (e.ContextError = "ContextError"),
      (e.NetworkError = "NetworkError"),
      (e.ConnectError = "ConnectError"),
      (e.InvalidConnect = "InvalidConnect"),
      (e.MediaError = "MediaError"),
      (e.UserMediaError = "UserMediaError"));
  })(R || (R = {})));
var k = (function (r) {
    function n(r, i, o, a, s) {
      var c;
      return (
        t(this, n),
        ((c = e(this, n, [r])).name = o),
        (c.code = i),
        (c.aside = s || ""),
        (c.sid = a || ""),
        c
      );
    }
    return (a(n, p(Error)), i(n));
  })(),
  w = function () {
    var e = { resolve: function () {}, reject: function () {} };
    return {
      promise: new Promise(function (t, r) {
        ((e.resolve = t), (e.reject = r));
      }),
      controller: e,
    };
  },
  O = { code: "700003", message: "无效的流数据" },
  P = { code: "700002", message: "播放不允许" },
  A = { code: "700005", message: "当前设备不支持 H.264" },
  L = { code: "700009", message: "播放失败" };
function x(e, t, r) {
  return (
    t in e
      ? Object.defineProperty(e, t, {
          value: r,
          enumerable: !0,
          configurable: !0,
          writable: !0,
        })
      : (e[t] = r),
    e
  );
}
function D(e, t) {
  (null == t || t > e.length) && (t = e.length);
  for (var r = 0, i = new Array(t); r < t; r++) i[r] = e[r];
  return i;
}
function M(e, t) {
  if (e) {
    if ("string" == typeof e) return D(e, t);
    var r = Object.prototype.toString.call(e).slice(8, -1);
    return (
      "Object" === r && e.constructor && (r = e.constructor.name),
      "Map" === r || "Set" === r
        ? Array.from(e)
        : "Arguments" === r ||
            /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
          ? D(e, t)
          : void 0
    );
  }
}
function U(e, t) {
  return (
    (function (e) {
      if (Array.isArray(e)) return e;
    })(e) ||
    (function (e, t) {
      if ("undefined" != typeof Symbol && Symbol.iterator in Object(e)) {
        var r = [],
          i = !0,
          n = !1,
          o = void 0;
        try {
          for (
            var a, s = e[Symbol.iterator]();
            !(i = (a = s.next()).done) &&
            (r.push(a.value), !t || r.length !== t);
            i = !0
          );
        } catch (e) {
          ((n = !0), (o = e));
        } finally {
          try {
            i || null == s.return || s.return();
          } finally {
            if (n) throw o;
          }
        }
        return r;
      }
    })(e, t) ||
    M(e, t) ||
    (function () {
      throw new TypeError(
        "Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
      );
    })()
  );
}
function N(e, t, r, i, n, o, a) {
  try {
    var s = e[o](a),
      c = s.value;
  } catch (e) {
    return void r(e);
  }
  s.done ? t(c) : Promise.resolve(c).then(i, n);
}
function V(e) {
  return function () {
    var t = this,
      r = arguments;
    return new Promise(function (i, n) {
      var o = e.apply(t, r);
      function a(e) {
        N(o, i, n, a, s, "next", e);
      }
      function s(e) {
        N(o, i, n, a, s, "throw", e);
      }
      a(void 0);
    });
  };
}
function j(e) {
  return (
    (function (e) {
      if (Array.isArray(e)) return D(e);
    })(e) ||
    (function (e) {
      if ("undefined" != typeof Symbol && Symbol.iterator in Object(e))
        return Array.from(e);
    })(e) ||
    M(e) ||
    (function () {
      throw new TypeError(
        "Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
      );
    })()
  );
}
function F(e, t) {
  if (!(e instanceof t))
    throw new TypeError("Cannot call a class as a function");
}
function B(e, t) {
  for (var r = 0; r < t.length; r++) {
    var i = t[r];
    ((i.enumerable = i.enumerable || !1),
      (i.configurable = !0),
      "value" in i && (i.writable = !0),
      Object.defineProperty(e, i.key, i));
  }
}
function W(e, t, r) {
  return (t && B(e.prototype, t), r && B(e, r), e);
}
function G(e) {
  var t = { exports: {} };
  return (e(t, t.exports), t.exports);
}
var H = G(function (e) {
    var t = (function (e) {
      var t,
        r = Object.prototype,
        i = r.hasOwnProperty,
        n = "function" == typeof Symbol ? Symbol : {},
        o = n.iterator || "@@iterator",
        a = n.asyncIterator || "@@asyncIterator",
        s = n.toStringTag || "@@toStringTag";
      function c(e, t, r) {
        return (
          Object.defineProperty(e, t, {
            value: r,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          }),
          e[t]
        );
      }
      try {
        c({}, "");
      } catch (e) {
        c = function (e, t, r) {
          return (e[t] = r);
        };
      }
      function u(e, t, r, i) {
        var n = Object.create(
            (t && t.prototype instanceof v ? t : v).prototype,
          ),
          o = new w(i || []);
        return (
          (n._invoke = (function (e, t, r) {
            var i = l;
            return function (n, o) {
              if (i === p) throw new Error("Generator is already running");
              if (i === f) {
                if ("throw" === n) throw o;
                return P();
              }
              for (r.method = n, r.arg = o; ; ) {
                var a = r.delegate;
                if (a) {
                  var s = I(a, r);
                  if (s) {
                    if (s === m) continue;
                    return s;
                  }
                }
                if ("next" === r.method) r.sent = r._sent = r.arg;
                else if ("throw" === r.method) {
                  if (i === l) throw ((i = f), r.arg);
                  r.dispatchException(r.arg);
                } else "return" === r.method && r.abrupt("return", r.arg);
                i = p;
                var c = d(e, t, r);
                if ("normal" === c.type) {
                  if (((i = r.done ? f : h), c.arg === m)) continue;
                  return { value: c.arg, done: r.done };
                }
                "throw" === c.type &&
                  ((i = f), (r.method = "throw"), (r.arg = c.arg));
              }
            };
          })(e, r, o)),
          n
        );
      }
      function d(e, t, r) {
        try {
          return { type: "normal", arg: e.call(t, r) };
        } catch (e) {
          return { type: "throw", arg: e };
        }
      }
      e.wrap = u;
      var l = "suspendedStart",
        h = "suspendedYield",
        p = "executing",
        f = "completed",
        m = {};
      function v() {}
      function g() {}
      function y() {}
      var b = {};
      b[o] = function () {
        return this;
      };
      var S = Object.getPrototypeOf,
        E = S && S(S(O([])));
      E && E !== r && i.call(E, o) && (b = E);
      var C = (y.prototype = v.prototype = Object.create(b));
      function T(e) {
        ["next", "throw", "return"].forEach(function (t) {
          c(e, t, function (e) {
            return this._invoke(t, e);
          });
        });
      }
      function R(e, t) {
        function r(n, o, a, s) {
          var c = d(e[n], e, o);
          if ("throw" !== c.type) {
            var u = c.arg,
              l = u.value;
            return l && "object" == typeof l && i.call(l, "__await")
              ? t.resolve(l.__await).then(
                  function (e) {
                    r("next", e, a, s);
                  },
                  function (e) {
                    r("throw", e, a, s);
                  },
                )
              : t.resolve(l).then(
                  function (e) {
                    ((u.value = e), a(u));
                  },
                  function (e) {
                    return r("throw", e, a, s);
                  },
                );
          }
          s(c.arg);
        }
        var n;
        this._invoke = function (e, i) {
          function o() {
            return new t(function (t, n) {
              r(e, i, t, n);
            });
          }
          return (n = n ? n.then(o, o) : o());
        };
      }
      function I(e, r) {
        var i = e.iterator[r.method];
        if (i === t) {
          if (((r.delegate = null), "throw" === r.method)) {
            if (
              e.iterator.return &&
              ((r.method = "return"),
              (r.arg = t),
              I(e, r),
              "throw" === r.method)
            )
              return m;
            ((r.method = "throw"),
              (r.arg = new TypeError(
                "The iterator does not provide a 'throw' method",
              )));
          }
          return m;
        }
        var n = d(i, e.iterator, r.arg);
        if ("throw" === n.type)
          return (
            (r.method = "throw"),
            (r.arg = n.arg),
            (r.delegate = null),
            m
          );
        var o = n.arg;
        return o
          ? o.done
            ? ((r[e.resultName] = o.value),
              (r.next = e.nextLoc),
              "return" !== r.method && ((r.method = "next"), (r.arg = t)),
              (r.delegate = null),
              m)
            : o
          : ((r.method = "throw"),
            (r.arg = new TypeError("iterator result is not an object")),
            (r.delegate = null),
            m);
      }
      function _(e) {
        var t = { tryLoc: e[0] };
        (1 in e && (t.catchLoc = e[1]),
          2 in e && ((t.finallyLoc = e[2]), (t.afterLoc = e[3])),
          this.tryEntries.push(t));
      }
      function k(e) {
        var t = e.completion || {};
        ((t.type = "normal"), delete t.arg, (e.completion = t));
      }
      function w(e) {
        ((this.tryEntries = [{ tryLoc: "root" }]),
          e.forEach(_, this),
          this.reset(!0));
      }
      function O(e) {
        if (e) {
          var r = e[o];
          if (r) return r.call(e);
          if ("function" == typeof e.next) return e;
          if (!isNaN(e.length)) {
            var n = -1,
              a = function r() {
                for (; ++n < e.length; )
                  if (i.call(e, n)) return ((r.value = e[n]), (r.done = !1), r);
                return ((r.value = t), (r.done = !0), r);
              };
            return (a.next = a);
          }
        }
        return { next: P };
      }
      function P() {
        return { value: t, done: !0 };
      }
      return (
        (g.prototype = C.constructor = y),
        (y.constructor = g),
        (g.displayName = c(y, s, "GeneratorFunction")),
        (e.isGeneratorFunction = function (e) {
          var t = "function" == typeof e && e.constructor;
          return (
            !!t &&
            (t === g || "GeneratorFunction" === (t.displayName || t.name))
          );
        }),
        (e.mark = function (e) {
          return (
            Object.setPrototypeOf
              ? Object.setPrototypeOf(e, y)
              : ((e.__proto__ = y), c(e, s, "GeneratorFunction")),
            (e.prototype = Object.create(C)),
            e
          );
        }),
        (e.awrap = function (e) {
          return { __await: e };
        }),
        T(R.prototype),
        (R.prototype[a] = function () {
          return this;
        }),
        (e.AsyncIterator = R),
        (e.async = function (t, r, i, n, o) {
          void 0 === o && (o = Promise);
          var a = new R(u(t, r, i, n), o);
          return e.isGeneratorFunction(r)
            ? a
            : a.next().then(function (e) {
                return e.done ? e.value : a.next();
              });
        }),
        T(C),
        c(C, s, "Generator"),
        (C[o] = function () {
          return this;
        }),
        (C.toString = function () {
          return "[object Generator]";
        }),
        (e.keys = function (e) {
          var t = [];
          for (var r in e) t.push(r);
          return (
            t.reverse(),
            function r() {
              for (; t.length; ) {
                var i = t.pop();
                if (i in e) return ((r.value = i), (r.done = !1), r);
              }
              return ((r.done = !0), r);
            }
          );
        }),
        (e.values = O),
        (w.prototype = {
          constructor: w,
          reset: function (e) {
            if (
              ((this.prev = 0),
              (this.next = 0),
              (this.sent = this._sent = t),
              (this.done = !1),
              (this.delegate = null),
              (this.method = "next"),
              (this.arg = t),
              this.tryEntries.forEach(k),
              !e)
            )
              for (var r in this)
                "t" === r.charAt(0) &&
                  i.call(this, r) &&
                  !isNaN(+r.slice(1)) &&
                  (this[r] = t);
          },
          stop: function () {
            this.done = !0;
            var e = this.tryEntries[0].completion;
            if ("throw" === e.type) throw e.arg;
            return this.rval;
          },
          dispatchException: function (e) {
            if (this.done) throw e;
            var r = this;
            function n(i, n) {
              return (
                (s.type = "throw"),
                (s.arg = e),
                (r.next = i),
                n && ((r.method = "next"), (r.arg = t)),
                !!n
              );
            }
            for (var o = this.tryEntries.length - 1; o >= 0; --o) {
              var a = this.tryEntries[o],
                s = a.completion;
              if ("root" === a.tryLoc) return n("end");
              if (a.tryLoc <= this.prev) {
                var c = i.call(a, "catchLoc"),
                  u = i.call(a, "finallyLoc");
                if (c && u) {
                  if (this.prev < a.catchLoc) return n(a.catchLoc, !0);
                  if (this.prev < a.finallyLoc) return n(a.finallyLoc);
                } else if (c) {
                  if (this.prev < a.catchLoc) return n(a.catchLoc, !0);
                } else {
                  if (!u)
                    throw new Error("try statement without catch or finally");
                  if (this.prev < a.finallyLoc) return n(a.finallyLoc);
                }
              }
            }
          },
          abrupt: function (e, t) {
            for (var r = this.tryEntries.length - 1; r >= 0; --r) {
              var n = this.tryEntries[r];
              if (
                n.tryLoc <= this.prev &&
                i.call(n, "finallyLoc") &&
                this.prev < n.finallyLoc
              ) {
                var o = n;
                break;
              }
            }
            o &&
              ("break" === e || "continue" === e) &&
              o.tryLoc <= t &&
              t <= o.finallyLoc &&
              (o = null);
            var a = o ? o.completion : {};
            return (
              (a.type = e),
              (a.arg = t),
              o
                ? ((this.method = "next"), (this.next = o.finallyLoc), m)
                : this.complete(a)
            );
          },
          complete: function (e, t) {
            if ("throw" === e.type) throw e.arg;
            return (
              "break" === e.type || "continue" === e.type
                ? (this.next = e.arg)
                : "return" === e.type
                  ? ((this.rval = this.arg = e.arg),
                    (this.method = "return"),
                    (this.next = "end"))
                  : "normal" === e.type && t && (this.next = t),
              m
            );
          },
          finish: function (e) {
            for (var t = this.tryEntries.length - 1; t >= 0; --t) {
              var r = this.tryEntries[t];
              if (r.finallyLoc === e)
                return (this.complete(r.completion, r.afterLoc), k(r), m);
            }
          },
          catch: function (e) {
            for (var t = this.tryEntries.length - 1; t >= 0; --t) {
              var r = this.tryEntries[t];
              if (r.tryLoc === e) {
                var i = r.completion;
                if ("throw" === i.type) {
                  var n = i.arg;
                  k(r);
                }
                return n;
              }
            }
            throw new Error("illegal catch attempt");
          },
          delegateYield: function (e, r, i) {
            return (
              (this.delegate = { iterator: O(e), resultName: r, nextLoc: i }),
              "next" === this.method && (this.arg = t),
              m
            );
          },
        }),
        e
      );
    })(e.exports);
    try {
      regeneratorRuntime = t;
    } catch (e) {
      Function("r", "regeneratorRuntime = r")(t);
    }
  }),
  J = (function () {
    function e(t) {
      (F(this, e), (this.events = {}), (this.logger = t));
    }
    return (
      W(e, [
        {
          key: "on",
          value: function (e, t) {
            var r = this.events[e] || [];
            return (r.push(t), (this.events[e] = r), this);
          },
        },
        {
          key: "once",
          value: function (e, t) {
            var r = this;
            this.on(e, function i() {
              for (
                var n = arguments.length, o = new Array(n), a = 0;
                a < n;
                a++
              )
                o[a] = arguments[a];
              (t.apply(null, o), r.off(e, i));
            });
          },
        },
        {
          key: "off",
          value: function (e, t) {
            if ("*" === e) return ((this.events = {}), this);
            var r = this.events[e];
            return (
              (this.events[e] =
                r &&
                r.filter(function (e) {
                  return e !== t;
                })),
              this
            );
          },
        },
        {
          key: "emit",
          value: function (e) {
            for (
              var t = arguments.length, r = new Array(t > 1 ? t - 1 : 0), i = 1;
              i < t;
              i++
            )
              r[i - 1] = arguments[i];
            "network-quality" !== e &&
              "audio-volume" !== e &&
              "mic-volume" !== e &&
              this.logger &&
              this.logger.info("Emit event name:", e);
            var n = this.events[e];
            return (
              n &&
                n.forEach(function (e) {
                  return e.apply(null, r);
                }),
              this
            );
          },
        },
      ]),
      e
    );
  })(),
  z = new Map();
(z.set("anchor", {
  publish: { audio: !0, video: !0 },
  subscribe: { audio: !0, video: !0 },
  control: !0,
}),
  z.set("audience", {
    publish: { audio: !1, video: !1 },
    subscribe: { audio: !0, video: !0 },
    control: !1,
  }));
var K, Y, q, X;
(!(function (e) {
  ((e[(e.New = 0)] = "New"),
    (e[(e.Joining = 1)] = "Joining"),
    (e[(e.Joined = 2)] = "Joined"),
    (e[(e.Leaving = 3)] = "Leaving"),
    (e[(e.Leaved = 4)] = "Leaved"));
})(K || (K = {})),
  (function (e) {
    ((e[(e.Create = 0)] = "Create"),
      (e[(e.Publishing = 1)] = "Publishing"),
      (e[(e.Published = 2)] = "Published"),
      (e[(e.Unpublished = 3)] = "Unpublished"));
  })(Y || (Y = {})),
  (function (e) {
    ((e[(e.Create = 0)] = "Create"),
      (e[(e.Subscribing = 1)] = "Subscribing"),
      (e[(e.Subscribed = 2)] = "Subscribed"),
      (e[(e.Unsubscribed = 3)] = "Unsubscribed"));
  })(q || (q = {})),
  (function (e) {
    ((e[(e.Invalid = 0)] = "Invalid"),
      (e[(e.AudioOnly = 1)] = "AudioOnly"),
      (e[(e.VideoOnly = 2)] = "VideoOnly"),
      (e[(e.AudioVideo = 3)] = "AudioVideo"));
  })(X || (X = {})));
var Q = "auxiliary",
  $ = "error";
function Z(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function ee(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? Z(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : Z(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
var te = ee(
  ee(
    ee(
      ee(
        ee(
          ee(
            {},
            {
              INVALID_PARAMETER: 4096,
              INVALID_OPERATION: 4097,
              NOT_SUPPORTED: 4098,
            },
          ),
          {
            JOIN_ROOM_FAILED: 16388,
            CREATE_OFFER_FAILED: 16389,
            LEAVE_ROOM_FAILED: 16390,
            PUBLISH_STREAM_FAILED: 16391,
            UNPUBLISH_STREAM_FAILED: 16392,
            SUBSCRIBE_FAILED: 16393,
            UNSUBSCRIBE_FAILED: 16400,
            SWITCH_ROLE_ERROR: 16401,
            INVALID_TRANSPORT_STATA: 16402,
            LOCAL_AUDIO_STATA_ERROR: 16403,
            LOCAL_VIDEO_STATA_ERROR: 16404,
            REMOTE_AUDIO_STATA_ERROR: 16405,
            REMOTE_VIDEO_STATA_ERROR: 16406,
            LOCAL_SWITCH_SIMULCAST: 16407,
            REMOTE_SWITCH_SIMULCAST: 16408,
            SUBSCRIPTION_TIMEOUT: 16450,
            UNKNOWN: "0xFFFF",
          },
        ),
        {
          INIT_STREAM_FAILED: 12289,
          PLAY_STREAM_ERROR: 12290,
          SET_AUDIO_OUTPUT_FAILED: 12291,
          SET_VIDEO_PROFILE_ERROR: 12292,
          SET_SCREEN_SHARE_FAILED: 12293,
          SWITCH_DEVICE_FAILED: 12294,
          ADD_TRACK_FAILED: 12295,
          REMOVE_TRACK_FAILED: 12296,
          REPLACE_TRACK_FAILED: 12297,
          PLAY_NOT_ALLOWED: 16451,
          DEVICE_AUTO_RECOVER_FAILED: 16452,
          CANDIDATE_COLLECT_FAILED: 16453,
          RTCPEERCONNECTION_SATE_FAILED: 16480,
        },
      ),
      {
        DEVICE_NOT_FOUND: 256,
        H264_NOT_SUPPORTED: 257,
        CAMERAS_NOT_FOUND: 258,
        MICROPHONES_NOT_FOUND: 259,
        SPEAKERS_NOT_FOUND: 260,
        OS_NOT_SUPPORTED: 261,
        WEBRTC_NOT_SUPPORTED: 262,
        BROWSER_NOT_SUPPORTED: 263,
      },
    ),
    {
      SIGNAL_CHANNEL_SETUP_FAILED: 20481,
      SIGNAL_CHANNEL_RECONNECTION_FAILED: 20482,
      SERVER_TIMEOUT: 20483,
    },
  ),
  {
    SERVER_UNKNOWN_ERROR: -10011,
    AUTHORIZATION_FAILED: -10013,
    GET_SERVER_NODE_FAILED: -10015,
    REQUEST_TIMEOUT: -10020,
  },
);
function re(e, t) {
  return (re =
    Object.setPrototypeOf ||
    function (e, t) {
      return ((e.__proto__ = t), e);
    })(e, t);
}
function ie(e, t) {
  if ("function" != typeof t && null !== t)
    throw new TypeError("Super expression must either be null or a function");
  ((e.prototype = Object.create(t && t.prototype, {
    constructor: { value: e, writable: !0, configurable: !0 },
  })),
    t && re(e, t));
}
function ne(e) {
  return (ne =
    "function" == typeof Symbol && "symbol" == typeof Symbol.iterator
      ? function (e) {
          return typeof e;
        }
      : function (e) {
          return e &&
            "function" == typeof Symbol &&
            e.constructor === Symbol &&
            e !== Symbol.prototype
            ? "symbol"
            : typeof e;
        })(e);
}
function oe(e) {
  if (void 0 === e)
    throw new ReferenceError(
      "this hasn't been initialised - super() hasn't been called",
    );
  return e;
}
function ae(e, t) {
  return !t || ("object" !== ne(t) && "function" != typeof t) ? oe(e) : t;
}
function se(e) {
  return (se = Object.setPrototypeOf
    ? Object.getPrototypeOf
    : function (e) {
        return e.__proto__ || Object.getPrototypeOf(e);
      })(e);
}
function ce(e, t, r) {
  return (ce = (function () {
    if ("undefined" == typeof Reflect || !Reflect.construct) return !1;
    if (Reflect.construct.sham) return !1;
    if ("function" == typeof Proxy) return !0;
    try {
      return (
        Boolean.prototype.valueOf.call(
          Reflect.construct(Boolean, [], function () {}),
        ),
        !0
      );
    } catch (e) {
      return !1;
    }
  })()
    ? Reflect.construct
    : function (e, t, r) {
        var i = [null];
        i.push.apply(i, t);
        var n = new (Function.bind.apply(e, i))();
        return (r && re(n, r.prototype), n);
      }).apply(null, arguments);
}
function ue(e) {
  var t = "function" == typeof Map ? new Map() : void 0;
  return (ue = function (e) {
    if (null === e || -1 === Function.toString.call(e).indexOf("[native code]"))
      return e;
    if ("function" != typeof e)
      throw new TypeError("Super expression must either be null or a function");
    if (void 0 !== t) {
      if (t.has(e)) return t.get(e);
      t.set(e, r);
    }
    function r() {
      return ce(e, arguments, se(this).constructor);
    }
    return (
      (r.prototype = Object.create(e.prototype, {
        constructor: {
          value: r,
          enumerable: !1,
          writable: !0,
          configurable: !0,
        },
      })),
      re(r, e)
    );
  })(e);
}
var de = (function (e) {
    ie(r, ue(Error));
    var t = (function (e) {
      var t = (function () {
        if ("undefined" == typeof Reflect || !Reflect.construct) return !1;
        if (Reflect.construct.sham) return !1;
        if ("function" == typeof Proxy) return !0;
        try {
          return (
            Boolean.prototype.valueOf.call(
              Reflect.construct(Boolean, [], function () {}),
            ),
            !0
          );
        } catch (e) {
          return !1;
        }
      })();
      return function () {
        var r,
          i = se(e);
        if (t) {
          var n = se(this).constructor;
          r = Reflect.construct(i, arguments, n);
        } else r = i.apply(this, arguments);
        return ae(this, r);
      };
    })(r);
    function r(e) {
      var i;
      (F(this, r),
        ((i = t.call(this)).code = e.code),
        e.name && (i.name = e.name));
      var n = e.message instanceof Error ? e.message.message : e.message;
      return ((i.message = n), i);
    }
    return (
      W(r, [
        {
          key: "getCode",
          value: function () {
            return this.code;
          },
        },
      ]),
      r
    );
  })(),
  le = (function () {
    function e() {
      var t = this;
      (F(this, e),
        (this.context = new (
          window.AudioContext || window.webkitAudioContext
        )()),
        (this.instant = 0),
        (this.slow = 0),
        (this.clip = 0),
        (this.script = this.context.createScriptProcessor(2048, 1, 1)),
        (this.script.onaudioprocess = function (e) {
          var r,
            i = e.inputBuffer.getChannelData(0),
            n = 0,
            o = 0;
          for (r = 0; r < i.length; ++r)
            ((n += i[r] * i[r]), Math.abs(i[r]) > 0.99 && (o += 1));
          ((t.instant = Math.sqrt(n / i.length)),
            (t.slow = 0.95 * t.slow + 0.05 * t.instant),
            (t.clip = o / i.length));
        }));
    }
    return (
      W(e, [
        {
          key: "connectToSource",
          value: function (e) {
            try {
              var t = new MediaStream();
              (t.addTrack(e),
                (this.mic = this.context.createMediaStreamSource(t)),
                this.mic.connect(this.script),
                this.script.connect(this.context.destination));
            } catch (e) {
              console.error("soundMeter connectoToSource error: " + e);
            }
          },
        },
        {
          key: "stop",
          value: function () {
            (this.mic.disconnect(), this.script.disconnect());
          },
        },
        {
          key: "resume",
          value: function () {
            this.context && this.context.resume();
          },
        },
        {
          key: "getVolume",
          value: function () {
            return this.instant.toFixed(2);
          },
        },
      ]),
      e
    );
  })();
function he() {
  var e = navigator.userAgent,
    t = navigator.connection,
    r = e.match(/NetType\/\w+/) ? e.match(/NetType\/\w+/)[0] : "";
  "3gnet" === (r = r.toLowerCase().replace("nettype/", "")) && (r = "3g");
  var i = t && t.type && t.type.toLowerCase(),
    n = t && t.effectiveType && t.effectiveType.toLowerCase();
  "slow-2" === n && (n = "2g");
  var o = r || "unknown";
  if (i)
    switch (i) {
      case "cellular":
      case "wimax":
        o = n || "unknown";
        break;
      case "wifi":
        o = "wifi";
        break;
      case "ethernet":
        o = "wired";
        break;
      case "none":
      case "other":
      case "unknown":
        o = "unknown";
    }
  return o;
}
var pe = {
  Android: function () {
    return navigator.userAgent.match(/Android/i);
  },
  BlackBerry: function () {
    return navigator.userAgent.match(/BlackBerry|BB10/i);
  },
  iOS: function () {
    return navigator.userAgent.match(/iPhone|iPad|iPod/i);
  },
  Opera: function () {
    return navigator.userAgent.match(/Opera Mini/i);
  },
  Windows: function () {
    return navigator.userAgent.match(/IEMobile/i);
  },
  wx: function () {
    return navigator.userAgent.match(/MicroMessenger/i);
  },
  any: function () {
    return pe.BlackBerry() || pe.Opera() || pe.Windows();
  },
  getOsName: function () {
    var e = "Unknown OS";
    return (
      pe.Android() && (e = "Android"),
      pe.BlackBerry() && (e = "BlackBerry"),
      pe.iOS() && (e = "iOS"),
      pe.Opera() && (e = "Opera Mini"),
      pe.Windows() && (e = "Windows"),
      pe.wx() && (e = "wx"),
      { osName: e, type: "mobile" }
    );
  },
};
function fe() {
  var e,
    t,
    r = navigator.userAgent.toLocaleLowerCase();
  if (-1 != r.indexOf("firefox")) e = "Firefox";
  else if (-1 != r.indexOf("trident"))
    ((e = "IE"), -1 == r.indexOf("ie") && (t = 11));
  else if (-1 != r.indexOf("opr")) e = "OPR";
  else if (-1 != r.indexOf("edge")) e = "Edge";
  else if (-1 != r.indexOf("chrome")) e = "Chrome";
  else if (-1 != r.indexOf("safari")) {
    e = "Safari";
    var i = r.match(/(version).*?([\d.]+)/);
    t = i ? i[2] : "";
  } else e = "未知浏览器";
  if (void 0 === t) {
    var n = r.match(/(firefox|trident|opr|chrome|safari).*?([\d.]+)/);
    t = n ? n[2] : "";
  }
  return { browser: e, version: t };
}
var me,
  ve = (function () {
    function e(t) {
      (F(this, e),
        (this.stream = t.stream),
        (this.userId = t.stream.userId),
        (this.log = t.stream.logger),
        (this.track = t.track),
        (this.div = t.div),
        (this.muted = t.muted),
        (this.outputDeviceId = t.deviceId),
        (this.volume = t.volume),
        (this.element = null),
        (this.state = "NONE"),
        (this.pausedRetryCount = 5),
        (this._emitter = new J()),
        (this.handleEleEventPlaying = this.eleEventPlaying.bind(this)),
        (this.handleEleEventEnded = this.eleEventEnded.bind(this)),
        (this.handleEleEventPause = this.eleEventPause.bind(this)),
        (this.handleTrackEventEnded = this.trackEventEnded.bind(this)),
        (this.handleTrackEventMute = this.trackEventMute.bind(this)),
        (this.handleTrackEventUnmute = this.trackEventUnmute.bind(this)));
    }
    var t;
    return (
      W(e, [
        {
          key: "play",
          value:
            ((t = V(
              H.mark(function e() {
                var t = this;
                return H.wrap(function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return e.abrupt(
                          "return",
                          new Promise(function (e, r) {
                            var i = new MediaStream();
                            i.addTrack(t.track);
                            var n = document.createElement("audio");
                            ((n.srcObject = i),
                              (n.muted = t.muted),
                              n.setAttribute(
                                "id",
                                "audio_"
                                  .concat(t.stream.getId(), "_")
                                  .concat(Date.now()),
                              ),
                              n.setAttribute("autoplay", "autoplay"),
                              n.setAttribute("playsinline", "playsinline"),
                              t.div.appendChild(n),
                              t.outputDeviceId &&
                                "function" ==
                                  typeof (null == n ? void 0 : n.setSinkId) &&
                                n.setSinkId(t.outputDeviceId),
                              (t.element = n),
                              t.setVolume(t.volume),
                              t.handleEvents());
                            var o = function () {
                              t.element
                                .play()
                                .then(function () {
                                  e();
                                })
                                .catch(function (e) {
                                  r(e);
                                });
                            };
                            pe.wx() && pe.iOS()
                              ? (t.log.info("ios wx audio play"), o())
                              : n.addEventListener("canplay", function () {
                                  (t.log.info("audio canplay"), o());
                                });
                          }),
                        );
                      case 1:
                      case "end":
                        return e.stop();
                    }
                }, e);
              }),
            )),
            function () {
              return t.apply(this, arguments);
            }),
        },
        {
          key: "handleEvents",
          value: function () {
            var e, t, r;
            (null === (e = this.element) ||
              void 0 === e ||
              e.addEventListener("playing", this.handleEleEventPlaying),
              null === (t = this.element) ||
                void 0 === t ||
                t.addEventListener("ended", this.handleEleEventEnded),
              null === (r = this.element) ||
                void 0 === r ||
                r.addEventListener("pause", this.handleEleEventPause),
              this.trackHandleEvents());
          },
        },
        {
          key: "trackHandleEvents",
          value: function () {
            var e, t, r;
            (null === (e = this.track) ||
              void 0 === e ||
              e.addEventListener("ended", this.handleTrackEventEnded),
              null === (t = this.track) ||
                void 0 === t ||
                t.addEventListener("mute", this.handleTrackEventMute),
              null === (r = this.track) ||
                void 0 === r ||
                r.addEventListener("unmute", this.handleTrackEventUnmute));
          },
        },
        {
          key: "trackRemoveEvents",
          value: function () {
            var e, t, r;
            (null === (e = this.track) ||
              void 0 === e ||
              e.removeEventListener("ended", this.handleTrackEventEnded),
              null === (t = this.track) ||
                void 0 === t ||
                t.removeEventListener("mute", this.handleTrackEventMute),
              null === (r = this.track) ||
                void 0 === r ||
                r.removeEventListener("unmute", this.handleTrackEventUnmute));
          },
        },
        {
          key: "removeEvents",
          value: function () {
            var e, t, r;
            (null === (e = this.element) ||
              void 0 === e ||
              e.removeEventListener("playing", this.handleEleEventPlaying),
              null === (t = this.element) ||
                void 0 === t ||
                t.removeEventListener("ended", this.handleEleEventEnded),
              null === (r = this.element) ||
                void 0 === r ||
                r.removeEventListener("pause", this.handleEleEventPause),
              this.trackRemoveEvents());
          },
        },
        {
          key: "setSinkId",
          value: function (e) {
            var t;
            this.outputDeviceId !== e &&
              ((this.outputDeviceId = e),
              "function" ==
                typeof (null === (t = this.element) || void 0 === t
                  ? void 0
                  : t.setSinkId) && this.element.setSinkId(e));
          },
        },
        {
          key: "setVolume",
          value: function (e) {
            (this.log.info(
              "stream - audioElement setVolume to : ".concat(e.toString()),
            ),
              (this.element.volume = e));
          },
        },
        {
          key: "getAudioLevel",
          value: function () {
            return (
              this.soundMeter ||
                ((this.soundMeter = new le()),
                this.soundMeter.connectToSource(this.track)),
              this.soundMeter.getVolume()
            );
          },
        },
        {
          key: "stop",
          value: function () {
            (this.removeEvents(),
              this.div.removeChild(this.element),
              (this.element.srcObject = null),
              (this.element = null),
              this.soundMeter &&
                (this.soundMeter.stop(), (this.soundMeter = null)));
          },
        },
        {
          key: "resume",
          value: function () {
            var e;
            return null === (e = this.element) || void 0 === e
              ? void 0
              : e.play();
          },
        },
        {
          key: "getAudioElement",
          value: function () {
            return this.element;
          },
        },
        {
          key: "setAudioTrack",
          value: function (e) {
            this.trackRemoveEvents();
            var t = new MediaStream();
            (t.addTrack(e),
              (this.track = e),
              this.trackHandleEvents(),
              (this.soundMeter = null),
              this.log.info("setAudioTrack", e),
              this.element &&
                ((this.element.srcObject = t), this.element.play()));
          },
        },
        {
          key: "eleEventPlaying",
          value: function () {
            (this.log.info(
              "stream ".concat(
                this.userId,
                " - audio player is starting playing",
              ),
            ),
              (this.state = "PLAYING"),
              this._emitter.emit("player-state-changed", {
                state: this.state,
                reason: "playing",
              }));
          },
        },
        {
          key: "eleEventEnded",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - audio player is ended"),
            ),
              "STOPPED" !== this.state &&
                ((this.state = "STOPPED"),
                this._emitter.emit("player-state-changed", {
                  state: this.state,
                  reason: "ended",
                })));
          },
        },
        {
          key: "eleEventPause",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - audio player is paused"),
            ),
              (this.state = "PAUSED"),
              this._emitter.emit("player-state-changed", {
                state: this.state,
                reason: "pause",
              }),
              this.div && document.getElementById(this.div.id)
                ? this.pausedRetryCount > 0 &&
                  (this.log.info(
                    "audio resume when audio paused count:" +
                      this.pausedRetryCount,
                  ),
                  this.resume(),
                  this.pausedRetryCount--)
                : this.log.warn("audio container is not in DOM"));
          },
        },
        {
          key: "trackEventEnded",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - audio player track is ended"),
            ),
              "STOPPED" !== this.state &&
                ((this.state = "STOPPED"),
                this._emitter.emit("player-state-changed", {
                  state: this.state,
                  reason: "ended",
                  type: "track",
                })));
          },
        },
        {
          key: "trackEventMute",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - audio track is muted"),
            ),
              "PAUSED" !== this.state &&
                ((this.state = "PAUSED"),
                this._emitter.emit("player-state-changed", {
                  state: this.state,
                  reason: "mute",
                  type: "track",
                })));
          },
        },
        {
          key: "trackEventUnmute",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - audio track is unmuted"),
            ),
              "PAUSED" === this.state &&
                ((this.state = "PLAYING"),
                this._emitter.emit("player-state-changed", {
                  state: this.state,
                  reason: "unmute",
                  type: "track",
                })));
          },
        },
      ]),
      e
    );
  })(),
  ge =
    ((me = function (e, t) {
      for (
        var r = ["webgl", "experimental-webgl", "webkit-3d", "moz-webgl"],
          i = null,
          n = 0;
        n < r.length;
        ++n
      ) {
        try {
          i = e.getContext(r[n], t);
        } catch (e) {}
        if (i) break;
      }
      return i;
    }),
    function (e, t, r) {
      ((r =
        r ||
        function (e) {
          var t = document.getElementsByTagName("body")[0];
          if (t) {
            var r = window.WebGLRenderingContext
              ? 'It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>'
              : 'This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>';
            (e && (r += "<br/><br/>Status: " + e),
              (t.innerHTML = (function (e) {
                return '<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;"> '.concat(
                  e,
                  " </div>",
                );
              })(r)));
          }
        }),
        e.addEventListener &&
          e.addEventListener(
            "webglcontextcreationerror",
            function (e) {
              r(e.statusMessage);
            },
            !1,
          ));
      var i = me(e, t);
      return (i || r(""), i);
    });
function ye(e, t, r) {
  var i = e.createShader(t);
  if (null == i) return (console.log("unable to create shader"), null);
  if (
    (e.shaderSource(i, r),
    e.compileShader(i),
    !e.getShaderParameter(i, e.COMPILE_STATUS))
  ) {
    var n = e.getShaderInfoLog(i);
    return (
      console.log("Failed to compile shader: " + n),
      e.deleteShader(i),
      null
    );
  }
  return i;
}
(window.requestAnimationFrame ||
  (window.requestAnimationFrame =
    window.requestAnimationFrame ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame ||
    window.oRequestAnimationFrame ||
    window.msRequestAnimationFrame ||
    function (e, t) {
      window.setTimeout(e, 1e3 / 60);
    }),
  window.cancelAnimationFrame ||
    (window.cancelAnimationFrame =
      window.cancelRequestAnimationFrame ||
      window.webkitCancelAnimationFrame ||
      window.webkitCancelRequestAnimationFrame ||
      window.mozCancelAnimationFrame ||
      window.mozCancelRequestAnimationFrame ||
      window.msCancelAnimationFrame ||
      window.msCancelRequestAnimationFrame ||
      window.oCancelAnimationFrame ||
      window.oCancelRequestAnimationFrame ||
      window.clearTimeout));
var be,
  Se,
  Ee,
  Ce,
  Te,
  Re,
  Ie,
  _e,
  ke,
  we,
  Oe,
  Pe,
  Ae,
  Le,
  xe = (function () {
    function e(t, r) {
      (F(this, e),
        (this.div = t.div),
        (this.video = t.video),
        (this.virtualBackgroundMix = t.virtualBackgroundMix || null),
        (this.textures = []),
        (this.canCopyVideo = !1),
        (this.canCopyBackground = !1),
        (this.log = r),
        (this.track = t.track),
        this.initVirtualBackground(t.virtualBackground),
        (this.isEleLisenter = t.isEleLisenter));
    }
    return (
      W(e, [
        {
          key: "play",
          value: function () {
            var e = this;
            if (
              (this.initCanvas(),
              (this.gl =
                ge(this.canvas, {
                  preserveDrawingBuffer: !0,
                  alpha: !0,
                  antialias: !0,
                }) || null),
              this.gl)
            ) {
              var t = this.initXShaderSource();
              if (
                (function (e, t, r) {
                  var i = (function (e, t, r) {
                    var i = ye(e, e.VERTEX_SHADER, t),
                      n = ye(e, e.FRAGMENT_SHADER, r);
                    if (!i || !n) return null;
                    var o = e.createProgram();
                    if (!o) return null;
                    if (
                      (e.attachShader(o, i),
                      e.attachShader(o, n),
                      e.linkProgram(o),
                      !e.getProgramParameter(o, e.LINK_STATUS))
                    ) {
                      var a = e.getProgramInfoLog(o);
                      return (
                        console.log("Failed to link program: " + a),
                        e.deleteProgram(o),
                        e.deleteShader(n),
                        e.deleteShader(i),
                        null
                      );
                    }
                    return o;
                  })(e, t, r);
                  return i
                    ? (e.useProgram(i), (e.program = i), !0)
                    : (console.log("Failed to create program"), !1);
                })(this.gl, t.VSHADER, t.FSHADER)
              )
                if (this.initVertexBuffers(this.gl) < 0)
                  this.log.warn("Failed to initialize shaders");
                else {
                  var r = [];
                  this.video
                    ? (this.setupVideo(this.video, "canCopyVideo"),
                      r.push(this.video),
                      this.virtualBackground &&
                        this.virtualBackgroundMix &&
                        r.push(this.virtualBackground),
                      r.forEach(function (t, r) {
                        var i = e.initTextures(e.gl, r);
                        i
                          ? e.textures.push(i)
                          : e.log.warn("Failed to initialize texture");
                      }),
                      this.gl.clearColor(0, 0, 0, 0),
                      this.gl.clear(this.gl.COLOR_BUFFER_BIT),
                      this.render())
                    : this.log.warn("Failed to get video");
                }
              else this.log.warn("Failed to initialize shaders");
            } else
              this.log.warn("Failed to get the rendering context for webgl");
          },
        },
        {
          key: "stop",
          value: function () {
            ((this.canCopyVideo = !1),
              (this.canCopyBackground = !1),
              this.rafId && cancelAnimationFrame(this.rafId),
              (this.rafId = null),
              (this.virtualBackground = null),
              (this.virtualBackgroundMix = !1),
              this.isEleLisenter && this.observer.unobserve(this.div),
              this.canvas.remove(),
              delete this.canvas,
              delete this.gl);
          },
        },
        {
          key: "unmute",
          value: function () {
            this.render();
          },
        },
        {
          key: "mute",
          value: function () {
            (this.rafId && cancelAnimationFrame(this.rafId),
              (this.rafId = null),
              this.gl.clearColor(0, 0, 0, 0),
              this.gl.clear(this.gl.COLOR_BUFFER_BIT),
              (this.canvas.style.backgroundImage = ""));
          },
        },
        {
          key: "render",
          value: function () {
            var e,
              t,
              r = this,
              i = Date.now();
            !(function n() {
              var o = r.track.getSettings();
              r.frameRate = o.frameRate || 15;
              var a = 1e3 / r.frameRate;
              (r.rafId && cancelAnimationFrame(r.rafId),
                (r.rafId = requestAnimationFrame(n)),
                (e = Date.now()),
                (t = e - i) > a &&
                  ((i = e - t / a),
                  r.canCopyVideo &&
                    (r.updateTexture(r.gl, r.textures[0], r.video),
                    r.setCanvasBgImage(),
                    r.canUpdateBackground() &&
                      r.updateTexture(
                        r.gl,
                        r.textures[1],
                        r.virtualBackground,
                      )),
                  r.gl.clear(r.gl.COLOR_BUFFER_BIT),
                  r.gl.viewport(0, 0, r.canvas.width, r.canvas.height),
                  r.gl.drawArrays(r.gl.TRIANGLE_STRIP, 0, 4)));
            })();
          },
        },
        {
          key: "initVirtualBackground",
          value: function (e) {
            if (e) {
              if ("IMG" === e.nodeName) {
                var t = new Image();
                ((t.src = e.src), (this.virtualBackground = t));
              } else if ("VIDEO" === e.nodeName) {
                var r = document.createElement("video");
                ((r.playsInline = !0),
                  (r.muted = !0),
                  (r.loop = !0),
                  (r.src = e.src),
                  r.play(),
                  (this.virtualBackground = r),
                  this.setupVideo(this.video, "canCopyBackground"));
              }
            } else this.virtualBackground = null;
          },
        },
        {
          key: "initCanvas",
          value: function () {
            ((this.canvas = document.createElement("canvas")),
              this.canvas
                ? ((this.canvas.width = this.div.clientWidth),
                  (this.canvas.height = this.div.clientHeight),
                  (this.canvas.style.objectFit = this.video.style.objectFit),
                  (this.canvas.style.width = "100%"),
                  (this.canvas.style.height = "100%"),
                  this.isEleLisenter && this.addDivListener(),
                  this.div.appendChild(this.canvas))
                : this.log.warn("Failed to retrieve the <canvas> element"));
          },
        },
        {
          key: "resize",
          value: function () {
            var e = this.canvas.width,
              t = this.div.clientHeight,
              r = this.div.clientWidth;
            (t !== this.canvas.height && (this.canvas.height = t),
              r !== e && (this.canvas.width = r));
          },
        },
        {
          key: "addDivListener",
          value: function () {
            ((this.observer = new ResizeObserver(this.resize.bind(this))),
              this.observer.observe(this.div));
          },
        },
        {
          key: "setCanvasBgImage",
          value: function () {
            this.canvas.style.backgroundImage ||
              (this.virtualBackground &&
                !this.virtualBackgroundMix &&
                ((this.canvas.style.backgroundImage = "url(".concat(
                  this.virtualBackground.src,
                  ")",
                )),
                (this.canvas.style.backgroundRepeat = "no-repeat"),
                (this.canvas.style.backgroundSize = "cover")));
          },
        },
        {
          key: "setupVideo",
          value: function (e, t) {
            var r = this,
              i = !1,
              n = !1;
            (e.addEventListener(
              "playing",
              function () {
                ((i = !0), o());
              },
              !0,
            ),
              e.addEventListener(
                "timeupdate",
                function () {
                  ((n = !0), o());
                },
                !0,
              ));
            var o = function () {
              i && n && (r[t] = !0);
            };
          },
        },
        {
          key: "canUpdateBackground",
          value: function () {
            return (
              !(!this.virtualBackground || !this.virtualBackgroundMix) &&
              ("IMG" === this.virtualBackground.nodeName
                ? this.virtualBackground.complete
                : this.canCopyBackground)
            );
          },
        },
        {
          key: "initVertexBuffers",
          value: function (e) {
            var t = new Float32Array([
                -1, 1, 0, 1, -1, -1, 0, 0, 1, 1, 1, 1, 1, -1, 1, 0,
              ]),
              r = t.BYTES_PER_ELEMENT,
              i = e.createBuffer();
            if (!i)
              return (this.log.warn("Failed to create vertex buffer"), -1);
            (e.bindBuffer(e.ARRAY_BUFFER, i),
              e.bufferData(e.ARRAY_BUFFER, t, e.STATIC_DRAW));
            var n = e.getAttribLocation(e.program, "a_Position");
            if (n < 0)
              return (
                this.log.warn(
                  "Failed to get the storage location of a_Position",
                ),
                -1
              );
            (e.vertexAttribPointer(n, 2, e.FLOAT, !1, 4 * r, 0),
              e.enableVertexAttribArray(n));
            var o = e.getAttribLocation(e.program, "a_TexCoord");
            return o < 0
              ? (this.log.warn(
                  "Failed to get the storage location of a_TexCoord",
                ),
                -1)
              : (e.vertexAttribPointer(o, 2, e.FLOAT, !1, 4 * r, 2 * r),
                e.enableVertexAttribArray(o),
                4);
          },
        },
        {
          key: "initTextures",
          value: function (e, t) {
            var r,
              i,
              n = e.createTexture();
            if (!n)
              return (
                this.log.warn("Failed to create the texture object"),
                null
              );
            if (0 === t) {
              if (!(r = e.getUniformLocation(e.program, "u_Sampler0")))
                return (
                  this.log.warn(
                    "Failed to get the storage location of u_Sampler",
                  ),
                  null
                );
            } else if (!(i = e.getUniformLocation(e.program, "u_Sampler1")))
              return (
                this.log.warn(
                  "Failed to get the storage location of u_Sampler",
                ),
                null
              );
            return (
              e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL, 1),
              e.activeTexture(0 === t ? e.TEXTURE0 : e.TEXTURE1),
              e.bindTexture(e.TEXTURE_2D, n),
              e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_S, e.CLAMP_TO_EDGE),
              e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_T, e.CLAMP_TO_EDGE),
              e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, e.LINEAR),
              e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, e.LINEAR),
              0 === t ? e.uniform1i(r, 0) : e.uniform1i(i, 1),
              n
            );
          },
        },
        {
          key: "updateTexture",
          value: function (e, t, r) {
            var i = e.RGBA,
              n = e.RGBA,
              o = e.UNSIGNED_BYTE;
            (e.bindTexture(e.TEXTURE_2D, t),
              e.texImage2D(e.TEXTURE_2D, 0, i, n, o, r));
          },
        },
        {
          key: "initXShaderSource",
          value: function () {
            return {
              VSHADER:
                "attribute vec4 a_Position;\nattribute vec2 a_TexCoord;\nvarying vec2 v_TexCoord;\nvoid main() {\ngl_Position = a_Position;\nv_TexCoord = a_TexCoord;\n}\n",
              FSHADER:
                this.virtualBackground && this.virtualBackgroundMix
                  ? "precision mediump float;\nuniform sampler2D u_Sampler0;\nuniform sampler2D u_Sampler1;\nvarying vec2 v_TexCoord;\nvoid main() {\nvec2 true_pixel_coord = vec2(v_TexCoord.x, (0.5 + (v_TexCoord.y / 2.))); \nvec2 mask_pexel_coord = vec2(v_TexCoord.x, v_TexCoord.y / 2.); \nfloat alpha = texture2D(u_Sampler0, mask_pexel_coord).r; \nvec3 rgb = texture2D(u_Sampler0, true_pixel_coord).rgb*alpha;\nvec4 videoColor = vec4(rgb, alpha);\nvec4 imgColor = vec4(texture2D(u_Sampler1, v_TexCoord).rgb*(1.0-alpha),1.0-alpha);\ngl_FragColor = imgColor + videoColor;\n}\n"
                  : "precision mediump float;\nuniform sampler2D u_Sampler0;\nvarying vec2 v_TexCoord;\nvoid main() {\nvec2 true_pixel_coord = vec2(v_TexCoord.x, (0.5 + (v_TexCoord.y / 2.))); \nvec2 mask_pexel_coord = vec2(v_TexCoord.x, v_TexCoord.y / 2.); \nfloat alpha = texture2D(u_Sampler0, mask_pexel_coord).r; \nvec3 rgb = texture2D(u_Sampler0, true_pixel_coord).rgb*alpha;\nvec4 videoColor = vec4(rgb, alpha);\ngl_FragColor = videoColor;\n}\n",
            };
          },
        },
      ]),
      e
    );
  })(),
  De = (function () {
    function e(t) {
      (F(this, e),
        (this.stream = t.stream),
        (this.userId = t.stream.userId),
        (this.log = t.stream.logger),
        (this.track = t.track),
        (this.div = t.div),
        (this.muted = t.muted),
        (this.objectFit = t.objectFit),
        (this.mirror = t.mirror),
        (this.element = null),
        (this.state = "NONE"),
        (this.pausedRetryCount = 5),
        (this.isEleLisenter = t.isEleLisenter),
        (this._emitter = new J()),
        (this.handleEleEventPlaying = this.eleEventPlaying.bind(this)),
        (this.handleEleEventEnded = this.eleEventEnded.bind(this)),
        (this.handleEleEventPause = this.eleEventPause.bind(this)),
        (this.handleTrackEventEnded = this.trackEventEnded.bind(this)),
        (this.handleTrackEventMute = this.trackEventMute.bind(this)),
        (this.handleTrackEventUnmute = this.trackEventUnmute.bind(this)),
        (this.isAlphaChannels = t.isAlphaChannels || !1),
        (this.virtualBackground = t.virtualBackground),
        (this.virtualBackgroundMix = t.virtualBackgroundMix),
        this.initializeElement(),
        this.isAlphaChannels && this.startTexturesPlayer());
    }
    var t;
    return (
      W(e, [
        {
          key: "initializeElement",
          value: function () {
            var e = new MediaStream();
            e.addTrack(this.track);
            var t = document.createElement("video");
            ((t.srcObject = e), (t.muted = !0));
            var r = "width: 100%; height: 100%; object-fit: ".concat(
              this.objectFit,
              ";",
            );
            (this.mirror && (r += "transform: rotateY(180deg);"),
              t.setAttribute(
                "id",
                "video_".concat(this.stream.getId(), "_").concat(Date.now()),
              ),
              t.setAttribute("style", r),
              t.setAttribute("autoplay", "autoplay"),
              t.setAttribute("playsinline", "playsinline"),
              (this.div.style.lineHeight = "0"),
              this.div.appendChild(t),
              (this.element = t),
              this.handleEvents());
          },
        },
        {
          key: "play",
          value:
            ((t = V(
              H.mark(function e() {
                var t = this;
                return H.wrap(function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return e.abrupt(
                          "return",
                          new Promise(function (e, r) {
                            t.element
                              .play()
                              .then(function () {
                                (t.element.pause(), e());
                              })
                              .catch(function (e) {
                                r(e);
                              });
                          }),
                        );
                      case 1:
                      case "end":
                        return e.stop();
                    }
                }, e);
              }),
            )),
            function () {
              return t.apply(this, arguments);
            }),
        },
        {
          key: "handleEvents",
          value: function () {
            var e, t, r;
            (null === (e = this.element) ||
              void 0 === e ||
              e.addEventListener("playing", this.handleEleEventPlaying),
              null === (t = this.element) ||
                void 0 === t ||
                t.addEventListener("ended", this.handleEleEventEnded),
              null === (r = this.element) ||
                void 0 === r ||
                r.addEventListener("pause", this.handleEleEventPause),
              this.trackHandleEvents());
          },
        },
        {
          key: "trackHandleEvents",
          value: function () {
            var e, t, r;
            (null === (e = this.track) ||
              void 0 === e ||
              e.addEventListener("ended", this.handleTrackEventEnded),
              null === (t = this.track) ||
                void 0 === t ||
                t.addEventListener("mute", this.handleTrackEventMute),
              null === (r = this.track) ||
                void 0 === r ||
                r.addEventListener("unmute", this.handleTrackEventUnmute));
          },
        },
        {
          key: "trackRemoveEvents",
          value: function () {
            var e, t, r;
            (null === (e = this.track) ||
              void 0 === e ||
              e.removeEventListener("ended", this.handleTrackEventEnded),
              null === (t = this.track) ||
                void 0 === t ||
                t.removeEventListener("mute", this.handleTrackEventMute),
              null === (r = this.track) ||
                void 0 === r ||
                r.removeEventListener("unmute", this.handleTrackEventUnmute));
          },
        },
        {
          key: "removeEvents",
          value: function () {
            var e, t, r;
            (null === (e = this.element) ||
              void 0 === e ||
              e.removeEventListener("playing", this.handleEleEventPlaying),
              null === (t = this.element) ||
                void 0 === t ||
                t.removeEventListener("ended", this.handleEleEventEnded),
              null === (r = this.element) ||
                void 0 === r ||
                r.removeEventListener("pause", this.handleEleEventPause),
              this.trackRemoveEvents());
          },
        },
        {
          key: "stop",
          value: function () {
            (this.removeEvents(),
              this.div.removeChild(this.element),
              (this.element.srcObject = null),
              (this.element = null),
              this.isAlphaChannels && this.texturesPlayer.stop(),
              (this.isAlphaChannels = !1));
          },
        },
        {
          key: "resume",
          value: function () {
            var e;
            return null === (e = this.element) || void 0 === e
              ? void 0
              : e.play();
          },
        },
        {
          key: "getVideoFrame",
          value: function () {
            var e,
              t,
              r = document.createElement("canvas");
            ((r.width =
              null === (e = this.element) || void 0 === e
                ? void 0
                : e.videoWidth),
              (r.height =
                null === (t = this.element) || void 0 === t
                  ? void 0
                  : t.videoHeight));
            var i = null;
            return (
              this.isAlphaChannels
                ? ((i = this.texturesPlayer.canvas),
                  (r.height = r.height / 2),
                  r
                    .getContext("2d")
                    .drawImage(
                      i,
                      0,
                      0,
                      i.width,
                      i.height,
                      0,
                      0,
                      r.width,
                      r.height,
                    ))
                : ((i = this.element), r.getContext("2d").drawImage(i, 0, 0)),
              r.toDataURL("image/png")
            );
          },
        },
        {
          key: "getVideoElement",
          value: function () {
            return this.element;
          },
        },
        {
          key: "setVideoTrack",
          value: function (e) {
            this.trackRemoveEvents();
            var t = new MediaStream();
            (t.addTrack(e),
              (this.track = e),
              this.trackHandleEvents(),
              this.log.info("setVideoTrack", e),
              this.element &&
                ((this.element.srcObject = t), this.element.play()));
          },
        },
        {
          key: "unmute",
          value: function () {
            this.isAlphaChannels && this.texturesPlayer.unmute();
          },
        },
        {
          key: "mute",
          value: function () {
            this.isAlphaChannels && this.texturesPlayer.mute();
          },
        },
        {
          key: "startTexturesPlayer",
          value: function () {
            ((this.element.style.position = "absolute"),
              (this.element.style.width = "0"),
              (this.element.style.height = "0"),
              (this.element.style.zIndex = "-1"),
              (this.texturesPlayer = new xe(
                {
                  div: this.div,
                  video: this.element,
                  track: this.track,
                  virtualBackground: this.virtualBackground,
                  virtualBackgroundMix: this.virtualBackgroundMix,
                  isEleLisenter: this.isEleLisenter,
                },
                this.log,
              )),
              this.texturesPlayer.play());
          },
        },
        {
          key: "resize",
          value: function () {
            this.texturesPlayer.resize();
          },
        },
        {
          key: "eleEventPlaying",
          value: function () {
            (this.log.info(
              "stream ".concat(
                this.userId,
                " - video player is starting playing",
              ),
            ),
              (this.state = "PLAYING"),
              this._emitter.emit("player-state-changed", {
                state: this.state,
                reason: "playing",
              }));
          },
        },
        {
          key: "eleEventEnded",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - video player is ended"),
            ),
              "STOPPED" !== this.state &&
                ((this.state = "STOPPED"),
                this._emitter.emit("player-state-changed", {
                  state: this.state,
                  reason: "ended",
                })));
          },
        },
        {
          key: "eleEventPause",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - video player is paused"),
            ),
              (this.state = "PAUSED"),
              this._emitter.emit("player-state-changed", {
                state: this.state,
                reason: "pause",
              }),
              this.div && document.getElementById(this.div.id)
                ? this.pausedRetryCount > 0 &&
                  (this.log.info(
                    "video resume when video paused count:" +
                      this.pausedRetryCount,
                  ),
                  this.resume(),
                  this.pausedRetryCount--)
                : this.log.warn("video container is not in DOM"));
          },
        },
        {
          key: "trackEventEnded",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - video player track is ended"),
            ),
              "STOPPED" !== this.state &&
                ((this.state = "STOPPED"),
                this._emitter.emit("player-state-changed", {
                  state: this.state,
                  reason: "ended",
                  type: "track",
                })));
          },
        },
        {
          key: "trackEventMute",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - video track is muted"),
            ),
              "PAUSED" !== this.state &&
                ((this.state = "PAUSED"),
                this._emitter.emit("player-state-changed", {
                  state: this.state,
                  reason: "mute",
                  type: "track",
                })));
          },
        },
        {
          key: "trackEventUnmute",
          value: function () {
            (this.log.info(
              "stream ".concat(this.userId, " - video track is unmuted"),
            ),
              "PAUSED" === this.state &&
                ((this.state = "PLAYING"),
                this._emitter.emit("player-state-changed", {
                  state: this.state,
                  reason: "unmute",
                  type: "track",
                })));
          },
        },
      ]),
      e
    );
  })(),
  Me = fe(),
  Ue = Me.browser,
  Ne = Me.version;
function Ve(e) {
  switch (e) {
    case _e.ForwardStream:
      return "forward";
    case _e.MixedStream:
      return "mixed";
  }
  return "";
}
function je(e) {
  return "forward" == e
    ? _e.ForwardStream
    : "mixed" == e
      ? _e.MixedStream
      : _e.Invalid;
}
function Fe(e) {
  switch (e) {
    case Oe.Microphone:
      return "mic";
    case Oe.ScreenShare:
      return "screen";
    case Oe.File:
      return "file";
  }
  return "";
}
function Be(e) {
  return "mic" == e
    ? Oe.Microphone
    : "screen" == e
      ? Oe.ScreenShare
      : "file" == e
        ? Oe.File
        : Oe.Unknown;
}
function We(e) {
  switch (e) {
    case Pe.Camera:
      return "camera";
    case Pe.ScreenShare:
      return "screen";
    case Pe.File:
      return "file";
  }
  return "";
}
function Ge(e) {
  return "camera" == e
    ? Pe.Camera
    : "screen" == e
      ? Pe.ScreenShare
      : "file" == e
        ? Pe.File
        : Pe.Unknown;
}
function He(e) {
  switch (e) {
    case Ae.BigStream:
      return "h";
    case Ae.MiddleStream:
      return "m";
    case Ae.SmallStream:
      return "l";
  }
  return "";
}
function Je(e) {
  return "h" == e
    ? Ae.BigStream
    : "m" == e
      ? Ae.MiddleStream
      : "l" == e
        ? Ae.SmallStream
        : Ae.Invalid;
}
(!(function (e) {
  ((e[(e.Failed = 0)] = "Failed"),
    (e[(e.Success = 1)] = "Success"),
    (e[(e.Timeout = 2)] = "Timeout"));
})(be || (be = {})),
  (function (e) {
    ((e[(e.Unknown = 0)] = "Unknown"),
      (e[(e.ActivelyLeave = 1)] = "ActivelyLeave"),
      (e[(e.RoomDissolved = 2)] = "RoomDissolved"),
      (e[(e.RepeatLogin = 3)] = "RepeatLogin"));
  })(Se || (Se = {})),
  (function (e) {
    ((e[(e.Normal = 0)] = "Normal"),
      (e[(e.Timeout = 1)] = "Timeout"),
      (e[(e.Kick = 2)] = "Kick"),
      (e[(e.RepeatLogin = 3)] = "RepeatLogin"),
      (e[(e.RoomDissolved = 4)] = "RoomDissolved"));
  })(Ee || (Ee = {})),
  (function (e) {
    ((e[(e.Unknown = 0)] = "Unknown"),
      (e[(e.Kicked = 1)] = "Kicked"),
      (e[(e.RepeatLogin = 2)] = "RepeatLogin"),
      (e[(e.RoomDissolved = 3)] = "RoomDissolved"));
  })(Ce || (Ce = {})),
  (function (e) {
    ((e[(e.New = 0)] = "New"),
      (e[(e.ConnectionConnected = 1)] = "ConnectionConnected"),
      (e[(e.ConnectionLost = 2)] = "ConnectionLost"),
      (e[(e.ConnectionRetring = 3)] = "ConnectionRetring"),
      (e[(e.ConnectionRecovery = 4)] = "ConnectionRecovery"));
  })(Te || (Te = {})),
  (function (e) {
    ((e[(e.ParticipantJoin = 0)] = "ParticipantJoin"),
      (e[(e.ParticipantLeave = 1)] = "ParticipantLeave"),
      (e[(e.StreamAdd = 2)] = "StreamAdd"),
      (e[(e.StreamUpdate = 3)] = "StreamUpdate"),
      (e[(e.StreamRemove = 4)] = "StreamRemove"),
      (e[(e.Drop = 5)] = "Drop"),
      (e[(e.PermissionChange = 6)] = "PermissionChange"),
      (e[(e.MuteLocal = 7)] = "MuteLocal"));
  })(Re || (Re = {})),
  (function (e) {
    ((e[(e.AudioMute = 0)] = "AudioMute"),
      (e[(e.VideoMute = 1)] = "VideoMute"),
      (e[(e.AudioUnmute = 2)] = "AudioUnmute"),
      (e[(e.VideoUnmute = 3)] = "VideoUnmute"),
      (e[(e.Kick = 4)] = "Kick"));
  })(Ie || (Ie = {})),
  (function (e) {
    ((e[(e.Invalid = 0)] = "Invalid"),
      (e[(e.ForwardStream = 1)] = "ForwardStream"),
      (e[(e.MixedStream = 2)] = "MixedStream"));
  })(_e || (_e = {})),
  (function (e) {
    ((e[(e.Invalid = 0)] = "Invalid"),
      (e[(e.AudioOnly = 1)] = "AudioOnly"),
      (e[(e.VideoOnly = 2)] = "VideoOnly"),
      (e[(e.AudioVideo = 3)] = "AudioVideo"));
  })(ke || (ke = {})),
  (function (e) {
    ((e[(e.Normal = 0)] = "Normal"), (e[(e.Shadow = 1)] = "Shadow"));
  })(we || (we = {})),
  (function (e) {
    ((e[(e.Unknown = 0)] = "Unknown"),
      (e[(e.Microphone = 1)] = "Microphone"),
      (e[(e.ScreenShare = 2)] = "ScreenShare"),
      (e[(e.File = 3)] = "File"));
  })(Oe || (Oe = {})),
  (function (e) {
    ((e[(e.Unknown = 0)] = "Unknown"),
      (e[(e.Camera = 1)] = "Camera"),
      (e[(e.ScreenShare = 2)] = "ScreenShare"),
      (e[(e.File = 3)] = "File"));
  })(Pe || (Pe = {})),
  (function (e) {
    ((e[(e.Invalid = 0)] = "Invalid"),
      (e[(e.BigStream = 1)] = "BigStream"),
      (e[(e.MiddleStream = 2)] = "MiddleStream"),
      (e[(e.SmallStream = 3)] = "SmallStream"));
  })(Ae || (Ae = {})),
  (function (e) {
    ((e[(e.Amute = 0)] = "Amute"),
      (e[(e.Aunmute = 1)] = "Aunmute"),
      (e[(e.Vmute = 2)] = "Vmute"),
      (e[(e.Vunmute = 3)] = "Vunmute"));
  })(Le || (Le = {})));
var ze = {
    TOP_ERROR: 8801,
    SET_LOG_LEVEL: 3001,
    ENABLE_UPLOAD_LOG: 3002,
    DISABLE_UPLOAD_LOG: 3003,
    JOIN: 3004,
    JOIN_FIRST: 8001,
    JOIN_SUCCESS: 1103,
    JOIN_FAILED: 1104,
    LEAVE: 3007,
    LEAVE_SUCCESS: 3008,
    LEAVE_FAILED: 3009,
    SWITCH_ROLE_ANCHOR: 3010,
    SWITCH_ROLE_AUDIENCE: 3011,
    SWITCH_ROLE_ANCHOR_SUCCESS: 3012,
    SWITCH_ROLE_ANCHOR_FAILED: 3013,
    SWITCH_ROLE_AUDIENCE_SUCCESS: 3014,
    SWITCH_ROLE_AUDIENCE_FAILED: 3015,
    PUBLISH_STREAM: 3016,
    PUBLISH_STREAM_SCREEN: 3017,
    PUBLISH_STREAM_SUCCESS: 3018,
    PUBLISH_STREAM_FAILED: 3019,
    PUBLISH_STREAM_SCREEN_SUCCESS: 3020,
    PUBLISH_STREAM_SCREEN_FAILED: 3021,
    UNPUBLISH_STREAM: 3022,
    UNPUBLISH_STREAM_SCREEN: 3023,
    UNPUBLISH_STREAM_SUCCESS: 3024,
    UNPUBLISH_STREAM_FAILED: 3025,
    UNPUBLISH_STREAM_SCREEN_SUCCESS: 3026,
    UNPUBLISH_STREAM_SCREEN_FAILED: 3027,
    SUBSCRIBE_STREAM: 3028,
    SUBSCRIBE_STREAM_SCREEN: 3029,
    SUBSCRIBE_STREAM_SUCCESS: 3030,
    SUBSCRIBE_STREAM_FAILED: 3031,
    SUBSCRIBE_STREAM_SCREEN_SUCCESS: 3032,
    SUBSCRIBE_STREAM_SCREEN_FAILED: 3033,
    UNSUBSCRIBE_STREAM: 3034,
    UNSUBSCRIBE_STREAM_SCREEN: 3035,
    UNSUBSCRIBE_STREAM_SUCCESS: 3036,
    UNSUBSCRIBE_STREAM_FAILED: 3037,
    UNSUBSCRIBE_STREAM_SCREEN_SUCCESS: 3038,
    UNSUBSCRIBE_STREAM_SCREEN_FAILED: 3039,
    HAS_PUBLISHED_STREAM: 3040,
    GET_CLIENT_STATE: 3041,
    GET_REMOTE_MUTED_STATE: 3042,
    ENABLE_AUDIO_VOLUME_EVALUATION: 3043,
    ENABLE_SMALL_STREAM: 3044,
    DISABLE_SMALL_STREAM: 3045,
    SET_SMALL_STREAM_PROFILE: 3046,
    SET_REMOTE_VIDEO_STREAM_TYPE_SAMLL: 3047,
    SET_REMOTE_VIDEO_STREAM_TYPE_BIG: 3048,
    SET_REMOTE_VIDEO_STREAM_TYPE_SAMLL_SUCCESS: 3049,
    SET_REMOTE_VIDEO_STREAM_TYPE_SAMLL_FAILED: 3050,
    SET_REMOTE_VIDEO_STREAM_TYPE_BIG_SUCCESSE: 3051,
    SET_REMOTE_VIDEO_STREAM_TYPE_BIG_FAILED: 3052,
    UPDATE_SIMULCAST: 3053,
    UPDATE_SIMULCAST_SUCCESSE: 3054,
    UPDATE_SIMULCAST_FAILED: 3055,
    PLAY_LOCAL_VIDEO: 3056,
    PLAY_LOCAL_AUDIO: 3057,
    PLAY_LOCAL_VIDEO_SCREEN: 3058,
    PLAY_LOCAL_AUDIO_SCREEN: 3059,
    PLAY_REMOTE_VIDEO: 3060,
    PLAY_REMOTE_AUDIO: 3061,
    PLAY_REMOTE_VIDEO_SCREEN: 3062,
    PLAY_REMOTE_AUDIO_SCREEN: 3063,
    STOP_LOCAL_VIDEO: 3064,
    STOP_LOCAL_AUDIO: 3065,
    STOP_LOCAL_VIDEO_SCREEN: 3066,
    STOP_LOCAL_AUDIO_SCREEN: 3067,
    STOP_REMOTE_VIDEO: 3068,
    STOP_REMOTE_AUDIO: 3069,
    STOP_REMOTE_VIDEO_SCREEN: 3070,
    STOP_REMOTE_AUDIO_SCREEN: 3071,
    RESUME_LOCAL_VIDEO: 3072,
    RESUME_LOCAL_AUDIO: 3073,
    RESUME_LOCAL_VIDEO_SCREEN: 3074,
    RESUME_LOCAL_AUDIO_SCREEN: 3075,
    RESUME_REMOTE_VIDEO: 3076,
    RESUME_REMOTE_AUDIO: 3077,
    RESUME_REMOTE_VIDEO_SCREEN: 3078,
    RESUME_REMOTE_AUDIO_SCREEN: 3079,
    CLOSE_LOCAL_VIDEO: 3080,
    CLOSE_LOCAL_AUDIO: 3081,
    CLOSE_LOCAL_VIDEO_SCREEN: 3082,
    CLOSE_LOCAL_AUDIO_SCREEN: 3083,
    CLOSE_REMOTE_VIDEO: 3084,
    CLOSE_REMOTE_AUDIO: 3085,
    CLOSE_REMOTE_VIDEO_SCREEN: 3086,
    CLOSE_REMOTE_AUDIO_SCREEN: 3087,
    MUTE_LOCAL_AUDIO: 3088,
    MUTE_LOCAL_AUDIO_SCREEN: 3089,
    MUTE_REMOTE_AUDIO: 3090,
    MUTE_REMOTE_AUDIO_SCREEN: 3091,
    MUTE_LOCAL_VIDEO: 3092,
    MUTE_LOCAL_VIDEO_SCREEN: 3093,
    MUTE_REMOTE_VIDEO: 3094,
    MUTE_REMOTE_VIDEO_SCREEN: 3095,
    UNMUTE_LOCAL_AUDIO: 3096,
    UNMUTE_LOCAL_AUDIO_SCREEN: 3097,
    UNMUTE_REMOTE_AUDIO: 3098,
    UNMUTE_REMOTE_AUDIO_SCREEN: 3099,
    UNMUTE_LOCAL_VIDEO: 3100,
    UNMUTE_LOCAL_VIDEO_SCREEN: 3101,
    UNMUTE_REMOTE_VIDEO: 3102,
    UNMUTE_REMOTE_VIDEO_SCREEN: 3103,
    GET_LOCAL_ID: 3104,
    GET_REMOTE_ID: 3105,
    GET_LOCAL_USER_ID: 3106,
    GET_REMOTE_USER_ID: 3107,
    SET_AUDIO_OUTPUT: 3108,
    SET_LOCAL_AUDIO_VOLUME: 3109,
    SET_LOCAL_AUDIO_VOLUME_SCREEN: 3110,
    SET_REMOTE_AUDIO_VOLUME: 3111,
    SET_REMOTE_AUDIO_VOLUME_SCREEN: 3112,
    GET_LOCAL_AUDIO_LEVEL: 3113,
    GET_LOCAL_AUDIO_LEVEL_SCREEN: 3114,
    GET_REMOTE_AUDIO_LEVEL: 3115,
    GET_REMOTE_AUDIO_LEVEL_SCREEN: 3116,
    HAS_LOCAL_AUDIO: 3117,
    HAS_LOCAL_AUDIO_SCREEN: 3118,
    HAS_REMOTE_AUDIO: 3119,
    HAS_REMOTE_AUDIO_SCREEN: 3120,
    HAS_LOCAL_VIDEO: 3121,
    HAS_LOCAL_VIDEO_SCREEN: 3122,
    HAS_REMOTE_VIDEO: 3123,
    HAS_REMOTE_VIDEO_SCREEN: 3124,
    GET_LCOAL_AUDIO_TRACK: 3125,
    GET_LCOAL_AUDIO_TRACK_SCREEN: 3126,
    GET_REMOTE_AUDIO_TRACK: 3127,
    GET_REMOTE_AUDIO_TRACK_SCREEN: 3128,
    GET_LCOAL_VIDEO_TRACK: 3129,
    GET_LCOAL_VIDEO_TRACK_SCREEN: 3130,
    GET_REMOTE_VIDEO_TRACK: 3131,
    GET_REMOTE_VIDEO_TRACK_SCREEN: 3132,
    GET_LCOAL_VIDEO_FRAME: 3133,
    GET_LCOAL_VIDEO_FRAME_SCREEN: 3134,
    GET_REMOTE_VIDEO_FRAME: 3135,
    GET_REMOTE_VIDEO_FRAME_SCREEN: 3136,
    GET_LCOAL_TYPE: 3137,
    GET_REMOTE_TYPE: 3138,
    GET_LOCAL_AUDIO_ELEMENT: 3139,
    GET_LOCAL_AUDIO_ELEMENT_SCREEN: 3140,
    GET_REMOTE_AUDIO_ELEMENT: 3141,
    GET_REMOTE_AUDIO_ELEMENT_SCREEN: 3142,
    GET_LOCAL_VIDEO_ELEMENT: 3143,
    GET_LOCAL_VIDEO_ELEMENT_SCREEN: 3144,
    GET_REMOTE_VIDEO_ELEMENT: 3145,
    GET_REMOTE_VIDEO_ELEMENT_SCREEN: 3146,
    SET_AUDIO_PROFILE: 3147,
    SET_VIDEO_PROFILE: 3148,
    SET_SCREEN_PROFILE: 3149,
    SET_VIDEO_CONTENT_HINT: 3150,
    SWITCH_DEVICE_AUDIO: 3151,
    SWITCH_DEVICE_VIDEO: 3152,
    ADD_AUDIO_TRACK: 3153,
    ADD_AUDIO_TRACK_SCREEN: 3154,
    ADD_VIDEO_TRACK: 3155,
    ADD_VIDEO_TRACK_SCREEN: 3156,
    REMOVE_TRACK: 3157,
    REMOVE_TRACK_SCREEN: 3158,
    REPLACE_AUDIO_TRACK: 3159,
    REPLACE_AUDIO_TRACK_SCREEN: 3160,
    REPLACE_VIDEO_TRACK: 3161,
    REPLACE_VIDEO_TRACK_SCREEN: 3162,
    GET_DEVICES_INFO_IN_USE: 3163,
    ON_STREAM_ADDED: 3164,
    ON_STREAM_ADDED_SCREEN: 3165,
    ON_STREAM_REMOVED: 3166,
    ON_STREAM_REMOVED_SCREEN: 3167,
    ON_STREAM_UPDATED: 3168,
    ON_STREAM_UPDATED_SCREEN: 3169,
    ON_STREAM_SUBSCRIBED: 3170,
    ON_STREAM_SUBSCRIBED_SCREEN: 3171,
    ON_PEER_JOIN: 3172,
    ON_PEER_LEVAE: 3173,
    ON_MUTE_AUDIO: 3174,
    ON_MUTE_AUDIO_SCREEN: 3175,
    ON_MUTE_VIDEO: 3176,
    ON_MUTE_VIDEO_SCREEN: 3177,
    ON_UNMUTE_AUDIO: 3178,
    ON_UNMUTE_AUDIO_SCREEN: 3179,
    ON_UNMUTE_VIDEO: 3180,
    ON_UNMUTE_VIDEO_SCREEN: 3181,
    ON_CLIENT_BANNED: 3182,
    ON_CAMERA_CHANGED: 3183,
    ON_RECORDING_DEVICE_CHANGED: 3184,
    ON_PLAYBACK_DEVICE_CHANGED: 3185,
    ON_ERROR: 3186,
    OFF_STREAM_ADDED: 3187,
    OFF_STREAM_REMOVED: 3188,
    OFF_STREAM_UPDATED: 3189,
    OFF_STREAM_SUBSCRIBED: 3190,
    OFF_CONNECTION_STATE_CHANGED: 3191,
    OFF_PEER_JOIN: 3192,
    OFF_PEER_LEVAE: 3193,
    OFF_MUTE_AUDIO: 3194,
    OFF_MUTE_VIDEO: 3195,
    OFF_UNMUTE_VIDEO: 3196,
    OFF_CLIENT_BANNED: 3197,
    OFF_CAMERA_CHANGED: 3198,
    OFF_RECORDING_DEVICE_CHANGED: 3199,
    OFF_PLAYBACK_DEVICE_CHANGED: 3200,
    OFF_NETWORK_QUALITY: 3201,
    OFF_AUDIO_VOLUME: 3202,
    OFF_ERROR: 3203,
    ON_PLAYER_STATE_CHANGED: 3204,
    ON_SCREEN_SHARING_STOPPED: 3205,
    ON_STREAM_ERROR: 3206,
    CONNECTIONLOST_CB: 3207,
    TRY_TO_RECONNECT_CB: 3208,
    CONNECTION_RECOVERY_CB: 3209,
  },
  Ke = {
    VUBIT: 2001,
    VDBIT: 2002,
    AUBIT: 2003,
    ADBIT: 2004,
    VULOSS: 2005,
    VDLOSS: 2006,
    AULOSS: 2007,
    ADLOSS: 2008,
    VURTT: 2009,
    VDRTT: 2010,
    AURTT: 2011,
    ADRTT: 2012,
    VUFPS: 2013,
    VDFPS: 2014,
    AUFPS: 2015,
    ADFPS: 2016,
    VUBLOCK: 2017,
    VDBLOCK: 2018,
    AUBLOCK: 2019,
    ADBLOCK: 2020,
    VUWIDTHHEIGHT: 2021,
    VDWIDTHHEIGHT: 2022,
    APPCPU: 2023,
    SYSCPU: 2024,
  };
function Ye(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function qe(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? Ye(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : Ye(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
var Xe = qe(qe({}, ze), Ke);
function Qe() {
  var e,
    t,
    r = navigator.userAgent.toLocaleLowerCase();
  if (-1 != r.indexOf("firefox")) e = "Firefox";
  else if (-1 != r.indexOf("trident"))
    ((e = "IE"), -1 == r.indexOf("ie") && (t = 11));
  else if (-1 != r.indexOf("opr")) e = "OPR";
  else if (-1 != r.indexOf("edge")) e = "Edge";
  else if (-1 != r.indexOf("chrome")) e = "Chrome";
  else if (-1 != r.indexOf("safari")) {
    var i;
    ((e = "Safari"),
      (i = (i = r.indexOf("version")) + 7 + 1),
      (t = parseInt(r.slice(i, i + 3))));
  } else e = "未知浏览器";
  return (
    void 0 === t &&
      ((i = (i = r.indexOf(e.toLocaleLowerCase())) + e.length + 1),
      (t = parseInt(r.slice(i, i + 3)))),
    { browser: e, version: t }
  );
}
function $e() {
  return (
    ["RTCPeerConnection", "webkitRTCPeerConnection", "RTCIceGatherer"].filter(
      function (e) {
        return e in window;
      },
    ).length > 0
  );
}
function Ze() {
  var e = (function () {
      if (navigator.userAgent.toLocaleLowerCase().includes("mobile")) return !0;
      var e = Qe(),
        t = e.browser,
        r = e.version;
      return "Chrome" === t
        ? r >= 74
        : "Edge" === t
          ? r >= 80
          : "Firefox" === t
            ? r >= 66
            : "OPR" === t
              ? r >= 60
              : "Safari" === t && r >= 13;
    })(),
    t = $e(),
    r = (function () {
      if (!navigator.mediaDevices) return !1;
      var e = ["getUserMedia", "enumerateDevices"];
      return (
        e.filter(function (e) {
          return e in navigator.mediaDevices;
        }).length === e.length
      );
    })();
  return new Promise(function (i, n) {
    new Promise(function (e, t) {
      if ($e()) {
        var r = new RTCPeerConnection();
        r.createOffer({ offerToReceiveAudio: !0, offerToReceiveVideo: !0 })
          .then(
            function (t) {
              var i = !!t.sdp && t.sdp.toLowerCase().indexOf("h264") > -1;
              (r.close(), (r = null), e(i));
            },
            function () {
              (Logger.onError({ c: Xe.TOP_ERROR, v: te.H264_NOT_SUPPORTED }),
                t(
                  new de({
                    code: te.H264_NOT_SUPPORTED,
                    message: "h264 not supported",
                  }),
                ));
            },
          )
          .catch(function (e) {
            Logger.onError({ c: Xe.TOP_ERROR, v: te.H264_NOT_SUPPORTED });
            var r = new de({ code: te.H264_NOT_SUPPORTED, message: e.message });
            t(r);
          });
      } else e(!1);
    }).then(
      function (n) {
        i({
          result: e && t && r && n,
          detail: {
            isBrowserSupported: e,
            isWebRTCSupported: t,
            isMediaDevicesSupported: r,
            isH264Supported: n,
          },
        });
      },
      function (e) {
        return n(e);
      },
    );
  });
}
function et() {
  if (!navigator.mediaDevices)
    throw (
      Logger.onError({ c: Xe.TOP_ERROR, v: te.DEVICE_NOT_FOUND }),
      new de({
        code: te.DEVICE_NOT_FOUND,
        message: "navigator.mediaDevices is undefined",
      })
    );
  return new Promise(function (e, t) {
    navigator.mediaDevices
      .enumerateDevices()
      .then(
        function (t) {
          var r = t
            .filter(function (e) {
              return "audioinput" !== e.kind || "communications" != e.deviceId;
            })
            .map(function (e, t) {
              var r = e.label;
              e.label || (r = e.kind + "_" + t);
              var i = { label: r, deviceId: e.deviceId, kind: e.kind };
              return (e.groupId && (i.groupId = e.groupId), i);
            });
          e(r);
        },
        function (e) {
          t(e);
        },
      )
      .catch(function (e) {
        Logger.onError({ c: Xe.TOP_ERROR, v: te.DEVICE_NOT_FOUND });
        var r = new de({ code: te.DEVICE_NOT_FOUND, message: e.message });
        t(r);
      });
  });
}
function tt() {
  if (!navigator.mediaDevices)
    throw (
      Logger.onError({ c: Xe.TOP_ERROR, v: te.CAMERAS_NOT_FOUND }),
      new de({
        code: te.CAMERAS_NOT_FOUND,
        message: "navigator.mediaDevices is undefined",
      })
    );
  return new Promise(function (e, t) {
    navigator.mediaDevices
      .enumerateDevices()
      .then(
        function (t) {
          var r = t
            .filter(function (e) {
              return "videoinput" === e.kind;
            })
            .map(function (e, t) {
              var r = e.label;
              e.label || (r = "camera_" + t);
              var i = { label: r, deviceId: e.deviceId, kind: e.kind };
              return (e.groupId && (i.groupId = e.groupId), i);
            });
          e(r);
        },
        function (e) {
          t(e);
        },
      )
      .catch(function (e) {
        Logger.onError({ c: Xe.TOP_ERROR, v: te.CAMERAS_NOT_FOUND });
        var r = new de({ code: te.CAMERAS_NOT_FOUND, message: e.message });
        t(r);
      });
  });
}
function rt() {
  if (!navigator.mediaDevices)
    throw (
      Logger.onError({ c: Xe.TOP_ERROR, v: te.MICROPHONES_NOT_FOUND }),
      new de({
        code: te.MICROPHONES_NOT_FOUND,
        message: "navigator.mediaDevices is undefined",
      })
    );
  return new Promise(function (e, t) {
    navigator.mediaDevices
      .enumerateDevices()
      .then(
        function (t) {
          var r = t
            .filter(function (e) {
              return "audioinput" === e.kind && "communications" !== e.deviceId;
            })
            .map(function (e, t) {
              var r = e.label;
              e.label || (r = "microphone_" + t);
              var i = { label: r, deviceId: e.deviceId, kind: e.kind };
              return (e.groupId && (i.groupId = e.groupId), i);
            });
          e(r);
        },
        function (e) {
          t(e);
        },
      )
      .catch(function (e) {
        var r = new de({ code: te.MICROPHONES_NOT_FOUND, message: e.message });
        t(r);
      });
  });
}
function it() {
  if (!navigator.mediaDevices)
    throw (
      Logger.onError({ c: Xe.TOP_ERROR, v: te.SPEAKERS_NOT_FOUND }),
      new de({
        code: te.SPEAKERS_NOT_FOUND,
        message: "navigator.mediaDevices is undefined",
      })
    );
  return new Promise(function (e, t) {
    navigator.mediaDevices
      .enumerateDevices()
      .then(
        function (t) {
          var r = t
            .filter(function (e) {
              return "audiooutput" === e.kind;
            })
            .map(function (e, t) {
              var r = e.label;
              e.label || (r = "speaker_" + t);
              var i = { label: r, deviceId: e.deviceId, kind: e.kind };
              return (e.groupId && (i.groupId = e.groupId), i);
            });
          e(r);
        },
        function (e) {
          t(e);
        },
      )
      .catch(function (e) {
        Logger.onError({ c: Xe.TOP_ERROR, v: te.SPEAKERS_NOT_FOUND });
        var r = new de({ code: te.SPEAKERS_NOT_FOUND, message: e.message });
        t(r);
      });
  });
}
function nt() {
  return !!("captureStream" in HTMLCanvasElement.prototype);
}
function ot() {
  return "Safari" !== Qe().browser;
}
var at = (function () {
    function e(t, r, i, n) {
      (F(this, e),
        (this.logger = r),
        (this.streamConfig = t),
        (this.streamId = t.streamId || null),
        (this.mediaStream = t.mediaStream || null),
        (this.type = t.type ? t.type : t.screen ? Q : null),
        (this.info = t.info || null),
        (this.mixedInfo = t.mixedInfo || null),
        (this.constraints = { audio: t.audio, video: t.video }),
        (this.roomId = i || null),
        (this.xsigoClient = n || null),
        (this.isPlaying = !1),
        (this.objectFit = "cover"),
        (this.muted = !1),
        (this.mirror = t.mirror || !1),
        (this.audioPlayer = null),
        (this.videoPlayer = null),
        (this.audioOutputDeviceId = ""),
        (this.audioOutputGroupId = ""),
        (this.audioVolume = 1),
        (this.isRemote = !1),
        this.setUserId(t.userId),
        (this.timer = null),
        (this.waterStreamStream = null),
        (this.waterMarkoptions = null),
        (this.waterMarkVideo = null),
        (this.isWaterMark = !1),
        (this.localId = "default"),
        (this._emitter = new J()),
        (this.hasAudioTrack = !1),
        (this.hasVideoTrack = !1),
        (this.audioStreamId = ""),
        (this.videoStreamId = ""),
        (this.peerConnections = []),
        (this.audioTrackEnabled = !0),
        (this.videoTrackEnabled = !0),
        (this.pcFailedCount = 0),
        (this.audioMuted = !0),
        (this.videoMuted = !0),
        (this.backgroundColor = "#000000"),
        (this.isAlphaChannels = !1),
        (this.virtualBackground = null),
        (this.virtualBackgroundMix = !1),
        (this.waterMarkImage = null),
        (this.isEleLisenter = !0),
        this.setAudioOutput("default"));
    }
    var t, r, i, n, o;
    return (
      W(e, [
        {
          key: "setPlayBackground",
          value: function (e) {
            this.backgroundColor = e;
          },
        },
        {
          key: "play",
          value:
            ((o = V(
              H.mark(function e(t, r) {
                var i, n, o;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (!this.isPlaying) {
                            e.next = 3;
                            break;
                          }
                          return (
                            this.logger.warn(
                              "duplicated play() call observed, please stop() firstly",
                            ),
                            e.abrupt("return")
                          );
                        case 3:
                          if (
                            ((this.isPlaying = !0),
                            this.logger.info(
                              "stream start to play with options: ".concat(
                                JSON.stringify(r),
                              ),
                            ),
                            (n =
                              "string" == typeof t
                                ? document.getElementById(t)
                                : t),
                            document.getElementById(
                              "player_".concat(this.userId),
                            )
                              ? (i = document.getElementById(
                                  "player_".concat(this.userId),
                                ))
                              : ((i =
                                  document.createElement("div")).setAttribute(
                                  "id",
                                  "player_".concat(this.userId),
                                ),
                                i.setAttribute(
                                  "style",
                                  "width: 100%; height: 100%; position: relative; background-color:".concat(
                                    this.backgroundColor,
                                    "; overflow: hidden;",
                                  ),
                                ),
                                null === (o = n) ||
                                  void 0 === o ||
                                  o.appendChild(i)),
                            (this.div = i),
                            this.isRemote || (this.muted = !0),
                            r && void 0 !== r.muted && (this.muted = r.muted),
                            this.isRemote &&
                              this.info.video &&
                              "screen" === this.info.video.source &&
                              (this.objectFit = "contain"),
                            r &&
                              void 0 !== r.objectFit &&
                              (this.objectFit = r.objectFit),
                            r &&
                              r.hasOwnProperty("isEleLisenter") &&
                              (this.isEleLisenter = r.isEleLisenter),
                            !this.hasVideo() || !this.hasAudio())
                          ) {
                            e.next = 17;
                            break;
                          }
                          return (
                            this.logger.buriedLog({
                              c: this.isRemote
                                ? this.type === Q
                                  ? Xe.PLAY_REMOTE_VIDEO_SCREEN
                                  : Xe.PLAY_REMOTE_VIDEO
                                : this.type === Q
                                  ? Xe.PLAY_LOCAL_VIDEO_SCREEN
                                  : Xe.PLAY_LOCAL_VIDEO,
                              v: this.addUid(),
                            }),
                            this.logger.buriedLog({
                              c: this.isRemote
                                ? this.type === Q
                                  ? Xe.PLAY_REMOTE_AUDIO_SCREEN
                                  : Xe.PLAY_REMOTE_AUDIO
                                : this.type === Q
                                  ? Xe.PLAY_LOCAL_AUDIO_SCREEN
                                  : Xe.PLAY_LOCAL_AUDIO,
                              v: this.addUid(),
                            }),
                            e.abrupt(
                              "return",
                              (this.playVideo(), this.playAudio()),
                            )
                          );
                        case 17:
                          if (!this.hasVideo()) {
                            e.next = 20;
                            break;
                          }
                          return (
                            this.logger.buriedLog({
                              c: this.isRemote
                                ? this.type === Q
                                  ? Xe.PLAY_REMOTE_VIDEO_SCREEN
                                  : Xe.PLAY_REMOTE_VIDEO
                                : this.type === Q
                                  ? Xe.PLAY_LOCAL_VIDEO_SCREEN
                                  : Xe.PLAY_LOCAL_VIDEO,
                              v: this.addUid(),
                            }),
                            e.abrupt("return", this.playVideo())
                          );
                        case 20:
                          if (!this.hasAudio()) {
                            e.next = 23;
                            break;
                          }
                          return (
                            this.logger.buriedLog({
                              c: this.isRemote
                                ? this.type === Q
                                  ? Xe.PLAY_REMOTE_AUDIO_SCREEN
                                  : Xe.PLAY_REMOTE_AUDIO
                                : this.type === Q
                                  ? Xe.PLAY_LOCAL_AUDIO_SCREEN
                                  : Xe.PLAY_LOCAL_AUDIO,
                              v: this.addUid(),
                            }),
                            e.abrupt("return", this.playAudio())
                          );
                        case 23:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function (e, t) {
              return o.apply(this, arguments);
            }),
        },
        {
          key: "stop",
          value: function () {
            (this.logger.info("is playing:" + this.isPlaying),
              this.isPlaying &&
                (this.logger.info("Stop playing audio and video"),
                this.audioPlayer &&
                  this.logger.buriedLog({
                    c: this.isRemote
                      ? this.type === Q
                        ? Xe.STOP_REMOTE_AUDIO_SCREEN
                        : Xe.STOP_REMOTE_AUDIO
                      : this.type === Q
                        ? Xe.STOP_LOCAL_AUDIO_SCREEN
                        : Xe.STOP_LOCAL_AUDIO,
                    v: this.addUid(),
                  }),
                this.videoPlayer &&
                  this.logger.buriedLog({
                    c: this.isRemote
                      ? this.type === Q
                        ? Xe.STOP_REMOTE_VIDEO_SCREEN
                        : Xe.STOP_REMOTE_VIDEO
                      : this.type === Q
                        ? Xe.STOP_LOCAL_VIDEO_SCREEN
                        : Xe.STOP_LOCAL_VIDEO,
                    v: this.addUid(),
                  }),
                (this.isPlaying = !1),
                this.stopAudio(),
                this.stopVideo(),
                this.div.parentNode &&
                  this.div.parentNode.removeChild(this.div)));
          },
        },
        {
          key: "resume",
          value:
            ((n = V(
              H.mark(function e() {
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          (this.logger.info("is playing:" + this.isPlaying),
                            this.isPlaying &&
                              (this.logger.info("stream - resume"),
                              this.audioPlayer &&
                                (this.logger.buriedLog({
                                  c: this.isRemote
                                    ? this.type === Q
                                      ? Xe.RESUME_REMOTE_AUDIO_SCREEN
                                      : Xe.RESUME_REMOTE_AUDIO
                                    : this.type === Q
                                      ? Xe.RESUME_LOCAL_AUDIO_SCREEN
                                      : Xe.RESUME_LOCAL_AUDIO,
                                  v: this.addUid(),
                                }),
                                this.audioPlayer.resume()),
                              this.videoPlayer &&
                                (this.logger.buriedLog({
                                  c: this.isRemote
                                    ? this.type === Q
                                      ? Xe.RESUME_REMOTE_VIDEO_SCREEN
                                      : Xe.RESUME_REMOTE_VIDEO
                                    : this.type === Q
                                      ? Xe.RESUME_LOCAL_VIDEO_SCREEN
                                      : Xe.RESUME_LOCAL_VIDEO,
                                  v: this.addUid(),
                                }),
                                this.videoPlayer.resume())));
                        case 2:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function () {
              return n.apply(this, arguments);
            }),
        },
        {
          key: "close",
          value: function () {
            (this.logger.info("is playing:" + this.isPlaying),
              this.isPlaying && this.stop(),
              this.mediaStream &&
                (this.mediaStream.getTracks().forEach(function (e) {
                  e.stop();
                }),
                (this.mediaStream = null)));
          },
        },
        {
          key: "muteAudio",
          value: function () {
            return (
              !(!this.mediaStream || !this.audioTrackEnabled) &&
              (this.logger.info("mute audio"),
              this.logger.buriedLog({
                c: this.isRemote
                  ? this.type === Q
                    ? Xe.MUTE_REMOTE_AUDIO_SCREEN
                    : Xe.MUTE_REMOTE_AUDIO
                  : this.type === Q
                    ? Xe.MUTE_LOCAL_AUDIO_SCREEN
                    : Xe.MUTE_LOCAL_AUDIO,
                v: this.addUid(),
              }),
              this.addRemoteEvent(Ie.AudioMute),
              this.doEnableTrack("audio", !1))
            );
          },
        },
        {
          key: "muteVideo",
          value: function () {
            return (
              !(!this.mediaStream || !this.videoTrackEnabled) &&
              (this.logger.info("mute video"),
              this.logger.buriedLog({
                c: this.isRemote
                  ? this.type === Q
                    ? Xe.MUTE_REMOTE_VIDEO_SCREEN
                    : Xe.MUTE_REMOTE_VIDEO
                  : this.type === Q
                    ? Xe.MUTE_LOCAL_VIDEO_SCREEN
                    : Xe.MUTE_LOCAL_VIDEO,
                v: this.addUid(),
              }),
              this.isAlphaChannels && this.videoPlayer.mute(),
              this.addRemoteEvent(Ie.VideoMute),
              this.doEnableTrack("video", !1))
            );
          },
        },
        {
          key: "unmuteAudio",
          value: function () {
            return (
              !(!this.mediaStream || this.audioTrackEnabled) &&
              (this.logger.info("unmute audio"),
              this.logger.buriedLog({
                c: this.isRemote
                  ? this.type === Q
                    ? Xe.UNMUTE_REMOTE_AUDIO_SCREEN
                    : Xe.UNMUTE_REMOTE_AUDIO
                  : this.type === Q
                    ? Xe.UNMUTE_LOCAL_AUDIO_SCREEN
                    : Xe.UNMUTE_LOCAL_AUDIO,
                v: this.addUid(),
              }),
              this.addRemoteEvent(Ie.AudioUnmute),
              this.doEnableTrack("audio", !0))
            );
          },
        },
        {
          key: "unmuteVideo",
          value: function () {
            return (
              !(!this.mediaStream || this.videoTrackEnabled) &&
              (this.logger.info("unmute video"),
              this.logger.buriedLog({
                c: this.isRemote
                  ? this.type === Q
                    ? Xe.UNMUTE_REMOTE_VIDEO_SCREEN
                    : Xe.UNMUTE_REMOTE_VIDEO
                  : this.type === Q
                    ? Xe.UNMUTE_LOCAL_VIDEO_SCREEN
                    : Xe.UNMUTE_LOCAL_VIDEO,
                v: this.addUid(),
              }),
              this.isAlphaChannels && this.videoPlayer.unmute(),
              this.addRemoteEvent(Ie.VideoUnmute),
              this.doEnableTrack("video", !0))
            );
          },
        },
        {
          key: "updateTrack",
          value: function (e, t) {
            var r;
            ((r =
              "audio" === e ? this.getAudioTrack() : this.getVideoTrack()) &&
              this.mediaStream.removeTrack(r),
              this.mediaStream.addTrack(t));
          },
        },
        {
          key: "doEnableTrack",
          value: function (e, t) {
            var r = !1;
            return (
              "audio" === e
                ? this.mediaStream.getAudioTracks().forEach(function (e) {
                    ((r = !0), (e.enabled = t));
                  })
                : this.mediaStream.getVideoTracks().forEach(function (e) {
                    ((r = !0), (e.enabled = t));
                  }),
              this.setEnableTrackFlag(e, t),
              r
            );
          },
        },
        {
          key: "setEnableTrackFlag",
          value: function (e, t) {
            "audio" === e
              ? (this.audioTrackEnabled = t)
              : (this.videoTrackEnabled = t);
          },
        },
        {
          key: "addRemoteEvent",
          value: function (e, t) {
            var r = this;
            return new Promise(function (i, n) {
              if (!r.isRemote) {
                var o = function (e, t, r) {
                  (1 === e && i(!0), 0 === e && n(!1));
                };
                if (r.xsigoClient)
                  switch (e) {
                    case Ie.AudioMute:
                      r.xsigoClient.muteAudio(r.roomId, r.audioStreamId, o, t);
                      break;
                    case Ie.VideoMute:
                      r.xsigoClient.muteVideo(r.roomId, r.videoStreamId, o, t);
                      break;
                    case Ie.AudioUnmute:
                      r.xsigoClient.unmuteAudio(
                        r.roomId,
                        r.audioStreamId,
                        o,
                        t,
                      );
                      break;
                    case Ie.VideoUnmute:
                      r.xsigoClient.unmuteVideo(
                        r.roomId,
                        r.videoStreamId,
                        o,
                        t,
                      );
                  }
                else r.logger.info("not xsigoClient");
              }
            });
          },
        },
        {
          key: "getId",
          value: function () {
            return this.streamId || "";
          },
        },
        {
          key: "getUserId",
          value: function () {
            return "main" === this.type
              ? this.userId
              : this.userId.replace("share_", "");
          },
        },
        {
          key: "setUserId",
          value: function (e) {
            if (this.streamConfig.screen)
              return (this.userId = "share_".concat(e));
            this.userId = e;
          },
        },
        {
          key: "setAudioOutput",
          value: function (e) {
            var t = this;
            ((this.audioOutputDeviceId = e),
              this.logger.info("setAudioOutput deviceId", this.userId, e),
              this.logger.buriedLog({
                c: Xe.SET_AUDIO_OUTPUT,
                v: "deviceId:".concat(e, ",uid:").concat(this.userId),
              }),
              this.audioPlayer && this.audioPlayer.setSinkId(e),
              it().then(function (e) {
                var r = e.find(function (e) {
                  return e.deviceId === t.audioOutputDeviceId;
                });
                r && (t.audioOutputGroupId = r.groupId);
              }));
          },
        },
        {
          key: "getInuseSpeaker",
          value: function () {
            return (
              this.logger.buriedLog({
                c: Xe.GET_DEVICES_INFO_IN_USE,
                v: "speaker:".concat(this.audioOutputDeviceId),
              }),
              {
                speaker: {
                  deviceId: this.audioOutputDeviceId,
                  groupId: this.audioOutputGroupId,
                },
              }
            );
          },
        },
        {
          key: "setAudioVolume",
          value: function (e) {
            ((this.audioVolume = e),
              this.logger.info("setAudioVolume to ".concat(e.toString())),
              this.logger.buriedLog({
                c: this.isRemote
                  ? this.type === Q
                    ? Xe.SET_REMOTE_AUDIO_VOLUME_SCREEN
                    : Xe.SET_REMOTE_AUDIO_VOLUME
                  : this.type === Q
                    ? Xe.SET_LOCAL_AUDIO_VOLUME_SCREEN
                    : Xe.SET_LOCAL_AUDIO_VOLUME,
                v: "volume:".concat(e),
              }),
              this.audioPlayer && this.audioPlayer.setVolume(e));
          },
        },
        {
          key: "getAudioLevel",
          value: function () {
            return this.audioPlayer ? this.audioPlayer.getAudioLevel() : 0;
          },
        },
        {
          key: "setHasAudio",
          value: function (e) {
            this.hasAudioTrack = e;
          },
        },
        {
          key: "hasAudio",
          value: function () {
            return !!this.checkMediaStream() && this.hasAudioTrack;
          },
        },
        {
          key: "setHasVideo",
          value: function (e) {
            this.hasVideoTrack = e;
          },
        },
        {
          key: "hasVideo",
          value: function () {
            return !!this.checkMediaStream() && this.hasVideoTrack;
          },
        },
        {
          key: "getAudioTrack",
          value: function () {
            var e = null;
            if (this.checkMediaStream()) {
              var t = this.mediaStream.getAudioTracks();
              t.length > 0 && (e = t[0]);
            }
            return e;
          },
        },
        {
          key: "getVideoTrack",
          value: function () {
            var e = null;
            if (this.checkMediaStream()) {
              var t = this.mediaStream.getVideoTracks();
              t.length > 0 && (e = t[0]);
            }
            return e;
          },
        },
        {
          key: "getVideoFrame",
          value: function () {
            return (
              this.logger.buriedLog({
                c: this.isRemote
                  ? this.type === Q
                    ? Xe.GET_REMOTE_VIDEO_FRAME_SCREEN
                    : Xe.GET_REMOTE_VIDEO_FRAME
                  : this.type === Q
                    ? Xe.GET_LCOAL_VIDEO_FRAME_SCREEN
                    : Xe.GET_LCOAL_VIDEO_FRAME,
              }),
              this.videoPlayer ? this.videoPlayer.getVideoFrame() : null
            );
          },
        },
        {
          key: "on",
          value: function (e, t) {
            this._emitter.on(e, t);
          },
        },
        {
          key: "playAudio",
          value:
            ((i = V(
              H.mark(function e() {
                var t,
                  r = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (
                            ((t = this.getAudioTrack()), !this.audioPlayer && t)
                          ) {
                            e.next = 3;
                            break;
                          }
                          return e.abrupt("return");
                        case 3:
                          return (
                            this.logger.info(
                              "stream - create AudioPlayer and play",
                            ),
                            (this.audioPlayer = new ve({
                              stream: this,
                              track: t,
                              div: this.div,
                              muted: this.muted,
                              volume: this.audioVolume,
                              deviceId: this.audioOutputDeviceId,
                            })),
                            this.audioPlayer._emitter.on(
                              "player-state-changed",
                              function (e) {
                                (r._emitter.emit("player-state-changed", {
                                  type: "audio",
                                  state: e.state,
                                  reason: e.reason,
                                }),
                                  "track" === e.type &&
                                    r._emitter.emit("track-state-changed", {
                                      type: "audio",
                                      state: e.state,
                                      reason: e.reason,
                                    }));
                              },
                            ),
                            e.abrupt(
                              "return",
                              new Promise(function (e, t) {
                                r.audioPlayer
                                  .play()
                                  .then(function () {
                                    e();
                                  })
                                  .catch(function (e) {
                                    if (
                                      (r.logger.warn(
                                        "<audio> play() error:" + e,
                                      ),
                                      (e.toString() + " <audio>").startsWith(
                                        "NotAllowedError",
                                      ))
                                    ) {
                                      r.logger.onError({
                                        c: Xe.TOP_ERROR,
                                        v: te.PLAY_NOT_ALLOWED,
                                      });
                                      var i = new de({
                                        code: te.PLAY_NOT_ALLOWED,
                                        message: e.message,
                                      });
                                      (r.logger.buriedLog({
                                        c: Xe.ON_STREAM_ERROR,
                                        v: "code:".concat(te.PLAY_NOT_ALLOWED),
                                      }),
                                        r._emitter.emit($, i),
                                        t(i));
                                    }
                                  });
                              }),
                            )
                          );
                        case 7:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function () {
              return i.apply(this, arguments);
            }),
        },
        {
          key: "getWaterStreamStream",
          value:
            ((r = V(
              H.mark(function e(t) {
                var r,
                  i,
                  n,
                  o,
                  a,
                  s,
                  c,
                  u,
                  d,
                  l = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          return (
                            (r = this.mediaStream),
                            (this.waterMarkVideo =
                              document.createElement("video")),
                            (this.waterMarkVideo.srcObject = r),
                            (e.next = 5),
                            this.waterMarkVideo.play()
                          );
                        case 5:
                          return (
                            (i = r.getVideoTracks()[0]),
                            (n = document.createElement("canvas")),
                            (o = n.getContext("2d")),
                            (a = i.getSettings()),
                            this.logger.info(
                              "settings frameRate ====>",
                              1e3 / a.frameRate,
                            ),
                            (s = Math.floor(1e3 / 15)),
                            (u = Date.now()),
                            (n.width = a.width),
                            (n.height = a.height),
                            (function e() {
                              var r = i.getSettings().frameRate;
                              (r && (s = Math.floor(1e3 / r)),
                                s < 1e3 / 15 && (s = Math.floor(1e3 / 15)),
                                l.timer && cancelAnimationFrame(l.timer),
                                (l.timer = requestAnimationFrame(e)),
                                (c = Date.now()),
                                (d = c - u) > s &&
                                  ((u = c - d / s),
                                  o.drawImage(
                                    l.waterMarkVideo,
                                    0,
                                    0,
                                    n.width,
                                    n.height,
                                  ),
                                  o.drawImage(t, 0, 0, a.width, a.height)));
                            })(),
                            (this.waterStreamStream = n.captureStream()),
                            e.abrupt("return", this.waterStreamStream)
                          );
                        case 17:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function (e) {
              return r.apply(this, arguments);
            }),
        },
        {
          key: "startWaterMark",
          value: function (e, t) {
            var r = this;
            return (
              this.logger.info(this.userId + " startWaterMark", e),
              new Promise(
                (function () {
                  var i = V(
                    H.mark(function i(n, o) {
                      var a, s;
                      return H.wrap(function (i) {
                        for (;;)
                          switch ((i.prev = i.next)) {
                            case 0:
                              if (!r.waterStreamStream) {
                                i.next = 2;
                                break;
                              }
                              return i.abrupt(
                                "return",
                                o("waterMark is starting"),
                              );
                            case 2:
                              if (
                                ((r.waterMarkoptions = e),
                                (r.waterMarkImage = t),
                                r.type === Q && r.isRemote)
                              ) {
                                i.next = 6;
                                break;
                              }
                              return i.abrupt(
                                "return",
                                o(
                                  "waterMark is only support remoteStream and screenShare",
                                ),
                              );
                            case 6:
                              if (!r.videoPlayer) {
                                i.next = 17;
                                break;
                              }
                              return ((i.next = 9), r.getWaterStreamStream(t));
                            case 9:
                              ((a = i.sent.getVideoTracks()[0]),
                                (s = new MediaStream()).addTrack(a),
                                (r.getVideoElement().srcObject = s),
                                (i.next = 18));
                              break;
                            case 17:
                              r.isWaterMark = !0;
                            case 18:
                              n();
                            case 19:
                            case "end":
                              return i.stop();
                          }
                      }, i);
                    }),
                  );
                  return function (e, t) {
                    return i.apply(this, arguments);
                  };
                })(),
              )
            );
          },
        },
        {
          key: "closeWaterMark",
          value: function () {
            if (
              this.waterStreamStream &&
              (this.logger.info(this.userId + " closeWaterMark"),
              (this.isWaterMark = !1),
              (this.waterStreamStream = null),
              (this.waterMarkImage = null),
              (this.waterMarkoptions = null),
              this.timer &&
                (cancelAnimationFrame(this.timer), (this.timer = null)),
              this.waterMarkVideo &&
                ((this.waterMarkVideo.srcObject = null),
                (this.waterMarkVideo = null)),
              this.isPlaying)
            ) {
              var e = this.getVideoElement(),
                t = this.getVideoTrack(),
                r = new MediaStream();
              (r.addTrack(t), (e.srcObject = r));
            }
          },
        },
        {
          key: "setLocalUserId",
          value: function (e) {
            this.localId = e;
          },
        },
        {
          key: "playVideo",
          value:
            ((t = V(
              H.mark(function e() {
                var t,
                  r = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (
                            ((t = this.getVideoTrack()), !this.videoPlayer && t)
                          ) {
                            e.next = 3;
                            break;
                          }
                          return e.abrupt("return");
                        case 3:
                          if (!this.isWaterMark) {
                            e.next = 8;
                            break;
                          }
                          return (
                            (e.next = 6),
                            this.getWaterStreamStream(this.waterMarkImage)
                          );
                        case 6:
                          t = e.sent.getVideoTracks()[0];
                        case 8:
                          return (
                            this.logger.info(
                              "stream - create VideoPlayer and play",
                            ),
                            (this.videoPlayer = new De({
                              stream: this,
                              track: t,
                              div: this.div,
                              muted: this.muted,
                              objectFit: this.objectFit,
                              mirror: this.mirror,
                              isAlphaChannels: this.isAlphaChannels,
                              virtualBackground: this.virtualBackground,
                              virtualBackgroundMix: this.virtualBackgroundMix,
                              isEleLisenter: this.isEleLisenter,
                            })),
                            this.videoPlayer._emitter.on(
                              "player-state-changed",
                              function (e) {
                                (r._emitter.emit("player-state-changed", {
                                  type: "video",
                                  state: e.state,
                                  reason: e.reason,
                                }),
                                  "track" === e.type &&
                                    r._emitter.emit("track-state-changed", {
                                      type: "video",
                                      state: e.state,
                                      reason: e.reason,
                                    }));
                              },
                            ),
                            e.abrupt(
                              "return",
                              new Promise(function (e, t) {
                                r.videoPlayer
                                  .play()
                                  .then(function () {
                                    e();
                                  })
                                  .catch(function (e) {
                                    if (
                                      (r.logger.warn(
                                        "<video> play() error:" + e,
                                      ),
                                      (e.toString() + " <video>").startsWith(
                                        "NotAllowedError",
                                      ))
                                    ) {
                                      r.logger.onError({
                                        c: Xe.TOP_ERROR,
                                        v: te.PLAY_NOT_ALLOWED,
                                      });
                                      var i = new de({
                                        code: te.PLAY_NOT_ALLOWED,
                                        message: e.message,
                                      });
                                      (r.logger.buriedLog({
                                        c: Xe.ON_STREAM_ERROR,
                                        v: "code:".concat(te.PLAY_NOT_ALLOWED),
                                      }),
                                        r._emitter.emit($, i),
                                        t(i));
                                    }
                                  });
                              }),
                            )
                          );
                        case 12:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function () {
              return t.apply(this, arguments);
            }),
        },
        {
          key: "stopAudio",
          value: function () {
            this.audioPlayer &&
              (this.logger.info("stream - stop AudioPlayer"),
              this.audioPlayer.stop(),
              (this.audioPlayer = null));
          },
        },
        {
          key: "stopVideo",
          value: function () {
            this.videoPlayer &&
              (this.logger.info("stream - stop VideoPlayer"),
              this.videoPlayer.stop(),
              (this.videoPlayer = null));
          },
        },
        {
          key: "checkMediaStream",
          value: function () {
            return !!this.mediaStream;
          },
        },
        {
          key: "restartAudio",
          value: function () {
            this.isPlaying && (this.stopAudio(), this.playAudio());
          },
        },
        {
          key: "restartVideo",
          value: function () {
            this.isPlaying && (this.stopVideo(), this.playVideo());
          },
        },
        {
          key: "setMediaStream",
          value: function (e) {
            this.mediaStream = e;
          },
        },
        {
          key: "setSimulcasts",
          value: function (e) {
            this.info.video.simulcast = e;
          },
        },
        {
          key: "getSimulcasts",
          value: function () {
            try {
              return this.info.video.simulcast || [];
            } catch (e) {
              return [];
            }
          },
        },
        {
          key: "setInfo",
          value: function (e) {
            this.info = e;
          },
        },
        {
          key: "getType",
          value: function () {
            return this.type || "main";
          },
        },
        {
          key: "getAudioElement",
          value: function () {
            return this.audioPlayer && this.audioPlayer.getAudioElement();
          },
        },
        {
          key: "getVideoElement",
          value: function () {
            return this.videoPlayer && this.videoPlayer.getVideoElement();
          },
        },
        {
          key: "setAudioTrack",
          value: function (e) {
            ((e.enabled = this.audioTrackEnabled),
              this.audioPlayer
                ? this.audioPlayer.setAudioTrack(e)
                : this.playAudio());
          },
        },
        {
          key: "setVideoTrack",
          value: function (e) {
            ((e.enabled = this.videoTrackEnabled),
              this.videoPlayer
                ? this.videoPlayer.setVideoTrack(e)
                : this.playVideo());
          },
        },
        {
          key: "setAudioStreamId",
          value: function (e) {
            this.audioStreamId = e;
          },
        },
        {
          key: "setVideoStreamId",
          value: function (e) {
            this.videoStreamId = e;
          },
        },
        {
          key: "addUid",
          value: function () {
            if (this.isRemote) return "uid:".concat(this.getUserId());
          },
        },
        {
          key: "getAudioMuted",
          value: function () {
            return (
              (this.getAudioTrack() && !this.audioTrackEnabled) ||
              this.audioMuted
            );
          },
        },
        {
          key: "getVideoMuted",
          value: function () {
            return (
              (this.getVideoTrack() && !this.videoTrackEnabled) ||
              this.videoMuted
            );
          },
        },
        {
          key: "updatePeerConnectionFailed",
          value: function (e) {
            if ("failed" === e) {
              (this.pcFailedCount++,
                this.logger.onError({
                  c: Xe.TOP_ERROR,
                  v: te.RTCPEERCONNECTION_SATE_FAILED,
                }));
              var t = new de({
                code: te.RTCPEERCONNECTION_SATE_FAILED,
                message: '{"count":'.concat(this.pcFailedCount, "}"),
              });
              (this._emitter.emit($, t),
                this.logger.warn(
                  "updatePeerConnectionFailed,count:".concat(
                    this.pcFailedCount,
                  ),
                ));
            } else
              "connected" === e &&
                0 !== this.pcFailedCount &&
                (this.pcFailedCount = 0);
          },
        },
        {
          key: "setMutedState",
          value: function (e, t) {
            "audio" === e
              ? (this.audioMuted = t)
              : "video" === e && (this.videoMuted = t);
          },
        },
        {
          key: "setIsAlphaChannels",
          value: function (e) {
            (this.logger.info("set isAlphaChannels", e),
              (this.isAlphaChannels = e));
          },
        },
        {
          key: "hasAlphaChannels",
          value: function () {
            return this.isAlphaChannels;
          },
        },
        {
          key: "setVirtualBackground",
          value: function (e) {
            var t =
              arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
            if (this.virtualBackground)
              return (
                this.logger.warn("The virtual background has already been set"),
                !1
              );
            return ["IMG", "VIDEO"].includes(e.nodeName)
              ? (this.logger.info(
                  "set virtual background,element:"
                    .concat(e.nodeName, ",mix:")
                    .concat(t),
                ),
                (this.virtualBackground = e),
                (this.virtualBackgroundMix = "VIDEO" === e.nodeName || t),
                !0)
              : (this.logger.warn("Element must be img or video"), !1);
          },
        },
        {
          key: "resize",
          value: function () {
            return this.isAlphaChannels
              ? this.videoPlayer
                ? void this.videoPlayer.resize()
                : (this.logger.warn("Please play video first"), !1)
              : (this.logger.warn(
                  "Please start the stream containing alpha channel first",
                ),
                !1);
          },
        },
      ]),
      e
    );
  })(),
  st = new Map();
(st.set("standard", { sampleRate: 48e3, channelCount: 1, bitrate: 40 }),
  st.set("high", { sampleRate: 48e3, channelCount: 1, bitrate: 128 }));
var ct = new Map();
(ct.set("120p", { width: 160, height: 120, frameRate: 15, bitrate: 200 }),
  ct.set("180p", { width: 320, height: 180, frameRate: 15, bitrate: 350 }),
  ct.set("240p", { width: 320, height: 240, frameRate: 15, bitrate: 400 }),
  ct.set("360p", { width: 640, height: 360, frameRate: 15, bitrate: 800 }),
  ct.set("480p", { width: 640, height: 480, frameRate: 15, bitrate: 900 }),
  ct.set("720p", { width: 1280, height: 720, frameRate: 15, bitrate: 1500 }),
  ct.set("1080p", { width: 1920, height: 1080, frameRate: 15, bitrate: 2e3 }),
  ct.set("1440p", { width: 2560, height: 1440, frameRate: 30, bitrate: 4860 }),
  ct.set("4K", { width: 3840, height: 2160, frameRate: 30, bitrate: 9e3 }));
var ut = new Map();
function dt(e) {
  return (
    "function" == typeof Symbol && "symbol" == ne(Symbol.iterator)
      ? function (e) {
          return ne(e);
        }
      : function (e) {
          return e &&
            "function" == typeof Symbol &&
            e.constructor === Symbol &&
            e !== Symbol.prototype
            ? "symbol"
            : ne(e);
        }
  )(e);
}
(ut.set("480p", { width: 640, height: 480, frameRate: 5, bitrate: 900 }),
  ut.set("480p_2", { width: 640, height: 480, frameRate: 30, bitrate: 1e3 }),
  ut.set("720p", { width: 1280, height: 720, frameRate: 5, bitrate: 1200 }),
  ut.set("720p_2", { width: 1280, height: 720, frameRate: 30, bitrate: 3e3 }),
  ut.set("1080p", { width: 1920, height: 1080, frameRate: 5, bitrate: 1600 }),
  ut.set("1080p_2", {
    width: 1920,
    height: 1080,
    frameRate: 30,
    bitrate: 4e3,
  }));
var lt,
  ht = (window.navigator && window.navigator.userAgent) || "",
  pt = /Edge\//i.test(ht),
  ft = (lt = ht.match(/Chrome\/(\d+)/)) && lt[1] ? parseFloat(lt[1]) : null;
function mt(e, t) {
  return new Promise(function (r, i) {
    var n = document.createElement("canvas"),
      o = n.getContext("2d");
    ((n.width = 1920), (n.height = 1080));
    var a = document.createElement("canvas");
    ((a.width = 400), (a.height = 200), (a.style.border = "1px solid"));
    var s = a.getContext("2d");
    (s.rotate((-20 * Math.PI) / 180),
      (s.font = "".concat(e.fontSize, "px ").concat(e.fontType)),
      (s.fillStyle = e.fontColor),
      (s.textBaseline = "middle"),
      s.fillText(t, 0, 90));
    var c = new Image();
    ((c.src = a.toDataURL("image/png")),
      (c.onload = function () {
        ((o.fillStyle = o.createPattern(c, "repeat")),
          o.fillRect(0, 0, n.width, n.height));
        var e = new Image();
        return ((e.src = n.toDataURL("image/png")), r(e));
      }));
  });
}
function vt(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function gt(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? vt(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : vt(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
var yt = (function (e) {
  ie(a, at);
  var t,
    r,
    i,
    n,
    o = (function (e) {
      var t = (function () {
        if ("undefined" == typeof Reflect || !Reflect.construct) return !1;
        if (Reflect.construct.sham) return !1;
        if ("function" == typeof Proxy) return !0;
        try {
          return (
            Boolean.prototype.valueOf.call(
              Reflect.construct(Boolean, [], function () {}),
            ),
            !0
          );
        } catch (e) {
          return !1;
        }
      })();
      return function () {
        var r,
          i = se(e);
        if (t) {
          var n = se(this).constructor;
          r = Reflect.construct(i, arguments, n);
        } else r = i.apply(this, arguments);
        return ae(this, r);
      };
    })(a);
  function a(e, t) {
    var r;
    return (
      F(this, a),
      ((r = o.call(this, e, t)).screen = e.screen),
      (r.audioProfile = st.get("standard")),
      (r.videoProfile = ct.get("480p")),
      (r.screenProfile = ut.get("1080p")),
      (r.bitrate = {
        audio: r.audioProfile.bitrate,
        video: r.screen ? r.screenProfile.bitrate : r.videoProfile.bitrate,
      }),
      (r.cameraId_ = e.cameraId || ""),
      (r.cameraGroupId_ = ""),
      (r.microphoneId_ = e.microphoneId || ""),
      (r.microphoneGroupId_ = ""),
      (r.cameraLabel_ = ""),
      (r.microphoneLabel_ = ""),
      (r.recoverCaptureCount_ = 0),
      (r.published = !1),
      (r.audioPubState = Y.Create),
      (r.videoPubState = Y.Create),
      r._emitter.on("track-state-changed", r.onTrackStopped.bind(oe(r))),
      r
    );
  }
  return (
    W(a, [
      {
        key: "initialize",
        value:
          ((n = V(
            H.mark(function e(t) {
              var r = this;
              return H.wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return (
                          this.logger.info(
                            "initialize stream audio: "
                              .concat(this.constraints.audio, " video: ")
                              .concat(this.constraints.video),
                          ),
                          e.abrupt(
                            "return",
                            new Promise(function (e, i) {
                              return r.screen
                                ? r
                                    .initShareStream({
                                      audio: r.streamConfig.audio,
                                      screenAudio: r.streamConfig.screenAudio,
                                      microphoneId: r.microphoneId_,
                                      width: r.screenProfile.width,
                                      height: r.screenProfile.height,
                                      frameRate: r.screenProfile.frameRate,
                                      sampleRate: r.audioProfile.sampleRate,
                                      channelCount: r.audioProfile.channelCount,
                                      customStream: t,
                                    })
                                    .then(function (t) {
                                      r.mediaStream = t;
                                      var i = t.getAudioTracks().length > 0,
                                        n = t.getVideoTracks().length > 0;
                                      (r.setHasAudio(i),
                                        r.setHasVideo(n),
                                        r.setMutedState("audio", !i),
                                        r.setMutedState("video", !n),
                                        r.listenForScreenSharingStopped(
                                          t.getVideoTracks()[0],
                                        ),
                                        r.setVideoContentHint("detail"),
                                        r.updateDeviceIdInUse(),
                                        e(t),
                                        r.logger.info(
                                          "init share stream success",
                                        ));
                                    })
                                    .catch(function (e) {
                                      r.logger.onError(
                                        {
                                          c: Xe.TOP_ERROR,
                                          v: te.INIT_STREAM_FAILED,
                                        },
                                        "init share stream failed,"
                                          .concat(e.name, ":")
                                          .concat(e.message),
                                      );
                                      var t = new de({
                                        code: te.INIT_STREAM_FAILED,
                                        message: e.message,
                                        name: e.name,
                                      });
                                      i(t);
                                    })
                                : r
                                    .initAvStream({
                                      audio: r.streamConfig.audio,
                                      video: r.streamConfig.video,
                                      facingMode: r.streamConfig.facingMode,
                                      cameraId: r.cameraId_,
                                      microphoneId: r.microphoneId_,
                                      width: r.videoProfile.width,
                                      height: r.videoProfile.height,
                                      frameRate: r.videoProfile.frameRate,
                                      sampleRate: r.audioProfile.sampleRate,
                                      channelCount: r.audioProfile.channelCount,
                                      customStream: t,
                                    })
                                    .then(function (t) {
                                      r.mediaStream = t;
                                      var i = t.getAudioTracks().length > 0,
                                        n = t.getVideoTracks().length > 0;
                                      (r.setHasAudio(i),
                                        r.setHasVideo(n),
                                        r.setMutedState("audio", !i),
                                        r.setMutedState("video", !n),
                                        r.updateDeviceIdInUse(),
                                        (r.videoSetting =
                                          n &&
                                          t.getVideoTracks()[0].getSettings()),
                                        e(t),
                                        r.logger.info(
                                          "init local stream success",
                                        ));
                                    })
                                    .catch(function (e) {
                                      r.logger.onError(
                                        {
                                          c: Xe.TOP_ERROR,
                                          v: te.INIT_STREAM_FAILED,
                                        },
                                        "init localstream failed,"
                                          .concat(e.name, ":")
                                          .concat(e.message),
                                      );
                                      var t = new de({
                                        code: te.INIT_STREAM_FAILED,
                                        message: e.message,
                                        name: e.name,
                                      });
                                      i(t);
                                    })
                                    .finally(
                                      V(
                                        H.mark(function e() {
                                          return H.wrap(function (e) {
                                            for (;;)
                                              switch ((e.prev = e.next)) {
                                                case 0:
                                                  return ((e.next = 2), et());
                                                case 2:
                                                  r.logger.info(
                                                    "mediaDevices",
                                                    JSON.stringify(
                                                      e.sent,
                                                      null,
                                                      4,
                                                    ),
                                                  );
                                                case 4:
                                                case "end":
                                                  return e.stop();
                                              }
                                          }, e);
                                        }),
                                      ),
                                    );
                            }),
                          )
                        );
                      case 2:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          )),
          function (e) {
            return n.apply(this, arguments);
          }),
      },
      {
        key: "initAvStream",
        value:
          ((i = V(
            H.mark(function e(t) {
              var r, i, n, o, a, s;
              return H.wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        if (!t.customStream) {
                          e.next = 2;
                          break;
                        }
                        return e.abrupt(
                          "return",
                          Promise.resolve(t.customStream),
                        );
                      case 2:
                        if (navigator.mediaDevices) {
                          e.next = 5;
                          break;
                        }
                        return (
                          this.logger.onError(
                            { c: Xe.TOP_ERROR, v: te.DEVICE_NOT_FOUND },
                            "navigator.mediaDevices is undefined",
                          ),
                          e.abrupt("return", Promise.reject())
                        );
                      case 5:
                        if (
                          ((i = { audio: t.audio, video: t.video }), !t.audio)
                        ) {
                          e.next = 20;
                          break;
                        }
                        return ((e.next = 9), rt());
                      case 9:
                        if (0 !== (r = e.sent).length) {
                          e.next = 15;
                          break;
                        }
                        throw (
                          this.logger.onError({
                            c: Xe.TOP_ERROR,
                            v: te.DEVICE_NOT_FOUND,
                          }),
                          new de({
                            code: te.DEVICE_NOT_FOUND,
                            message:
                              "no microphone detected, but you are trying to get audio stream, please check your microphone and the configeration on XRTC.createStream.",
                          })
                        );
                      case 15:
                        ((n = r.filter(function (e) {
                          return e.deviceId.length > 0;
                        })).length > 0 && (o = n[0].deviceId),
                          (a = r.filter(function (e) {
                            return "default" === e.deviceId;
                          })).length > 0 && (s = a[0].deviceId),
                          (i.audio = {
                            deviceId: { exact: t.microphoneId || s || o },
                            echoCancellation: !0,
                            autoGainControl: !0,
                            noiseSuppression: !0,
                            sampleRate: t.sampleRate,
                            channelCount: t.channelCount,
                          }));
                      case 20:
                        if (!t.video) {
                          e.next = 32;
                          break;
                        }
                        return ((e.next = 23), tt());
                      case 23:
                        if (0 !== e.sent.length) {
                          e.next = 29;
                          break;
                        }
                        throw (
                          this.logger.onError({
                            c: Xe.TOP_ERROR,
                            v: te.DEVICE_NOT_FOUND,
                          }),
                          new de({
                            code: te.DEVICE_NOT_FOUND,
                            message:
                              "no camera detected, but you are trying to get video stream, please check your camera and the configeration on XRTC.createStream.",
                          })
                        );
                      case 29:
                        ((i.video = {
                          width: t.width,
                          height: t.height,
                          frameRate: t.frameRate,
                        }),
                          t.cameraId &&
                            (i.video = gt(
                              gt({}, i.video),
                              {},
                              { deviceId: { exact: t.cameraId } },
                            )),
                          t.facingMode &&
                            (i.video = gt(
                              gt({}, i.video),
                              {},
                              { facingMode: t.facingMode },
                            )));
                      case 32:
                        return e.abrupt(
                          "return",
                          navigator.mediaDevices.getUserMedia(i),
                        );
                      case 33:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          )),
          function (e) {
            return i.apply(this, arguments);
          }),
      },
      {
        key: "initShareStream",
        value: function (e) {
          if (e.customStream) return Promise.resolve(e.customStream);
          if (!navigator.mediaDevices)
            return (
              this.logger.onError(
                { c: Xe.TOP_ERROR, v: te.DEVICE_NOT_FOUND },
                "navigator.mediaDevices is undefined",
              ),
              Promise.reject()
            );
          if (e.screenAudio)
            pt || ft < 74
              ? this.logger.onError(
                  { c: Xe.TOP_ERROR, v: te.BROWSER_NOT_SUPPORTED },
                  "Your browser not support capture system audio",
                )
              : (e.audioConstraints = {
                  echoCancellation: !0,
                  noiseSuppression: !0,
                  sampleRate: 44100,
                });
          else if (e.audio) {
            var t = {
                audio: e.microphoneId
                  ? {
                      deviceId: { exact: e.microphoneId },
                      sampleRate: e.sampleRate,
                      channelCount: e.channelCount,
                    }
                  : { sampleRate: e.sampleRate, channelCount: e.channelCount },
                video: !1,
              },
              r = this.setConstraints(e);
            return (
              this.logger.info(
                "getDisplayMedia with contraints1: " + JSON.stringify(r),
              ),
              new Promise(
                (function () {
                  var e = V(
                    H.mark(function e(i, n) {
                      var o;
                      return H.wrap(
                        function (e) {
                          for (;;)
                            switch ((e.prev = e.next)) {
                              case 0:
                                return (
                                  (e.prev = 0),
                                  (e.next = 3),
                                  navigator.mediaDevices.getDisplayMedia(r)
                                );
                              case 3:
                                ((o = e.sent),
                                  navigator.mediaDevices
                                    .getUserMedia(t)
                                    .then(function (e) {
                                      (o.addTrack(e.getAudioTracks()[0]), i(o));
                                    }),
                                  (e.next = 10));
                                break;
                              case 7:
                                ((e.prev = 7), (e.t0 = e.catch(0)), n(e.t0));
                              case 10:
                              case "end":
                                return e.stop();
                            }
                        },
                        e,
                        null,
                        [[0, 7]],
                      );
                    }),
                  );
                  return function (t, r) {
                    return e.apply(this, arguments);
                  };
                })(),
              )
            );
          }
          var i = this.setConstraints(e);
          return (
            this.logger.info(
              "getDisplayMedia with contraints2: " + JSON.stringify(i),
            ),
            navigator.mediaDevices.getDisplayMedia(i)
          );
        },
      },
      {
        key: "setAudioProfile",
        value: function (e) {
          var t;
          this.mediaStream
            ? this.logger.warn("Please set audio profile before initialize!")
            : ("object" === dt(e)
                ? (t = e)
                : void 0 === (t = st.get(e)) && (t = st.get("standard")),
              this.logger.info("setAudioProfile: " + JSON.stringify(t)),
              this.logger.buriedLog({
                c: Xe.SET_AUDIO_PROFILE,
                v: JSON.stringify(t),
              }),
              (this.audioProfile = t),
              (this.bitrate.audio = t.bitrate));
        },
      },
      {
        key: "setVideoProfile",
        value:
          ((r = V(
            H.mark(function e(t) {
              var r;
              return H.wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        if (!this.mediaStream) {
                          e.next = 3;
                          break;
                        }
                        return (
                          this.logger.warn(
                            "Please set video profile before initialize!",
                          ),
                          e.abrupt("return")
                        );
                      case 3:
                        ("object" === dt(t)
                          ? (r = t)
                          : void 0 === (r = ct.get(t)) && (r = ct.get("480p")),
                          this.logger.info(
                            "setVideoProfile " + JSON.stringify(r),
                          ),
                          this.logger.buriedLog({
                            c: Xe.SET_VIDEO_PROFILE,
                            v: JSON.stringify(r),
                          }),
                          (this.videoProfile = r),
                          (this.bitrate.video = r.bitrate));
                      case 8:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          )),
          function (e) {
            return r.apply(this, arguments);
          }),
      },
      {
        key: "setScreenProfile",
        value: function (e) {
          var t;
          this.mediaStream
            ? this.logger.warn("Please set screen profile before initialize!")
            : ("object" === dt(e)
                ? (t = e)
                : void 0 === (t = ut.get(e)) && (t = ut.get("1080p_2")),
              this.logger.info("setScreenProfile " + JSON.stringify(t)),
              this.logger.buriedLog({
                c: Xe.SET_SCREEN_PROFILE,
                v: JSON.stringify(t),
              }),
              (this.screenProfile = t),
              (this.bitrate.video = t.bitrate));
        },
      },
      {
        key: "setConstraints",
        value: function (e) {
          var t = {};
          return (
            (t.video = {
              width: e.width,
              height: e.height,
              frameRate: e.frameRate,
            }),
            void 0 !== e.audioConstraints && (t.audio = e.audioConstraints),
            (this.constraints = t),
            t
          );
        },
      },
      {
        key: "getBitrate",
        value: function () {
          return this.bitrate;
        },
      },
      {
        key: "addTrack",
        value: function (e) {
          var t = this;
          if (!this.mediaStream)
            throw (
              this.logger.onError({ c: Xe.TOP_ERROR, v: te.ADD_TRACK_FAILED }),
              new de({
                code: te.ADD_TRACK_FAILED,
                message: "the local stream is not initialized yet",
              })
            );
          if (
            ("audio" === e.kind && this.getAudioTracks().length > 0) ||
            ("video" === e.kind && this.getVideoTracks().length > 0)
          )
            throw (
              this.logger.onError({ c: Xe.TOP_ERROR, v: te.ADD_TRACK_FAILED }),
              new de({
                code: te.ADD_TRACK_FAILED,
                message:
                  "A Stream has at most one audio track and one video track",
              })
            );
          var r = e.getSettings();
          return (
            "video" === e.kind &&
              r &&
              this.videoSetting &&
              (r.width !== this.videoSetting.width ||
                r.height !== this.videoSetting.height) &&
              this.logger.warn(
                "video resolution of the track "
                  .concat(r.width, " x ")
                  .concat(r.height, " shall be kept the same as the previous: ")
                  .concat(this.videoSetting.width, " x ")
                  .concat(this.videoSetting.height),
              ),
            new Promise(function (i, n) {
              (t._emitter.once("stream-track-update-result", function (e) {
                var r = e.code,
                  o = e.message;
                if ((t.logger.info("add track response", r), 1 === r)) i(!0);
                else {
                  t.logger.onError({ c: Xe.TOP_ERROR, v: te.ADD_TRACK_FAILED });
                  var a = new de({
                    code: te.ADD_TRACK_FAILED,
                    message: o || "add track failed",
                  });
                  n(a);
                }
              }),
                "video" === e.kind
                  ? ((t.cameraId_ = r.deviceId), (t.cameraGroupId_ = r.groupId))
                  : "audio" === e.kind &&
                    ((t.microphoneId_ = r.deviceId),
                    (t.microphoneGroupId_ = r.groupId)),
                t.setEnableTrackFlag(e.kind, e.enabled),
                t.logger.buriedLog({
                  c:
                    "audio" === e.kind
                      ? t.type === Q
                        ? Xe.ADD_AUDIO_TRACK_SCREEN
                        : Xe.ADD_AUDIO_TRACK
                      : t.type === Q
                        ? Xe.ADD_VIDEO_TRACK_SCREEN
                        : Xe.ADD_VIDEO_TRACK,
                }),
                t._emitter.emit("stream-add-track", {
                  track: e,
                  streamId: t.streamId,
                }));
            })
          );
        },
      },
      {
        key: "removeTrack",
        value: function (e) {
          var t = this;
          if (e && "audio" === e.kind)
            throw (
              this.logger.onError({
                c: Xe.TOP_ERROR,
                v: te.INVALID_PARAMETER,
              }),
              new de({
                code: te.INVALID_PARAMETER,
                message: "remove audio track is not supported",
              })
            );
          if (!this.mediaStream)
            throw new de({
              code: te.INVALID_OPERATION,
              message: "the local stream is not initialized yet",
            });
          if (-1 === this.mediaStream.getTracks().indexOf(e))
            throw (
              this.logger.onError({
                c: Xe.TOP_ERROR,
                v: te.INVALID_PARAMETER,
              }),
              new de({
                code: te.INVALID_PARAMETER,
                message: "the track to be removed is not being publishing",
              })
            );
          if (!this.supportPC())
            throw new de({
              code: te.INVALID_OPERATION,
              message: "removeTrack is not supported in this browser",
            });
          return (
            this.logger.info(
              "remove video track from current published stream",
            ),
            new Promise(function (r, i) {
              (t._emitter.once("stream-track-update-result", function (e) {
                var n = e.code,
                  o = e.message;
                if ((t.logger.info("remove track response", n), 1 === n)) r(!0);
                else {
                  t.logger.onError({
                    c: Xe.TOP_ERROR,
                    v: te.REMOVE_TRACK_FAILED,
                  });
                  var a = new de({
                    code: te.REMOVE_TRACK_FAILED,
                    message: o || "remove track failed",
                  });
                  i(a);
                }
              }),
                t.logger.buriedLog({
                  c: t.type === Q ? Xe.REMOVE_TRACK_SCREEN : Xe.REMOVE_TRACK,
                }),
                t._emitter.emit("stream-remove-track", {
                  track: e,
                  streamId: t.streamId,
                }));
            })
          );
        },
      },
      {
        key: "replaceTrack",
        value: function (e) {
          if (!this.mediaStream)
            throw new de({
              code: te.INVALID_OPERATION,
              message: "the local stream is not initialized yet",
            });
          var t = e.getSettings();
          if (
            ("video" === e.kind &&
              t &&
              this.videoSetting &&
              (t.width !== this.videoSetting.width ||
                t.height !== this.videoSetting.height) &&
              this.logger.warn(
                "video resolution of the track "
                  .concat(t.width, " x ")
                  .concat(t.height, " shall be kept the same as the previous: ")
                  .concat(this.videoSetting.width, " x ")
                  .concat(this.videoSetting.height),
              ),
            "audio" === e.kind
              ? (this.mediaStream.removeTrack(this.getAudioTrack()),
                this.mediaStream.addTrack(e),
                (e.enabled = !this.getAudioMuted()),
                this.restartAudio())
              : (this.mediaStream.removeTrack(this.getVideoTrack()),
                this.mediaStream.addTrack(e),
                (e.enabled = !this.getVideoMuted()),
                this.restartVideo()),
            !this.isReplaceTrackAvailable() || !this.supportPC())
          )
            throw new de({
              code: te.INVALID_OPERATION,
              message:
                "replaceTrack is not supported in this browser, please use switchDevice or addTrack instead",
            });
          (this.logger.buriedLog({
            c:
              "audio" === e.kind
                ? this.type === Q
                  ? Xe.REPLACE_AUDIO_TRACK_SCREEN
                  : Xe.REPLACE_AUDIO_TRACK
                : this.type === Q
                  ? Xe.REPLACE_VIDEO_TRACK_SCREEN
                  : Xe.REPLACE_VIDEO_TRACK,
          }),
            this._emitter.emit("stream-replace-track", {
              streamId: this.streamId,
              type: e.kind,
              track: e,
            }));
        },
      },
      {
        key: "setVideoContentHint",
        value: function (e) {
          var t = this.getVideoTrack();
          t &&
            "contentHint" in t &&
            (this.logger.info("set video track contentHint to: " + e),
            (t.contentHint = e),
            t.contentHint !== e &&
              this.logger.info("Invalid video track contentHint: " + e),
            this.logger.buriedLog({
              c: Xe.SET_VIDEO_CONTENT_HINT,
              v: "hint".concat(e),
            }));
        },
      },
      {
        key: "switchDevice",
        value: function (e, t) {
          var r,
            i,
            n = this;
          if (this.screen)
            throw new de({
              code: te.INVALID_OPERATION,
              message: "switch device is not supported in screen sharing",
            });
          if (
            !t ||
            this.streamConfig.audioSource ||
            this.streamConfig.videoSource
          )
            return Promise.reject();
          if (
            ("audio" === e && this.microphoneId_ === t) ||
            ("video" === e && this.cameraId_ === t)
          )
            return (
              this.logger.warn("switch device is not supported same device"),
              Promise.reject("switch device is not supported same device")
            );
          if (
            (this.logger.info("switchDevice " + e + " to: " + t),
            "audio" === e && this.microphoneId_ !== t)
          ) {
            if (!(r = this.getAudioTrack()))
              return ((this.microphoneId_ = t), Promise.resolve());
            (r && r.stop(),
              (this.microphoneId_ = t),
              this.logger.buriedLog({
                c: Xe.SWITCH_DEVICE_AUDIO,
                v: "deviceId:".concat(t),
              }));
          }
          if ("video" === e && this.cameraId_ !== t) {
            if (!(i = this.getVideoTrack()))
              return ((this.cameraId_ = t), Promise.resolve());
            (i && i.stop(),
              (this.cameraId_ = t),
              this.logger.buriedLog({
                c: Xe.SWITCH_DEVICE_VIDEO,
                v: "deviceId:".concat(t),
              }));
          }
          return new Promise(function (t, o) {
            n.initAvStream({
              audio: "audio" === e,
              video: "video" === e,
              facingMode: n.streamConfig.facingMode,
              cameraId: n.cameraId_,
              microphoneId: n.microphoneId_,
              width: n.videoProfile.width,
              height: n.videoProfile.height,
              frameRate: n.videoProfile.frameRate,
              sampleRate: n.audioProfile.sampleRate,
              channelCount: n.audioProfile.channelCount,
            })
              .then(function (o) {
                ("audio" === e &&
                  (n.mediaStream.removeTrack(r),
                  (r = o.getAudioTracks()[0]) && n.mediaStream.addTrack(r),
                  r && n.setHasAudio(!0),
                  r &&
                    n._emitter.emit("stream-switch-device", {
                      streamId: n.streamId,
                      type: e,
                      track: r,
                    }),
                  n.updateDeviceIdInUse("audio"),
                  (r.enabled = !n.getAudioMuted()),
                  n.restartAudio()),
                  "video" == e &&
                    (n.mediaStream.removeTrack(i),
                    (i = o.getVideoTracks()[0]) && n.mediaStream.addTrack(i),
                    i && n.setHasVideo(!0),
                    i &&
                      n._emitter.emit("stream-switch-device", {
                        streamId: n.streamId,
                        type: e,
                        track: i,
                      }),
                    n.updateDeviceIdInUse("video"),
                    (i.enabled = !n.getVideoMuted()),
                    n.restartVideo()),
                  t());
              })
              .catch(function (e) {
                ((n.microphoneId_ = ""),
                  (n.cameraId_ = ""),
                  n.logger.onError({
                    c: Xe.TOP_ERROR,
                    v: te.SWITCH_DEVICE_FAILED,
                  }),
                  o(
                    new de({
                      code: te.SWITCH_DEVICE_FAILED,
                      message: "init audio or video stream failed",
                    }),
                  ),
                  n.logger.onError({
                    c: Xe.TOP_ERROR,
                    v: te.SWITCH_DEVICE_FAILED,
                  }));
                var t = new de({
                  code: te.SWITCH_DEVICE_FAILED,
                  message: e.message,
                });
                o(t);
              });
          });
        },
      },
      {
        key: "updateStream",
        value: function (e) {
          var t = this;
          if (
            this.screen ||
            this.streamConfig.audioSource ||
            this.streamConfig.videoSource
          )
            return Promise.reject();
          var r,
            i,
            n = e.audio,
            o = e.video,
            a = e.cameraId,
            s = e.microphoneId;
          return (
            n && (r = this.getAudioTrack()),
            o && (i = this.getVideoTrack()),
            new Promise(function (e, c) {
              t.initAvStream({
                audio: n,
                video: o,
                facingMode: t.streamConfig.facingMode,
                cameraId: a || "",
                microphoneId: s || "",
                width: t.videoProfile.width,
                height: t.videoProfile.height,
                frameRate: t.videoProfile.frameRate,
                sampleRate: t.audioProfile.sampleRate,
                channelCount: t.audioProfile.channelCount,
              })
                .then(function (a) {
                  (n &&
                    (t.logger.info("updateStream audio"),
                    r && r.stop(),
                    t.mediaStream.removeTrack(r),
                    (r = a.getAudioTracks()[0]) && t.mediaStream.addTrack(r),
                    r && t.setHasAudio(!0),
                    r &&
                      t._emitter.emit("stream-switch-device", {
                        streamId: t.streamId,
                        type: "audio",
                        track: r,
                      }),
                    t.updateDeviceIdInUse("audio"),
                    t.setAudioTrack(r)),
                    o &&
                      (t.logger.info("updateStream video"),
                      i && i.stop(),
                      t.mediaStream.removeTrack(i),
                      (i = a.getVideoTracks()[0]) && t.mediaStream.addTrack(i),
                      i && t.setHasVideo(!0),
                      i &&
                        t._emitter.emit("stream-switch-device", {
                          streamId: t.streamId,
                          type: "video",
                          track: i,
                        }),
                      t.updateDeviceIdInUse("video"),
                      t.setVideoTrack(i)),
                    e());
                })
                .catch(function (e) {
                  (t.logger.warn(
                    "NotReadableError" === e.name
                      ? "getUserMedia NotReadableError observed"
                      : e.name,
                    e.message,
                  ),
                    t.logger.onError({
                      c: Xe.TOP_ERROR,
                      v: te.DEVICE_AUTO_RECOVER_FAILED,
                    }));
                  var r = new de({
                    code: te.DEVICE_AUTO_RECOVER_FAILED,
                    message: e,
                  });
                  (c(r), t._emitter.emit($, r));
                });
            })
          );
        },
      },
      {
        key: "getAudioTracks",
        value: function () {
          return this.mediaStream.getAudioTracks();
        },
      },
      {
        key: "getVideoTracks",
        value: function () {
          return this.mediaStream.getVideoTracks();
        },
      },
      {
        key: "isReplaceTrackAvailable",
        value: function () {
          return (
            "RTCRtpSender" in window &&
            "replaceTrack" in window.RTCRtpSender.prototype
          );
        },
      },
      {
        key: "supportPC",
        value: function () {
          return (
            "RTCPeerConnection" in window &&
            "getSenders" in window.RTCPeerConnection.prototype
          );
        },
      },
      {
        key: "listenForScreenSharingStopped",
        value: function (e) {
          var t = this;
          e.addEventListener(
            "ended",
            function (e) {
              (t.logger.info(
                "screen sharing was stopped because the video track is ended",
              ),
                t.logger.buriedLog({ c: Xe.ON_SCREEN_SHARING_STOPPED }),
                t._emitter.emit("screen-sharing-stopped"));
            },
            { once: !0 },
          );
        },
      },
      {
        key: "updateDeviceIdInUse",
        value: function (e) {
          if (!this.mediaStream)
            return (
              (this.microphoneId_ = ""),
              (this.microphoneGroupId_ = ""),
              (this.cameraId_ = ""),
              (this.cameraGroupId_ = ""),
              (this.microphoneLabel_ = ""),
              void (this.cameraLabel_ = "")
            );
          for (
            var t = this.mediaStream.getTracks(), r = t.length, i = 0;
            i < r;
            i++
          ) {
            var n = t[i].getSettings(),
              o = n.deviceId,
              a = n.groupId;
            if (e && o) {
              if (e === t[i].kind && "audio" === t[i].kind) {
                ((this.microphoneId_ = o),
                  (this.microphoneGroupId_ = a),
                  (this.microphoneLabel_ = t[i].label));
                break;
              }
              if (e === t[i].kind && "video" === t[i].kind && !this.screen) {
                ((this.cameraId_ = o),
                  (this.cameraGroupId_ = a),
                  (this.cameraLabel_ = t[i].label));
                break;
              }
            } else
              o &&
                ("audio" === t[i].kind
                  ? ((this.microphoneId_ = o),
                    a && (this.microphoneGroupId_ = a),
                    (this.microphoneLabel_ = t[i].label))
                  : "video" !== t[i].kind ||
                    this.screen ||
                    ((this.cameraId_ = o),
                    a && (this.cameraGroupId_ = a),
                    (this.cameraLabel_ = t[i].label)));
          }
          var s = this.mediaStream.getAudioTracks(),
            c = this.mediaStream.getVideoTracks();
          (s &&
            0 === s.length &&
            ((this.microphoneId_ = ""),
            (this.microphoneGroupId_ = ""),
            (this.microphoneLabel_ = "")),
            c &&
              0 === c.length &&
              ((this.cameraId_ = ""),
              (this.cameraGroupId_ = ""),
              (this.cameraLabel_ = "")),
            this.logger.info(
              "update device id: microphoneId: "
                .concat(this.microphoneId_, ",microphoneLabel:")
                .concat(this.microphoneLabel_, ", microphoneGroupId:")
                .concat(this.microphoneGroupId_, ",cameraId: ")
                .concat(this.cameraId_, ",cameraLabel:")
                .concat(this.cameraLabel_, ",cameraGroupId:")
                .concat(this.cameraGroupId_),
            ));
        },
      },
      {
        key: "getDevicesInfoInUse",
        value: function () {
          return (
            this.logger.buriedLog({
              c: Xe.GET_DEVICES_INFO_IN_USE,
              v: "microphone:"
                .concat(this.microphoneId_, ",camera:")
                .concat(this.cameraId_),
            }),
            {
              camera: {
                deviceId: this.cameraId_,
                groupId: this.cameraGroupId_,
                label: this.cameraLabel_,
              },
              microphone: {
                deviceId: this.microphoneId_,
                groupId: this.microphoneGroupId_,
                label: this.microphoneLabel_,
              },
            }
          );
        },
      },
      {
        key: "setPubState",
        value: function (e, t) {
          "audio" === e ? (this.audioPubState = t) : (this.videoPubState = t);
        },
      },
      {
        key: "getPubState",
        value: function (e) {
          return "audio" === e ? this.audioPubState : this.videoPubState;
        },
      },
      {
        key: "onTrackAdd",
        value: function (e) {
          this._emitter.on("stream-add-track", e);
        },
      },
      {
        key: "onTrackRemove",
        value: function (e) {
          this._emitter.on("stream-remove-track", e);
        },
      },
      {
        key: "onSwitchDevice",
        value: function (e) {
          this._emitter.on("stream-switch-device", e);
        },
      },
      {
        key: "onReplaceTrack",
        value: function (e) {
          this._emitter.on("stream-replace-track", e);
        },
      },
      {
        key: "onTrackStopped",
        value:
          ((t = V(
            H.mark(function e(t) {
              var r,
                i,
                n,
                o,
                a = this;
              return H.wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        if (
                          ((r = t.type),
                          this.logger.info(
                            "onTrackStopped",
                            (i = t.reason),
                            this.recoverCaptureCount_,
                          ),
                          "audio" !== r || "ended" !== i)
                        ) {
                          e.next = 11;
                          break;
                        }
                        if (!(this.recoverCaptureCount_ <= 10)) {
                          e.next = 9;
                          break;
                        }
                        return ((e.next = 6), rt());
                      case 6:
                        ((n = e.sent.findIndex(function (e) {
                          return e.deviceId === a.microphoneId_;
                        })),
                          this.microphoneId_ &&
                            n > -1 &&
                            (this.logger.info("stat-local-audio-ended"),
                            (this.recoverCaptureCount_ += 1),
                            this.updateStream({
                              audio: !0,
                              video: !1,
                              microphoneId: this.microphoneId_,
                            })));
                      case 9:
                        e.next = 18;
                        break;
                      case 11:
                        if ("video" !== r || "ended" !== i) {
                          e.next = 18;
                          break;
                        }
                        if (!(this.recoverCaptureCount_ <= 10)) {
                          e.next = 18;
                          break;
                        }
                        return ((e.next = 15), tt());
                      case 15:
                        ((o = e.sent.findIndex(function (e) {
                          return e.deviceId === a.cameraId_;
                        })),
                          this.cameraId_ &&
                            o > -1 &&
                            (this.logger.info("stat-local-video-ended"),
                            (this.recoverCaptureCount_ += 1),
                            this.updateStream({
                              audio: !1,
                              video: !0,
                              cameraId: this.cameraId_,
                            })));
                      case 18:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          )),
          function (e) {
            return t.apply(this, arguments);
          }),
      },
    ]),
    a
  );
})();
var bt = (function (e) {
  ie(r, at);
  var t = (function (e) {
    var t = (function () {
      if ("undefined" == typeof Reflect || !Reflect.construct) return !1;
      if (Reflect.construct.sham) return !1;
      if ("function" == typeof Proxy) return !0;
      try {
        return (
          Boolean.prototype.valueOf.call(
            Reflect.construct(Boolean, [], function () {}),
          ),
          !0
        );
      } catch (e) {
        return !1;
      }
    })();
    return function () {
      var r,
        i = se(e);
      if (t) {
        var n = se(this).constructor;
        r = Reflect.construct(i, arguments, n);
      } else r = i.apply(this, arguments);
      return ae(this, r);
    };
  })(r);
  function r(e, i) {
    var n;
    return (
      F(this, r),
      ((n = t.call(this, e, i)).isRemote = !0),
      (n.subscribed = !1),
      (n.audio = !1),
      (n.video = !1),
      (n.subscriptionId = null),
      (n.audioSubscriptionId = null),
      (n.videoSubscriptionId = null),
      (n.audioSubState = q.Create),
      (n.videoSubState = q.Create),
      (n.simulcastType = null),
      n
    );
  }
  return (
    W(r, [
      {
        key: "getUserSeq",
        value: function () {
          return this.userId;
        },
      },
      {
        key: "setAudio",
        value: function (e) {
          this.audio = e;
        },
      },
      {
        key: "setVideo",
        value: function (e) {
          this.video = e;
        },
      },
      {
        key: "setAudioSubscriptionId",
        value: function (e) {
          this.audioSubscriptionId = e;
        },
      },
      {
        key: "setVideoSubscriptionId",
        value: function (e) {
          this.videoSubscriptionId = e;
        },
      },
      {
        key: "getStreamKind",
        value: function (e) {
          return this.audioStreamId === this.videoStreamId
            ? X.AudioVideo
            : this.audioStreamId === e
              ? X.AudioOnly
              : this.videoStreamId === e
                ? X.VideoOnly
                : void 0;
        },
      },
      {
        key: "setSimulcastType",
        value: function (e) {
          this.simulcastType = e;
        },
      },
      {
        key: "getSimulcastType",
        value: function () {
          return this.simulcastType;
        },
      },
      {
        key: "setSubState",
        value: function (e, t) {
          "audio" === e ? (this.audioSubState = t) : (this.videoSubState = t);
        },
      },
      {
        key: "getSubState",
        value: function (e) {
          return "audio" === e ? this.audioSubState : this.videoSubState;
        },
      },
    ]),
    r
  );
})();
function St(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function Et(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? St(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : St(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
var Ct,
  Tt,
  Rt = Et(Et({}, ze), Ke);
function It(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function _t(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? It(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : It(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
(!(function (e) {
  ((e[(e.Create = 0)] = "Create"),
    (e[(e.Publishing = 1)] = "Publishing"),
    (e[(e.Published = 2)] = "Published"),
    (e[(e.Unpublished = 3)] = "Unpublished"));
})(Ct || (Ct = {})),
  (function (e) {
    ((e[(e.Normal = 0)] = "Normal"), (e[(e.Half = 1)] = "Half"));
  })(Tt || (Tt = {})));
var kt = (function () {
  function e(t) {
    (F(this, e),
      (this.options = t),
      (this.userId = t.userId),
      (this.streamId = null),
      (this.localStream = t.mediaStream),
      (this.peerConnection = new RTCPeerConnection({
        bundlePolicy: "max-bundle",
        sdpSemantics: "unified-plan",
      })),
      (this.logger = t.logger),
      (this.xsigoClient = t.xsigoClient),
      (this.roomId = t.roomId),
      (this.state = Ct.Create),
      (this.transceiver = null),
      (this._emitter = new J()),
      (this._interval = -1),
      (this.audioBytesSentIs0Count = 0),
      (this.videoBytesSentIs0Count = 0),
      (this.recoverCaptureCount = 0),
      (this.times = 2e3),
      (this.timer = null),
      (this.level = Tt.Normal));
  }
  var t, r;
  return (
    W(e, [
      {
        key: "publish",
        value: function () {
          var e = this;
          return new Promise(
            (function () {
              var t = V(
                H.mark(function t(r, i) {
                  var n, o, a;
                  return H.wrap(
                    function (t) {
                      for (;;)
                        switch ((t.prev = t.next)) {
                          case 0:
                            return (
                              (t.prev = 0),
                              e.state !== Ct.Create &&
                                (e.logger.warn(
                                  "Stream already publishing or published",
                                ),
                                i({
                                  message:
                                    "stream already publishing or published",
                                })),
                              e.logger.info("stream publishing"),
                              (e.state = Ct.Publishing),
                              (t.next = 6),
                              e.createOffer(e.localStream)
                            );
                          case 6:
                            ((n = t.sent),
                              e.logger.info(
                                "publishStream track",
                                e.localStream.getTracks(),
                              ),
                              (e.peerConnection.onconnectionstatechange =
                                e.onConnectionstatechange.bind(e, "publish")),
                              (o = ""),
                              (a = []),
                              (e.peerConnection.onicecandidate = function (t) {
                                var s = t.candidate;
                                (e.logger.info(
                                  "peerConnection publish "
                                    .concat(
                                      JSON.stringify(
                                        e.localStream.getTracks()[0].kind,
                                      ),
                                      "  IceCandidate data:\n ",
                                    )
                                    .concat(
                                      (null == s ? void 0 : s.candidate) || "",
                                    ),
                                ),
                                  null != s &&
                                    s.candidate &&
                                    (o = o + "a=" + s.candidate + "\r\n"),
                                  a.push(s));
                                var c = !1,
                                  u = window.setTimeout(function () {
                                    c = !0;
                                  }, e.times);
                                if (!s || c) {
                                  (window.clearTimeout(u),
                                    (a[0] && 0 !== a.length) ||
                                      i({
                                        code: te.CANDIDATE_COLLECT_FAILED,
                                        message: "candidate is null",
                                      }),
                                    (a = []));
                                  var d = n.sdp;
                                  if (
                                    d.toLowerCase().includes("audio") &&
                                    !d.toLowerCase().includes("opus")
                                  )
                                    return (
                                      e.logger.warn(
                                        "=======publish offer========\n",
                                        d,
                                      ),
                                      i("opus not supported")
                                    );
                                  if (
                                    d.toLowerCase().includes("video") &&
                                    !d.toLowerCase().includes("h264")
                                  )
                                    return (
                                      e.logger.warn(
                                        "=======publish offer========\n",
                                        d,
                                      ),
                                      i("H264 not supported")
                                    );
                                  d.includes("a=candidate") || (d += o);
                                  var l = e.buildPublishParams();
                                  ((l.params.offerSdp = d),
                                    e.logger.info(
                                      "=======publish offer========\n",
                                      d,
                                    ),
                                    (e.streamId = e.xsigoClient.publishStream(
                                      e.roomId,
                                      l,
                                    )),
                                    r(e.streamId));
                                }
                              }),
                              (t.next = 17));
                            break;
                          case 14:
                            ((t.prev = 14), (t.t0 = t.catch(0)), i(t.t0));
                          case 17:
                          case "end":
                            return t.stop();
                        }
                    },
                    t,
                    null,
                    [[0, 14]],
                  );
                }),
              );
              return function (e, r) {
                return t.apply(this, arguments);
              };
            })(),
          );
        },
      },
      {
        key: "republish",
        value: function () {
          var e = this;
          return new Promise(
            (function () {
              var t = V(
                H.mark(function t(r, i) {
                  var n, o;
                  return H.wrap(function (t) {
                    for (;;)
                      switch ((t.prev = t.next)) {
                        case 0:
                          return (
                            e.close(),
                            (e.peerConnection = new RTCPeerConnection({
                              bundlePolicy: "max-bundle",
                              sdpSemantics: "unified-plan",
                            })),
                            (e.state = Ct.Publishing),
                            (t.next = 5),
                            e.createOffer(e.localStream)
                          );
                        case 5:
                          ((n = t.sent),
                            (e.peerConnection.onconnectionstatechange =
                              e.onConnectionstatechange.bind(e, "republish")),
                            (o = ""),
                            (e.peerConnection.onicecandidate = function (t) {
                              var i = t.candidate;
                              (e.logger.info(
                                "peerConnection republish IceCandidate data:\n ".concat(
                                  (null == i ? void 0 : i.candidate) || "",
                                ),
                              ),
                                null != i &&
                                  i.candidate &&
                                  (o = o + "a=" + i.candidate + "\r\n"));
                              var a = !1,
                                s = window.setTimeout(function () {
                                  a = !0;
                                }, e.times);
                              (i && !a) ||
                                (window.clearTimeout(s),
                                n.sdp.includes("a=candidate") ||
                                  (n.sdp = n.sdp + o),
                                e.logger.info(
                                  "=======republish offer========\n",
                                  n.sdp,
                                ),
                                r(n));
                            }));
                        case 9:
                        case "end":
                          return t.stop();
                      }
                  }, t);
                }),
              );
              return function (e, r) {
                return t.apply(this, arguments);
              };
            })(),
          );
        },
      },
      {
        key: "unpublish",
        value: function (e) {
          var t = this;
          this.xsigoClient.unpublishStream(
            this.roomId,
            this.streamId,
            function (r, i, n) {
              (1 === r && ((t.state = Ct.Unpublished), t.close()), e(r, i, n));
            },
          );
        },
      },
      {
        key: "updateSimulcast",
        value: function (e, t) {
          this.xsigoClient.updateSimulcast(
            this.roomId,
            this.streamId,
            { simulcast: e },
            t,
          );
        },
      },
      {
        key: "createOffer",
        value: function (e) {
          var t = this;
          return new Promise(
            (function () {
              var r = V(
                H.mark(function r(i, n) {
                  var o, a, s, c, u;
                  return H.wrap(
                    function (r) {
                      for (;;)
                        switch ((r.prev = r.next)) {
                          case 0:
                            return (
                              (o = t.options.minBitrate
                                ? t.options.minBitrate
                                : t.options.bitrate.video < 200
                                  ? t.options.bitrate.video
                                  : 200),
                              (r.prev = 1),
                              t.localStream.getTracks().forEach(function (r) {
                                var i = [];
                                if ("video" === r.kind) {
                                  var n = t.options,
                                    a = n.isEnableSmallStream,
                                    s = n.smallStreamConfig,
                                    c = n.screen,
                                    u = r.getSettings();
                                  ((t.captureVideoWidth = u.width),
                                    (t.captureVideoHeight = u.height),
                                    a &&
                                      !c &&
                                      (i.push({
                                        rid: "h",
                                        active: !0,
                                        scaleResolutionDownBy: 1,
                                      }),
                                      i.push({
                                        rid: "l",
                                        active: !0,
                                        scaleResolutionDownBy:
                                          t.captureVideoHeight / s.height,
                                        maxBitrate: 1e3 * s.bitrate,
                                      }),
                                      (o = t.options.minBitrate
                                        ? t.options.minBitrate
                                        : t.options.bitrate.video < 600
                                          ? t.options.bitrate.video
                                          : 600)));
                                }
                                ((t.transceiver =
                                  t.peerConnection.addTransceiver(r.kind, {
                                    direction: "sendonly",
                                    sendEncodings: i,
                                  })),
                                  t.peerConnection.addTrack(r, e));
                              }),
                              (r.next = 5),
                              t.peerConnection.createOffer()
                            );
                          case 5:
                            (t.logger.info(
                              "=======publish offer original========\n",
                              (a = r.sent).sdp,
                            ),
                              (s = []),
                              a.sdp.includes("video") &&
                                ((c = (c = a.sdp.split("\r\n")).map(
                                  function (e) {
                                    if (
                                      e.includes("a=rtpmap") &&
                                      !e.toLowerCase().includes("h264")
                                    ) {
                                      var t = e.indexOf(":") + 1,
                                        r = e.indexOf(" ");
                                      s.push(e.slice(t, r));
                                    }
                                    return e.includes("a=fmtp:") && o
                                      ? e + ";x-google-min-bitrate=".concat(o)
                                      : e;
                                  },
                                )),
                                s.length &&
                                  s.forEach(function (e) {
                                    c = c.filter(function (t) {
                                      return !(
                                        t.includes("a=rtpmap:" + e) ||
                                        t.includes("a=fmtp:" + e) ||
                                        t.includes("a=rtcp-fb:" + e)
                                      );
                                    });
                                  }),
                                (a.sdp = c.join("\r\n"))),
                              a.sdp.includes("audio") &&
                                ((u = a.sdp.split("\r\n")).forEach(
                                  function (e) {
                                    if (
                                      e.includes("a=rtpmap") &&
                                      !e.toLowerCase().includes("opus")
                                    ) {
                                      var t = e.indexOf(":") + 1,
                                        r = e.indexOf(" ");
                                      s.push(e.slice(t, r));
                                    }
                                  },
                                ),
                                s.length &&
                                  s.forEach(function (e) {
                                    u = u.filter(function (t) {
                                      return !(
                                        t.includes("a=rtpmap:" + e) ||
                                        t.includes("a=fmtp:" + e) ||
                                        t.includes("a=rtcp-fb:" + e)
                                      );
                                    });
                                  }),
                                (a.sdp = u.join("\r\n"))),
                              i(a),
                              t.logger.info(
                                "=======publish offer old========\n",
                                a.sdp,
                              ),
                              t.peerConnection.setLocalDescription(a),
                              (r.next = 20));
                            break;
                          case 15:
                            throw (
                              (r.prev = 15),
                              (r.t0 = r.catch(1)),
                              t.logger.onError(
                                { c: Rt.TOP_ERROR, v: te.CREATE_OFFER_FAILED },
                                "code:"
                                  .concat(
                                    te.CREATE_OFFER_FAILED,
                                    ",create offer error!, ",
                                  )
                                  .concat(r.t0),
                              ),
                              (t.state = Ct.Create),
                              new de({
                                code: te.CREATE_OFFER_FAILED,
                                message: "create offer error!,".concat(r.t0),
                              })
                            );
                          case 20:
                          case "end":
                            return r.stop();
                        }
                    },
                    r,
                    null,
                    [[1, 15]],
                  );
                }),
              );
              return function (e, t) {
                return r.apply(this, arguments);
              };
            })(),
          );
        },
      },
      {
        key: "onConnectionstatechange",
        value: function (e) {
          var t = this;
          (["failed", "connected"].includes(
            this.peerConnection.connectionState,
          ) &&
            this._emitter.emit("publish-ice-state", {
              state: this.peerConnection.connectionState,
              streamId: this.streamId,
            }),
            this.logger.info(
              "peerConnection "
                .concat(e, " ICE State: ")
                .concat(this.peerConnection.connectionState),
            ),
            "connecting" === this.peerConnection.connectionState
              ? -1 === this._interval &&
                (this._interval = window.setInterval(function () {
                  t.getRTCIceCandidatePairStats();
                }, this.times))
              : "connected" === this.peerConnection.connectionState
                ? (this.localStream.getTracks().forEach(function (e) {
                    (t.peerConnection.getSenders() || []).forEach(function (t) {
                      t.replaceTrack(e);
                    });
                  }),
                  clearInterval(this._interval))
                : clearInterval(this._interval));
        },
      },
      {
        key: "filterCodecs",
        value: function (e) {
          if (RTCRtpSender.getCapabilities) {
            var t = RTCRtpSender.getCapabilities(e.kind).codecs.filter(
              function (t) {
                return "audio" === e.kind
                  ? -1 != t.mimeType.indexOf("opus")
                  : -1 != t.mimeType.indexOf("H264");
              },
            );
            this.transceiver.setCodecPreferences &&
              "function" == typeof this.transceiver.setCodecPreferences &&
              this.transceiver.setCodecPreferences(t);
          }
        },
      },
      {
        key: "setRemoteDesc",
        value: function (e, t) {
          var r = this;
          return new Promise(function (i, n) {
            var o = e.split("\r\n");
            if (!o.includes("a=ptime")) {
              var a = o.findIndex(function (e) {
                return e.includes("a=fmtp");
              });
              -1 !== a && o.splice(a, 0, "a=ptime:10");
            }
            if (!e.includes("x-google-min-bitrate")) {
              var s = r.options.minBitrate
                  ? r.options.minBitrate
                  : r.options.bitrate.video < 200
                    ? r.options.bitrate.video
                    : 200,
                c = r.options;
              (c.isEnableSmallStream &&
                !c.screen &&
                (s = r.options.minBitrate
                  ? r.options.minBitrate
                  : r.options.bitrate.video < 600
                    ? r.options.bitrate.video
                    : 600),
                (o = o.map(function (e) {
                  return e.includes("a=fmtp:") && s
                    ? e + ";x-google-min-bitrate=".concat(s)
                    : e;
                })));
            }
            var u = o.join("\r\n");
            (r.logger.info("=======publish answer========\n", u),
              (r.state = Ct.Published),
              (r.streamId = t),
              r.peerConnection
                .setRemoteDescription({ sdp: u, type: "answer" })
                .then(function () {
                  (r.setBandwidth(r.options.bitrate), i(!0));
                })
                .catch(function (e) {
                  (r.logger.error("publish setRemoteDescription error", e),
                    n(e));
                }));
          });
        },
      },
      {
        key: "getPeerConnection",
        value: function () {
          return this.peerConnection;
        },
      },
      {
        key: "close",
        value: function () {
          (this.peerConnection &&
            ((this.peerConnection.onicecandidate = null),
            (this.peerConnection.onconnectionstatechange = null),
            this.peerConnection.close()),
            (this.peerConnection = null),
            (this.transceiver = null),
            this._interval && clearInterval(this._interval),
            (this._interval = null),
            this.timer && clearInterval(this.timer),
            (this.timer = null),
            (this.audioBytesSentIs0Count = 0),
            (this.videoBytesSentIs0Count = 0),
            (this.recoverCaptureCount = 0),
            this.logger.info(
              "close publish stream peerConnection,streamId",
              this.streamId,
            ));
        },
      },
      {
        key: "setBandwidth",
        value: function (e) {
          var t = this,
            r = this.peerConnection.getSenders(),
            i = e.audio,
            n = e.video;
          r.forEach(function (e) {
            var r = e.getParameters();
            if (
              (r.encodings.length || (r.encodings = [{}]),
              "video" === e.track.kind)
            ) {
              var o = t.options;
              (o.isEnableSmallStream && !o.screen && t.onchangeNet(e),
                (r.encodings[0].maxBitrate = t.options.maxBitrate
                  ? 1e3 * t.options.maxBitrate
                  : 1e3 * n));
            }
            ("audio" === e.track.kind && (r.encodings[0].maxBitrate = 1e3 * i),
              t.logger.info("encodings", JSON.stringify(r.encodings)),
              e.setParameters(r).then(
                function () {
                  t.logger.info(
                    ""
                      .concat(e.track.kind, " set bitrate to ")
                      .concat(r.encodings[0].maxBitrate, " success"),
                  );
                },
                function (r) {
                  t.logger.warn(
                    "".concat(e.track.kind, " set bitrate error"),
                    r,
                  );
                },
              ));
          });
        },
      },
      {
        key: "onchangeNet",
        value: function (e) {
          var t,
            r = this,
            i = 0,
            n = 0;
          this.timer = setInterval(
            V(
              H.mark(function o() {
                var a, s, c, u, d, l, h, p, f;
                return H.wrap(function (o) {
                  for (;;)
                    switch ((o.prev = o.next)) {
                      case 0:
                        ((a = r.level), (s = Date.now()), (c = []), (u = []));
                      case 4:
                        if (!(Date.now() - s < 4e3)) {
                          o.next = 13;
                          break;
                        }
                        return ((o.next = 7), r.getLocalStats("video"));
                      case 7:
                        return (
                          (t = o.sent)
                            ? ((l =
                                (d = t.video.retransmittedPacketsSent - i) <= 0
                                  ? 0
                                  : Math.floor(
                                      (d / (t.video.packetsSent - n)) * 100,
                                    )),
                              (i = t.video.retransmittedPacketsSent),
                              (n = t.video.packetsSent),
                              c.push(t.rtt),
                              u.push(l))
                            : (c.push(0), u.push(0)),
                          (o.next = 11),
                          new Promise(function (e) {
                            return setTimeout(e, 1e3);
                          })
                        );
                      case 11:
                        o.next = 4;
                        break;
                      case 13:
                        if (
                          ((h =
                            c.reduce(function (e, t) {
                              return e + t;
                            }, 0) / c.length),
                          (p =
                            u.reduce(function (e, t) {
                              return e + t;
                            }, 0) / c.length),
                          (f = e.getParameters()).encodings.length &&
                            f.encodings[0])
                        ) {
                          o.next = 18;
                          break;
                        }
                        return o.abrupt("return");
                      case 18:
                        if (
                          (h < 150 && p < 30
                            ? ((f.encodings[0].scaleResolutionDownBy = 1),
                              (r.level = Tt.Normal))
                            : (h >= 150 || p >= 30) &&
                              ((r.level = Tt.Half),
                              (f.encodings[0].scaleResolutionDownBy = 2)),
                          a !== r.level)
                        ) {
                          o.next = 21;
                          break;
                        }
                        return o.abrupt("return");
                      case 21:
                        e.setParameters(f).then(
                          function () {
                            r.logger.info(
                              "video onchangeBitrite set success ".concat(
                                r.level,
                              ),
                            );
                          },
                          function (e) {
                            r.logger.warn(
                              "video onchangeBitrite set failed ".concat(
                                r.level,
                              ),
                              e,
                            );
                          },
                        );
                      case 22:
                      case "end":
                        return o.stop();
                    }
                }, o);
              }),
            ),
            4e3,
          );
        },
      },
      {
        key: "replaceMediaStreamTrack",
        value: function (e) {
          var t = this;
          (this.logger.info("replace mediaStream Track", e),
            this.peerConnection &&
              e &&
              (this.peerConnection.getSenders() || []).forEach(function (r) {
                if ("audio" === e.kind && r.track && "audio" === r.track.kind) {
                  r.replaceTrack(e);
                  var i = t.localStream.getAudioTracks()[0];
                  (i && t.localStream.removeTrack(i),
                    i && t.localStream.addTrack(e));
                }
                if ("video" === e.kind && r.track && "video" === r.track.kind) {
                  r.replaceTrack(e);
                  var n = t.localStream.getVideoTracks()[0];
                  (n && t.localStream.removeTrack(n),
                    n && t.localStream.addTrack(e));
                }
              }));
          var r =
            "audio" === e.kind
              ? this.localStream.getAudioTracks()[0]
              : this.localStream.getVideoTracks()[0];
          (r && this.localStream.removeTrack(r),
            r && this.localStream.addTrack(e));
        },
      },
      {
        key: "buildPublishParams",
        value: function () {
          var e = this,
            t = this.options || {},
            r = t.hasAudio,
            i = t.hasVideo,
            n = t.screen,
            o = {
              streamType: _e.ForwardStream,
              streamKind:
                r && i
                  ? ke.AudioVideo
                  : r
                    ? ke.AudioOnly
                    : i
                      ? ke.VideoOnly
                      : ke.Invalid,
              params: {
                offerSdp: "",
                audioInfo: {
                  source: n ? Oe.ScreenShare : Oe.Microphone,
                  muted: t.audioMuted,
                  floor: !0,
                },
                videoInfo: {
                  source: n ? Pe.ScreenShare : Pe.Camera,
                  muted: t.videoMuted,
                  floor: !0,
                },
              },
              cb: function (t, r, i) {
                1 === t
                  ? e
                      .setRemoteDesc(i.answer_sdp, i.streamId)
                      .then(function () {
                        e.options.onPublish && e.options.onPublish(t, r, i);
                      })
                      .catch(function (t) {
                        e.options.onPublish && e.options.onPublish(0, t, i);
                      })
                  : e.options.onPublish && e.options.onPublish(t, r, i);
              },
              updateCb: function () {},
            },
            a = this.options,
            s = a.smallStreamConfig,
            c = [];
          if (a.isEnableSmallStream && !n) {
            if (
              (this.logger.info(
                "publish width height",
                this.captureVideoWidth,
                this.captureVideoHeight,
              ),
              this.captureVideoWidth > 0 && this.captureVideoHeight > 0)
            ) {
              var u = {
                type: Ae.SmallStream,
                maxWidth: s.width,
                maxHeight: s.height,
              };
              (c.push({
                type: Ae.BigStream,
                maxWidth: this.captureVideoWidth,
                maxHeight: this.captureVideoHeight,
              }),
                c.push(u));
            }
            o.params.videoInfo.simulcast = c;
          }
          return o;
        },
      },
      {
        key: "getTransportStats",
        value:
          ((r = V(
            H.mark(function e() {
              var t = this;
              return H.wrap(function (e) {
                for (;;)
                  switch ((e.prev = e.next)) {
                    case 0:
                      return e.abrupt(
                        "return",
                        new Promise(function (e, r) {
                          if (t.peerConnection) {
                            var i,
                              n = (t.peerConnection.getSenders() || [])[0];
                            n &&
                              n.getStats().then(
                                function (r) {
                                  ((i = t.getSenderStats({
                                    send: r,
                                    mediaType: n.track.kind,
                                  })),
                                    e(i));
                                },
                                function (e) {
                                  (t.logger.onError(
                                    {
                                      c: Rt.TOP_ERROR,
                                      v: te.INVALID_TRANSPORT_STATA,
                                    },
                                    "Get transport stats error, ".concat(e),
                                  ),
                                    r(e.message));
                                },
                              );
                          }
                        }),
                      );
                    case 1:
                    case "end":
                      return e.stop();
                  }
              }, e);
            }),
          )),
          function () {
            return r.apply(this, arguments);
          }),
      },
      {
        key: "getLocalStats",
        value:
          ((t = V(
            H.mark(function e(t) {
              var r = this;
              return H.wrap(function (e) {
                for (;;)
                  switch ((e.prev = e.next)) {
                    case 0:
                      return e.abrupt(
                        "return",
                        new Promise(function (e, i) {
                          if (r.peerConnection) {
                            var n,
                              o = (r.peerConnection.getSenders() || []).find(
                                function (e) {
                                  return e.track.kind === t;
                                },
                              );
                            o &&
                              o
                                .getStats()
                                .then(function (i) {
                                  ((n = r.getSenderStats({
                                    send: i,
                                    mediaType: t,
                                  })),
                                    e(n));
                                })
                                .catch(function (e) {
                                  i(e.message);
                                });
                          }
                        }),
                      );
                    case 1:
                    case "end":
                      return e.stop();
                  }
              }, e);
            }),
          )),
          function (e) {
            return t.apply(this, arguments);
          }),
      },
      {
        key: "getSenderStats",
        value: function (e) {
          var t = this,
            r = {
              audio: {
                bytesSent: 0,
                packetsSent: 0,
                retransmittedPacketsSent: 0,
                audioLevel: 0,
              },
              video: {
                bytesSent: 0,
                packetsSent: 0,
                framesEncoded: 0,
                frameWidth: 0,
                frameHeight: 0,
                framesSent: 0,
                retransmittedPacketsSent: 0,
                framesPerSecond: 0,
                rid: "h",
              },
              smallVideo: {
                bytesSent: 0,
                packetsSent: 0,
                framesEncoded: 0,
                frameWidth: 0,
                frameHeight: 0,
                framesSent: 0,
                retransmittedPacketsSent: 0,
                framesPerSecond: 0,
                rid: "l",
              },
              rtt: 0,
              timestamp: 0,
            };
          return (
            e.send.forEach(function (i) {
              if ("outbound-rtp" === i.type)
                if (
                  ((r.timestamp = i.timestamp),
                  "video" === e.mediaType && "l" === i.rid)
                ) {
                  if (0 === i.bytesSent) return;
                  r.smallVideo = _t(
                    _t({}, r.smallVideo),
                    {},
                    {
                      bytesSent: i.bytesSent,
                      packetsSent: i.packetsSent,
                      framesEncoded: i.framesEncoded,
                      retransmittedPacketsSent: i.retransmittedPacketsSent || 0,
                      framesPerSecond: i.framesPerSecond || 0,
                      frameWidth: i.frameWidth || 0,
                      frameHeight: i.frameHeight || 0,
                      framesSent: i.framesSent,
                      rid: i.rid || "l",
                    },
                  );
                } else if ("video" === e.mediaType) {
                  if (0 === i.bytesSent) return;
                  ((r.video = _t(
                    _t({}, r.video),
                    {},
                    {
                      bytesSent: i.bytesSent,
                      packetsSent: i.packetsSent,
                      framesEncoded: i.framesEncoded,
                      retransmittedPacketsSent: i.retransmittedPacketsSent || 0,
                      rid: i.rid || "h",
                    },
                  )),
                    void 0 !== i.framesPerSecond &&
                      (r.video.framesPerSecond = i.framesPerSecond),
                    void 0 !== i.frameWidth &&
                      (r.video.frameWidth = i.frameWidth),
                    void 0 !== i.frameHeight &&
                      (r.video.frameHeight = i.frameHeight),
                    void 0 !== i.framesSent &&
                      (r.video.framesSent = i.framesSent));
                } else
                  "audio" === e.mediaType &&
                    (r.audio = _t(
                      _t({}, r.audio),
                      {},
                      {
                        bytesSent: i.bytesSent,
                        packetsSent: i.packetsSent,
                        retransmittedPacketsSent:
                          i.retransmittedPacketsSent || 0,
                      },
                    ));
              else if ("candidate-pair" === i.type)
                "number" == typeof i.currentRoundTripTime &&
                  (r.rtt = 1e3 * i.currentRoundTripTime);
              else if ("track" === i.type) {
                if (void 0 !== i.frameWidth) {
                  var n = t.localStream.getVideoTracks();
                  n.length &&
                    n[0].id === i.trackIdentifier &&
                    ((r.video.frameWidth = i.frameWidth),
                    (r.video.frameHeight = i.frameHeight),
                    (r.video.framesSent = i.framesSent));
                }
              } else if ("media-source" === i.type)
                if ("video" === i.kind) {
                  var o = t.localStream.getVideoTracks();
                  o.length &&
                    o[0].id === i.trackIdentifier &&
                    void 0 !== i.framesPerSecond &&
                    (r.video.framesPerSecond = i.framesPerSecond);
                } else
                  "audio" === i.kind &&
                    (r.audio.audioLevel = i.audioLevel || 0);
            }),
            r
          );
        },
      },
      {
        key: "onPublishPeerConnectionFailed",
        value: function (e) {
          this._emitter.on("publish-ice-state", e);
        },
      },
      {
        key: "getRTCIceCandidatePairStats",
        value: function () {
          var e = this;
          this.peerConnection &&
            this.peerConnection.getStats().then(function (t) {
              t.forEach(function (t) {
                "candidate-pair" === t.type &&
                  e.logger.warn(
                    "publish RTCIceCandidatePairStats",
                    JSON.stringify(t, null, 4),
                  );
              });
            });
        },
      },
      {
        key: "updateBytesSentIs0Count",
        value: function (e) {
          var t = this;
          if ("audio" === e) {
            var r,
              i = this.localStream.getAudioTracks();
            i.length &&
              "connected" ===
                (null === (r = this.peerConnection) || void 0 === r
                  ? void 0
                  : r.connectionState) &&
              ((this.audioBytesSentIs0Count += 1),
              this.audioBytesSentIs0Count >= 4 &&
                this.recoverCaptureCount <= 5 &&
                ((this.recoverCaptureCount += 1),
                (this.audioBytesSentIs0Count = 0),
                i.forEach(function (e) {
                  (t.peerConnection.getSenders() || []).forEach(function (t) {
                    "audio" === t.track.kind && t.replaceTrack(e);
                  });
                }),
                this.logger.info(
                  "replace the track because the audio bytes sent is 0,recover count:",
                  this.recoverCaptureCount,
                )));
          } else if ("video" === e) {
            var n,
              o = this.localStream.getVideoTracks();
            o.length &&
              "connected" ===
                (null === (n = this.peerConnection) || void 0 === n
                  ? void 0
                  : n.connectionState) &&
              ((this.videoBytesSentIs0Count += 1),
              this.videoBytesSentIs0Count >= 4 &&
                this.recoverCaptureCount <= 5 &&
                ((this.recoverCaptureCount += 1),
                (this.videoBytesSentIs0Count = 0),
                o.forEach(function (e) {
                  (t.peerConnection.getSenders() || []).forEach(function (t) {
                    "video" === t.track.kind && t.replaceTrack(e);
                  });
                }),
                this.logger.info(
                  "replace the track because the video bytes sent is 0,recover count:",
                  this.recoverCaptureCount,
                )));
          }
        },
      },
    ]),
    e
  );
})();
function wt(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function Ot(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? wt(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : wt(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
var Pt,
  At = (function () {
    function e(t) {
      (F(this, e),
        (this.subscribedStreams = new Map()),
        (this.subscriptedOptions = new Map()),
        (this.subscriptedState = new Map()),
        (this.logger = t));
    }
    return (
      W(e, [
        {
          key: "addSubscriptionRecord",
          value: function (e, t) {
            this.subscribedStreams.set(e, t);
          },
        },
        {
          key: "setSubscriptionOpts",
          value: function (e, t) {
            (this.logger.debug("set subscribe options:", t),
              this.subscriptedOptions.set(e, t));
          },
        },
        {
          key: "getSubscriptionOpts",
          value: function (e) {
            return (
              this.subscriptedOptions.get(e) || {
                audio: !0,
                video: !0,
                small: !1,
              }
            );
          },
        },
        {
          key: "updateSubscriptedState",
          value: function (e, t) {
            var r = Ot(Ot({}, this.getSubscriptedState(e)), t);
            (this.subscriptedState.set(e, r),
              this.logger.info(
                "-----\x3e update subscribe state <----------",
                e,
                JSON.stringify(r),
              ));
          },
        },
        {
          key: "getSubscriptedState",
          value: function (e) {
            return (
              this.subscriptedState.get(e) || {
                audio: !1,
                video: !1,
                small: !1,
              }
            );
          },
        },
        {
          key: "needSubscribeKind",
          value: function (e) {
            var t = this.subscriptedState.get(e) || { audio: !1, video: !1 },
              r = this.subscriptedOptions.get(e) || { audio: !1, video: !1 };
            return (
              this.logger.info("subscribe state", t),
              this.logger.info("subscribe options:", r),
              r.audio && !t.audio && r.video && !t.video
                ? X.AudioVideo
                : r.audio && !t.audio
                  ? X.AudioOnly
                  : r.video && !t.video
                    ? X.VideoOnly
                    : void 0
            );
          },
        },
        {
          key: "reset",
          value: function (e) {
            if (e)
              return (
                this.subscriptedState.delete(e),
                this.subscribedStreams.delete(e),
                void this.subscriptedOptions.delete(e)
              );
            (this.subscriptedState.clear(),
              this.subscribedStreams.clear(),
              this.subscriptedOptions.clear());
          },
        },
      ]),
      e
    );
  })(),
  Lt = G(function (e) {
    var t = (e.exports = {
      v: [{ name: "version", reg: /^(\d*)$/ }],
      o: [
        {
          name: "origin",
          reg: /^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,
          names: [
            "username",
            "sessionId",
            "sessionVersion",
            "netType",
            "ipVer",
            "address",
          ],
          format: "%s %s %d %s IP%d %s",
        },
      ],
      s: [{ name: "name" }],
      i: [{ name: "description" }],
      u: [{ name: "uri" }],
      e: [{ name: "email" }],
      p: [{ name: "phone" }],
      z: [{ name: "timezones" }],
      r: [{ name: "repeats" }],
      t: [
        {
          name: "timing",
          reg: /^(\d*) (\d*)/,
          names: ["start", "stop"],
          format: "%d %d",
        },
      ],
      c: [
        {
          name: "connection",
          reg: /^IN IP(\d) (\S*)/,
          names: ["version", "ip"],
          format: "IN IP%d %s",
        },
      ],
      b: [
        {
          push: "bandwidth",
          reg: /^(TIAS|AS|CT|RR|RS):(\d*)/,
          names: ["type", "limit"],
          format: "%s:%s",
        },
      ],
      m: [
        {
          reg: /^(\w*) (\d*) ([\w/]*)(?: (.*))?/,
          names: ["type", "port", "protocol", "payloads"],
          format: "%s %d %s %s",
        },
      ],
      a: [
        {
          push: "rtp",
          reg: /^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,
          names: ["payload", "codec", "rate", "encoding"],
          format: function (e) {
            return e.encoding
              ? "rtpmap:%d %s/%s/%s"
              : e.rate
                ? "rtpmap:%d %s/%s"
                : "rtpmap:%d %s";
          },
        },
        {
          push: "fmtp",
          reg: /^fmtp:(\d*) ([\S| ]*)/,
          names: ["payload", "config"],
          format: "fmtp:%d %s",
        },
        { name: "control", reg: /^control:(.*)/, format: "control:%s" },
        {
          name: "rtcp",
          reg: /^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,
          names: ["port", "netType", "ipVer", "address"],
          format: function (e) {
            return null != e.address ? "rtcp:%d %s IP%d %s" : "rtcp:%d";
          },
        },
        {
          push: "rtcpFbTrrInt",
          reg: /^rtcp-fb:(\*|\d*) trr-int (\d*)/,
          names: ["payload", "value"],
          format: "rtcp-fb:%s trr-int %d",
        },
        {
          push: "rtcpFb",
          reg: /^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,
          names: ["payload", "type", "subtype"],
          format: function (e) {
            return null != e.subtype ? "rtcp-fb:%s %s %s" : "rtcp-fb:%s %s";
          },
        },
        {
          push: "ext",
          reg: /^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,
          names: ["value", "direction", "encrypt-uri", "uri", "config"],
          format: function (e) {
            return (
              "extmap:%d" +
              (e.direction ? "/%s" : "%v") +
              (e["encrypt-uri"] ? " %s" : "%v") +
              " %s" +
              (e.config ? " %s" : "")
            );
          },
        },
        { name: "extmapAllowMixed", reg: /^(extmap-allow-mixed)/ },
        {
          push: "crypto",
          reg: /^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,
          names: ["id", "suite", "config", "sessionConfig"],
          format: function (e) {
            return null != e.sessionConfig
              ? "crypto:%d %s %s %s"
              : "crypto:%d %s %s";
          },
        },
        { name: "setup", reg: /^setup:(\w*)/, format: "setup:%s" },
        {
          name: "connectionType",
          reg: /^connection:(new|existing)/,
          format: "connection:%s",
        },
        { name: "mid", reg: /^mid:([^\s]*)/, format: "mid:%s" },
        { name: "msid", reg: /^msid:(.*)/, format: "msid:%s" },
        { name: "ptime", reg: /^ptime:(\d*(?:\.\d*)*)/, format: "ptime:%d" },
        {
          name: "maxptime",
          reg: /^maxptime:(\d*(?:\.\d*)*)/,
          format: "maxptime:%d",
        },
        { name: "direction", reg: /^(sendrecv|recvonly|sendonly|inactive)/ },
        { name: "icelite", reg: /^(ice-lite)/ },
        { name: "iceUfrag", reg: /^ice-ufrag:(\S*)/, format: "ice-ufrag:%s" },
        { name: "icePwd", reg: /^ice-pwd:(\S*)/, format: "ice-pwd:%s" },
        {
          name: "fingerprint",
          reg: /^fingerprint:(\S*) (\S*)/,
          names: ["type", "hash"],
          format: "fingerprint:%s %s",
        },
        {
          push: "candidates",
          reg: /^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,
          names: [
            "foundation",
            "component",
            "transport",
            "priority",
            "ip",
            "port",
            "type",
            "raddr",
            "rport",
            "tcptype",
            "generation",
            "network-id",
            "network-cost",
          ],
          format: function (e) {
            var t = "candidate:%s %d %s %d %s %d typ %s";
            return (
              (t += null != e.raddr ? " raddr %s rport %d" : "%v%v"),
              (t += null != e.tcptype ? " tcptype %s" : "%v"),
              null != e.generation && (t += " generation %d"),
              (t += null != e["network-id"] ? " network-id %d" : "%v") +
                (null != e["network-cost"] ? " network-cost %d" : "%v")
            );
          },
        },
        { name: "endOfCandidates", reg: /^(end-of-candidates)/ },
        {
          name: "remoteCandidates",
          reg: /^remote-candidates:(.*)/,
          format: "remote-candidates:%s",
        },
        {
          name: "iceOptions",
          reg: /^ice-options:(\S*)/,
          format: "ice-options:%s",
        },
        {
          push: "ssrcs",
          reg: /^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,
          names: ["id", "attribute", "value"],
          format: function (e) {
            var t = "ssrc:%d";
            return (
              null != e.attribute &&
                ((t += " %s"), null != e.value && (t += ":%s")),
              t
            );
          },
        },
        {
          push: "ssrcGroups",
          reg: /^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,
          names: ["semantics", "ssrcs"],
          format: "ssrc-group:%s %s",
        },
        {
          name: "msidSemantic",
          reg: /^msid-semantic:\s?(\w*) (\S*)/,
          names: ["semantic", "token"],
          format: "msid-semantic: %s %s",
        },
        {
          push: "groups",
          reg: /^group:(\w*) (.*)/,
          names: ["type", "mids"],
          format: "group:%s %s",
        },
        { name: "rtcpMux", reg: /^(rtcp-mux)/ },
        { name: "rtcpRsize", reg: /^(rtcp-rsize)/ },
        {
          name: "sctpmap",
          reg: /^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,
          names: ["sctpmapNumber", "app", "maxMessageSize"],
          format: function (e) {
            return null != e.maxMessageSize
              ? "sctpmap:%s %s %s"
              : "sctpmap:%s %s";
          },
        },
        {
          name: "xGoogleFlag",
          reg: /^x-google-flag:([^\s]*)/,
          format: "x-google-flag:%s",
        },
        {
          push: "rids",
          reg: /^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,
          names: ["id", "direction", "params"],
          format: function (e) {
            return e.params ? "rid:%s %s %s" : "rid:%s %s";
          },
        },
        {
          push: "imageattrs",
          reg: new RegExp(
            "^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?",
          ),
          names: ["pt", "dir1", "attrs1", "dir2", "attrs2"],
          format: function (e) {
            return "imageattr:%s %s %s" + (e.dir2 ? " %s %s" : "");
          },
        },
        {
          name: "simulcast",
          reg: new RegExp(
            "^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$",
          ),
          names: ["dir1", "list1", "dir2", "list2"],
          format: function (e) {
            return "simulcast:%s %s" + (e.dir2 ? " %s %s" : "");
          },
        },
        {
          name: "simulcast_03",
          reg: /^simulcast:[\s\t]+([\S+\s\t]+)$/,
          names: ["value"],
          format: "simulcast: %s",
        },
        {
          name: "framerate",
          reg: /^framerate:(\d+(?:$|\.\d+))/,
          format: "framerate:%s",
        },
        {
          name: "sourceFilter",
          reg: /^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,
          names: [
            "filterMode",
            "netType",
            "addressTypes",
            "destAddress",
            "srcList",
          ],
          format: "source-filter: %s %s %s %s %s",
        },
        { name: "bundleOnly", reg: /^(bundle-only)/ },
        { name: "label", reg: /^label:(.+)/, format: "label:%s" },
        { name: "sctpPort", reg: /^sctp-port:(\d+)$/, format: "sctp-port:%s" },
        {
          name: "maxMessageSize",
          reg: /^max-message-size:(\d+)$/,
          format: "max-message-size:%s",
        },
        {
          push: "tsRefClocks",
          reg: /^ts-refclk:([^\s=]*)(?:=(\S*))?/,
          names: ["clksrc", "clksrcExt"],
          format: function (e) {
            return "ts-refclk:%s" + (null != e.clksrcExt ? "=%s" : "");
          },
        },
        {
          name: "mediaClk",
          reg: /^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,
          names: [
            "id",
            "mediaClockName",
            "mediaClockValue",
            "rateNumerator",
            "rateDenominator",
          ],
          format: function (e) {
            var t = "mediaclk:";
            return (
              (t += null != e.id ? "id=%s %s" : "%v%s"),
              (t += null != e.mediaClockValue ? "=%s" : ""),
              (t += null != e.rateNumerator ? " rate=%s" : "") +
                (null != e.rateDenominator ? "/%s" : "")
            );
          },
        },
        { name: "keywords", reg: /^keywds:(.+)$/, format: "keywds:%s" },
        { name: "content", reg: /^content:(.+)/, format: "content:%s" },
        {
          name: "bfcpFloorCtrl",
          reg: /^floorctrl:(c-only|s-only|c-s)/,
          format: "floorctrl:%s",
        },
        { name: "bfcpConfId", reg: /^confid:(\d+)/, format: "confid:%s" },
        { name: "bfcpUserId", reg: /^userid:(\d+)/, format: "userid:%s" },
        {
          name: "bfcpFloorId",
          reg: /^floorid:(.+) (?:m-stream|mstrm):(.+)/,
          names: ["id", "mStream"],
          format: "floorid:%s mstrm:%s",
        },
        { push: "invalid", names: ["value"] },
      ],
    });
    Object.keys(t).forEach(function (e) {
      t[e].forEach(function (e) {
        (e.reg || (e.reg = /(.*)/), e.format || (e.format = "%s"));
      });
    });
  }),
  xt = G(function (e, t) {
    var r = function (e) {
        return String(Number(e)) === e ? Number(e) : e;
      },
      i = function (e, t, i) {
        var n = e.name && e.names;
        e.push && !t[e.push]
          ? (t[e.push] = [])
          : n && !t[e.name] && (t[e.name] = {});
        var o = e.push ? {} : n ? t[e.name] : t;
        (!(function (e, t, i, n) {
          if (n && !i) t[n] = r(e[1]);
          else
            for (var o = 0; o < i.length; o += 1)
              null != e[o + 1] && (t[i[o]] = r(e[o + 1]));
        })(i.match(e.reg), o, e.names, e.name),
          e.push && t[e.push].push(o));
      },
      n = RegExp.prototype.test.bind(/^([a-z])=(.*)/);
    t.parse = function (e) {
      var t = {},
        r = [],
        o = t;
      return (
        e
          .split(/(\r\n|\r|\n)/)
          .filter(n)
          .forEach(function (e) {
            var t = e[0],
              n = e.slice(2);
            "m" === t && (r.push({ rtp: [], fmtp: [] }), (o = r[r.length - 1]));
            for (var a = 0; a < (Lt[t] || []).length; a += 1) {
              var s = Lt[t][a];
              if (s.reg.test(n)) return i(s, o, n);
            }
          }),
        (t.media = r),
        t
      );
    };
    var o = function (e, t) {
      var i = t.split(/=(.+)/, 2);
      return (
        2 === i.length
          ? (e[i[0]] = r(i[1]))
          : 1 === i.length && t.length > 1 && (e[i[0]] = void 0),
        e
      );
    };
    ((t.parseParams = function (e) {
      return e.split(/;\s?/).reduce(o, {});
    }),
      (t.parseFmtpConfig = t.parseParams),
      (t.parsePayloads = function (e) {
        return e.toString().split(" ").map(Number);
      }),
      (t.parseRemoteCandidates = function (e) {
        for (var t = [], i = e.split(" ").map(r), n = 0; n < i.length; n += 3)
          t.push({ component: i[n], ip: i[n + 1], port: i[n + 2] });
        return t;
      }),
      (t.parseImageAttributes = function (e) {
        return e.split(" ").map(function (e) {
          return e
            .substring(1, e.length - 1)
            .split(",")
            .reduce(o, {});
        });
      }),
      (t.parseSimulcastStreamList = function (e) {
        return e.split(";").map(function (e) {
          return e.split(",").map(function (e) {
            var t,
              i = !1;
            return (
              "~" !== e[0]
                ? (t = r(e))
                : ((t = r(e.substring(1, e.length))), (i = !0)),
              { scid: t, paused: i }
            );
          });
        });
      }));
  }),
  Dt = /%[sdv%]/g,
  Mt = function (e) {
    var t = 1,
      r = arguments,
      i = r.length;
    return e.replace(Dt, function (e) {
      if (t >= i) return e;
      var n = r[t];
      switch (((t += 1), e)) {
        case "%%":
          return "%";
        case "%s":
          return String(n);
        case "%d":
          return Number(n);
        case "%v":
          return "";
      }
    });
  },
  Ut = function (e, t, r) {
    var i = [
      e +
        "=" +
        (t.format instanceof Function
          ? t.format(t.push ? r : r[t.name])
          : t.format),
    ];
    if (t.names)
      for (var n = 0; n < t.names.length; n += 1)
        i.push(t.name ? r[t.name][t.names[n]] : r[t.names[n]]);
    else i.push(r[t.name]);
    return Mt.apply(null, i);
  },
  Nt = ["v", "o", "s", "i", "u", "e", "p", "c", "b", "t", "r", "z", "a"],
  Vt = ["i", "c", "b", "a"],
  jt = function (e, t) {
    ((t = t || {}),
      null == e.version && (e.version = 0),
      null == e.name && (e.name = " "),
      e.media.forEach(function (e) {
        null == e.payloads && (e.payloads = "");
      }));
    var r = t.innerOrder || Vt,
      i = [];
    return (
      (t.outerOrder || Nt).forEach(function (t) {
        Lt[t].forEach(function (r) {
          r.name in e && null != e[r.name]
            ? i.push(Ut(t, r, e))
            : r.push in e &&
              null != e[r.push] &&
              e[r.push].forEach(function (e) {
                i.push(Ut(t, r, e));
              });
        });
      }),
      e.media.forEach(function (e) {
        (i.push(Ut("m", Lt.m[0], e)),
          r.forEach(function (t) {
            Lt[t].forEach(function (r) {
              r.name in e && null != e[r.name]
                ? i.push(Ut(t, r, e))
                : r.push in e &&
                  null != e[r.push] &&
                  e[r.push].forEach(function (e) {
                    i.push(Ut(t, r, e));
                  });
            });
          }));
      }),
      i.join("\r\n") + "\r\n"
    );
  },
  Ft = xt.parse,
  Bt = xt.parsePayloads;
function Wt(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function Gt(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? Wt(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : Wt(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
function Ht(e, t) {
  var r;
  if ("undefined" == typeof Symbol || null == e[Symbol.iterator]) {
    if (
      Array.isArray(e) ||
      (r = (function (e, t) {
        if (e) {
          if ("string" == typeof e) return Jt(e, t);
          var r = Object.prototype.toString.call(e).slice(8, -1);
          return (
            "Object" === r && e.constructor && (r = e.constructor.name),
            "Map" === r || "Set" === r
              ? Array.from(e)
              : "Arguments" === r ||
                  /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
                ? Jt(e, t)
                : void 0
          );
        }
      })(e)) ||
      (t && e && "number" == typeof e.length)
    ) {
      r && (e = r);
      var i = 0,
        n = function () {};
      return {
        s: n,
        n: function () {
          return i >= e.length ? { done: !0 } : { done: !1, value: e[i++] };
        },
        e: function (e) {
          throw e;
        },
        f: n,
      };
    }
    throw new TypeError(
      "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
    );
  }
  var o,
    a = !0,
    s = !1;
  return {
    s: function () {
      r = e[Symbol.iterator]();
    },
    n: function () {
      var e = r.next();
      return ((a = e.done), e);
    },
    e: function (e) {
      ((s = !0), (o = e));
    },
    f: function () {
      try {
        a || null == r.return || r.return();
      } finally {
        if (s) throw o;
      }
    },
  };
}
function Jt(e, t) {
  (null == t || t > e.length) && (t = e.length);
  for (var r = 0, i = new Array(t); r < t; r++) i[r] = e[r];
  return i;
}
!(function (e) {
  ((e[(e.Create = 0)] = "Create"),
    (e[(e.Subscribing = 1)] = "Subscribing"),
    (e[(e.Subscribed = 2)] = "Subscribed"),
    (e[(e.Unsubscribed = 3)] = "Unsubscribed"));
})(Pt || (Pt = {}));
var zt,
  Kt = (function () {
    function e(t) {
      (F(this, e),
        (this.options = t),
        (this.userId = t.userId),
        (this.logger = t.logger),
        (this.xsigoClient = t.xsigoClient || null),
        (this.roomId = t.roomId),
        (this.peerConnection = new RTCPeerConnection({
          sdpSemantics: "unified-plan",
        })),
        (this.peerConnection.onnegotiationneeded =
          this.onNegotiationNeeded.bind(this)),
        (this.peerConnection.ontrack = this.onTrack.bind(this)),
        (this.state = Pt.Create),
        (this.subscriptionId = null),
        (this._emitter = new J()),
        (this._interval = -1),
        (this.times = 2e3),
        (this.isAlphaChannels = !1));
    }
    var t;
    return (
      W(e, [
        {
          key: "getState",
          value: function () {
            return this.state;
          },
        },
        {
          key: "subscribe",
          value: function () {
            var e = this;
            return new Promise(function (t, r) {
              (e.logger.info("start subscribing to the stream"),
                (e.state = Pt.Subscribing),
                e.addTransceiver(),
                e.createOffer(),
                (e.peerConnection.onconnectionstatechange =
                  e.onConnectionstatechange.bind(e, "subscribe")));
              var i = "";
              e.peerConnection.onicecandidate = function (n) {
                var o = n.candidate;
                (e.logger.info(
                  "peercConnection subscribe IceCandidate data:\n ".concat(
                    (null == o ? void 0 : o.candidate) || "",
                  ),
                ),
                  null != o &&
                    o.candidate &&
                    (i = i + "a=" + o.candidate + "\r\n"));
                var a = !1,
                  s = window.setTimeout(function () {
                    a = !0;
                  }, e.times);
                if (!o || a) {
                  window.clearTimeout(s);
                  var c = e.peerConnection.pendingLocalDescription.sdp;
                  if (
                    c.toLocaleLowerCase().includes("video") &&
                    !c.toLowerCase().includes("h264")
                  )
                    (e.logger.warn("=======subscribe offer========\n", c),
                      r("H264 not supported"));
                  else {
                    c.includes("a=candidate") || (c += i);
                    var u = e.buildSubscribeParams();
                    ((u.params.offerSdp = c),
                      e.logger.info("=======subscribe offer========\n", c),
                      (e.subscriptionId = e.xsigoClient.subscribeStream(
                        e.roomId,
                        u,
                      )),
                      t(e.subscriptionId));
                  }
                }
              };
            });
          },
        },
        {
          key: "resubscribe",
          value: function () {
            var e = this;
            return new Promise(function (t, r) {
              (e.logger.info("resubscribe stream", e.subscriptionId),
                e.close(),
                (e.peerConnection = new RTCPeerConnection({
                  sdpSemantics: "unified-plan",
                })),
                (e.state = Pt.Subscribing),
                e.addTransceiver(),
                e.createOffer(),
                (e.peerConnection.onconnectionstatechange =
                  e.onConnectionstatechange.bind(e, "resubscribe")),
                (e.peerConnection.ontrack = e.onTrack.bind(e)));
              var i = "";
              e.peerConnection.onicecandidate = function (r) {
                var n = r.candidate;
                (e.logger.info(
                  "peercConnection resubscribe IceCandidate data:\n ".concat(
                    (null == n ? void 0 : n.candidate) || "",
                  ),
                ),
                  null != n &&
                    n.candidate &&
                    (i = i + "a=" + n.candidate + "\r\n"));
                var o = !1,
                  a = window.setTimeout(function () {
                    o = !0;
                  }, e.times);
                if (!n || o) {
                  window.clearTimeout(a);
                  var s = e.peerConnection.pendingLocalDescription;
                  (s.sdp.includes("a=candidate") || (s.sdp = s.sdp + i),
                    e.logger.info("=======resubscribe offer========\n", s.sdp),
                    t(s));
                }
              };
            });
          },
        },
        {
          key: "unsubscribe",
          value: function (e) {
            var t = this;
            (this.logger.info(
              "unsubscribe subscriptionId",
              this.subscriptionId,
            ),
              this.xsigoClient.unsubscribeStream(
                this.roomId,
                this.subscriptionId,
                function (r, i, n) {
                  (1 === r && ((t.state = Pt.Unsubscribed), t.close()),
                    e(r, i, n));
                },
              ));
          },
        },
        {
          key: "switchSimulcast",
          value: function (e, t) {
            this.xsigoClient.switchSimulcast(
              this.roomId,
              this.subscriptionId,
              { type: e },
              t,
            );
          },
        },
        {
          key: "setRemoteDescription",
          value: function (e) {
            var t = this;
            return new Promise(function (r, i) {
              (t.logger.info("=======subscribe answer========\n" + e),
                (t.isAlphaChannels = e.includes("a=xrtc-alpha")),
                t.peerConnection
                  .setRemoteDescription({ sdp: e, type: "answer" })
                  .then(function () {
                    ((t.state = Pt.Subscribed), r(!0));
                  })
                  .catch(function (e) {
                    (t.logger.error("subscribe setRemoteDescription error", e),
                      i(e));
                  }));
            });
          },
        },
        {
          key: "onConnectionstatechange",
          value: function (e) {
            var t = this;
            (["failed", "connected"].includes(
              this.peerConnection.connectionState,
            ) &&
              this._emitter.emit("subscribe-ice-state", {
                state: this.peerConnection.connectionState,
                subscriptionId: this.subscriptionId,
              }),
              this.logger.info(
                "peerConnection "
                  .concat(e, " ICE State: ")
                  .concat(this.peerConnection.connectionState),
              ),
              "connecting" === this.peerConnection.connectionState
                ? -1 === this._interval &&
                  (this._interval = window.setInterval(function () {
                    t.getRTCIceCandidatePairStats();
                  }, this.times))
                : clearInterval(this._interval));
          },
        },
        {
          key: "addTransceiver",
          value: function () {
            (this.options.hasAudio &&
              this.peerConnection.addTransceiver("audio", {
                direction: "recvonly",
              }),
              this.options.hasVideo &&
                this.peerConnection.addTransceiver("video", {
                  direction: "recvonly",
                }));
          },
        },
        {
          key: "createOffer",
          value: function () {
            var e = this;
            this.peerConnection
              .createOffer()
              .then(this.onGotOffer.bind(this))
              .catch(function (t) {
                (e.logger.error("create offer error", t),
                  (e.state = Pt.Create));
              });
          },
        },
        {
          key: "onGotOffer",
          value: function (e) {
            var t,
              r = this,
              i = Ft(e.sdp),
              n = Ht(i.media);
            try {
              for (n.s(); !(t = n.n()).done; ) {
                var o,
                  a = t.value,
                  s = Ht(Bt(a.payloads));
                try {
                  for (s.s(); !(o = s.n()).done; ) {
                    var c = o.value;
                    a.rtcpFb = a.rtcpFb
                      ? [].concat(j(a.rtcpFb), [{ payload: c, type: "rrtr" }])
                      : [{ payload: c, type: "rrtr" }];
                  }
                } catch (e) {
                  s.e(e);
                } finally {
                  s.f();
                }
              }
            } catch (e) {
              n.e(e);
            } finally {
              n.f();
            }
            var u = { sdp: jt(i), type: "offer" };
            this.peerConnection
              .setLocalDescription(u)
              .then(function () {
                r.logger.info(
                  "Set local description success",
                  r.subscriptionId,
                );
              })
              .catch(function (e) {
                r.logger.error("Set local description failure", e);
              });
          },
        },
        {
          key: "onNegotiationNeeded",
          value: function () {
            this.logger.info("onNegotiationneeded--");
          },
        },
        {
          key: "onTrack",
          value: function (e) {
            this.logger.debug("on track return");
            var t = this.options || {},
              r = t.hasAudio,
              i =
                r && t.hasVideo
                  ? ke.AudioVideo
                  : r
                    ? ke.AudioOnly
                    : ke.VideoOnly,
              n = e.streams[0],
              o = e.track;
            t.audioStreamId || t.videoStreamId
              ? this.options.onRemoteStream(n, o, i, this.isAlphaChannels)
              : this.logger.info("not audio or video");
          },
        },
        {
          key: "getPeerConnection",
          value: function () {
            return this.peerConnection;
          },
        },
        {
          key: "close",
          value: function () {
            (this.peerConnection &&
              ((this.peerConnection.onicecandidate = null),
              (this.peerConnection.onnegotiationneeded = null),
              (this.peerConnection.onconnectionstatechange = null),
              (this.peerConnection.ontrack = null),
              this.peerConnection.close()),
              (this.peerConnection = null),
              this._interval && clearInterval(this._interval),
              this.logger.info(
                "close subscribe stream peerConnection subscriptionId",
                this.subscriptionId,
              ));
          },
        },
        {
          key: "buildSubscribeParams",
          value: function () {
            var e = this,
              t = this.options || {},
              r = t.hasAudio,
              i = t.hasVideo,
              n = t.simulcast,
              o = {
                publisherUserId: t.publisherUserId,
                streamId: r ? t.audioStreamId : t.videoStreamId,
                streamKind:
                  r && i ? ke.AudioVideo : r ? ke.AudioOnly : ke.VideoOnly,
                params: {
                  offerSdp: "",
                  hasAudio: r,
                  hasVideo: i,
                  type: (null == n ? void 0 : n.length) > 0 && n[0].type,
                },
                cb: function (t, r, i) {
                  1 === t
                    ? e
                        .setRemoteDescription(i.answer_sdp)
                        .then(function () {
                          e.options.onSubscribe &&
                            e.options.onSubscribe(t, r, i);
                        })
                        .catch(function (t) {
                          (e.logger.error("setRemoteDescription is failed", t),
                            e.options.onSubscribe &&
                              e.options.onSubscribe(0, t, i));
                        })
                    : e.options.onSubscribe && e.options.onSubscribe(t, r, i);
                },
                updateCb: function () {},
              };
            return (
              t.small &&
                i &&
                ((n || []).find(function (e) {
                  return e.type === Ae.SmallStream;
                })
                  ? (o.params.type = Ae.SmallStream)
                  : this.logger.warn("does not publish small stream")),
              o
            );
          },
        },
        {
          key: "getTransportStats",
          value:
            ((t = V(
              H.mark(function e() {
                var t = this;
                return H.wrap(function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return e.abrupt(
                          "return",
                          new Promise(function (e, r) {
                            if (t.peerConnection) {
                              var i = (t.peerConnection.getReceivers() ||
                                [])[0];
                              i &&
                                i
                                  .getStats()
                                  .then(function (r) {
                                    var n = t.getReceiverStats({
                                      send: r,
                                      mediaType: i.track.kind,
                                    });
                                    e(n.rtt);
                                  })
                                  .catch(function (e) {
                                    r(e);
                                  });
                            }
                          }),
                        );
                      case 1:
                      case "end":
                        return e.stop();
                    }
                }, e);
              }),
            )),
            function () {
              return t.apply(this, arguments);
            }),
        },
        {
          key: "getRemoteAudioOrVideoStats",
          value: function (e) {
            var t = this;
            return new Promise(function (r, i) {
              if (t.peerConnection) {
                var n = t.peerConnection.getReceivers().find(function (t) {
                  return t.track.kind === e;
                });
                n &&
                  n
                    .getStats()
                    .then(function (i) {
                      var n = t.getReceiverStats({ send: i, mediaType: e });
                      r(n);
                    })
                    .catch(function (e) {
                      i(e);
                    });
              }
            });
          },
        },
        {
          key: "getReceiverStats",
          value: function (e) {
            var t = {
              audio: {
                bytesReceived: 0,
                packetsReceived: 0,
                packetsLost: 0,
                nackCount: 0,
                audioLevel: 0,
              },
              video: {
                bytesReceived: 0,
                packetsReceived: 0,
                packetsLost: 0,
                framesDecoded: 0,
                frameWidth: 0,
                frameHeight: 0,
                framesPerSecond: 0,
                nackCount: 0,
              },
              rtt: 0,
              timestamp: 0,
            };
            return (
              e.send.forEach(function (r) {
                if ("inbound-rtp" === r.type)
                  if (((t.timestamp = r.timestamp), "audio" === e.mediaType))
                    ((t.audio = Gt(
                      Gt({}, t.audio),
                      {},
                      {
                        bytesReceived: r.bytesReceived,
                        packetsReceived: r.packetsReceived,
                        packetsLost: r.packetsLost,
                      },
                    )),
                      void 0 !== r.nackCount &&
                        (t.audio.nackCount = r.nackCount),
                      void 0 !== r.audioLevel &&
                        (t.audio.audioLevel = r.audioLevel));
                  else {
                    if (0 === r.bytesReceived) return;
                    ((t.video = Gt(
                      Gt({}, t.video),
                      {},
                      {
                        bytesReceived: r.bytesReceived,
                        packetsReceived: r.packetsReceived,
                        packetsLost: r.packetsLost,
                        framesDecoded: r.framesDecoded,
                        framesPerSecond: r.framesPerSecond || 0,
                        nackCount: r.nackCount,
                      },
                    )),
                      void 0 !== r.frameWidth &&
                        (t.video.frameWidth = r.frameWidth),
                      void 0 !== r.frameHeight &&
                        (t.video.frameHeight = r.frameHeight));
                  }
                else
                  "track" === r.type
                    ? void 0 !== r.frameWidth
                      ? (t.video = Gt(
                          Gt({}, t.video),
                          {},
                          {
                            frameWidth: r.frameWidth,
                            frameHeight: r.frameHeight,
                          },
                        ))
                      : void 0 !== r.audioLevel &&
                        (t.audio.audioLevel = r.audioLevel || 0)
                    : "candidate-pair" === r.type &&
                      "number" == typeof r.currentRoundTripTime &&
                      (t.rtt = 1e3 * r.currentRoundTripTime);
              }),
              t
            );
          },
        },
        {
          key: "onSubscribePeerConnectionFailed",
          value: function (e) {
            this._emitter.on("subscribe-ice-state", e);
          },
        },
        {
          key: "getRTCIceCandidatePairStats",
          value: function () {
            var e = this;
            this.peerConnection &&
              this.peerConnection.getStats().then(function (t) {
                t.forEach(function (t) {
                  "candidate-pair" === t.type &&
                    e.logger.warn(
                      "subscribe RTCIceCandidatePairStats",
                      JSON.stringify(t, null, 4),
                    );
                });
              });
          },
        },
      ]),
      e
    );
  })();
function Yt(e, t) {
  (null == t || t > e.length) && (t = e.length);
  for (var r = 0, i = new Array(t); r < t; r++) i[r] = e[r];
  return i;
}
function qt(e) {
  var t,
    r = new Array(),
    i = (function (e, t) {
      var r;
      if ("undefined" == typeof Symbol || null == e[Symbol.iterator]) {
        if (
          Array.isArray(e) ||
          (r = (function (e, t) {
            if (e) {
              if ("string" == typeof e) return Yt(e, t);
              var r = Object.prototype.toString.call(e).slice(8, -1);
              return (
                "Object" === r && e.constructor && (r = e.constructor.name),
                "Map" === r || "Set" === r
                  ? Array.from(e)
                  : "Arguments" === r ||
                      /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
                    ? Yt(e, t)
                    : void 0
              );
            }
          })(e)) ||
          (t && e && "number" == typeof e.length)
        ) {
          r && (e = r);
          var i = 0,
            n = function () {};
          return {
            s: n,
            n: function () {
              return i >= e.length ? { done: !0 } : { done: !1, value: e[i++] };
            },
            e: function (e) {
              throw e;
            },
            f: n,
          };
        }
        throw new TypeError(
          "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
        );
      }
      var o,
        a = !0,
        s = !1;
      return {
        s: function () {
          r = e[Symbol.iterator]();
        },
        n: function () {
          var e = r.next();
          return ((a = e.done), e);
        },
        e: function (e) {
          ((s = !0), (o = e));
        },
        f: function () {
          try {
            a || null == r.return || r.return();
          } finally {
            if (s) throw o;
          }
        },
      };
    })(e);
  try {
    for (i.s(); !(t = i.n()).done; ) {
      var n = t.value,
        o = { type: Je(n.rid), maxWidth: n.maxWidth, maxHeight: n.maxHeight };
      r.push(o);
    }
  } catch (e) {
    i.e(e);
  } finally {
    i.f();
  }
  return r;
}
function Xt(e) {
  var t = { userId: e.userId, streamId: e.streamId, type: je(e.type) };
  return (
    e.info &&
      ((t.info = {}),
      e.info.audio &&
        (t.info.audio = {
          source: Be(e.info.audio.source),
          muted: e.info.audio.muted,
          floor: e.info.audio.floor,
        }),
      e.info.video &&
        ((t.info.video = {
          source: Ge(e.info.video.source),
          muted: e.info.video.muted,
          floor: e.info.video.floor,
        }),
        e.info.video.simulcast &&
          (t.info.video.simulcast = qt(e.info.video.simulcast)))),
    t
  );
}
function Qt(e) {
  var t = { userId: e.userId, streamId: e.streamId, type: je(e.data.type) };
  return (
    e.data.media.info &&
      ((t.info = {}),
      e.data.media.info.audio &&
        (t.info.audio = {
          source: Be(e.data.media.info.audio.source),
          muted: e.data.media.info.audio.muted,
          floor: e.data.media.info.audio.floor,
        }),
      e.data.media.info.video &&
        ((t.info.video = {
          source: Ge(e.data.media.info.video.source),
          muted: e.data.media.info.video.muted,
          floor: e.data.media.info.video.floor,
        }),
        e.data.media.info.video.simulcast &&
          (t.info.video.simulcast = qt(e.data.media.info.video.simulcast)))),
    t
  );
}
!(function (e) {
  ((e[(e.Created = 0)] = "Created"),
    (e[(e.Entering = 1)] = "Entering"),
    (e[(e.EnterFailed = 2)] = "EnterFailed"),
    (e[(e.EnterTimeout = 3)] = "EnterTimeout"),
    (e[(e.Entered = 4)] = "Entered"),
    (e[(e.Exiting = 5)] = "Exiting"),
    (e[(e.ExitFailed = 6)] = "ExitFailed"),
    (e[(e.ExitTimeout = 7)] = "ExitTimeout"),
    (e[(e.Exited = 8)] = "Exited"),
    (e[(e.Destroyed = 9)] = "Destroyed"),
    (e[(e.StateMax = 10)] = "StateMax"));
})(zt || (zt = {}));
var $t,
  Zt = [
    "Created",
    "Entering",
    "EnterFailed",
    "EnterTimeout",
    "Entered",
    "Exiting",
    "ExitFailed",
    "ExitTimeout",
    "Exited",
    "Destroyed",
  ],
  er = (function () {
    function e(t) {
      (F(this, e),
        (this.currentState = zt.Created),
        (this.stateTransformTable = new Array()),
        (this.logger = t),
        this.initStateTransformTable());
    }
    return (
      W(e, [
        {
          key: "setState",
          value: function (e) {
            return this.checkStateChange(this.currentState, e)
              ? (this.logger.info(
                  "RoomState : state change from " +
                    Zt[this.currentState] +
                    " to " +
                    Zt[e],
                ),
                (this.currentState = e),
                !0)
              : (this.logger.error(
                  "RoomState : INVALID state change from " +
                    Zt[this.currentState] +
                    " to " +
                    Zt[e],
                ),
                !1);
          },
        },
        {
          key: "state",
          value: function () {
            return this.currentState;
          },
        },
        {
          key: "checkStateChange",
          value: function (e, t) {
            return this.stateTransformTable[e][t];
          },
        },
        {
          key: "initStateTransformTable",
          value: function () {
            for (var e = zt.Created; e < zt.StateMax; e++) {
              this.stateTransformTable[e] = new Array();
              for (var t = zt.Created; t < zt.StateMax; t++)
                this.stateTransformTable[e][t] = !1;
            }
            ((this.stateTransformTable[zt.Created][zt.Entering] = !0),
              (this.stateTransformTable[zt.Created][zt.Destroyed] = !0),
              (this.stateTransformTable[zt.Entering][zt.Entered] = !0),
              (this.stateTransformTable[zt.Entering][zt.EnterFailed] = !0),
              (this.stateTransformTable[zt.Entering][zt.EnterTimeout] = !0),
              (this.stateTransformTable[zt.Entering][zt.Destroyed] = !0),
              (this.stateTransformTable[zt.EnterFailed][zt.Destroyed] = !0),
              (this.stateTransformTable[zt.EnterTimeout][zt.Destroyed] = !0),
              (this.stateTransformTable[zt.Entered][zt.Exiting] = !0),
              (this.stateTransformTable[zt.Entered][zt.Destroyed] = !0),
              (this.stateTransformTable[zt.Exiting][zt.Exited] = !0),
              (this.stateTransformTable[zt.Exiting][zt.ExitTimeout] = !0),
              (this.stateTransformTable[zt.Exiting][zt.Destroyed] = !0),
              (this.stateTransformTable[zt.Exited][zt.Destroyed] = !0));
          },
        },
      ]),
      e
    );
  })();
!(function (e) {
  ((e[(e.New = 0)] = "New"),
    (e[(e.Logining = 1)] = "Logining"),
    (e[(e.LoginFailed = 2)] = "LoginFailed"),
    (e[(e.LoginTimeout = 3)] = "LoginTimeout"),
    (e[(e.Logined = 4)] = "Logined"),
    (e[(e.Relogining = 5)] = "Relogining"),
    (e[(e.Relogined = 6)] = "Relogined"),
    (e[(e.Logouting = 7)] = "Logouting"),
    (e[(e.LogoutTimeout = 8)] = "LogoutTimeout"),
    (e[(e.Logouted = 9)] = "Logouted"),
    (e[(e.Destroyed = 10)] = "Destroyed"),
    (e[(e.StateMax = 11)] = "StateMax"));
})($t || ($t = {}));
var tr,
  rr,
  ir = [
    "New",
    "Logining",
    "LoginFailed",
    "LoginTimeout",
    "Logined",
    "Relogining",
    "Relogined",
    "Logouting",
    "LogoutTimeout",
    "Logouted",
    "Destroy",
  ],
  nr = (function () {
    function e(t) {
      (F(this, e),
        (this.currentState = $t.New),
        (this.stateTransformTable = new Array()),
        (this.logger = t),
        this.initStateTransformTable());
    }
    return (
      W(e, [
        {
          key: "setState",
          value: function (e) {
            return this.checkStateChange(this.currentState, e)
              ? (this.logger.info(
                  "Login : state change from " +
                    ir[this.currentState] +
                    " to " +
                    ir[e],
                ),
                (this.currentState = e),
                !0)
              : (this.logger.error(
                  "Login : INVALID state change from " +
                    ir[this.currentState] +
                    " to " +
                    ir[e],
                ),
                !1);
          },
        },
        {
          key: "state",
          value: function () {
            return this.currentState;
          },
        },
        {
          key: "checkStateChange",
          value: function (e, t) {
            return this.stateTransformTable[e][t];
          },
        },
        {
          key: "initStateTransformTable",
          value: function () {
            for (var e = $t.New; e < $t.StateMax; e++) {
              this.stateTransformTable[e] = new Array();
              for (var t = $t.New; t < $t.StateMax; t++)
                this.stateTransformTable[e][t] = !1;
            }
            ((this.stateTransformTable[$t.New][$t.Logining] = !0),
              (this.stateTransformTable[$t.New][$t.Destroyed] = !0),
              (this.stateTransformTable[$t.Logining][$t.Logined] = !0),
              (this.stateTransformTable[$t.Logining][$t.LoginFailed] = !0),
              (this.stateTransformTable[$t.Logining][$t.LoginTimeout] = !0),
              (this.stateTransformTable[$t.Logining][$t.Destroyed] = !0),
              (this.stateTransformTable[$t.LoginFailed][$t.Destroyed] = !0),
              (this.stateTransformTable[$t.LoginTimeout][$t.Destroyed] = !0),
              (this.stateTransformTable[$t.Logined][$t.Logouting] = !0),
              (this.stateTransformTable[$t.Logined][$t.Relogining] = !0),
              (this.stateTransformTable[$t.Logined][$t.Destroyed] = !0),
              (this.stateTransformTable[$t.Relogining][$t.Relogining] = !0),
              (this.stateTransformTable[$t.Relogining][$t.Relogined] = !0),
              (this.stateTransformTable[$t.Relogining][$t.Logined] = !0),
              (this.stateTransformTable[$t.Relogining][$t.Destroyed] = !0),
              (this.stateTransformTable[$t.Relogined][$t.Relogining] = !0),
              (this.stateTransformTable[$t.Relogined][$t.Logouting] = !0),
              (this.stateTransformTable[$t.Relogined][$t.Destroyed] = !0),
              (this.stateTransformTable[$t.Logouting][$t.Logouted] = !0),
              (this.stateTransformTable[$t.Logouting][$t.LogoutTimeout] = !0),
              (this.stateTransformTable[$t.Logouting][$t.Destroyed] = !0),
              (this.stateTransformTable[$t.Logouted][$t.Destroyed] = !0));
          },
        },
      ]),
      e
    );
  })();
function or(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function ar(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? or(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : or(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
(!(function (e) {
  ((e[(e.LoginSuccess = 0)] = "LoginSuccess"),
    (e[(e.LoginTimeout = 1)] = "LoginTimeout"),
    (e[(e.LoginFailed = 2)] = "LoginFailed"));
})(tr || (tr = {})),
  (function (e) {
    ((e[(e.LogoutSuccess = 0)] = "LogoutSuccess"),
      (e[(e.LogoutTimeout = 1)] = "LogoutTimeout"),
      (e[(e.LogoutFailed = 2)] = "LogoutFailed"));
  })(rr || (rr = {})));
var sr,
  cr = (function () {
    function e(t) {
      (F(this, e),
        (this.options = t),
        (this.state = new nr(t.logger)),
        (this.connectionStatus = Te.New),
        (this.timeout = 1e4));
    }
    return (
      W(e, [
        {
          key: "login",
          value: function () {
            var e = this;
            if (this.state.setState($t.Logining)) {
              this.options.logger.info(
                "Login room: ".concat(this.options.roomId),
              );
              var t = null;
              this.buildLoginReuqest();
              var r = { method: "login", params: this.loginRequestParams };
              (t ||
                (t = setTimeout(function () {
                  (e.options.logger.info(
                    "login timeout: ".concat(e.options.roomId),
                  ),
                    e.state.setState($t.LoginTimeout) &&
                      (t && clearTimeout(t),
                      (t = null),
                      e.options.loginCb &&
                        e.options.loginCb(
                          tr.LoginTimeout,
                          null,
                          "login timeout",
                        )));
                }, this.timeout)),
                this.options.rpcClient.sendRequest(
                  r,
                  function (r) {
                    if (
                      e.state.setState($t.Logined) &&
                      (t && clearTimeout(t), (t = null), e.options.loginCb)
                    ) {
                      var i = r.result.room,
                        n = {
                          room: ar(
                            ar({}, i),
                            {},
                            {
                              roomUniqueId: i.roomUniqueId || i.roomId,
                              participants: i.participants || [],
                              streams: i.streams || [],
                            },
                          ),
                        };
                      e.options.loginCb(tr.LoginSuccess, n);
                    }
                  },
                  function (r) {
                    e.state.setState($t.LoginFailed) &&
                      (t && clearTimeout(t),
                      (t = null),
                      e.options.loginCb &&
                        e.options.loginCb(
                          tr.LoginFailed,
                          null,
                          r.error.message,
                        ));
                  },
                ) ||
                  this.options.logger.error(
                    "Json Rpc Client send login request error",
                  ));
            }
          },
        },
        {
          key: "logout",
          value: function () {
            var e = this;
            if (this.state.setState($t.Logouting)) {
              this.options.logger.info(
                "Logout room: ".concat(this.options.roomId),
              );
              var t = null;
              (this.options.rpcClient.sendRequest(
                { method: "logout" },
                function (r) {
                  e.state.setState($t.Logouted) &&
                    (t && clearTimeout(t),
                    (t = null),
                    e.options.logoutCb && e.options.logoutCb(rr.LogoutSuccess));
                },
                function (r) {
                  e.state.setState($t.LoginFailed) &&
                    (t && clearTimeout(t),
                    (t = null),
                    e.options.logoutCb &&
                      e.options.logoutCb(rr.LogoutFailed, r.error.message));
                },
              ) ||
                this.options.logger.error(
                  "Json Rpc Client send loginout request error",
                ),
                t ||
                  (t = setTimeout(function () {
                    (e.options.logger.info(
                      "logout timeout: ".concat(e.options.roomId),
                    ),
                      e.state.setState($t.LogoutTimeout) &&
                        (t && clearTimeout(t),
                        (t = null),
                        e.options.logoutCb &&
                          e.options.logoutCb(
                            rr.LogoutTimeout,
                            "logout timeout",
                          )));
                  }, this.timeout)));
            }
          },
        },
        {
          key: "relogin",
          value: function () {
            var e = this;
            this.state.setState($t.Relogining) &&
              (this.buildLoginReuqest(),
              this.options.logger.info(
                "Relogin room: ".concat(this.options.roomId),
              ),
              this.options.rpcClient.sendRequest(
                { method: "login", params: this.loginRequestParams },
                function (t) {
                  if (e.state.setState($t.Relogined) && e.options.reloginCb) {
                    var r = t.result.room,
                      i = {
                        room: ar(
                          ar({}, r),
                          {},
                          {
                            roomUniqueId: r.roomUniqueId || r.roomId,
                            participants: r.participants || [],
                            streams: r.streams || [],
                          },
                        ),
                      };
                    e.options.reloginCb(!0, r.sessionTimeout, i);
                  }
                },
                function (t) {
                  e.options.logger.info("relogining failed");
                },
              ) ||
                this.options.logger.error(
                  "Json Rpc Client send relogin request error",
                ));
          },
        },
        {
          key: "updatePermission",
          value: function (e) {
            this.options.permission = e;
          },
        },
        {
          key: "onConnectionLost",
          value: function () {
            this.connectionStatus = Te.ConnectionLost;
          },
        },
        {
          key: "onConnectionRecovery",
          value: function () {
            ((this.connectionStatus = Te.ConnectionRecovery), this.relogin());
          },
        },
        {
          key: "buildLoginReuqest",
          value: function () {
            this.loginRequestParams = {
              appId: this.options.appId,
              userId: this.options.userId,
              type: this.options.userType,
              roomId: this.options.roomId,
              previousRoomId: this.options.previousRoomId,
              permission: this.options.permission,
              userAgent: this.options.userAgent,
              userData: this.options.userData,
              protocol: "1.0",
            };
          },
        },
      ]),
      e
    );
  })();
!(function (e) {
  ((e[(e.Create = 0)] = "Create"),
    (e[(e.Publishing = 1)] = "Publishing"),
    (e[(e.Published = 2)] = "Published"),
    (e[(e.Republishing = 3)] = "Republishing"),
    (e[(e.Republished = 4)] = "Republished"),
    (e[(e.Unpublishing = 5)] = "Unpublishing"),
    (e[(e.Unpublished = 6)] = "Unpublished"),
    (e[(e.Destroyed = 7)] = "Destroyed"),
    (e[(e.StateMax = 8)] = "StateMax"));
})(sr || (sr = {}));
var ur = [
    "Create",
    "Publishing",
    "Published",
    "Republishing",
    "Republished",
    "Unpublishing",
    "Unpublished",
    "Destroy",
  ],
  dr = (function () {
    function e(t) {
      (F(this, e),
        (this.currentState = sr.Create),
        (this.stateTransformTable = new Array()),
        (this.logger = t),
        this.initStateTransformTable());
    }
    return (
      W(e, [
        {
          key: "setState",
          value: function (e) {
            return this.checkStateChange(this.currentState, e)
              ? (this.logger.info(
                  "PublicationState : state change from " +
                    ur[this.currentState] +
                    " to " +
                    ur[e],
                ),
                (this.currentState = e),
                !0)
              : (this.logger.error(
                  "PublicationState : INVALID state change from" +
                    ur[this.currentState] +
                    " to " +
                    ur[e],
                ),
                !1);
          },
        },
        {
          key: "state",
          value: function () {
            return this.currentState;
          },
        },
        {
          key: "checkStateChange",
          value: function (e, t) {
            return this.stateTransformTable[e][t];
          },
        },
        {
          key: "initStateTransformTable",
          value: function () {
            for (var e = sr.Create; e < sr.StateMax; e++) {
              this.stateTransformTable[e] = new Array();
              for (var t = sr.Create; t < sr.StateMax; t++)
                this.stateTransformTable[e][t] = !1;
            }
            ((this.stateTransformTable[sr.Create][sr.Publishing] = !0),
              (this.stateTransformTable[sr.Create][sr.Destroyed] = !0),
              (this.stateTransformTable[sr.Publishing][sr.Published] = !0),
              (this.stateTransformTable[sr.Publishing][sr.Unpublishing] = !0),
              (this.stateTransformTable[sr.Publishing][sr.Destroyed] = !0),
              (this.stateTransformTable[sr.Publishing][sr.Republishing] = !0),
              (this.stateTransformTable[sr.Published][sr.Unpublishing] = !0),
              (this.stateTransformTable[sr.Published][sr.Republishing] = !0),
              (this.stateTransformTable[sr.Published][sr.Destroyed] = !0),
              (this.stateTransformTable[sr.Republishing][sr.Republishing] = !0),
              (this.stateTransformTable[sr.Republishing][sr.Republished] = !0),
              (this.stateTransformTable[sr.Republishing][sr.Unpublishing] = !0),
              (this.stateTransformTable[sr.Republishing][sr.Published] = !0),
              (this.stateTransformTable[sr.Republishing][sr.Destroyed] = !0),
              (this.stateTransformTable[sr.Republished][sr.Republishing] = !0),
              (this.stateTransformTable[sr.Republished][sr.Unpublishing] = !0),
              (this.stateTransformTable[sr.Republished][sr.Destroyed] = !0),
              (this.stateTransformTable[sr.Unpublishing][sr.Unpublished] = !0),
              (this.stateTransformTable[sr.Unpublishing][sr.Destroyed] = !0),
              (this.stateTransformTable[sr.Unpublished][sr.Destroyed] = !0));
          },
        },
      ]),
      e
    );
  })();
function lr(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function hr(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? lr(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : lr(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
var pr = (function () {
    function e(t) {
      (F(this, e),
        (this.options = t),
        (this.state = new dr(t.logger)),
        (this.connectionStatus = Te.ConnectionConnected),
        t.stream.info &&
          (t.stream.info.audio && t.stream.info.video
            ? ((this.streamKind = ke.AudioVideo),
              (this.audioMuteWanted = this.options.stream.info.audio.muted),
              (this.simulcastWanted = this.options.stream.info.video.simulcast),
              (this.videoMuteWanted = this.options.stream.info.video.muted))
            : t.stream.info.audio
              ? ((this.streamKind = ke.AudioOnly),
                (this.audioMuteWanted = this.options.stream.info.audio.muted))
              : t.stream.info.video
                ? ((this.streamKind = ke.VideoOnly),
                  (this.simulcastWanted =
                    this.options.stream.info.video.simulcast),
                  (this.videoMuteWanted = this.options.stream.info.video.muted))
                : this.options.logger.warn("now not support mix")));
    }
    return (
      W(e, [
        {
          key: "publish",
          value: function () {
            if (
              (this.options.logger.info(
                "Publish stream: ".concat(this.options.stream.streamId),
              ),
              this.state.setState(sr.Publishing))
            ) {
              var e = this.options.rpcClient.getWsState().state;
              ["CONNECTED", "RECOVERY"].includes(e) && this.doPublish();
            }
          },
        },
        {
          key: "unpublish",
          value: function (e) {
            if (
              (this.options.logger.info(
                "Unpublish stream: " + this.options.stream.streamId,
              ),
              this.state.setState(sr.Unpublishing))
            ) {
              this.unpublishCb = e;
              var t = this.options.rpcClient.getWsState().state;
              ["CONNECTED", "RECOVERY"].includes(t)
                ? this.doUnpublish(e)
                : this.options.logger.info(
                    "websocketState: ".concat(t, ", unpublish has been cached"),
                  );
            }
          },
        },
        {
          key: "updateSimulcast",
          value: function (e, t) {
            ((this.simulcastWanted = e), (this.updateSimulcastCb = t));
            var r = this.options.rpcClient.getWsState().state,
              i = this.state.state();
            ["CONNECTED", "RECOVERY"].includes(r)
              ? i === sr.Republished || i === sr.Published
                ? this.doUpdateSimulcast(t)
                : this.options.logger.info(
                    "publicationState: ".concat(
                      r,
                      ",updateSimulcast has been cached",
                    ),
                  )
              : this.options.logger.info(
                  "websocketState: ".concat(
                    r,
                    ",updateSimulcast has been cached",
                  ),
                );
          },
        },
        {
          key: "muteAudio",
          value: function (e, t, r, i) {
            ((this.audioMuteWanted = !0),
              (this.muteAudioOption = { userId: e, cb: t, userData: i }));
            var n = this.options.rpcClient.getWsState().state,
              o = this.state.state();
            ["CONNECTED", "RECOVERY"].includes(n)
              ? o === sr.Republished || o === sr.Published
                ? this.control(e, "mute", t, r, i)
                : this.options.logger.info(
                    "publicationState: ".concat(
                      n,
                      ",muteAudio has been cached",
                    ),
                  )
              : this.options.logger.info(
                  "websocketState: ".concat(n, ",muteAudio has been cached"),
                );
          },
        },
        {
          key: "muteVideo",
          value: function (e, t, r, i) {
            ((this.videoMuteWanted = !0),
              (this.muteVideoOption = { userId: e, cb: t, userData: i }));
            var n = this.options.rpcClient.getWsState().state,
              o = this.state.state();
            ["CONNECTED", "RECOVERY"].includes(n)
              ? o === sr.Republished || o === sr.Published
                ? this.control(e, "vmute", t, r, i)
                : this.options.logger.info(
                    "publicationState: ".concat(
                      n,
                      ",muteVideo has been cached",
                    ),
                  )
              : this.options.logger.info(
                  "websocketState: ".concat(n, ",muteVideo has been cached"),
                );
          },
        },
        {
          key: "unmuteAudio",
          value: function (e, t, r, i) {
            ((this.audioMuteWanted = !1),
              (this.unmuteAudioOption = { userId: e, cb: t, userData: i }));
            var n = this.options.rpcClient.getWsState().state,
              o = this.state.state();
            ["CONNECTED", "RECOVERY"].includes(n)
              ? o === sr.Republished || o === sr.Published
                ? this.control(e, "unmute", t, r, i)
                : this.options.logger.info(
                    "publicationState: ".concat(
                      n,
                      ",unmuteAudio has been cached",
                    ),
                  )
              : this.options.logger.info(
                  "websocketState: ".concat(n, ",unmuteAudio has been cached"),
                );
          },
        },
        {
          key: "unmuteVideo",
          value: function (e, t, r, i) {
            ((this.videoMuteWanted = !1),
              (this.unmuteVideoOPtion = { userId: e, cb: t, userData: i }));
            var n = this.options.rpcClient.getWsState().state,
              o = this.state.state();
            ["CONNECTED", "RECOVERY"].includes(n)
              ? o === sr.Republished || o === sr.Published
                ? this.control(e, "unvmute", t, r, i)
                : this.options.logger.info(
                    "publicationState: ".concat(
                      n,
                      ",unmuteVideo has been cached",
                    ),
                  )
              : this.options.logger.info(
                  "websocketState: ".concat(n, ",unmuteVideo has been cached"),
                );
          },
        },
        { key: "onConnectionLost", value: function () {} },
        {
          key: "onConnectionRecovery",
          value: function (e, t) {
            if (
              (this.options.logger.info(
                "onConnectionRecovery streamId",
                this.options.stream.streamId,
                "sessionTimeout",
                e,
                "sdp",
                t,
              ),
              this.state.state() === sr.Unpublishing)
            )
              return this.doUnpublish(this.unpublishCb);
            e
              ? t &&
                ((this.options.offerSdp = t.sdp),
                (this.options.stream.streamId = t.pubId),
                this.republish())
              : this.recoveryOperations();
          },
        },
        {
          key: "republish",
          value: function () {
            (this.options.logger.info(
              "start republish: " + this.options.stream.streamId,
            ),
              this.state.setState(sr.Republishing) && this.doPublish());
          },
        },
        {
          key: "recoveryOperations",
          value: function () {
            var e, t, r, i, n, o;
            if (
              this.audioMuteWanted !==
              (null === (e = this.options.stream.info) ||
              void 0 === e ||
              null === (t = e.audio) ||
              void 0 === t
                ? void 0
                : t.muted)
            )
              if (this.audioMuteWanted) {
                var a = this.muteAudioOption;
                this.control(a.userId, "mute", a.cb, a.userData);
              } else {
                var s = this.unmuteAudioOption;
                this.control(s.userId, "unmute", s.cb, s.userData);
              }
            if (
              this.videoMuteWanted !==
              (null === (r = this.options.stream.info) ||
              void 0 === r ||
              null === (i = r.video) ||
              void 0 === i
                ? void 0
                : i.muted)
            )
              if (this.videoMuteWanted) {
                var c = this.muteVideoOption;
                this.control(c.userId, "vmute", c.cb, c.userData);
              } else {
                var u = this.unmuteVideoOPtion;
                this.control(u.userId, "unvmute", u.cb, u.userData);
              }
            this.simulcastWanted &&
              null !== (n = this.options.stream.info) &&
              void 0 !== n &&
              null !== (o = n.video) &&
              void 0 !== o &&
              o.simulcast &&
              JSON.stringify(this.simulcastWanted) !==
                JSON.stringify(this.options.stream.info.video.simulcast) &&
              this.doUpdateSimulcast(this.updateSimulcastCb);
          },
        },
        {
          key: "buildPublishParams",
          value: function () {
            if (this.streamKind === ke.AudioVideo) {
              var e = {
                streamId: this.options.stream.streamId,
                type: Ve(this.options.stream.type),
                media: {
                  audio: {
                    source: Fe(this.options.stream.info.audio.source),
                    muted: this.audioMuteWanted,
                    floor: this.options.stream.info.audio.floor,
                  },
                  video: {
                    source: We(this.options.stream.info.video.source),
                    muted: this.videoMuteWanted,
                    floor: this.options.stream.info.video.floor,
                  },
                },
                sdp: this.options.offerSdp,
              };
              return (
                this.simulcastWanted &&
                  this.simulcastWanted.length &&
                  (e.media.video.simulcast = this.simulcastWanted.map(
                    function (e) {
                      return hr(hr({}, e), {}, { rid: He(e.type) });
                    },
                  )),
                e
              );
            }
            if (this.streamKind === ke.AudioOnly)
              return {
                streamId: this.options.stream.streamId,
                type: Ve(this.options.stream.type),
                media: {
                  audio: {
                    source: Fe(this.options.stream.info.audio.source),
                    muted: this.audioMuteWanted,
                    floor: this.options.stream.info.audio.floor,
                  },
                },
                sdp: this.options.offerSdp,
              };
            if (this.streamKind === ke.VideoOnly) {
              var t = {
                streamId: this.options.stream.streamId,
                type: Ve(this.options.stream.type),
                media: {
                  video: {
                    source: We(this.options.stream.info.video.source),
                    muted: this.videoMuteWanted,
                    floor: this.options.stream.info.video.floor,
                  },
                },
                sdp: this.options.offerSdp,
              };
              return (
                this.simulcastWanted &&
                  this.simulcastWanted.length &&
                  (t.media.video.simulcast = this.simulcastWanted.map(
                    function (e) {
                      return hr(hr({}, e), {}, { rid: He(e.type) });
                    },
                  )),
                t
              );
            }
          },
        },
        {
          key: "doPublish",
          value: function () {
            var e = this;
            try {
              var t = this.buildPublishParams();
              null !== t &&
                (this.options.rpcClient.sendRequest(
                  { method: "publish", params: t },
                  function (t) {
                    if (
                      (e.state.state() !== sr.Publishing ||
                        e.state.setState(sr.Published)) &&
                      (e.state.state() !== sr.Republishing ||
                        e.state.setState(sr.Republished))
                    ) {
                      if (e.options.publishCb) {
                        var r = t.result;
                        e.options.publishCb(be.Success, null, {
                          roomId: e.options.roomId,
                          streamId: r.streamId,
                          answer_sdp: r.sdp,
                        });
                      }
                      e.recoveryOperations();
                    }
                  },
                  function (t) {
                    (e.options.logger.info("publish stream failed"),
                      e.options.publishCb &&
                        e.options.publishCb(be.Failed, t.error.message, {
                          roomId: e.options.roomId,
                          streamId: e.options.stream.streamId,
                        }));
                  },
                ) ||
                  this.options.logger.error(
                    "Json Rpc Client send publish request error",
                  ));
            } catch (e) {
              (this.options.publishCb &&
                this.options.publishCb(be.Failed, e, {
                  roomId: this.options.roomId,
                }),
                this.options.logger.error(e));
            }
          },
        },
        {
          key: "doUnpublish",
          value: function (e) {
            var t = this;
            this.options.rpcClient.sendRequest(
              {
                method: "unpublish",
                params: { id: this.options.stream.streamId },
              },
              function () {
                t.state.setState(sr.Unpublished) &&
                  e &&
                  (e(be.Success, null, { roomId: t.options.roomId }),
                  (t.unpublishCb = null));
              },
              function (r) {
                e &&
                  (t.options.logger.info("unpublish stream failed"),
                  e(be.Failed, r.error.message, { roomId: t.options.roomId }),
                  (t.unpublishCb = null));
              },
            ) ||
              this.options.logger.error(
                "Json Rpc Client send unpublish request error",
              );
          },
        },
        {
          key: "doUpdateSimulcast",
          value: function (e) {
            var t = this,
              r = {
                method: "publishControl",
                params: {
                  type: "simulcast",
                  streamId: this.options.stream.streamId,
                  simulcast: this.simulcastWanted.map(function (e) {
                    return {
                      rid: He(e.type),
                      maxWidth: e.maxWidth,
                      maxHeight: e.maxHeight,
                    };
                  }),
                },
              };
            this.options.rpcClient.sendRequest(
              r,
              function (r) {
                (t.options.logger.info(
                  "updateSimulcast ".concat(
                    t.options.stream.streamId,
                    " success",
                  ),
                ),
                  (t.options.stream.info.video.simulcast = t.simulcastWanted),
                  e && e(be.Success, null, t.options.roomId));
              },
              function (r) {
                (t.options.logger.info(
                  "updateSimulcast ".concat(
                    t.options.stream.streamId,
                    " failed",
                  ),
                ),
                  e && e(be.Failed, r.error.message, null));
              },
            ) ||
              this.options.logger.error(
                "Json Rpc Client send unsubscribe request error",
              );
          },
        },
        {
          key: "control",
          value: function (e, t, r, i, n) {
            var o = this,
              a = {
                method: "controlCommand",
                params: {
                  type: t,
                  streamId: this.options.stream.streamId,
                  member: e,
                  userData: n,
                },
              };
            (this.options.logger.info("control command with", t),
              this.options.rpcClient.sendRequest(
                a,
                function (n) {
                  switch (
                    (o.options.logger.info(
                      "control command with ".concat(t, " success"),
                    ),
                    t)
                  ) {
                    case "mute":
                      i &&
                        i(o.options.roomId, Re.MuteLocal, {
                          type: Le.Amute,
                          userId: e,
                        });
                      break;
                    case "unmute":
                      (i &&
                        i(o.options.roomId, Re.MuteLocal, {
                          type: Le.Aunmute,
                          userId: e,
                        }),
                        (o.options.stream.info.audio.muted =
                          o.audioMuteWanted));
                      break;
                    case "vmute":
                      i &&
                        i(o.options.roomId, Re.MuteLocal, {
                          type: Le.Vmute,
                          userId: e,
                        });
                      break;
                    case "unvmute":
                      (i &&
                        i(o.options.roomId, Re.MuteLocal, {
                          type: Le.Vunmute,
                          userId: e,
                        }),
                        (o.options.stream.info.video.muted =
                          o.videoMuteWanted));
                  }
                  r && r(be.Success, null, { roomId: o.options.roomId });
                },
                function (e) {
                  (o.options.logger.info(
                    "control command with ".concat(t, " failed"),
                  ),
                    r &&
                      r(be.Failed, e.error.message, {
                        roomId: o.options.roomId,
                      }));
                },
              ) ||
                this.options.logger.error(
                  "Json Rpc Client send ControlCommand request error",
                ));
          },
        },
      ]),
      e
    );
  })(),
  fr = (function () {
    function e(t) {
      (F(this, e),
        (this.options = t),
        (this.publiccation = new pr({
          roomId: this.options.roomId,
          stream: this.options.stream,
          offerSdp: this.options.offerSdp,
          rpcClient: this.options.rpcClient,
          logger: this.options.logger,
          publishCb: this.options.publishCb,
          publishUpdateCb: this.options.publishUpdateCb,
        })));
    }
    return (
      W(e, [
        {
          key: "publish",
          value: function () {
            this.publiccation.publish();
          },
        },
        {
          key: "unpublish",
          value: function (e) {
            this.publiccation.unpublish(e);
          },
        },
        {
          key: "updateSimulcast",
          value: function (e, t) {
            this.publiccation.updateSimulcast(e, t);
          },
        },
        {
          key: "muteAudio",
          value: function (e, t, r, i) {
            this.publiccation.muteAudio(e, t, r, i);
          },
        },
        {
          key: "muteVideo",
          value: function (e, t, r, i) {
            this.publiccation.muteVideo(e, t, r, i);
          },
        },
        {
          key: "unmuteAudio",
          value: function (e, t, r, i) {
            this.publiccation.unmuteAudio(e, t, r, i);
          },
        },
        {
          key: "unmuteVideo",
          value: function (e, t, r, i) {
            this.publiccation.unmuteVideo(e, t, r, i);
          },
        },
        {
          key: "onConnectionLost",
          value: function () {
            this.publiccation.onConnectionLost();
          },
        },
        {
          key: "onConnectionRecovery",
          value: function (e, t) {
            (this.options.logger.info("localStreams onConnectionRecovery"),
              this.publiccation.onConnectionRecovery(e, t));
          },
        },
      ]),
      e
    );
  })();
function mr(e, t) {
  (null == t || t > e.length) && (t = e.length);
  for (var r = 0, i = new Array(t); r < t; r++) i[r] = e[r];
  return i;
}
var vr,
  gr = (function () {
    function e(t) {
      (F(this, e),
        (this.options = t),
        (this.permissionWanted = t.permission),
        (this.permissionCb = null),
        (this.localStreams = new Map()));
    }
    return (
      W(e, [
        {
          key: "getUserId",
          value: function () {
            return this.options.userId;
          },
        },
        {
          key: "switchPermission",
          value: function (e, t) {
            ((this.permissionWanted = e), (this.permissionCb = t));
            var r = this.options.rpcClient.getWsState().state;
            ["CONNECTED", "RECOVERY"].includes(r)
              ? this.doSwitchPermission(t)
              : this.options.logger.info(
                  "websocketState: ".concat(
                    r,
                    ",the operation has been cached",
                  ),
                );
          },
        },
        {
          key: "publishStream",
          value: function (e, t, r, i, n, o) {
            var a = {
              roomId: this.options.roomId,
              stream: {
                userId: this.options.userId,
                streamId: e,
                type: t,
                info: {},
              },
              offerSdp: i.offerSdp,
              rpcClient: this.options.rpcClient,
              logger: this.options.logger,
              publishCb: n,
              publishUpdateCb: o,
            };
            (r === ke.AudioVideo &&
              (a.stream.info = { audio: i.audioInfo, video: i.videoInfo }),
              r === ke.AudioOnly && (a.stream.info.audio = i.audioInfo),
              r === ke.VideoOnly && (a.stream.info.video = i.videoInfo));
            var s = new fr(a);
            (s.publish(), this.localStreams.set(e, s));
          },
        },
        {
          key: "unpublishStream",
          value: function (e, t) {
            var r = this;
            this.localStreams.has(e) &&
              this.localStreams.get(e).unpublish(function (i, n, o) {
                (i === be.Success && r.localStreams.delete(e), t && t(i, n, o));
              });
          },
        },
        {
          key: "updateSimulcast",
          value: function (e, t, r) {
            this.localStreams.has(e) &&
              this.localStreams.get(e).updateSimulcast(t.simulcast, r);
          },
        },
        {
          key: "muteAudio",
          value: function (e, t, r, i) {
            this.localStreams.has(e) &&
              this.localStreams.get(e).muteAudio(this.options.userId, t, r, i);
          },
        },
        {
          key: "muteVideo",
          value: function (e, t, r, i) {
            this.localStreams.has(e) &&
              this.localStreams.get(e).muteVideo(this.options.userId, t, r, i);
          },
        },
        {
          key: "unmuteAudio",
          value: function (e, t, r, i) {
            this.localStreams.has(e) &&
              this.localStreams
                .get(e)
                .unmuteAudio(this.options.userId, t, r, i);
          },
        },
        {
          key: "unmuteVideo",
          value: function (e, t, r, i) {
            this.localStreams.has(e) &&
              this.localStreams
                .get(e)
                .unmuteVideo(this.options.userId, t, r, i);
          },
        },
        { key: "onConnectionLost", value: function () {} },
        {
          key: "onConnectionRecovery",
          value: function (e, t) {
            if (
              (this.options.logger.info("localUser onConnectionRecovery", e), e)
            ) {
              var r,
                i = (function (e, t) {
                  var r;
                  if (
                    "undefined" == typeof Symbol ||
                    null == e[Symbol.iterator]
                  ) {
                    if (
                      Array.isArray(e) ||
                      (r = (function (e, t) {
                        if (e) {
                          if ("string" == typeof e) return mr(e, t);
                          var r = Object.prototype.toString
                            .call(e)
                            .slice(8, -1);
                          return (
                            "Object" === r &&
                              e.constructor &&
                              (r = e.constructor.name),
                            "Map" === r || "Set" === r
                              ? Array.from(e)
                              : "Arguments" === r ||
                                  /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(
                                    r,
                                  )
                                ? mr(e, t)
                                : void 0
                          );
                        }
                      })(e)) ||
                      (t && e && "number" == typeof e.length)
                    ) {
                      r && (e = r);
                      var i = 0,
                        n = function () {};
                      return {
                        s: n,
                        n: function () {
                          return i >= e.length
                            ? { done: !0 }
                            : { done: !1, value: e[i++] };
                        },
                        e: function (e) {
                          throw e;
                        },
                        f: n,
                      };
                    }
                    throw new TypeError(
                      "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
                    );
                  }
                  var o,
                    a = !0,
                    s = !1;
                  return {
                    s: function () {
                      r = e[Symbol.iterator]();
                    },
                    n: function () {
                      var e = r.next();
                      return ((a = e.done), e);
                    },
                    e: function (e) {
                      ((s = !0), (o = e));
                    },
                    f: function () {
                      try {
                        a || null == r.return || r.return();
                      } finally {
                        if (s) throw o;
                      }
                    },
                  };
                })(new Map(this.localStreams));
              try {
                for (i.s(); !(r = i.n()).done; ) {
                  var n = U(r.value, 2),
                    o = n[0],
                    a = n[1];
                  (this.options.logger.info(
                    "localUser onConnectionRecovery",
                    o,
                  ),
                    a.onConnectionRecovery(e, null == t ? void 0 : t.get(o)),
                    this.localStreams.delete(o));
                  var s = null == t ? void 0 : t.get(o).pubId;
                  this.localStreams.set(s, a);
                }
              } catch (e) {
                i.e(e);
              } finally {
                i.f();
              }
              JSON.stringify(this.permissionWanted) !==
                JSON.stringify(this.options.permission) &&
                this.doSwitchPermission(this.permissionCb);
            }
          },
        },
        {
          key: "doSwitchPermission",
          value: function (e) {
            var t = this;
            this.options.rpcClient.sendRequest(
              {
                method: "switchPermission",
                params: { permission: this.permissionWanted },
              },
              function (r) {
                (t.options.logger.info("switch permission success"),
                  (t.options.permission = t.permissionWanted),
                  e && e(be.Success, null, t.options.roomId));
              },
              function (r) {
                (t.options.logger.info("switch permission failed"),
                  e && e(be.Failed, r.error.message, t.options.roomId));
              },
            ) ||
              this.options.logger.error(
                "Json Rpc Client send switch permission request error",
              );
          },
        },
      ]),
      e
    );
  })();
!(function (e) {
  ((e[(e.Create = 0)] = "Create"),
    (e[(e.Subscribing = 1)] = "Subscribing"),
    (e[(e.Subscribed = 2)] = "Subscribed"),
    (e[(e.Resubscribing = 3)] = "Resubscribing"),
    (e[(e.Resubscribed = 4)] = "Resubscribed"),
    (e[(e.Unsubscribing = 5)] = "Unsubscribing"),
    (e[(e.Unsubscribed = 6)] = "Unsubscribed"),
    (e[(e.Destroyed = 7)] = "Destroyed"),
    (e[(e.StateMax = 8)] = "StateMax"));
})(vr || (vr = {}));
var yr = [
    "Create",
    "Subscribing",
    "Subscribed",
    "Resubscribing",
    "Resubscribed",
    "Unsubscribing",
    "Unsubscribed",
    "Destroy",
  ],
  br = (function () {
    function e(t) {
      (F(this, e),
        (this.currentState = vr.Create),
        (this.stateTransformTable = new Array()),
        (this.logger = t),
        this.initStateTransformTable());
    }
    return (
      W(e, [
        {
          key: "setState",
          value: function (e) {
            return this.checkStateChange(this.currentState, e)
              ? (this.logger.info(
                  "SubscriptionState : state change from " +
                    yr[this.currentState] +
                    " to " +
                    yr[e],
                ),
                (this.currentState = e),
                !0)
              : (this.logger.error(
                  "SubscriptionState : INVALID state change from" +
                    yr[this.currentState] +
                    " to " +
                    yr[e],
                ),
                !1);
          },
        },
        {
          key: "state",
          value: function () {
            return this.currentState;
          },
        },
        {
          key: "checkStateChange",
          value: function (e, t) {
            return this.stateTransformTable[e][t];
          },
        },
        {
          key: "initStateTransformTable",
          value: function () {
            for (var e = vr.Create; e < vr.StateMax; e++) {
              this.stateTransformTable[e] = new Array();
              for (var t = vr.Create; t < vr.StateMax; t++)
                this.stateTransformTable[e][t] = !1;
            }
            ((this.stateTransformTable[vr.Create][vr.Subscribing] = !0),
              (this.stateTransformTable[vr.Create][vr.Destroyed] = !0),
              (this.stateTransformTable[vr.Subscribing][vr.Subscribed] = !0),
              (this.stateTransformTable[vr.Subscribing][vr.Unsubscribing] = !0),
              (this.stateTransformTable[vr.Subscribing][vr.Destroyed] = !0),
              (this.stateTransformTable[vr.Subscribing][vr.Resubscribing] = !0),
              (this.stateTransformTable[vr.Subscribed][vr.Unsubscribing] = !0),
              (this.stateTransformTable[vr.Subscribed][vr.Resubscribing] = !0),
              (this.stateTransformTable[vr.Subscribed][vr.Destroyed] = !0),
              (this.stateTransformTable[vr.Resubscribing][vr.Resubscribing] =
                !0),
              (this.stateTransformTable[vr.Resubscribing][vr.Resubscribed] =
                !0),
              (this.stateTransformTable[vr.Resubscribing][vr.Unsubscribing] =
                !0),
              (this.stateTransformTable[vr.Resubscribing][vr.Subscribed] = !0),
              (this.stateTransformTable[vr.Resubscribing][vr.Destroyed] = !0),
              (this.stateTransformTable[vr.Resubscribed][vr.Resubscribing] =
                !0),
              (this.stateTransformTable[vr.Resubscribed][vr.Unsubscribing] =
                !0),
              (this.stateTransformTable[vr.Resubscribed][vr.Destroyed] = !0),
              (this.stateTransformTable[vr.Unsubscribing][vr.Unsubscribed] =
                !0),
              (this.stateTransformTable[vr.Unsubscribing][vr.Destroyed] = !0),
              (this.stateTransformTable[vr.Unsubscribed][vr.Destroyed] = !0));
          },
        },
      ]),
      e
    );
  })(),
  Sr = (function () {
    function e(t) {
      (F(this, e),
        (this.options = t),
        (this.state = new br(t.logger)),
        (this.connectionStatus = Te.ConnectionConnected),
        this.options.rid && (this.ridWanted = this.options.rid),
        (this.switchSimulcastCb = null),
        (this.unsubscribeCb = null));
    }
    return (
      W(e, [
        {
          key: "subscribe",
          value: function () {
            if (
              (this.options.logger.info(
                "start subscribe: ".concat(this.options.subscriptionId),
              ),
              this.state.setState(vr.Subscribing))
            ) {
              var e = this.options.rpcClient.getWsState().state;
              ["CONNECTED", "RECOVERY"].includes(e) && this.doSubscribe();
            }
          },
        },
        {
          key: "unsubscribe",
          value: function (e) {
            if (
              (this.options.logger.info(
                "unsubscribe: ".concat(this.options.subscriptionId),
              ),
              this.state.setState(vr.Unsubscribing))
            ) {
              this.unsubscribeCb = e;
              var t = this.options.rpcClient.getWsState().state;
              ["CONNECTED", "RECOVERY"].includes(t)
                ? this.doUnsubscribe(this.unsubscribeCb)
                : this.options.logger.info(
                    "websocketState: ".concat(
                      t,
                      ",unsubscribe has been cached",
                    ),
                  );
            }
          },
        },
        {
          key: "switchSimulcast",
          value: function (e, t) {
            if (this.ridWanted !== e) {
              ((this.ridWanted = e), (this.switchSimulcastCb = t));
              var r = this.options.rpcClient.getWsState().state,
                i = this.state.state();
              ["CONNECTED", "RECOVERY"].includes(r)
                ? i === vr.Resubscribed || i === vr.Subscribed
                  ? this.doSwitchSimulcast(t)
                  : this.options.logger.info(
                      "publicationState: ".concat(
                        r,
                        ",switchSimulcast has been cached",
                      ),
                    )
                : this.options.logger.info(
                    "websocketState: ".concat(
                      r,
                      ",switchSimulcast has been cached",
                    ),
                  );
            } else
              this.options.logger.info("can not switch the same simulcast");
          },
        },
        { key: "onConnectionLost", value: function () {} },
        {
          key: "onConnectionRecovery",
          value: function (e, t) {
            if (
              (this.options.logger.info(
                "onConnectionRecovery subscriptionId",
                this.options.subscriptionId,
                "sessionTimeout",
                e,
                "sdp",
                t,
              ),
              this.state.state() === vr.Unsubscribing)
            )
              return this.doUnsubscribe(this.unsubscribeCb);
            e
              ? t &&
                ((this.options.offerSdp = t.sdp),
                (this.options.subscriptionId = t.subId),
                this.resubscribe())
              : this.recoveryOperations();
          },
        },
        {
          key: "resubscribe",
          value: function () {
            (this.options.logger.info(
              "start resubscribe: " + this.options.subscriptionId,
            ),
              this.state.setState(vr.Resubscribing) && this.doSubscribe());
          },
        },
        {
          key: "recoveryOperations",
          value: function () {
            this.ridWanted &&
              this.ridWanted !== this.options.rid &&
              this.doSwitchSimulcast(this.switchSimulcastCb);
          },
        },
        {
          key: "doSubscribe",
          value: function () {
            var e = this;
            try {
              var t = {
                userId: this.options.userId,
                subscriptionId: this.options.subscriptionId,
                media: {
                  audio: { has: this.options.subAudio },
                  video: { has: this.options.subVideo },
                },
                sdp: this.options.offerSdp,
              };
              (this.options.subAudio &&
                (t.media.audio.streamId = this.options.audioStreamId),
                this.options.subVideo &&
                  ((t.media.video.streamId = this.options.videoStreamId),
                  (t.media.video.rid = this.ridWanted)),
                this.options.rpcClient.sendRequest(
                  { method: "subscribe", params: t },
                  function (t) {
                    if (
                      (e.state.state() !== vr.Subscribing ||
                        e.state.setState(vr.Subscribed)) &&
                      (e.state.state() !== vr.Resubscribing ||
                        e.state.setState(vr.Resubscribed))
                    ) {
                      e.options.logger.info(
                        "subscribe ".concat(
                          e.options.subscriptionId,
                          " success",
                        ),
                      );
                      var r = t.result;
                      (e.options.subscribeCb &&
                        e.options.subscribeCb(be.Success, null, {
                          roomId: e.options.roomId,
                          subscriptionId: r.subscriptionId,
                          answer_sdp: r.sdp,
                        }),
                        e.recoveryOperations());
                    }
                  },
                  function (t) {
                    (e.options.logger.info(
                      "subscribe ".concat(e.options.subscriptionId, " failed"),
                    ),
                      e.options.subscribeCb &&
                        e.options.subscribeCb(be.Failed, t.error.message, {
                          roomId: e.options.roomId,
                          subscriptionId: e.options.subscriptionId,
                        }));
                  },
                ) ||
                  this.options.logger.error(
                    "Json Rpc Client send subscribe request error",
                  ));
            } catch (e) {
              (this.options.subscribeCb &&
                this.options.subscribeCb(be.Failed, e, null),
                this.options.logger.error(e));
            }
          },
        },
        {
          key: "doSwitchSimulcast",
          value: function (e) {
            var t = this;
            this.options.rpcClient.sendRequest(
              {
                method: "subscribeControl",
                params: {
                  subscriptionId: this.options.subscriptionId,
                  type: "simulcast",
                  rid: this.ridWanted,
                },
              },
              function (r) {
                (t.options.logger.info(
                  "switchSimulcast ".concat(
                    t.options.subscriptionId,
                    " success",
                  ),
                ),
                  (t.options.rid = t.ridWanted),
                  e && e(be.Success, null, t.options.roomId));
              },
              function (r) {
                (t.options.logger.info(
                  "switchSimulcast ".concat(
                    t.options.subscriptionId,
                    " failed",
                  ),
                ),
                  e && e(be.Failed, r.error.message, null));
              },
            ) ||
              this.options.logger.error(
                "Json Rpc Client send unsubscribe request error",
              );
          },
        },
        {
          key: "doUnsubscribe",
          value: function (e) {
            var t = this;
            this.options.rpcClient.sendRequest(
              {
                method: "unsubscribe",
                params: { id: this.options.subscriptionId },
              },
              function (r) {
                t.state.setState(vr.Unsubscribed) &&
                  (t.options.logger.info(
                    "unsubscribe ".concat(t.options.subscriptionId, " success"),
                  ),
                  e &&
                    (e(be.Success, null, { roomId: t.options.roomId }),
                    (t.unsubscribeCb = null)));
              },
              function (r) {
                (t.options.logger.info(
                  "unsubscribe ".concat(t.options.subscriptionId, " failed"),
                ),
                  e &&
                    (e(be.Failed, r.error.message, null),
                    (t.unsubscribeCb = null)));
              },
            ) ||
              this.options.logger.error(
                "Json Rpc Client send unsubscribe request error",
              );
          },
        },
      ]),
      e
    );
  })();
function Er(e, t) {
  var r;
  if ("undefined" == typeof Symbol || null == e[Symbol.iterator]) {
    if (
      Array.isArray(e) ||
      (r = (function (e, t) {
        if (e) {
          if ("string" == typeof e) return Cr(e, t);
          var r = Object.prototype.toString.call(e).slice(8, -1);
          return (
            "Object" === r && e.constructor && (r = e.constructor.name),
            "Map" === r || "Set" === r
              ? Array.from(e)
              : "Arguments" === r ||
                  /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
                ? Cr(e, t)
                : void 0
          );
        }
      })(e)) ||
      (t && e && "number" == typeof e.length)
    ) {
      r && (e = r);
      var i = 0,
        n = function () {};
      return {
        s: n,
        n: function () {
          return i >= e.length ? { done: !0 } : { done: !1, value: e[i++] };
        },
        e: function (e) {
          throw e;
        },
        f: n,
      };
    }
    throw new TypeError(
      "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
    );
  }
  var o,
    a = !0,
    s = !1;
  return {
    s: function () {
      r = e[Symbol.iterator]();
    },
    n: function () {
      var e = r.next();
      return ((a = e.done), e);
    },
    e: function (e) {
      ((s = !0), (o = e));
    },
    f: function () {
      try {
        a || null == r.return || r.return();
      } finally {
        if (s) throw o;
      }
    },
  };
}
function Cr(e, t) {
  (null == t || t > e.length) && (t = e.length);
  for (var r = 0, i = new Array(t); r < t; r++) i[r] = e[r];
  return i;
}
var Tr = (function () {
  function e(t) {
    (F(this, e), (this.options = t), (this.subscriptions = new Map()));
  }
  return (
    W(e, [
      {
        key: "subscribe",
        value: function (e, t, r, i, n, o, a) {
          var s = new Sr({
            roomId: this.options.roomId,
            userId: this.options.stream.userId,
            subscriptionId: e,
            offerSdp: n,
            subAudio: t,
            audioStreamId: this.options.stream.streamId,
            subVideo: r,
            videoStreamId: this.options.stream.streamId,
            rid: i,
            rpcClient: this.options.rpcClient,
            logger: this.options.logger,
            subscribeCb: o,
            subscribeUpdateCb: a,
          });
          (s.subscribe(),
            this.options.logger.info(
              "remoteStream subscribe subscriptionId",
              e,
            ),
            this.subscriptions.set(e, s));
        },
      },
      {
        key: "unsubscribe",
        value: function (e, t) {
          var r = this;
          this.subscriptions.has(e) &&
            this.subscriptions.get(e).unsubscribe(function (i, n, o) {
              (i === be.Success &&
                (r.options.logger.info(
                  "remoteStream unsubscribe subscriptionId",
                  e,
                ),
                r.subscriptions.delete(e)),
                t && t(i, n, o));
            });
        },
      },
      {
        key: "updateSimulcast",
        value: function (e) {
          this.options.stream.info.video.simulcast = e;
        },
      },
      {
        key: "updateLiveStatus",
        value: function (e) {
          (e.audio && (this.options.stream.info.audio.muted = e.audio.muted),
            e.video && (this.options.stream.info.video.muted = e.video.muted));
        },
      },
      {
        key: "switchSimulcast",
        value: function (e, t, r) {
          this.subscriptions.has(e) &&
            this.subscriptions.get(e).switchSimulcast(t, r);
        },
      },
      {
        key: "onConnectionLost",
        value: function () {
          var e,
            t = Er(this.subscriptions.values());
          try {
            for (t.s(); !(e = t.n()).done; ) e.value.onConnectionLost();
          } catch (e) {
            t.e(e);
          } finally {
            t.f();
          }
        },
      },
      {
        key: "onConnectionRecovery",
        value: function (e, t, r) {
          this.options.logger.info(
            "remoteStream onConnectionRecovery subscriptionId",
            this.subscriptions,
            t,
            r,
          );
          var i,
            n = Er(new Map(this.subscriptions));
          try {
            for (n.s(); !(i = n.n()).done; ) {
              var o = U(i.value, 2),
                a = o[1];
              o[0] === t &&
                (this.subscriptions.get(t).onConnectionRecovery(e, r),
                this.subscriptions.delete(t),
                this.subscriptions.set(null == r ? void 0 : r.subId, a));
            }
          } catch (e) {
            n.e(e);
          } finally {
            n.f();
          }
        },
      },
    ]),
    e
  );
})();
function Rr(e, t) {
  var r;
  if ("undefined" == typeof Symbol || null == e[Symbol.iterator]) {
    if (
      Array.isArray(e) ||
      (r = (function (e, t) {
        if (e) {
          if ("string" == typeof e) return Ir(e, t);
          var r = Object.prototype.toString.call(e).slice(8, -1);
          return (
            "Object" === r && e.constructor && (r = e.constructor.name),
            "Map" === r || "Set" === r
              ? Array.from(e)
              : "Arguments" === r ||
                  /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
                ? Ir(e, t)
                : void 0
          );
        }
      })(e)) ||
      (t && e && "number" == typeof e.length)
    ) {
      r && (e = r);
      var i = 0,
        n = function () {};
      return {
        s: n,
        n: function () {
          return i >= e.length ? { done: !0 } : { done: !1, value: e[i++] };
        },
        e: function (e) {
          throw e;
        },
        f: n,
      };
    }
    throw new TypeError(
      "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
    );
  }
  var o,
    a = !0,
    s = !1;
  return {
    s: function () {
      r = e[Symbol.iterator]();
    },
    n: function () {
      var e = r.next();
      return ((a = e.done), e);
    },
    e: function (e) {
      ((s = !0), (o = e));
    },
    f: function () {
      try {
        a || null == r.return || r.return();
      } finally {
        if (s) throw o;
      }
    },
  };
}
function Ir(e, t) {
  (null == t || t > e.length) && (t = e.length);
  for (var r = 0, i = new Array(t); r < t; r++) i[r] = e[r];
  return i;
}
var _r = (function () {
    function e(t) {
      (F(this, e),
        (this.options = t),
        (this.remoteStreams = new Map()),
        (this.streamIdArray = new Array()),
        (this.subPubIdMap = new Map()));
    }
    return (
      W(e, [
        {
          key: "addStream",
          value: function (e) {
            var t = e.streamId;
            (this.remoteStreams.set(
              t,
              new Tr({
                roomId: this.options.roomId,
                stream: e,
                rpcClient: this.options.rpcClient,
                logger: this.options.logger,
              }),
            ),
              this.streamIdArray.push(t));
          },
        },
        {
          key: "deleteStream",
          value: function (e) {
            if (this.remoteStreams.has(e)) {
              this.remoteStreams.delete(e);
              var t = this.streamIdArray.indexOf(e);
              -1 != t && this.streamIdArray.splice(t, 1);
              var r,
                i = null,
                n = Rr(this.subPubIdMap);
              try {
                for (n.s(); !(r = n.n()).done; ) {
                  var o = U(r.value, 2);
                  o[1] === e && (i = o[0]);
                }
              } catch (e) {
                n.e(e);
              } finally {
                n.f();
              }
              i && this.subPubIdMap.delete(i);
            }
          },
        },
        {
          key: "updateStreamSimulcast",
          value: function (e, t) {
            this.remoteStreams.has(e) &&
              this.remoteStreams.get(e).updateSimulcast(t);
          },
        },
        {
          key: "updateStreamStatus",
          value: function (e, t) {
            this.remoteStreams.has(e) &&
              this.remoteStreams.get(e).updateLiveStatus(t);
          },
        },
        {
          key: "subscribeStream",
          value: function (e, t, r, i, n, o) {
            (this.options.logger.info(
              "remote user subscribe stream",
              this.remoteStreams.has(t),
            ),
              this.remoteStreams.has(t) &&
                (this.remoteStreams
                  .get(t)
                  .subscribe(
                    e,
                    i.hasAudio,
                    i.hasVideo,
                    He(null == i ? void 0 : i.type),
                    i.offerSdp,
                    n,
                    o,
                  ),
                this.options.logger.info(
                  "remoteUser subscribeStream subscriptionId",
                  e,
                ),
                this.subPubIdMap.set(e, t)));
          },
        },
        {
          key: "unsubscribeStream",
          value: function (e, t) {
            var r = this,
              i = this.subPubIdMap.get(e);
            i &&
              this.remoteStreams.has(i) &&
              this.remoteStreams.get(i).unsubscribe(e, function (i, n, o) {
                (i === be.Success && r.subPubIdMap.delete(e), t && t(i, n, o));
              });
          },
        },
        {
          key: "switchSimulcast",
          value: function (e, t, r) {
            var i = this.subPubIdMap.get(e);
            i &&
              this.remoteStreams.has(i) &&
              this.remoteStreams.get(i).switchSimulcast(e, He(t.type), r);
          },
        },
        {
          key: "getAllStreamId",
          value: function () {
            return this.streamIdArray;
          },
        },
        { key: "onConnectionLost", value: function () {} },
        {
          key: "onConnectionRecovery",
          value: function (e, t) {
            this.options.logger.info("remoteUser onConnectionRecovery", e);
            var r,
              i = Rr(new Map(this.subPubIdMap));
            try {
              for (i.s(); !(r = i.n()).done; ) {
                var n = U(r.value, 2),
                  o = n[0],
                  a = n[1];
                if (
                  (this.options.logger.info(
                    "remoteUser onConnectionRecovery subscriptionId",
                    o,
                    "streamId",
                    a,
                  ),
                  this.remoteStreams.has(a))
                ) {
                  (this.remoteStreams
                    .get(a)
                    .onConnectionRecovery(e, o, t.get(o)),
                    this.subPubIdMap.delete(o));
                  var s = null == t ? void 0 : t.get(o).subId;
                  this.subPubIdMap.set(s, a);
                }
              }
            } catch (e) {
              i.e(e);
            } finally {
              i.f();
            }
          },
        },
      ]),
      e
    );
  })(),
  kr = (function () {
    function e(t, r) {
      (F(this, e),
        (this.options = t),
        (this.wsUrlList = j(t.wsUrl)),
        (this.userId = t.userId),
        (this.ssl = t.ssl),
        (this.roomId = t.roomId),
        (this.logger = r),
        (this.wsSocket = null),
        (this.pendingRequests = new Array()),
        (this.successCallbacks = new Map()),
        (this.errorCallbacks = new Map()),
        (this.requestTypes = new Map()),
        (this.retryTimerId = 0),
        (this.retryCount = 0),
        (this.maxRetryCount = 30),
        (this.currentId = 1),
        (this.times = 6e4),
        (this.timer = null),
        (this.state = "DISCONNECTED"),
        (this.prevState = "DISCONNECTED"),
        (this.autoReconnected = !0),
        (this.lockReconnect = !1),
        (this.heartCheck = this.initHeartCheck()));
    }
    var t, r;
    return (
      W(e, [
        {
          key: "sendRequest",
          value: function (e, t, r) {
            if (!e) return !1;
            ((e.jsonrpc = "2.0"),
              (e.id = ""
                .concat(this.userId, "_")
                .concat(Date.now(), "_")
                .concat(this.currentId++)));
            var i = this;
            (t ||
              (t = function (e) {
                i.logger.debug("success: " + JSON.stringify(e));
              }),
              r ||
                (r = function (e) {
                  i.logger.debug("error: " + JSON.stringify(e));
                }));
            var n = JSON.stringify(e);
            return (
              !!this.wsSocket &&
              (this.wsSocket.readyState < 1
                ? this.pendingRequests.push(n)
                : (i.logger.info(
                    "send message: \n" + JSON.stringify(JSON.parse(n), null, 4),
                  ),
                  this.sendMessage(n)),
              this.successCallbacks.set(e.id, t),
              this.errorCallbacks.set(e.id, r),
              this.requestTypes.set(e.id, e.method),
              !0)
            );
          },
        },
        {
          key: "socketReady",
          value: function () {
            return (
              this.logger.info(
                "wsSocket readyState",
                this.wsSocket && this.wsSocket.readyState,
              ),
              !(null == this.wsSocket || this.wsSocket.readyState > 1)
            );
          },
        },
        {
          key: "connect",
          value:
            ((r = V(
              H.mark(function e() {
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (
                            this.options.wsUrl ||
                            0 !== this.options.wsUrl.length
                          ) {
                            e.next = 3;
                            break;
                          }
                          return (
                            this.logger.error("Websocket url is empty!"),
                            e.abrupt("return", !1)
                          );
                        case 3:
                          if (
                            (this.retryTimerId &&
                              window.clearTimeout(this.retryTimerId),
                            this.socketReady())
                          ) {
                            e.next = 13;
                            break;
                          }
                          return (
                            (this.prevState = this.state),
                            (this.state = "CONNECTING"),
                            this.options.onWsStateChange(
                              this.prevState,
                              this.state,
                              this.retryCount,
                            ),
                            (e.next = 10),
                            this.getWsUrl()
                          );
                        case 10:
                          ((this.wsSocket = new WebSocket(e.sent)),
                            this.wsSocket &&
                              ((this.wsSocket.onmessage =
                                this.onWsMessage.bind(this)),
                              (this.wsSocket.onclose =
                                this.onWsClose.bind(this)),
                              (this.wsSocket.onerror =
                                this.onWsError.bind(this)),
                              (this.wsSocket.onopen =
                                this.onConnect.bind(this))));
                        case 13:
                          return e.abrupt("return", !!this.wsSocket);
                        case 14:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function () {
              return r.apply(this, arguments);
            }),
        },
        {
          key: "close",
          value: function () {
            this.socketReady() &&
              ((this.autoReconnected = !1),
              (this.pendingRequests = []),
              this.wsSocket.close(),
              this.resetWs(),
              this.timer && clearTimeout(this.timer),
              this.retryTimerId && clearTimeout(this.retryTimerId),
              this.heartCheck.reset(),
              (this.heartCheck = null),
              this.logger.info("close websocket"));
          },
        },
        {
          key: "onConnect",
          value: function () {
            var e;
            for (
              this.heartCheck.start(),
                this.prevState = this.state,
                this.retryTimerId
                  ? (window.clearTimeout(this.retryTimerId),
                    (this.retryTimerId = null),
                    (this.state = "RECOVERY"))
                  : (this.state = "CONNECTED"),
                this.options.onConnect(this.state),
                this.retryCount = 0,
                this.options.onWsStateChange(
                  this.prevState,
                  this.state,
                  this.retryCount,
                );
              (e = this.pendingRequests.shift());
            )
              (this.logger.info("send message: \n" + e), this.sendMessage(e));
          },
        },
        {
          key: "onWsMessage",
          value: function (e) {
            var t;
            if (
              (this.heartCheck &&
                this.heartCheck.serverTimeoutObj &&
                (clearTimeout(this.heartCheck.serverTimeoutObj),
                (this.heartCheck.serverTimeoutObj = null)),
              this.timer && clearTimeout(this.timer),
              (this.timer = null),
              "object" !== ne((t = JSON.parse(e.data))) || "pong" !== t.method)
            ) {
              if (
                (this.logger.info(
                  "格式化消息: \n" + JSON.stringify(t, null, 4),
                ),
                "object" === ne(t) && "jsonrpc" in t && "2.0" === t.jsonrpc)
              ) {
                var r = t.id,
                  i = this.successCallbacks.get(r),
                  n = this.errorCallbacks.get(r);
                if ("result" in t && i)
                  return (
                    i({ jsonrpc: "2.0", id: t.id, result: t.result }),
                    this.successCallbacks.delete(r),
                    void this.errorCallbacks.delete(r)
                  );
                if ("error" in t && n) {
                  var o = { jsonrpc: "2.0", id: t.id, error: t.error };
                  return (
                    this.logger.error(
                      "信令返回错误: \n" + JSON.stringify(o, null, 4),
                    ),
                    n(o),
                    this.successCallbacks.delete(r),
                    void this.errorCallbacks.delete(r)
                  );
                }
              }
              if ("id" in t) {
                if ("function" == typeof this.options.onRequest) {
                  var a = this.options.onRequest({
                    jsonrpc: "2.0",
                    id: t.id,
                    method: t.method,
                    params: t.params,
                  });
                  ((a.jsonrpc = "2.0"),
                    (a.id = t.id),
                    this.wsSocket && this.wsSocket.send(JSON.stringify(a)));
                }
              } else
                this.options.onNotification({
                  jsonrpc: "2.0",
                  method: t.method,
                  params: t.params,
                });
            }
          },
        },
        {
          key: "onWsClose",
          value: function (e) {
            (this.logger.info("onWsClose", e),
              this.heartCheck && this.heartCheck.reset(),
              (this.pendingRequests = []),
              (this.prevState = this.state),
              (this.state = "DISCONNECTED"),
              this.prevState !== this.state &&
                this.options.onWsStateChange(
                  this.prevState,
                  this.state,
                  this.retryCount,
                ));
          },
        },
        {
          key: "onWsError",
          value: function (e) {
            if (
              (this.logger.info("onWsError", e),
              this.heartCheck && this.heartCheck.reset(),
              (this.pendingRequests = []),
              (this.prevState = this.state),
              (this.state = "DISCONNECTED"),
              this.prevState !== this.state &&
                this.options.onWsStateChange(
                  this.prevState,
                  this.state,
                  this.retryCount,
                ),
              0 === this.retryCount)
            ) {
              this.logger.onError({
                c: Xe.TOP_ERROR,
                v: te.SIGNAL_CHANNEL_SETUP_FAILED,
              });
              var t = new de({
                code: te.SIGNAL_CHANNEL_SETUP_FAILED,
                message: "WebSocket connect failed",
              });
              "function" == typeof this.options.onError &&
                this.options.onError(t);
            }
          },
        },
        {
          key: "reconnect",
          value: function () {
            var e = this;
            (!this.autoReconnected && this.lockReconnect) ||
              ((this.lockReconnect = !0),
              (this.prevState = this.state),
              this.retryTimerId && clearTimeout(this.retryTimerId),
              this.retryCount < this.maxRetryCount
                ? (this.retryTimerId = window.setTimeout(function () {
                    (e.retryCount++,
                      e.logger.info(
                        ""
                          .concat(
                            new Date().toLocaleString(),
                            " Try to reconnect, count: ",
                          )
                          .concat(e.retryCount),
                      ),
                      (e.state = "RECONNECTING"),
                      e.options.onWsStateChange(
                        e.prevState,
                        e.state,
                        e.retryCount,
                      ),
                      e.resetWs(),
                      e.connect(),
                      (e.lockReconnect = !1));
                  }, this.getReconnectDelay(this.retryCount)))
                : (this.logger.warn(
                    "SDK has tried reconnect signal channel for ".concat(
                      this.maxRetryCount,
                      " times, but all failed. please check your network",
                    ),
                  ),
                  this.options.onWsReconnectFailed &&
                    this.options.onWsReconnectFailed()));
          },
        },
        {
          key: "sendMessage",
          value: function (e) {
            var t = this;
            (this.wsSocket.send(e),
              this.timer ||
                (this.timer = setTimeout(function () {
                  t.logger.onError(
                    { c: Xe.TOP_ERROR, v: te.SERVER_TIMEOUT },
                    "websocket connection timeout!",
                  );
                  var e = new de({
                    code: te.SERVER_TIMEOUT,
                    message: "server timeout",
                  });
                  "function" == typeof t.options.onError &&
                    t.options.onError(e);
                }, this.times)));
          },
        },
        {
          key: "getWsState",
          value: function () {
            return { state: this.state, prevState: this.prevState };
          },
        },
        {
          key: "resetWs",
          value: function () {
            this.wsSocket &&
              ((this.wsSocket.onmessage = null),
              (this.wsSocket.onclose = null),
              (this.wsSocket.onerror = null),
              (this.wsSocket.onopen = null),
              (this.wsSocket = null));
          },
        },
        {
          key: "initHeartCheck",
          value: function () {
            var e = this;
            return {
              timeout: 2e3,
              serverTimeout: 1e4,
              timeoutObj: null,
              serverTimeoutObj: null,
              reset: function () {
                return (
                  clearInterval(this.timeoutObj),
                  clearTimeout(this.serverTimeoutObj),
                  (this.timeoutObj = null),
                  (this.serverTimeoutObj = null),
                  this
                );
              },
              start: function () {
                var t = this;
                (this.reset(),
                  (this.timeoutObj = setInterval(function () {
                    (e.sendMessage(
                      JSON.stringify({
                        jsonrpc: "2.0",
                        id: 0,
                        method: "ping",
                        params: {},
                      }),
                    ),
                      t.serverTimeoutObj ||
                        (t.serverTimeoutObj = setTimeout(function () {
                          (e.logger.info(
                            new Date().toLocaleString(),
                            "not received pong, close the websocket",
                          ),
                            e.onWsError());
                        }, t.serverTimeout)));
                  }, this.timeout)));
              },
            };
          },
        },
        {
          key: "getReconnectDelay",
          value: function (e) {
            return Math.round(e / 2) + 1 > 6 ? 13e3 : 3e3;
          },
        },
        {
          key: "getWsUrl",
          value:
            ((t = V(
              H.mark(function e() {
                var t, r, i, n, o, a, s, c, u, d, l, h, p, f;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (
                            ((t = ""),
                            "string" == typeof this.options.wsUrl
                              ? (t = ""
                                  .concat(this.options.wsUrl, "/xsigo?roomNum=")
                                  .concat(this.roomId, "&userId=")
                                  .concat(this.userId, "&appKey=")
                                  .concat(this.options.appId))
                              : ((r = this.getWsUrlList()),
                                (t = ""
                                  .concat(this.ssl ? "wss" : "ws", "://")
                                  .concat(r, "/xsigo?roomNum=")
                                  .concat(this.roomId, "&userId=")
                                  .concat(this.userId, "&appKey=")
                                  .concat(this.options.appId))),
                            this.options.privateKey &&
                              (t += "&privateKey=".concat(
                                this.options.privateKey,
                              )),
                            this.options.extendInfo &&
                              this.options.extendInfo.location &&
                              (t += "&location=".concat(
                                this.options.extendInfo.location,
                              )),
                            !(i = this.options.onCustomSignParam))
                          ) {
                            e.next = 13;
                            break;
                          }
                          return ((e.next = 8), i());
                        case 8:
                          if (
                            "object" === ne((n = e.sent).getHeader) &&
                            "{}" !== JSON.stringify(n.getHeader) &&
                            ((o = n.getHeader),
                            "[object Object]" ===
                              Object.prototype.toString.call(o) &&
                              "{}" !== JSON.stringify(o))
                          )
                            for (
                              a = 0, s = Object.entries(o);
                              a < s.length;
                              a++
                            )
                              ((c = U(s[a], 2)),
                                (u = c[1]),
                                (t += "&".concat(c[0], "=").concat(u)));
                          if (
                            "object" === ne(n.getQuery) &&
                            "{}" !== JSON.stringify(n.getQuery) &&
                            ((d = n.getQuery),
                            "[object Object]" ===
                              Object.prototype.toString.call(d) &&
                              "{}" !== JSON.stringify(d))
                          )
                            for (
                              l = 0, h = Object.entries(d);
                              l < h.length;
                              l++
                            )
                              ((p = U(h[l], 2)),
                                (f = p[1]),
                                (t += "&".concat(p[0], "=").concat(f)));
                          e.next = 14;
                          break;
                        case 13:
                          i ||
                            (t = ""
                              .concat(t, "&Authorization=")
                              .concat(this.options.userSig));
                        case 14:
                          return e.abrupt("return", t);
                        case 15:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function () {
              return t.apply(this, arguments);
            }),
        },
        {
          key: "getWsUrlList",
          value: function () {
            var e = this.options.wsUrl.length;
            if (1 === e) return this.options.wsUrl[0];
            if (
              (e &&
                !this.wsUrlList.length &&
                (this.wsUrlList = j(this.options.wsUrl)),
              e === this.wsUrlList.length)
            )
              for (; e; ) {
                var t = Math.floor(Math.random() * e--),
                  r = [this.wsUrlList[e], this.wsUrlList[t]];
                ((this.wsUrlList[t] = r[0]), (this.wsUrlList[e] = r[1]));
              }
            return this.wsUrlList.shift();
          },
        },
      ]),
      e
    );
  })();
function wr(e, t) {
  var r;
  if ("undefined" == typeof Symbol || null == e[Symbol.iterator]) {
    if (
      Array.isArray(e) ||
      (r = (function (e, t) {
        if (e) {
          if ("string" == typeof e) return Or(e, t);
          var r = Object.prototype.toString.call(e).slice(8, -1);
          return (
            "Object" === r && e.constructor && (r = e.constructor.name),
            "Map" === r || "Set" === r
              ? Array.from(e)
              : "Arguments" === r ||
                  /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
                ? Or(e, t)
                : void 0
          );
        }
      })(e)) ||
      (t && e && "number" == typeof e.length)
    ) {
      r && (e = r);
      var i = 0,
        n = function () {};
      return {
        s: n,
        n: function () {
          return i >= e.length ? { done: !0 } : { done: !1, value: e[i++] };
        },
        e: function (e) {
          throw e;
        },
        f: n,
      };
    }
    throw new TypeError(
      "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
    );
  }
  var o,
    a = !0,
    s = !1;
  return {
    s: function () {
      r = e[Symbol.iterator]();
    },
    n: function () {
      var e = r.next();
      return ((a = e.done), e);
    },
    e: function (e) {
      ((s = !0), (o = e));
    },
    f: function () {
      try {
        a || null == r.return || r.return();
      } finally {
        if (s) throw o;
      }
    },
  };
}
function Or(e, t) {
  (null == t || t > e.length) && (t = e.length);
  for (var r = 0, i = new Array(t); r < t; r++) i[r] = e[r];
  return i;
}
var Pr = (function () {
  function e(t) {
    (F(this, e), (this.options = t), (this.isFirstLogin = !0));
    var r = t.roomCbs;
    ((this.roomCbs = {
      connectionLostCb: r.connectionLostCb,
      connectionRecoveryCb: r.connectionRecoveryCb,
      tryToReconnectCb: r.tryToReconnectCb,
      notificationCb: r.notificationCb,
      onWsStateChange: r.onWsStateChange,
      onWsError: r.onWsError,
      onWsReconnectFailed: r.onWsReconnectFailed,
    }),
      (this.remoteUsers = new Map()),
      (this.remoteUserIdArray = new Array()),
      (this.remoteStreams = new Map()),
      (this.remoteStreamIdArray = new Array()),
      (this.subUserIdMap = new Map()),
      (this.state = new er(this.options.logger)),
      (this.connectionStatus = Te.New));
  }
  var t, r, i, n;
  return (
    W(e, [
      {
        key: "enter",
        value:
          ((n = V(
            H.mark(function e(t, r, i, n, o, a, s, c, u, d, l, h, p) {
              return H.wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        if (
                          ((this.loginParams = {
                            appId: r,
                            userId: n,
                            userType: o,
                            previousRoomId: a,
                            permission: s,
                            userData: c,
                            extendInfo: u,
                          }),
                          this.state.setState(zt.Entering))
                        ) {
                          e.next = 3;
                          break;
                        }
                        return e.abrupt("return");
                      case 3:
                        return (
                          this.options.logger.info(
                            "Enter Room " + this.options.roomId,
                          ),
                          (this.roomCbs.enterRoomCb = l),
                          (e.next = 7),
                          this.initJsonRpcClient(t, r, i, n, d, u, h, p)
                        );
                      case 7:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          )),
          function (e, t, r, i, o, a, s, c, u, d, l, h, p) {
            return n.apply(this, arguments);
          }),
      },
      {
        key: "exit",
        value: function (e) {
          this.state.setState(zt.Exiting) &&
            (this.options.logger.info("Exit Room " + this.options.roomId),
            (this.isFirstLogin = !0),
            (this.roomCbs.exitRoomCb = e),
            this.login.logout());
        },
      },
      {
        key: "publishStream",
        value: function (e, t, r, i, n, o) {
          if (this.state.state() == zt.Entered)
            return this.localUser.publishStream(e, t, r, i, n, o);
          this.options.logger.info(
            "We are not enter room, can not publish stream",
          );
        },
      },
      {
        key: "unpublishStream",
        value: function (e, t) {
          if (this.state.state() == zt.Entered)
            return this.localUser.unpublishStream(e, t);
          this.options.logger.info(
            "We are not enter room, can not unpublish stream",
          );
        },
      },
      {
        key: "updateSimulcast",
        value: function (e, t, r) {
          if (this.state.state() == zt.Entered)
            return this.localUser.updateSimulcast(e, t, r);
          this.options.logger.info(
            "We arn not enter room, can not publish updateSimulcast",
          );
        },
      },
      {
        key: "muteLocalAudio",
        value: function (e, t, r) {
          this.state.state() == zt.Entered
            ? this.localUser.muteAudio(e, t, this.roomCbs.notificationCb, r)
            : this.options.logger.info(
                "We are not enter room, can not muteLocalAudio",
              );
        },
      },
      {
        key: "muteLocalVideo",
        value: function (e, t, r) {
          this.state.state() == zt.Entered
            ? this.localUser.muteVideo(e, t, this.roomCbs.notificationCb, r)
            : this.options.logger.info(
                "We are not enter room, can not muteLocalVideo",
              );
        },
      },
      {
        key: "unmuteLocalAudio",
        value: function (e, t, r) {
          this.state.state() == zt.Entered
            ? this.localUser.unmuteAudio(e, t, this.roomCbs.notificationCb, r)
            : this.options.logger.info(
                "We are not enter room, can not unmuteLocalAudio",
              );
        },
      },
      {
        key: "unmuteLocalVideo",
        value: function (e, t, r) {
          this.state.state() == zt.Entered
            ? this.localUser.unmuteVideo(e, t, this.roomCbs.notificationCb, r)
            : this.options.logger.info(
                "We are not enter room, can not unmuteLocalVideo",
              );
        },
      },
      {
        key: "subscribeStream",
        value: function (e, t, r, i, n, o, a) {
          this.state.state() == zt.Entered
            ? (this.options.logger.info(
                "room subscribe stream",
                this.remoteUsers.has(t),
              ),
              this.remoteUsers.has(t) &&
                (this.remoteUsers.get(t).subscribeStream(e, r, i, n, o, a),
                this.subUserIdMap.set(e, t)))
            : this.options.logger.info(
                "We are not enter room, can not subscribe stream",
              );
        },
      },
      {
        key: "unsubscribeStream",
        value: function (e, t) {
          if (this.state.state() == zt.Entered)
            if (
              (this.options.logger.debug("subUserIdMap", this.subUserIdMap, e),
              this.subUserIdMap.has(e))
            ) {
              var r = this.subUserIdMap.get(e);
              this.remoteUsers.has(r)
                ? (this.remoteUsers.get(r).unsubscribeStream(e, t),
                  this.subUserIdMap.delete(e))
                : this.options.logger.info(
                    "unsubscription: " + e + "  no related user",
                  );
            } else
              this.options.logger.info(
                "unsubscription: " + e + "  no related user",
              );
          else
            this.options.logger.info(
              "We are not enter room, can not unsubscribe stream",
            );
        },
      },
      {
        key: "switchSimulcast",
        value: function (e, t, r) {
          if (this.state.state() == zt.Entered)
            if (this.subUserIdMap.has(e)) {
              var i = this.subUserIdMap.get(e);
              this.remoteUsers.has(i) &&
                this.remoteUsers.get(i).switchSimulcast(e, t, r);
            } else
              this.options.logger.info("Subscription: " + e + " not exist");
          else
            this.options.logger.info(
              "We are not enter room, can not switchSimulcast",
            );
        },
      },
      {
        key: "switchPermission",
        value: function (e, t) {
          var r = this;
          this.state.state() == zt.Entered
            ? this.localUser.switchPermission(e, function (i, n, o) {
                (1 === i && r.login.updatePermission(e), t && t(i, n, o));
              })
            : this.options.logger.info(
                "We are not enter room, can not switchPermission",
              );
        },
      },
      {
        key: "getWsState",
        value: function () {
          return this.rpcClient.getWsState();
        },
      },
      {
        key: "onLogin",
        value: function (e, t, r) {
          if (e === tr.LoginSuccess) {
            if (
              ((this.connectionStatus = Te.ConnectionConnected),
              !this.state.setState(zt.Entered))
            )
              return;
            (this.options.logger.info(
              "Enter Room ".concat(this.options.roomId, " success"),
            ),
              this.roomCbs.enterRoomCb &&
                this.roomCbs.enterRoomCb(be.Success, null, {
                  roomId: this.options.roomId,
                  roomUniqueId: t.room.roomUniqueId,
                  participants: t.room.participants,
                }));
            var i = this.buildRemoteUserAndCollectNotification(t, !1),
              n = this.buildRemoteStreamsAndCollectNotification(t, !1),
              o = setTimeout(function () {
                var e,
                  t = wr(i);
                try {
                  for (t.s(); !(e = t.n()).done; ) (0, e.value)();
                } catch (e) {
                  t.e(e);
                } finally {
                  t.f();
                }
                var r,
                  a = wr(n);
                try {
                  for (a.s(); !(r = a.n()).done; ) (0, r.value)();
                } catch (e) {
                  a.e(e);
                } finally {
                  a.f();
                }
                (o && clearTimeout(o), (o = null));
              }, 300);
          } else if (e === tr.LoginTimeout) {
            if (!this.state.setState(zt.EnterTimeout)) return;
            (this.options.logger.info(
              "Enter Room ".concat(this.options.roomId, " timeout"),
            ),
              this.roomCbs.enterRoomCb &&
                this.roomCbs.enterRoomCb(be.Timeout, r, {
                  roomId: this.options.roomId,
                }));
          } else if (e === tr.LoginFailed) {
            if (!this.state.setState(zt.EnterFailed)) return;
            (this.options.logger.info(
              "Enter Room ".concat(this.options.roomId, " failed"),
            ),
              this.roomCbs.enterRoomCb &&
                this.roomCbs.enterRoomCb(be.Failed, r, {
                  roomId: this.options.roomId,
                }));
          } else
            this.options.logger.error("Enter room result type is invalid!");
        },
      },
      {
        key: "onRelogin",
        value:
          ((i = V(
            H.mark(function e(t, r, i) {
              var n,
                o,
                a,
                s,
                c,
                u,
                d,
                l,
                h,
                p,
                f,
                m,
                v,
                g,
                y,
                b,
                S,
                E,
                C,
                T,
                R,
                I,
                _,
                k;
              return H.wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        if (!t) {
                          e.next = 22;
                          break;
                        }
                        if (
                          ((this.connectionStatus = Te.ConnectionRecovery),
                          this.options.logger.info("onRelogin:", t, r, i),
                          (n = this.buildRemoteUserAndCollectNotification(
                            i,
                            !0,
                          )),
                          (o = this.buildRemoteStreamsAndCollectNotification(
                            i,
                            !0,
                          )),
                          (a = i.room.roomUniqueId),
                          (s = null),
                          !this.roomCbs.connectionRecoveryCb)
                        ) {
                          e.next = 16;
                          break;
                        }
                        return (
                          (e.next = 10),
                          this.roomCbs.connectionRecoveryCb(
                            this.options.roomId,
                            a,
                            r,
                          )
                        );
                      case 10:
                        (this.localUser.onConnectionRecovery(
                          r,
                          null === (c = s = e.sent) || void 0 === c
                            ? void 0
                            : c.publishOfferSdp,
                        ),
                          (u = new Map(this.subUserIdMap)),
                          this.options.logger.info("subUserIdMap", u, s),
                          (d = wr(u)));
                        try {
                          for (d.s(); !(l = d.n()).done; )
                            ((f = U(l.value, 2)),
                              (m = f[0]),
                              (v = f[1]),
                              null !== (h = s) &&
                                void 0 !== h &&
                                null !== (p = h.subscribeOfferSdp) &&
                                void 0 !== p &&
                                p.has(m) &&
                                ((S =
                                  null === (g = s) ||
                                  void 0 === g ||
                                  null === (y = g.subscribeOfferSdp) ||
                                  void 0 === y ||
                                  null === (b = y.get(m)) ||
                                  void 0 === b
                                    ? void 0
                                    : b.subId),
                                this.subUserIdMap.delete(m),
                                this.subUserIdMap.set(S, v)));
                        } catch (e) {
                          d.e(e);
                        } finally {
                          d.f();
                        }
                      case 16:
                        E = wr(this.remoteUsers.values());
                        try {
                          for (E.s(); !(C = E.n()).done; )
                            C.value.onConnectionRecovery(
                              r,
                              null === (T = s) || void 0 === T
                                ? void 0
                                : T.subscribeOfferSdp,
                            );
                        } catch (e) {
                          E.e(e);
                        } finally {
                          E.f();
                        }
                        R = wr(n);
                        try {
                          for (R.s(); !(I = R.n()).done; ) (0, I.value)();
                        } catch (e) {
                          R.e(e);
                        } finally {
                          R.f();
                        }
                        _ = wr(o);
                        try {
                          for (_.s(); !(k = _.n()).done; ) (0, k.value)();
                        } catch (e) {
                          _.e(e);
                        } finally {
                          _.f();
                        }
                      case 22:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          )),
          function (e, t, r) {
            return i.apply(this, arguments);
          }),
      },
      {
        key: "onLogout",
        value: function (e, t) {
          if (e === rr.LogoutSuccess) {
            if (!this.state.setState(zt.Exited)) return;
            (this.options.logger.info(
              "Exit Room " + this.options.roomId + " success",
            ),
              this.roomCbs.exitRoomCb &&
                this.roomCbs.exitRoomCb(be.Success, null, {
                  roomId: this.options.roomId,
                  reason: Se.ActivelyLeave,
                }),
              this.rpcClient &&
                (this.rpcClient.close(), (this.rpcClient = null)));
          } else if (e === rr.LogoutFailed) {
            if (!this.state.setState(zt.ExitFailed)) return;
            (this.roomCbs.exitRoomCb &&
              (this.options.logger.info("exit room failed"),
              this.roomCbs.exitRoomCb(be.Failed, t, {
                roomId: this.options.roomId,
                reason: Se.ActivelyLeave,
              })),
              this.rpcClient &&
                (this.rpcClient.close(), (this.rpcClient = null)));
          } else if (e === rr.LogoutTimeout) {
            if (!this.state.setState(zt.ExitTimeout)) return;
            (this.options.logger.info(
              "Exit Room " + this.options.roomId + " timeout",
            ),
              this.roomCbs.exitRoomCb &&
                (this.options.logger.info("exit room timeout"),
                this.roomCbs.exitRoomCb(be.Failed, t, {
                  roomId: this.options.roomId,
                  reason: Se.ActivelyLeave,
                })),
              this.rpcClient &&
                (this.rpcClient.close(), (this.rpcClient = null)));
          } else this.options.logger.error("Exit room result type is invalid!");
        },
      },
      {
        key: "onNotification",
        value: function (e) {
          this.options.logger.info(
            "room: " + this.options.roomId + " receive notification message",
          );
          var t,
            r = e.method;
          if (r)
            if ("participant" === r) {
              var i = e.params.type;
              if ("join" === i) {
                var n = e.params,
                  o = {
                    participant: {
                      userId: n.userId,
                      previousRoomId: n.previousRoomId,
                      userData: n.userData,
                    },
                  };
                (this.buildRemoteUser(o.participant),
                  this.roomCbs.notificationCb &&
                    (this.options.logger.info(
                      "user: " + o.participant.userId + "join notification",
                    ),
                    this.roomCbs.notificationCb(
                      this.options.roomId,
                      Re.ParticipantJoin,
                      o,
                    )));
              } else if ("leave" === i) {
                var a = e.params,
                  s = { userId: a.userId, reason: a.reason };
                (this.remoteUsers.has(s.userId) &&
                  this.deleteRemoteUser(s.userId),
                  this.roomCbs.notificationCb &&
                    (this.options.logger.info(
                      "user: " + s.userId + " leave notification",
                      this.remoteStreams,
                      this.remoteUsers,
                      this.remoteStreamIdArray,
                    ),
                    this.roomCbs.notificationCb(
                      this.options.roomId,
                      Re.ParticipantLeave,
                      s,
                    )));
              } else
                this.options.logger.error(
                  "participant notification type error!!!",
                );
            } else if ("stream" === r) {
              var c = e.params.type;
              if ("add" === c) {
                var u = { stream: Qt(e.params) };
                (this.options.logger.info(
                  "room-add ",
                  this.remoteStreams,
                  this.remoteUsers,
                  u,
                ),
                  this.remoteUsers.has(u.stream.userId) &&
                    !this.remoteStreams.has(u.stream.streamId) &&
                    (this.buildRemoteStream(u.stream),
                    this.roomCbs.notificationCb &&
                      (this.options.logger.info(
                        "user: " +
                          u.stream.userId +
                          ", stream " +
                          u.stream.streamId +
                          " add notification",
                      ),
                      this.roomCbs.notificationCb(
                        this.options.roomId,
                        Re.StreamAdd,
                        u,
                      ))));
              } else if ("remove" === c) {
                var d = e.params,
                  l = { userId: d.userId, streamId: d.streamId };
                this.remoteStreams.has(l.streamId) &&
                  (this.deleteRemoteStream(l.streamId),
                  this.options.logger.info(
                    "room-remove ",
                    this.remoteStreams,
                    this.remoteUsers,
                    l,
                  ),
                  this.roomCbs.notificationCb &&
                    (this.options.logger.info(
                      "user: " +
                        l.userId +
                        ", stream " +
                        l.streamId +
                        " remove notification",
                    ),
                    this.roomCbs.notificationCb(
                      this.options.roomId,
                      Re.StreamRemove,
                      l,
                    )));
              } else if ("update" === c) {
                var h = e.params,
                  p = {
                    userId: h.userId,
                    streamId: h.streamId,
                    liveStatus: h.data.liveStatus,
                    userData: h.userData,
                  };
                (h.data.simulcast &&
                  this.remoteStreams.has(p.streamId) &&
                  ((p.simulcast = qt(h.data.simulcast)),
                  (this.remoteStreams.get(p.streamId).info.video.simulcast =
                    p.simulcast),
                  this.remoteUsers
                    .get(p.userId)
                    .updateStreamSimulcast(p.streamId, p.simulcast)),
                  h.data.liveStatus &&
                    ((p.liveStatus = h.data.liveStatus),
                    this.remoteStreams.has(p.streamId) &&
                      (p.liveStatus.audio &&
                        (this.remoteStreams.get(p.streamId).info.audio.muted =
                          p.liveStatus.audio.muted),
                      p.liveStatus.video &&
                        (this.remoteStreams.get(p.streamId).info.video.muted =
                          p.liveStatus.video.muted),
                      this.remoteUsers
                        .get(p.userId)
                        .updateStreamStatus(p.streamId, p.liveStatus))),
                  this.roomCbs.notificationCb &&
                    (this.options.logger.info(
                      "user: " +
                        p.userId +
                        ", stream " +
                        p.streamId +
                        " update notification",
                    ),
                    this.roomCbs.notificationCb(
                      this.options.roomId,
                      Re.StreamUpdate,
                      p,
                    )));
              } else
                this.options.logger.error("Stream notification type error!!!");
            } else if ("drop" === r) {
              var f = {
                cause:
                  ((t = e.params.cause),
                  "kicked" == t
                    ? Ce.Kicked
                    : "repeatlogin" == t
                      ? Ce.RepeatLogin
                      : "disbanded" == t
                        ? Ce.RoomDissolved
                        : Ce.Unknown),
              };
              if (!this.state.setState(zt.Destroyed)) return;
              (this.roomCbs.notificationCb &&
                (this.options.logger.info("drop notification"),
                this.roomCbs.notificationCb(this.options.roomId, Re.Drop, f)),
                this.rpcClient &&
                  (this.rpcClient.close(), (this.rpcClient = null)));
            } else if ("permission" === r) {
              var m = e.params,
                v = {
                  userId: m.userId,
                  publish: m.publish,
                  subscribe: m.subscribe,
                  control: m.control,
                };
              this.roomCbs.notificationCb &&
                (this.options.logger.info("permission change notification"),
                this.roomCbs.notificationCb(
                  this.options.roomId,
                  Re.PermissionChange,
                  v,
                ));
              var g = v.publish && (v.publish.audio || v.publish.video);
              if (this.remoteUsers.has(v.userId)) {
                if (!g) {
                  this.deleteRemoteUser(v.userId);
                  var y = { userId: v.userId, reason: Ee.Normal };
                  this.roomCbs.notificationCb &&
                    (this.options.logger.info(
                      "user: " + y.userId + "leave notification",
                    ),
                    this.roomCbs.notificationCb(
                      this.options.roomId,
                      Re.ParticipantLeave,
                      y,
                    ));
                }
              } else if (g) {
                var b = {
                  userId: v.userId,
                  previousRoomId: "",
                  userData: { userId: v.userId, userName: "" },
                };
                (this.buildRemoteUser(b),
                  this.roomCbs.notificationCb &&
                    (this.options.logger.info(
                      "user: " + b.userId + "join notification",
                    ),
                    this.roomCbs.notificationCb(
                      this.options.roomId,
                      Re.ParticipantJoin,
                      { participant: b },
                    )));
              }
            }
        },
      },
      {
        key: "onRpcStateChange",
        value: function (e, t, r) {
          (this.options.logger.info(
            "prevState: ".concat(e, ",state: ").concat(t),
          ),
            "DISCONNECTED" === t
              ? this.onConnectionLost()
              : "RECONNECTING" === t && this.onTryToReconenct(),
            this.roomCbs.onWsStateChange &&
              this.roomCbs.onWsStateChange(this.options.roomId, e, t));
        },
      },
      {
        key: "onConnectionLost",
        value: function () {
          (this.options.logger.info(
            "room: " + this.options.roomId + " connection lost!!!",
          ),
            (this.connectionStatus = Te.ConnectionLost));
          var e,
            t = wr(this.remoteUsers.values());
          try {
            for (t.s(); !(e = t.n()).done; ) e.value.onConnectionLost();
          } catch (e) {
            t.e(e);
          } finally {
            t.f();
          }
          (this.roomCbs.connectionLostCb &&
            this.roomCbs.connectionLostCb(this.options.roomId),
            this.rpcClient.reconnect());
        },
      },
      {
        key: "onTryToReconenct",
        value: function () {
          (this.options.logger.info(
            "room: " + this.options.roomId + " connection retring ......",
          ),
            (this.connectionStatus = Te.ConnectionRetring),
            this.roomCbs.tryToReconnectCb &&
              this.roomCbs.tryToReconnectCb(this.options.roomId));
        },
      },
      {
        key: "onConnectionRecovery",
        value: function () {
          (this.options.logger.info(
            "room: ".concat(this.options.roomId, " connection recovery!!!"),
          ),
            this.state.state() != zt.Entering &&
              this.login.onConnectionRecovery());
        },
      },
      {
        key: "onRpcReconnectFailed",
        value: function () {
          (this.options.logger.info(
            "room: " + this.options.roomId + " reconnection failed!!!",
          ),
            this.roomCbs.onWsReconnectFailed &&
              this.roomCbs.onWsReconnectFailed(this.options.roomId));
        },
      },
      {
        key: "initJsonRpcClient",
        value:
          ((r = V(
            H.mark(function e(t, r, i, n, o, a, s, c) {
              var u;
              return H.wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return (
                          (u = {
                            onCustomSignParam: t,
                            appId: r,
                            userSig: i,
                            userId: n,
                            privateKey: o,
                            extendInfo: a,
                            wsUrl: this.options.serverUrl,
                            ssl: s,
                            roomId: c,
                            onRequest: null,
                            onNotification: this.onNotification.bind(this),
                            onError: this.roomCbs.onWsError,
                            onConnect: this.initLoginAndLocalUser.bind(this),
                            onWsStateChange: this.onRpcStateChange.bind(this),
                            onWsReconnectFailed:
                              this.onRpcReconnectFailed.bind(this),
                          }),
                          (this.rpcClient = new kr(u, this.options.logger)),
                          (e.next = 4),
                          this.rpcClient.connect()
                        );
                      case 4:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          )),
          function (e, t, i, n, o, a, s, c) {
            return r.apply(this, arguments);
          }),
      },
      {
        key: "initLoginAndLocalUser",
        value:
          ((t = V(
            H.mark(function e() {
              var t, r, i, n, o, a, s, c, u, d;
              return H.wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        if (this.isFirstLogin) {
                          e.next = 2;
                          break;
                        }
                        return e.abrupt("return", this.onConnectionRecovery());
                      case 2:
                        return (
                          (this.isFirstLogin = !1),
                          (r = (t = this.loginParams).appId),
                          (i = t.userId),
                          (n = t.userType),
                          (o = t.previousRoomId),
                          (a = t.permission),
                          (s = t.userData),
                          (c = t.extendInfo),
                          (e.next = 6),
                          new Promise(
                            (function () {
                              var e = V(
                                H.mark(function e(t) {
                                  var r;
                                  return H.wrap(
                                    function (e) {
                                      for (;;)
                                        switch ((e.prev = e.next)) {
                                          case 0:
                                            return (
                                              (r = {
                                                sdk: {
                                                  type: "WebRTC",
                                                  version: "5.2024.5.0_00",
                                                },
                                                device: {
                                                  osName: "",
                                                  osVersion: ""
                                                    .concat(Ue, "/")
                                                    .concat(Ne),
                                                  netType: he(),
                                                },
                                                capabilities: {
                                                  isp: "unknown",
                                                  location: "unknown",
                                                  trikleIce: !1,
                                                  secure: !0,
                                                },
                                              }),
                                              (e.prev = 1),
                                              (e.next = 4),
                                              new Promise(
                                                (function () {
                                                  var e = V(
                                                    H.mark(function e(t, r) {
                                                      return H.wrap(
                                                        function (e) {
                                                          for (;;)
                                                            switch (
                                                              (e.prev = e.next)
                                                            ) {
                                                              case 0:
                                                                if (
                                                                  ((e.prev = 0),
                                                                  !pe.any())
                                                                ) {
                                                                  e.next = 5;
                                                                  break;
                                                                }
                                                                (t(
                                                                  pe.getOsName(),
                                                                ),
                                                                  (e.next = 9));
                                                                break;
                                                              case 5:
                                                                return (
                                                                  (e.next = 7),
                                                                  new Promise(
                                                                    (function () {
                                                                      var e = V(
                                                                        H.mark(
                                                                          function e(
                                                                            t,
                                                                            r,
                                                                          ) {
                                                                            var i,
                                                                              n,
                                                                              o,
                                                                              a,
                                                                              s,
                                                                              c,
                                                                              u,
                                                                              d;
                                                                            return H.wrap(
                                                                              function (
                                                                                e,
                                                                              ) {
                                                                                for (;;)
                                                                                  switch (
                                                                                    (e.prev =
                                                                                      e.next)
                                                                                  ) {
                                                                                    case 0:
                                                                                      ((i =
                                                                                        "-"),
                                                                                        (n =
                                                                                          navigator.appVersion),
                                                                                        (o =
                                                                                          navigator.userAgent),
                                                                                        (a =
                                                                                          i),
                                                                                        (s =
                                                                                          [
                                                                                            {
                                                                                              s: "Chrome OS",
                                                                                              r: /CrOS/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows 10",
                                                                                              r: /(Windows 10.0|Windows NT 10.0)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows 8.1",
                                                                                              r: /(Windows 8.1|Windows NT 6.3)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows 8",
                                                                                              r: /(Windows 8|Windows NT 6.2)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows 7",
                                                                                              r: /(Windows 7|Windows NT 6.1)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows Vista",
                                                                                              r: /Windows NT 6.0/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows Server 2003",
                                                                                              r: /Windows NT 5.2/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows XP",
                                                                                              r: /(Windows NT 5.1|Windows XP)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows 2000",
                                                                                              r: /(Windows NT 5.0|Windows 2000)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows ME",
                                                                                              r: /(Win 9x 4.90|Windows ME)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows 98",
                                                                                              r: /(Windows 98|Win98)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows 95",
                                                                                              r: /(Windows 95|Win95|Windows_95)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows NT 4.0",
                                                                                              r: /(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows CE",
                                                                                              r: /Windows CE/,
                                                                                            },
                                                                                            {
                                                                                              s: "Windows 3.11",
                                                                                              r: /Win16/,
                                                                                            },
                                                                                            {
                                                                                              s: "Android",
                                                                                              r: /Android/,
                                                                                            },
                                                                                            {
                                                                                              s: "Open BSD",
                                                                                              r: /OpenBSD/,
                                                                                            },
                                                                                            {
                                                                                              s: "Sun OS",
                                                                                              r: /SunOS/,
                                                                                            },
                                                                                            {
                                                                                              s: "Linux",
                                                                                              r: /(Linux|X11)/,
                                                                                            },
                                                                                            {
                                                                                              s: "iOS",
                                                                                              r: /(iPhone|iPad|iPod)/,
                                                                                            },
                                                                                            {
                                                                                              s: "Mac OS X",
                                                                                              r: /Mac OS X/,
                                                                                            },
                                                                                            {
                                                                                              s: "Mac OS",
                                                                                              r: /(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/,
                                                                                            },
                                                                                            {
                                                                                              s: "QNX",
                                                                                              r: /QNX/,
                                                                                            },
                                                                                            {
                                                                                              s: "UNIX",
                                                                                              r: /UNIX/,
                                                                                            },
                                                                                            {
                                                                                              s: "BeOS",
                                                                                              r: /BeOS/,
                                                                                            },
                                                                                            {
                                                                                              s: "OS/2",
                                                                                              r: /OS\/2/,
                                                                                            },
                                                                                            {
                                                                                              s: "Search Bot",
                                                                                              r: /(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/,
                                                                                            },
                                                                                          ]),
                                                                                        (c = 0));
                                                                                    case 6:
                                                                                      if (
                                                                                        !(u =
                                                                                          s[
                                                                                            c
                                                                                          ])
                                                                                      ) {
                                                                                        e.next = 13;
                                                                                        break;
                                                                                      }
                                                                                      if (
                                                                                        !u.r.test(
                                                                                          o,
                                                                                        )
                                                                                      ) {
                                                                                        e.next = 10;
                                                                                        break;
                                                                                      }
                                                                                      return (
                                                                                        (a =
                                                                                          u.s),
                                                                                        e.abrupt(
                                                                                          "break",
                                                                                          13,
                                                                                        )
                                                                                      );
                                                                                    case 10:
                                                                                      (c++,
                                                                                        (e.next = 6));
                                                                                      break;
                                                                                    case 13:
                                                                                      if (
                                                                                        ((d =
                                                                                          i),
                                                                                        !/Windows/.test(
                                                                                          a,
                                                                                        ))
                                                                                      ) {
                                                                                        e.next = 28;
                                                                                        break;
                                                                                      }
                                                                                      if (
                                                                                        !/Windows (.*)/.test(
                                                                                          a,
                                                                                        )
                                                                                      ) {
                                                                                        e.next = 27;
                                                                                        break;
                                                                                      }
                                                                                      if (
                                                                                        10 !=
                                                                                        (d =
                                                                                          /Windows (.*)/.exec(
                                                                                            a,
                                                                                          )[1])
                                                                                      ) {
                                                                                        e.next = 27;
                                                                                        break;
                                                                                      }
                                                                                      return (
                                                                                        (e.prev = 18),
                                                                                        (e.next = 21),
                                                                                        new Promise(
                                                                                          function (
                                                                                            e,
                                                                                          ) {
                                                                                            navigator &&
                                                                                            navigator.userAgentData &&
                                                                                            navigator
                                                                                              .userAgentData
                                                                                              .getHighEntropyValues
                                                                                              ? navigator.userAgentData
                                                                                                  .getHighEntropyValues(
                                                                                                    [
                                                                                                      "platformVersion",
                                                                                                    ],
                                                                                                  )
                                                                                                  .then(
                                                                                                    function (
                                                                                                      t,
                                                                                                    ) {
                                                                                                      if (
                                                                                                        navigator
                                                                                                          .userAgentData
                                                                                                          .platform &&
                                                                                                        "windows" ===
                                                                                                          navigator.userAgentData.platform.toLowerCase() &&
                                                                                                        t.platformVersion
                                                                                                      ) {
                                                                                                        var r =
                                                                                                          parseInt(
                                                                                                            t.platformVersion.split(
                                                                                                              ".",
                                                                                                            )[0],
                                                                                                          );
                                                                                                        e(
                                                                                                          r >=
                                                                                                            13
                                                                                                            ? 11
                                                                                                            : 10,
                                                                                                        );
                                                                                                      } else
                                                                                                        e(
                                                                                                          10,
                                                                                                        );
                                                                                                    },
                                                                                                  )
                                                                                                  .catch(
                                                                                                    function () {
                                                                                                      e(
                                                                                                        10,
                                                                                                      );
                                                                                                    },
                                                                                                  )
                                                                                              : e(
                                                                                                  10,
                                                                                                );
                                                                                          },
                                                                                        )
                                                                                      );
                                                                                    case 21:
                                                                                      ((d =
                                                                                        e.sent),
                                                                                        (e.next = 27));
                                                                                      break;
                                                                                    case 24:
                                                                                      ((e.prev = 24),
                                                                                        (e.t0 =
                                                                                          e.catch(
                                                                                            18,
                                                                                          )),
                                                                                        (d = 10));
                                                                                    case 27:
                                                                                      a =
                                                                                        "Windows";
                                                                                    case 28:
                                                                                      ((e.t1 =
                                                                                        a),
                                                                                        (e.next =
                                                                                          "Mac OS X" ===
                                                                                          e.t1
                                                                                            ? 31
                                                                                            : "Android" ===
                                                                                                e.t1
                                                                                              ? 33
                                                                                              : "iOS" ===
                                                                                                  e.t1
                                                                                                ? 35
                                                                                                : 37));
                                                                                      break;
                                                                                    case 31:
                                                                                      return (
                                                                                        /Mac OS X (10[/._\d]+)/.test(
                                                                                          o,
                                                                                        ) &&
                                                                                          (d =
                                                                                            /Mac OS X (10[\.\_\d]+)/.exec(
                                                                                              o,
                                                                                            )[1]),
                                                                                        e.abrupt(
                                                                                          "break",
                                                                                          37,
                                                                                        )
                                                                                      );
                                                                                    case 33:
                                                                                      return (
                                                                                        /Android ([\.\_\d]+)/.test(
                                                                                          o,
                                                                                        ) &&
                                                                                          (d =
                                                                                            /Android ([\.\_\d]+)/.exec(
                                                                                              o,
                                                                                            )[1]),
                                                                                        e.abrupt(
                                                                                          "break",
                                                                                          37,
                                                                                        )
                                                                                      );
                                                                                    case 35:
                                                                                      return (
                                                                                        /OS (\d+)_(\d+)_?(\d+)?/.test(
                                                                                          o,
                                                                                        ) &&
                                                                                          (d =
                                                                                            (d =
                                                                                              /OS (\d+)_(\d+)_?(\d+)?/.exec(
                                                                                                n,
                                                                                              ))[1] +
                                                                                            "." +
                                                                                            d[2] +
                                                                                            "." +
                                                                                            (0 |
                                                                                              d[3])),
                                                                                        e.abrupt(
                                                                                          "break",
                                                                                          37,
                                                                                        )
                                                                                      );
                                                                                    case 37:
                                                                                      t(
                                                                                        {
                                                                                          osName:
                                                                                            a +
                                                                                            d,
                                                                                          type: "desktop",
                                                                                        },
                                                                                      );
                                                                                    case 38:
                                                                                    case "end":
                                                                                      return e.stop();
                                                                                  }
                                                                              },
                                                                              e,
                                                                              null,
                                                                              [
                                                                                [
                                                                                  18,
                                                                                  24,
                                                                                ],
                                                                              ],
                                                                            );
                                                                          },
                                                                        ),
                                                                      );
                                                                      return function (
                                                                        t,
                                                                        r,
                                                                      ) {
                                                                        return e.apply(
                                                                          this,
                                                                          arguments,
                                                                        );
                                                                      };
                                                                    })(),
                                                                  )
                                                                );
                                                              case 7:
                                                                t(e.sent);
                                                              case 9:
                                                                e.next = 14;
                                                                break;
                                                              case 11:
                                                                ((e.prev = 11),
                                                                  (e.t0 =
                                                                    e.catch(0)),
                                                                  r(e.t0));
                                                              case 14:
                                                              case "end":
                                                                return e.stop();
                                                            }
                                                        },
                                                        e,
                                                        null,
                                                        [[0, 11]],
                                                      );
                                                    }),
                                                  );
                                                  return function (t, r) {
                                                    return e.apply(
                                                      this,
                                                      arguments,
                                                    );
                                                  };
                                                })(),
                                              )
                                            );
                                          case 4:
                                            ((r.device.osName = e.sent.osName),
                                              t(r),
                                              (e.next = 12));
                                            break;
                                          case 9:
                                            ((e.prev = 9),
                                              (e.t0 = e.catch(1)),
                                              t(r));
                                          case 12:
                                          case "end":
                                            return e.stop();
                                        }
                                    },
                                    e,
                                    null,
                                    [[1, 9]],
                                  );
                                }),
                              );
                              return function (t) {
                                return e.apply(this, arguments);
                              };
                            })(),
                          )
                        );
                      case 6:
                        ((u = e.sent),
                          c &&
                            c.location &&
                            (u.capabilities.location = c.location),
                          (d = {
                            appId: r,
                            userId: i,
                            userType: n,
                            roomId: this.options.roomId,
                            previousRoomId: o,
                            userAgent: u,
                            permission: a,
                            userData: s,
                            rpcClient: this.rpcClient,
                            logger: this.options.logger,
                            loginCb: this.onLogin.bind(this),
                            reloginCb: this.onRelogin.bind(this),
                            logoutCb: this.onLogout.bind(this),
                          }),
                          (this.login = new cr(d)),
                          (this.localUser = new gr({
                            userId: i,
                            roomId: this.options.roomId,
                            previousRoomId: o,
                            userAgent: d.userAgent,
                            permission: a,
                            userData: s,
                            rpcClient: this.rpcClient,
                            logger: this.options.logger,
                          })),
                          this.login.login());
                      case 13:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          )),
          function () {
            return t.apply(this, arguments);
          }),
      },
      {
        key: "buildRemoteUser",
        value: function (e) {
          var t = e.userId,
            r = new _r({
              roomId: this.options.roomId,
              participant: e,
              rpcClient: this.rpcClient,
              logger: this.options.logger,
            });
          (this.remoteUsers.set(t, r),
            this.remoteUserIdArray.push(t),
            this.options.logger.info(
              "this.remoteUsers",
              JSON.stringify(this.remoteUsers, null, 4),
            ));
        },
      },
      {
        key: "deleteRemoteStream",
        value: function (e) {
          if (
            (this.options.logger.info("delete-streamId", e, this.remoteStreams),
            this.remoteStreams.has(e))
          ) {
            var t = this.remoteStreams.get(e).userId;
            (this.remoteUsers.has(t) && this.remoteUsers.get(t).deleteStream(e),
              this.remoteStreams.delete(e));
            var r = this.remoteStreamIdArray.indexOf(e);
            -1 != r && this.remoteStreamIdArray.splice(r, 1);
          }
        },
      },
      {
        key: "deleteRemoteUser",
        value: function (e) {
          if (this.remoteUsers.has(e)) {
            var t,
              r = wr(
                JSON.parse(
                  JSON.stringify(this.remoteUsers.get(e).getAllStreamId()),
                ),
              );
            try {
              for (r.s(); !(t = r.n()).done; ) this.deleteRemoteStream(t.value);
            } catch (e) {
              r.e(e);
            } finally {
              r.f();
            }
            this.remoteUsers.delete(e);
            var i = this.remoteUserIdArray.indexOf(e);
            -1 != i && this.remoteUserIdArray.splice(i, 1);
          }
        },
      },
      {
        key: "buildRemoteStream",
        value: function (e) {
          var t = e.streamId;
          (this.remoteUsers.get(e.userId).addStream(e),
            this.remoteStreams.set(t, e),
            this.remoteStreamIdArray.push(t));
        },
      },
      {
        key: "buildRemoteUserAndCollectNotification",
        value: function (e, t) {
          var r = this,
            i = new Array();
          if (t) {
            var n,
              o = wr(e.room.participants);
            try {
              var a = function () {
                var e = n.value,
                  t = { participant: e },
                  o = e.userId;
                if (o === r.localUser.getUserId()) return "continue";
                r.remoteUsers.has(o) ||
                  (r.buildRemoteUser(e),
                  i.push(function () {
                    r.roomCbs.notificationCb &&
                      (r.options.logger.info(
                        "user: " + t.participant.userId + "join notification",
                      ),
                      r.roomCbs.notificationCb(
                        r.options.roomId,
                        Re.ParticipantJoin,
                        t,
                      ));
                  }));
              };
              for (o.s(); !(n = o.n()).done; ) a();
            } catch (e) {
              o.e(e);
            } finally {
              o.f();
            }
            var s,
              c = wr(JSON.parse(JSON.stringify(this.remoteUserIdArray)));
            try {
              for (c.s(); !(s = c.n()).done; ) {
                var u,
                  d = s.value,
                  l = !0,
                  h = wr(e.room.participants);
                try {
                  for (h.s(); !(u = h.n()).done; )
                    u.value.userId === d && (l = !1);
                } catch (e) {
                  h.e(e);
                } finally {
                  h.f();
                }
                if (l) {
                  this.deleteRemoteUser(d);
                  var p = { userId: d, reason: Ee.Normal };
                  this.roomCbs.notificationCb &&
                    (this.options.logger.info(
                      "user: " + p.userId + "leave notification",
                    ),
                    this.roomCbs.notificationCb(
                      this.options.roomId,
                      Re.ParticipantLeave,
                      p,
                    ));
                }
              }
            } catch (e) {
              c.e(e);
            } finally {
              c.f();
            }
          } else {
            var f,
              m = wr(e.room.participants);
            try {
              var v = function () {
                var e = f.value,
                  t = { participant: e };
                if (e.userId === r.localUser.getUserId()) return "continue";
                (r.buildRemoteUser(e),
                  i.push(function () {
                    r.roomCbs.notificationCb &&
                      (r.options.logger.info(
                        "user: ".concat(
                          t.participant.userId,
                          " join notification",
                        ),
                      ),
                      r.roomCbs.notificationCb(
                        r.options.roomId,
                        Re.ParticipantJoin,
                        t,
                      ));
                  }));
              };
              for (m.s(); !(f = m.n()).done; ) v();
            } catch (e) {
              m.e(e);
            } finally {
              m.f();
            }
          }
          return i;
        },
      },
      {
        key: "buildRemoteStreamsAndCollectNotification",
        value: function (e, t) {
          var r = this,
            i = new Array();
          if (t) {
            var n,
              o = wr(JSON.parse(JSON.stringify(this.remoteStreamIdArray)));
            try {
              for (o.s(); !(n = o.n()).done; ) {
                var a,
                  s = n.value,
                  c = !0,
                  u = wr(e.room.streams);
                try {
                  for (u.s(); !(a = u.n()).done; )
                    a.value.streamId === s && (c = !1);
                } catch (e) {
                  u.e(e);
                } finally {
                  u.f();
                }
                if (c && this.remoteStreams.has(s)) {
                  var d = this.remoteStreams.get(s).userId;
                  this.deleteRemoteStream(s);
                  var l = { userId: d, streamId: s };
                  this.roomCbs.notificationCb &&
                    (this.options.logger.info(
                      "user: " +
                        l.userId +
                        ", stream " +
                        l.streamId +
                        " remove notification",
                    ),
                    this.roomCbs.notificationCb(
                      this.options.roomId,
                      Re.StreamRemove,
                      l,
                    ));
                }
              }
            } catch (e) {
              o.e(e);
            } finally {
              o.f();
            }
            var h,
              p = wr(e.room.streams);
            try {
              var f = function () {
                var e = h.value,
                  t = { stream: Xt(e) },
                  n = e.userId,
                  o = e.streamId;
                if (n === r.localUser.getUserId()) return "continue";
                if (r.remoteStreams.has(o)) {
                  if (
                    e.info.audio &&
                    e.info.audio.muted !=
                      r.remoteStreams.get(o).info.audio.muted
                  ) {
                    var a = {
                      audio: {
                        muted: e.info.audio.muted,
                        floor: e.info.audio.floor,
                      },
                    };
                    ((r.remoteStreams.get(o).info.audio.muted =
                      e.info.audio.muted),
                      (r.remoteStreams.get(o).info.audio.floor =
                        e.info.audio.floor),
                      r.remoteUsers.get(n).updateStreamStatus(o, a));
                    var s = { userId: n, streamId: o, liveStatus: a };
                    i.push(function () {
                      r.roomCbs.notificationCb &&
                        (r.options.logger.info(
                          "user: " +
                            n +
                            ", stream " +
                            o +
                            " update notification",
                        ),
                        r.roomCbs.notificationCb(
                          r.options.roomId,
                          Re.StreamUpdate,
                          s,
                        ));
                    });
                  }
                  if (
                    e.info.video &&
                    e.info.video.muted !=
                      r.remoteStreams.get(o).info.video.muted
                  ) {
                    var c = {
                      video: {
                        muted: e.info.video.muted,
                        floor: e.info.video.floor,
                      },
                    };
                    ((r.remoteStreams.get(o).info.video.muted =
                      e.info.video.muted),
                      (r.remoteStreams.get(o).info.video.floor =
                        e.info.video.floor),
                      r.remoteUsers.get(n).updateStreamStatus(o, c));
                    var u = { userId: n, streamId: o, liveStatus: c };
                    i.push(function () {
                      r.roomCbs.notificationCb &&
                        (r.options.logger.info(
                          "user: " +
                            n +
                            ", stream " +
                            o +
                            " update notification",
                        ),
                        r.roomCbs.notificationCb(
                          r.options.roomId,
                          Re.StreamUpdate,
                          u,
                        ));
                    });
                  }
                  if (
                    e.info.video &&
                    e.info.video.simulcast &&
                    e.info.video.simulcast.length !=
                      r.remoteStreams.get(o).info.video.simulcast.length
                  ) {
                    var d = qt(e.info.video.simulcast);
                    ((r.remoteStreams.get(o).info.video.simulcast = d),
                      r.remoteUsers.get(n).updateStreamSimulcast(o, d));
                    var l = { userId: n, streamId: o, simulcast: d };
                    i.push(function () {
                      r.roomCbs.notificationCb &&
                        (r.options.logger.info(
                          "user: " +
                            n +
                            ", stream " +
                            o +
                            " update notification",
                        ),
                        r.roomCbs.notificationCb(
                          r.options.roomId,
                          Re.StreamUpdate,
                          l,
                        ));
                    });
                  }
                } else {
                  if (!r.remoteUsers.has(n))
                    return (
                      r.options.logger.error(
                        "Stream " + o + " no related user!",
                      ),
                      { v: i }
                    );
                  (r.buildRemoteStream(t.stream),
                    i.push(function () {
                      r.roomCbs.notificationCb &&
                        (r.options.logger.info(
                          "user: " + n + ", stream " + o + " add notification",
                        ),
                        r.roomCbs.notificationCb(
                          r.options.roomId,
                          Re.StreamAdd,
                          t,
                        ));
                    }));
                }
              };
              for (p.s(); !(h = p.n()).done; ) {
                var m = f();
                if ("continue" !== m && "object" === ne(m)) return m.v;
              }
            } catch (e) {
              p.e(e);
            } finally {
              p.f();
            }
          } else {
            var v,
              g = wr(e.room.streams);
            try {
              var y = function () {
                var e = v.value,
                  t = { stream: Xt(e) },
                  n = e.userId,
                  o = e.streamId;
                return n === r.localUser.getUserId()
                  ? "continue"
                  : r.remoteUsers.has(n)
                    ? (r.buildRemoteStream(t.stream),
                      void i.push(function () {
                        r.roomCbs.notificationCb &&
                          (r.options.logger.info(
                            "user: " +
                              n +
                              ", stream " +
                              o +
                              " add notification",
                          ),
                          r.roomCbs.notificationCb(
                            r.options.roomId,
                            Re.StreamAdd,
                            t,
                          ));
                      }))
                    : (r.options.logger.error(
                        "Stream " + o + " no related user!",
                      ),
                      { v: i });
              };
              for (g.s(); !(v = g.n()).done; ) {
                var b = y();
                if ("continue" !== b && "object" === ne(b)) return b.v;
              }
            } catch (e) {
              g.e(e);
            } finally {
              g.f();
            }
          }
          return i;
        },
      },
    ]),
    e
  );
})();
function Ar() {
  function e() {
    return ((65536 * (1 + Math.random())) | 0).toString(16).substring(1);
  }
  return e() + e() + "-" + e() + "-" + e() + "-" + e() + "-" + e() + e() + e();
}
var Lr,
  xr = (function () {
    function e(t, r) {
      (F(this, e),
        (this.rooms = new Map()),
        (this.logger = t),
        (this.roomCbs = r));
    }
    return (
      W(e, [
        {
          key: "enterRoom",
          value: function (e, t) {
            var r = t.onCustomSignParam,
              i = t.appId,
              n = t.userSig,
              o = t.userId,
              a = t.userType,
              s = t.previousRoomId,
              c = t.permission,
              u = t.userData,
              d = t.extendInfo,
              l = t.serverUrl,
              h = t.privateKey,
              p = t.enterRoomCb,
              f = t.ssl;
            if (
              (this.logger.info("XsigoStackClient enterRoom: " + e),
              !this.rooms.has(e))
            ) {
              var m = new Pr({
                roomId: e,
                serverUrl: l,
                logger: this.logger,
                roomCbs: this.roomCbs,
              });
              this.rooms.set(e, m);
            }
            this.rooms.get(e).enter(r, i, n, o, a, s, c, u, d, h, p, f, e);
          },
        },
        {
          key: "exitRoom",
          value: function (e, t) {
            if (
              (this.logger.info("XsigoStackClient exitRoom: " + e),
              this.rooms.has(e))
            )
              return (this.rooms.get(e).exit(t), void this.rooms.delete(e));
            this.logger.error(
              "XsigoStackClient exitRoom: " + e + "error, room not exist",
            );
          },
        },
        {
          key: "publishStream",
          value: function (e, t) {
            var r = t.streamType,
              i = t.streamKind,
              n = t.params,
              o = t.cb,
              a = t.updateCb,
              s = Ar();
            if (
              (this.logger.info(
                "XsigoStackClient publishStream :  " + s + " in room" + e,
                this.rooms.has(e),
              ),
              this.rooms.has(e))
            )
              return (this.rooms.get(e).publishStream(s, r, i, n, o, a), s);
          },
        },
        {
          key: "unpublishStream",
          value: function (e, t, r) {
            (this.logger.info(
              "XsigoStackClient unpublishStream :  " + t + " in room" + e,
            ),
              this.rooms.has(e) && this.rooms.get(e).unpublishStream(t, r));
          },
        },
        {
          key: "updateSimulcast",
          value: function (e, t, r, i) {
            this.rooms.has(e) && this.rooms.get(e).updateSimulcast(t, r, i);
          },
        },
        {
          key: "muteAudio",
          value: function (e, t, r, i) {
            this.rooms.has(e) && this.rooms.get(e).muteLocalAudio(t, r, i);
          },
        },
        {
          key: "muteVideo",
          value: function (e, t, r, i) {
            this.rooms.has(e) && this.rooms.get(e).muteLocalVideo(t, r, i);
          },
        },
        {
          key: "unmuteAudio",
          value: function (e, t, r, i) {
            this.rooms.has(e) && this.rooms.get(e).unmuteLocalAudio(t, r, i);
          },
        },
        {
          key: "unmuteVideo",
          value: function (e, t, r, i) {
            this.rooms.has(e) && this.rooms.get(e).unmuteLocalVideo(t, r, i);
          },
        },
        {
          key: "subscribeStream",
          value: function (e, t) {
            var r = t.publisherUserId,
              i = t.streamId,
              n = t.streamKind,
              o = t.params,
              a = t.cb,
              s = t.updateCb;
            this.logger.info(
              "XsigoStackClient subscribeStream :  " + i + " in room" + e,
            );
            var c = Ar();
            return this.rooms.has(e)
              ? (this.rooms.get(e).subscribeStream(c, r, i, n, o, a, s), c)
              : "";
          },
        },
        {
          key: "unsubscribeStream",
          value: function (e, t, r) {
            (this.logger.info(
              "XsigoStackClient unsubscribe :  " + t + " in room" + e,
            ),
              this.rooms.has(e) && this.rooms.get(e).unsubscribeStream(t, r));
          },
        },
        {
          key: "switchSimulcast",
          value: function (e, t, r, i) {
            this.rooms.has(e) && this.rooms.get(e).switchSimulcast(t, r, i);
          },
        },
        {
          key: "switchPermission",
          value: function (e, t, r) {
            this.rooms.has(e) && this.rooms.get(e).switchPermission(t, r);
          },
        },
        {
          key: "getWsState",
          value: function (e) {
            if (this.rooms.has(e)) return this.rooms.get(e).getWsState();
          },
        },
        {
          key: "isDisconnected",
          value: function (e) {
            var t = this.getWsState(e).state;
            return (
              ["CONNECTED", "RECOVERY"].includes(t) ||
                this.logger.warn("cannot operate during network disconnection"),
              !["CONNECTED", "RECOVERY"].includes(t)
            );
          },
        },
      ]),
      e
    );
  })();
function Dr(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function Mr(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? Dr(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : Dr(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
!(function (e) {
  ((e[(e.AuthTypeHeader = 0)] = "AuthTypeHeader"),
    (e[(e.AuthTypeQuery = 1)] = "AuthTypeQuery"));
})(Lr || (Lr = {}));
var Ur = {
  appKey: null,
  authorization: "",
  timeout: 1e4,
  extendInfo: {},
  ssl: !0,
  onCustomSignParam: null,
  path: "",
  privateKey: "",
  timeoutObj: {},
  init: function (e) {
    var t = e.sdkAppId,
      r = e.userSig,
      i = e.onCustomSignParam,
      n = e.extendInfo,
      o = e.userId;
    ((this.ssl = e.ssl),
      (this.userId = o),
      (this.appKey = t),
      (this.authorization = r),
      (this.onCustomSignParam = i),
      (this.extendInfo = n));
  },
  timeoutPromise: function (e, t, r) {
    var i = this;
    return new Promise(function (n, o) {
      i.timeoutObj[r] = setTimeout(function () {
        (n(
          new Response("timeout", {
            status: 408,
            statusText: "request timeout",
          }),
        ),
          t.abort());
      }, e);
    });
  },
  getHeader: function () {
    var e = this;
    return V(
      H.mark(function t() {
        var r, i;
        return H.wrap(function (t) {
          for (;;)
            switch ((t.prev = t.next)) {
              case 0:
                if (!e.onCustomSignParam) {
                  t.next = 18;
                  break;
                }
                return ((t.next = 3), e.onCustomSignParam());
              case 3:
                if ((r = t.sent).getHeader) {
                  t.next = 6;
                  break;
                }
                return t.abrupt(
                  "return",
                  new Headers({
                    "Content-Type": "application/json",
                    appKey: e.appKey,
                    userId: e.userId,
                  }),
                );
              case 6:
                if ("object" !== ne(r.getHeader)) {
                  t.next = 15;
                  break;
                }
                if (
                  ((i = r.getHeader),
                  "[object Object]" !== Object.prototype.toString.call(i))
                ) {
                  t.next = 12;
                  break;
                }
                return t.abrupt(
                  "return",
                  new Headers(
                    Mr(
                      { "Content-Type": "application/json", appKey: e.appKey },
                      i,
                    ),
                  ),
                );
              case 12:
                throw new Error(
                  "onCustomSignParam.getHeader result is not an object",
                );
              case 13:
                t.next = 16;
                break;
              case 15:
                throw new Error("onCustomSignParam.getHeader is not a object");
              case 16:
                t.next = 19;
                break;
              case 18:
                return t.abrupt(
                  "return",
                  new Headers({
                    "Content-Type": "application/json",
                    appKey: e.appKey,
                    Authorization: e.authorization,
                    userId: e.userId,
                  }),
                );
              case 19:
              case "end":
                return t.stop();
            }
        }, t);
      }),
    )();
  },
  getQuerys: function () {
    var e = this;
    return V(
      H.mark(function t() {
        var r, i, n, o, a, s, c;
        return H.wrap(function (t) {
          for (;;)
            switch ((t.prev = t.next)) {
              case 0:
                if (!e.onCustomSignParam) {
                  t.next = 20;
                  break;
                }
                return ((t.next = 3), e.onCustomSignParam());
              case 3:
                if ((r = t.sent).getQuery) {
                  t.next = 6;
                  break;
                }
                return t.abrupt("return", "");
              case 6:
                if ("object" !== ne(r.getQuery)) {
                  t.next = 17;
                  break;
                }
                if (
                  ((i = r.getQuery),
                  "[object Object]" !== Object.prototype.toString.call(i))
                ) {
                  t.next = 14;
                  break;
                }
                for (n = "", o = 0, a = Object.entries(i); o < a.length; o++)
                  ((s = U(a[o], 2)),
                    (c = s[1]),
                    (n += "&".concat(s[0], "=").concat(c)));
                return t.abrupt("return", n.slice(1));
              case 14:
                throw new Error(
                  "onCustomSignParam.getQuery result is not an object",
                );
              case 15:
                t.next = 18;
                break;
              case 17:
                throw new Error("onCustomSignParam.getQuery is not a object");
              case 18:
                t.next = 21;
                break;
              case 20:
                return t.abrupt("return", "");
              case 21:
              case "end":
                return t.stop();
            }
        }, t);
      }),
    )();
  },
  baseUrl: function (e) {
    return e.includes("https://") || e.includes("http://")
      ? e
      : "".concat(this.ssl ? "https://" : "http://").concat(e);
  },
  getAppConfig: function (e, t) {
    var r = this;
    return V(
      H.mark(function i() {
        var n, o, a, s, c;
        return H.wrap(function (i) {
          for (;;)
            switch ((i.prev = i.next)) {
              case 0:
                return ((r.path = r.baseUrl(e)), (i.next = 3), r.getQuerys());
              case 3:
                return ((n = i.sent), (i.next = 6), r.getHeader());
              case 6:
                return (
                  (o = i.sent),
                  (a = new AbortController()),
                  (s = ""
                    .concat(r.path, "/api/v1/app/config/get?")
                    .concat(n && n + "&", "appId=")
                    .concat(r.appKey)),
                  r.extendInfo &&
                    r.extendInfo.location &&
                    (s += "&location=".concat(r.extendInfo.location)),
                  t && ((r.privateKey = t), (s += "&privateKey=".concat(t))),
                  (c = function () {
                    return fetch(s, {
                      method: "GET",
                      headers: o,
                      signal: a.signal,
                    });
                  }),
                  i.abrupt(
                    "return",
                    Promise.race([
                      r.timeoutPromise(r.timeout, a, "getAppConfig"),
                      c(),
                    ])
                      .then(function (e) {
                        if (e.ok) return e.json();
                        throw new de(
                          401 === e.status
                            ? {
                                code: te.AUTHORIZATION_FAILED,
                                message:
                                  "Authorization failed: /api/v1/app/config/get?appId",
                              }
                            : 404 === e.status
                              ? {
                                  code: te.GET_SERVER_NODE_FAILED,
                                  message: "404: /api/v1/app/config/get?appId",
                                }
                              : 408 === e.status
                                ? {
                                    code: te.REQUEST_TIMEOUT,
                                    message: "".concat(
                                      e.statusText,
                                      ": /api/v1/app/config/get?appId",
                                    ),
                                  }
                                : {
                                    code: te.SERVER_UNKNOWN_ERROR,
                                    message:
                                      "Server unknown error: /api/v1/app/config/get?appId",
                                  },
                        );
                      })
                      .catch(function (e) {
                        return Promise.reject(s + e);
                      })
                      .finally(function () {
                        (r.timeoutObj.getAppConfig &&
                          clearTimeout(r.timeoutObj.getAppConfig),
                          (r.timeoutObj.getAppConfig = null));
                      }),
                  )
                );
              case 13:
              case "end":
                return i.stop();
            }
        }, i);
      }),
    )();
  },
  getWsUrl: function (e, t, r) {
    var i = this;
    return V(
      H.mark(function n() {
        var o, a, s, c, u;
        return H.wrap(function (n) {
          for (;;)
            switch ((n.prev = n.next)) {
              case 0:
                return ((i.path = i.baseUrl(t)), (n.next = 3), i.getQuerys());
              case 3:
                return ((o = n.sent), (n.next = 6), i.getHeader());
              case 6:
                return (
                  (a = n.sent),
                  (s = ""
                    .concat(i.path, "/api/v1/dispatch/get-can-use?")
                    .concat(o && o + "&", "mucNum=")
                    .concat(e)),
                  i.extendInfo &&
                    i.extendInfo.location &&
                    (s += "&location=".concat(i.extendInfo.location)),
                  r && (s += "&privateKey=".concat(r)),
                  (c = new AbortController()),
                  (u = function () {
                    return fetch(s, {
                      method: "GET",
                      headers: a,
                      signal: c.signal,
                    });
                  }),
                  n.abrupt(
                    "return",
                    Promise.race([
                      i.timeoutPromise(i.timeout, c, "getWsUrl"),
                      u(),
                    ])
                      .then(function (e) {
                        if (e.ok) return e.json();
                        throw new de(
                          401 === e.status
                            ? {
                                code: te.AUTHORIZATION_FAILED,
                                message:
                                  "Authorization failed: /api/v1/dispatch/get-can-use?mucNum",
                              }
                            : 404 === e.status
                              ? {
                                  code: te.GET_SERVER_NODE_FAILED,
                                  message:
                                    "404: /api/v1/dispatch/get-can-use?mucNum",
                                }
                              : 408 === e.status
                                ? {
                                    code: te.REQUEST_TIMEOUT,
                                    message: "".concat(
                                      e.statusText,
                                      ": /api/v1/dispatch/get-can-use?mucNum",
                                    ),
                                  }
                                : {
                                    code: te.SERVER_UNKNOWN_ERROR,
                                    message:
                                      "Server unknown error: /api/v1/dispatch/get-can-use?mucNum",
                                  },
                        );
                      })
                      .catch(function (e) {
                        return Promise.reject(s + e);
                      })
                      .finally(function () {
                        (i.timeoutObj.getWsUrl &&
                          clearTimeout(i.timeoutObj.getWsUrl),
                          (i.timeoutObj.getWsUrl = null));
                      }),
                  )
                );
              case 13:
              case "end":
                return n.stop();
            }
        }, n);
      }),
    )();
  },
  upload: function (e) {
    var t = this;
    return V(
      H.mark(function r() {
        var i, n, o;
        return H.wrap(function (r) {
          for (;;)
            switch ((r.prev = r.next)) {
              case 0:
                return ((r.next = 2), t.getQuerys());
              case 2:
                return ((i = r.sent), (r.next = 5), t.getHeader());
              case 5:
                return (
                  (n = r.sent),
                  (o = ""
                    .concat(t.path, "/api/v1/logging/collect/list")
                    .concat(i && "?".concat(i))),
                  t.extendInfo &&
                    t.extendInfo.location &&
                    (o += i
                      ? "&location=".concat(t.extendInfo.location)
                      : "?location=".concat(t.extendInfo.location)),
                  t.privateKey &&
                    (o += i
                      ? "&privateKey=".concat(t.privateKey)
                      : "?privateKey=".concat(t.privateKey)),
                  r.abrupt(
                    "return",
                    fetch(o, {
                      method: "POST",
                      body: JSON.stringify(e),
                      headers: n,
                    })
                      .then(function (e) {
                        if (e.ok) return e.json();
                        throw new de({ code: e.status, message: e.statusText });
                      })
                      .catch(function (e) {
                        return Promise.reject(e);
                      }),
                  )
                );
              case 10:
              case "end":
                return r.stop();
            }
        }, r);
      }),
    )();
  },
};
function Nr(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function Vr(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? Nr(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : Nr(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
function jr(e, t) {
  var r;
  if ("undefined" == typeof Symbol || null == e[Symbol.iterator]) {
    if (
      Array.isArray(e) ||
      (r = (function (e, t) {
        if (e) {
          if ("string" == typeof e) return Fr(e, t);
          var r = Object.prototype.toString.call(e).slice(8, -1);
          return (
            "Object" === r && e.constructor && (r = e.constructor.name),
            "Map" === r || "Set" === r
              ? Array.from(e)
              : "Arguments" === r ||
                  /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)
                ? Fr(e, t)
                : void 0
          );
        }
      })(e)) ||
      (t && e && "number" == typeof e.length)
    ) {
      r && (e = r);
      var i = 0,
        n = function () {};
      return {
        s: n,
        n: function () {
          return i >= e.length ? { done: !0 } : { done: !1, value: e[i++] };
        },
        e: function (e) {
          throw e;
        },
        f: n,
      };
    }
    throw new TypeError(
      "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.",
    );
  }
  var o,
    a = !0,
    s = !1;
  return {
    s: function () {
      r = e[Symbol.iterator]();
    },
    n: function () {
      var e = r.next();
      return ((a = e.done), e);
    },
    e: function (e) {
      ((s = !0), (o = e));
    },
    f: function () {
      try {
        a || null == r.return || r.return();
      } finally {
        if (s) throw o;
      }
    },
  };
}
function Fr(e, t) {
  (null == t || t > e.length) && (t = e.length);
  for (var r = 0, i = new Array(t); r < t; r++) i[r] = e[r];
  return i;
}
var Br,
  Wr,
  Gr = (function () {
    function e(t, r) {
      (F(this, e),
        (this.logger = r),
        (this.ssl =
          !!t.ssl || !!t.wsUrl.includes("https") || !t.wsUrl.includes("http")),
        (this.wsUrl = t.wsUrl),
        (this.wsUrlList = t.backupWsUrlList
          ? j(new Set([this.wsUrl].concat(j(t.backupWsUrlList))))
          : [this.wsUrl]),
        (this.userId = t.userId),
        (this.userName =
          "undefined" !== t.userName && t.userName ? t.userName : ""),
        (this.mode = t.mode),
        (this.sdkAppId = t.sdkAppId),
        (this.userSig = t.userSig),
        (this.onCustomSignParam = t.onCustomSignParam),
        (this.extendInfo = t.extendInfo),
        (this.appConfig = null),
        (this.reconnectCount = 0),
        this.init());
    }
    var t, r, i, n, o, a, s, c, u, d, l, h, p, f, m;
    return (
      W(e, [
        {
          key: "init",
          value: function () {
            var e = this;
            ((this.publications = new Map()),
              (this.subscriptions = new Map()),
              (this.roomId = null),
              (this.roomUniqueId = null),
              (this.role = "anchor"),
              (this.remoteStreams = new Map()),
              (this.state = K.New),
              (this.localStreams = []),
              (this.enablemicVolume = !1),
              (this.soundMeter = null),
              (this.timer = null),
              (this.micStream = null),
              (this.isEnableSmallStream = !1),
              (this._emitter = new J(this.logger)),
              (this.subscribeManager = new At(this.logger)),
              (this._interval = -1),
              (this._remoteMutedStateMap = new Map()),
              (this.audioVolumeInterval = null),
              (this.isWaterMark = !1),
              (this.waterMarkoptions = null),
              (this.waterMarkImage = null),
              (this.smallStreamConfig = {
                width: 160,
                height: 120,
                bitrate: 100,
                framerate: 15,
              }),
              this.logger.setUserId(this.userId),
              this.logger.setServerUrl(this.wsUrl),
              Ur.init({
                userId: this.userId,
                ssl: this.ssl,
                sdkAppId: this.sdkAppId,
                userSig: this.userSig,
                onCustomSignParam: this.onCustomSignParam,
                extendInfo: this.extendInfo,
              }),
              (this.xsigoClient = new xr(this.logger, {
                notificationCb: this.notificationCb.bind(this),
                connectionLostCb: this.connectionLostCb.bind(this),
                tryToReconnectCb: this.tryToReconnectCb.bind(this),
                connectionRecoveryCb: this.connectionRecoveryCb.bind(this),
                onWsStateChange: this.onWsStateChange.bind(this),
                onWsError: this.onError.bind(this),
                onWsReconnectFailed: this.onWsReconnectFailed.bind(this),
              })),
              this.ssl &&
                navigator.mediaDevices &&
                et()
                  .then(function (t) {
                    ((e._preDiviceList = t),
                      e.logger.info(
                        "mediaDevices",
                        JSON.stringify(e._preDiviceList, null, 4),
                      ));
                  })
                  .catch(function () {
                    e._preDiviceList = [];
                  }),
              (this.senderStats = new Map()),
              (this.receiverStats = new Map()),
              (this.senderLocalStats = new Map()),
              (this.deviceChange = this.onDeviceChange.bind(this)),
              (this.visibilitychange = this.onVisibilitychange.bind(this)),
              this.logger.info("userAgent:", navigator.userAgent));
          },
        },
        {
          key: "setAppConfig",
          value: function (e) {
            var t = e.serverTs,
              r = e.logPeriod,
              i = e.enableLog,
              n = e.eventPeriod,
              o = e.enableEvent,
              a = e.metricCollectPeriod;
            ((this.appConfig = {
              serverTs: t,
              timeDiff: t ? Date.now() - t : 0,
              logPeriod: r,
              enableLog: !1 !== i,
              eventPeriod: n,
              enableEvent: !1 !== o,
              metricCollectPeriod: a,
            }),
              this.logger.setAppConfig(this.appConfig),
              this.logger.info(
                "get app config",
                JSON.stringify(this.appConfig, null, 4),
              ));
          },
        },
        {
          key: "reset",
          value: function () {
            ((this.publications = new Map()),
              (this.subscriptions = new Map()),
              (this.localStreams = []),
              this.remoteStreams.clear(),
              this.subscribeManager.reset(),
              this._remoteMutedStateMap.clear(),
              (this.appConfig = null),
              this._interval && window.clearInterval(this._interval),
              (this._interval = -1),
              (this.reconnectCount = 0),
              this.audioVolumeInterval &&
                window.clearInterval(this.audioVolumeInterval),
              (this.audioVolumeInterval = null),
              this.removeEventListenser("devicechange"),
              this.removeEventListenser("visibilitychange"),
              this.logger.setServerUrl(null),
              this.logger.setAppConfig(null),
              this.closeWaterMark());
          },
        },
        {
          key: "notificationCb",
          value: function (e, t, r) {
            if (t === Re.ParticipantJoin) {
              var i = r.participant,
                n = i.userId,
                o = i.previousRoomId,
                a = i.userData;
              (this.logger.info("======notification: participant join======"),
                this.updateRemoteMutedState(n),
                this.logger.buriedLog({
                  c: Xe.ON_PEER_JOIN,
                  v: "uid:".concat(n),
                }),
                this._emitter.emit("peer-join", {
                  userId: n,
                  previousRoomId: o,
                  userData: a,
                }));
            }
            if (t === Re.ParticipantLeave) {
              var s = r.userId;
              (this.logger.info("======notification: participant leave======"),
                this.onParticipantLeave(s));
            }
            if (
              (t === Re.StreamAdd &&
                (this.logger.info("======notification: stream add======"),
                this.onStreamAdd(r.stream)),
              t === Re.StreamRemove &&
                (this.logger.info("======notification: stream remove======"),
                this.onStreamChange(r.userId, r.streamId)),
              t === Re.Drop)
            ) {
              var c = r.cause;
              (this.logger.info("======notification: participant drop======"),
                this.onClientBanned(c));
            }
            if (
              (t === Re.StreamUpdate &&
                (this.logger.info("======notification: stream update======"),
                this.onStreamUpdate(
                  r.userId,
                  r.streamId,
                  r.liveStatus,
                  r.simulcast,
                )),
              t === Re.PermissionChange)
            ) {
              var u = r;
              this.logger.info(
                "======notification: role change======",
                u.userId,
                u.publish,
              );
            }
            if (t === Re.MuteLocal) {
              var d = r.type,
                l = r.userId;
              (this.logger.info("======notification: muteLocal ======", d),
                this.onMuteLocal(d, l));
            }
          },
        },
        {
          key: "connectionLostCb",
          value: function (e) {
            this.logger &&
              (this.logger.info("room: ".concat(e, " connection lost")),
              this.logger.buriedLog({ c: Xe.CONNECTIONLOST_CB }));
          },
        },
        {
          key: "tryToReconnectCb",
          value: function (e) {
            this.logger.info("room: ".concat(e, " connection retring ......"));
          },
        },
        {
          key: "connectionRecoveryCb",
          value: function (e, t, r) {
            var i = this;
            return new Promise(
              (function () {
                var n = V(
                  H.mark(function n(o, a) {
                    var s, c, u, d, l, h, p, f, m, v, g, y, b, S;
                    return H.wrap(
                      function (n) {
                        for (;;)
                          switch ((n.prev = n.next)) {
                            case 0:
                              if (
                                (i.logger.info(
                                  "room: ".concat(e, " connection recovery"),
                                ),
                                i.logger.buriedLog({
                                  c: Xe.CONNECTION_RECOVERY_CB,
                                }),
                                !r)
                              ) {
                                n.next = 50;
                                break;
                              }
                              if (
                                ((i.roomUniqueId = t),
                                i.logger.setRoomUniqueId(t),
                                (s = new Map()),
                                (c = new Map()),
                                (u = new Map(i.publications)),
                                !i.publications.size)
                              ) {
                                n.next = 25;
                                break;
                              }
                              ((d = jr(u.entries())),
                                (n.prev = 10),
                                (h = H.mark(function e() {
                                  var t, r, n, o, a, c, u;
                                  return H.wrap(function (e) {
                                    for (;;)
                                      switch ((e.prev = e.next)) {
                                        case 0:
                                          return (
                                            (t = U(l.value, 2)),
                                            (r = t[0]),
                                            (n = t[1]),
                                            (e.next = 3),
                                            n.republish()
                                          );
                                        case 3:
                                          (o = e.sent) &&
                                            ((a = Ar()),
                                            s.set(r, { sdp: o.sdp, pubId: a }),
                                            i.publications.delete(r),
                                            i.publications.set(a, n),
                                            (c = i.localStreams.find(
                                              function (e) {
                                                return [
                                                  e.audioStreamId,
                                                  e.videoStreamId,
                                                ].includes(r);
                                              },
                                            )) &&
                                              ((u = c.screen
                                                ? "share_".concat(c.getUserId())
                                                : c.getUserId()),
                                              i.senderStats.delete(u),
                                              (c.streamId = a)));
                                        case 5:
                                        case "end":
                                          return e.stop();
                                      }
                                  }, e);
                                })),
                                d.s());
                            case 13:
                              if ((l = d.n()).done) {
                                n.next = 17;
                                break;
                              }
                              return n.delegateYield(h(), "t0", 15);
                            case 15:
                              n.next = 13;
                              break;
                            case 17:
                              n.next = 22;
                              break;
                            case 19:
                              ((n.prev = 19), (n.t1 = n.catch(10)), d.e(n.t1));
                            case 22:
                              return ((n.prev = 22), d.f(), n.finish(22));
                            case 25:
                              if (!i.subscriptions.size) {
                                n.next = 48;
                                break;
                              }
                              ((p = new Map(i.subscriptions)),
                                (f = jr(p.entries())),
                                (n.prev = 28),
                                f.s());
                            case 30:
                              if ((m = f.n()).done) {
                                n.next = 40;
                                break;
                              }
                              return (
                                (v = U(m.value, 2)),
                                (y = v[1]),
                                i.logger.info("resubscribe stream", (g = v[0])),
                                (n.next = 35),
                                y.subscriber.resubscribe()
                              );
                            case 35:
                              ((b = n.sent),
                                i.receiverStats.delete(y.stream.getUserSeq()),
                                b &&
                                  ((S = Ar()),
                                  c.set(g, { sdp: b.sdp, subId: S }),
                                  i.subscriptions.delete(g),
                                  i.subscriptions.set(S, y)));
                            case 38:
                              n.next = 30;
                              break;
                            case 40:
                              n.next = 45;
                              break;
                            case 42:
                              ((n.prev = 42), (n.t2 = n.catch(28)), f.e(n.t2));
                            case 45:
                              return ((n.prev = 45), f.f(), n.finish(45));
                            case 48:
                              (i.logger.info(
                                "publishOfferSdp==>",
                                s,
                                "subscribeOfferSdp==>",
                                c,
                              ),
                                o({
                                  publishOfferSdp: s,
                                  subscribeOfferSdp: c,
                                }));
                            case 50:
                            case "end":
                              return n.stop();
                          }
                      },
                      n,
                      null,
                      [
                        [10, 19, 22, 25],
                        [28, 42, 45, 48],
                      ],
                    );
                  }),
                );
                return function (e, t) {
                  return n.apply(this, arguments);
                };
              })(),
            );
          },
        },
        {
          key: "join",
          value: function (e) {
            var t = this;
            if (
              (this.logger.info("join room with options", JSON.stringify(e)),
              this.logger.buriedLog({ c: Xe.JOIN }),
              this.logger.buriedLog({ c: Xe.JOIN_FIRST }),
              [K.New, K.Leaved].includes(this.state))
            )
              return new Promise(
                (function () {
                  var r = V(
                    H.mark(function r(i, n) {
                      var o, a, s, c, u, d, l, h, p, f, m, v;
                      return H.wrap(function (r) {
                        for (;;)
                          switch ((r.prev = r.next)) {
                            case 0:
                              return ((r.next = 2), t.isJoinRoomSupported());
                            case 2:
                              if (
                                ((a = (o = r.sent).code),
                                (s = o.message),
                                o.isSupported)
                              ) {
                                r.next = 11;
                                break;
                              }
                              return (
                                t.logger.buriedLog({ c: Xe.JOIN_FAILED }, !0),
                                (c = "join room failed,".concat(s)),
                                t.logger.onError(
                                  { c: Xe.TOP_ERROR, v: te.JOIN_ROOM_FAILED },
                                  c,
                                  !0,
                                ),
                                r.abrupt(
                                  "return",
                                  n(new de({ code: a, message: s })),
                                )
                              );
                            case 11:
                              if (
                                ((d = e.role),
                                (l = ""),
                                e.privateKey && (l = e.privateKey),
                                (h = /^[A-Za-z0-9_-]+$/g),
                                !(u = e.roomId) || h.test(u))
                              ) {
                                r.next = 20;
                                break;
                              }
                              return (
                                (p = "join room failed,roomId:".concat(
                                  u,
                                  ' is invalid，roomId can only be numbers, letters and "-" ',
                                )),
                                t.logger.buriedLog({ c: Xe.JOIN_FAILED }, !0),
                                t.logger.onError(
                                  { c: Xe.TOP_ERROR, v: te.JOIN_ROOM_FAILED },
                                  p,
                                  !0,
                                ),
                                r.abrupt(
                                  "return",
                                  n(
                                    new de({
                                      code: te.INVALID_OPERATION,
                                      message: p,
                                    }),
                                  ),
                                )
                              );
                            case 20:
                              if (
                                !(
                                  t.wsUrl &&
                                  t.sdkAppId &&
                                  (t.userSig || t.onCustomSignParam) &&
                                  u &&
                                  t.userId
                                )
                              ) {
                                r.next = 28;
                                break;
                              }
                              ((t.roomId = u),
                                (t.role = ("live" === t.mode && d) || t.role),
                                t.logger.setRoomId(t.roomId),
                                (f = function (r) {
                                  t.state = K.Joining;
                                  var o = {
                                    onCustomSignParam: t.onCustomSignParam,
                                    appId: t.sdkAppId,
                                    userSig: t.userSig,
                                    userId: t.userId,
                                    userType: we.Normal,
                                    previousRoomId: "",
                                    permission: z.get(t.role),
                                    userData: {
                                      userId: t.userId,
                                      userName: t.userName,
                                      extra: e.extra,
                                    },
                                    extendInfo: t.extendInfo,
                                    serverUrl: r,
                                    privateKey: l,
                                    ssl: t.ssl,
                                    enterRoomCb: function (e, r, o) {
                                      if (1 === e) {
                                        t.state = K.Joined;
                                        var a = o.participants,
                                          s = o.roomUniqueId;
                                        (t.getNetworkQuality(),
                                          t.addEventListenser("devicechange"),
                                          t.addEventListenser(
                                            "visibilitychange",
                                          ),
                                          (t.roomUniqueId = s),
                                          t.logger.setRoomUniqueId(s),
                                          t.logger.buriedLog({
                                            c: Xe.JOIN_SUCCESS,
                                          }),
                                          t._emitter.emit("members", a),
                                          t.logger.info(
                                            "join room ".concat(
                                              t.roomId,
                                              " success",
                                            ),
                                          ),
                                          i(!0));
                                      } else if (2 === e) {
                                        t.state = K.New;
                                        var c = "".concat(
                                          te.JOIN_ROOM_FAILED,
                                          " join room timeout",
                                        );
                                        (t.logger.onError(
                                          {
                                            c: Xe.TOP_ERROR,
                                            v: te.JOIN_ROOM_FAILED,
                                          },
                                          c,
                                          !0,
                                        ),
                                          t.logger.buriedLog(
                                            { c: Xe.JOIN_FAILED },
                                            !0,
                                          ),
                                          n(
                                            new de({
                                              code: te.JOIN_ROOM_FAILED,
                                              message: "join room timeout",
                                            }),
                                          ));
                                      } else {
                                        t.state = K.New;
                                        var u = "join room failed:, ".concat(r);
                                        (t.logger.onError(
                                          {
                                            c: Xe.TOP_ERROR,
                                            v: te.JOIN_ROOM_FAILED,
                                          },
                                          u,
                                          !0,
                                        ),
                                          t.logger.buriedLog(
                                            { c: Xe.JOIN_FAILED },
                                            !0,
                                          ),
                                          n(
                                            new de({
                                              code: te.JOIN_ROOM_FAILED,
                                              message: r,
                                            }),
                                          ));
                                      }
                                    },
                                  };
                                  t.xsigoClient.enterRoom(t.roomId, o);
                                }),
                                t.getWsUrl(l, f, n),
                                (r.next = 35));
                              break;
                            case 28:
                              return ((r.next = 30), t.onCustomSignParam());
                            case 30:
                              ((m = r.sent),
                                (v =
                                  "join room failed, options is invalid,wsUrl:"
                                    .concat(t.wsUrl, ",sdkAppId:")
                                    .concat(t.sdkAppId, ",userSig:")
                                    .concat(t.userSig, ",onCustomSignParam:")
                                    .concat(JSON.stringify(m), ",roomId:")
                                    .concat(e.roomId, ",userId:")
                                    .concat(t.userId)),
                                t.logger.error(v),
                                t.logger.buriedLog({ c: Xe.JOIN_FAILED }, !0),
                                n(
                                  new de({
                                    code: te.INVALID_OPERATION,
                                    message: v,
                                  }),
                                ));
                            case 35:
                            case "end":
                              return r.stop();
                          }
                      }, r);
                    }),
                  );
                  return function (e, t) {
                    return r.apply(this, arguments);
                  };
                })(),
              );
            this.logger.buriedLog({ c: Xe.JOIN_FAILED });
            var r = "join room failed,client state is error ,state:".concat(
              this.state,
            );
            this.logger.onError(
              { c: Xe.TOP_ERROR, v: te.JOIN_ROOM_FAILED },
              r,
              !0,
            );
          },
        },
        {
          key: "getWsUrl",
          value:
            ((m = V(
              H.mark(function e(t, r, i) {
                var n, o, a, s, c, u, d, l, h, p;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (
                            ((n = []),
                            this.logger.info(
                              "wsUrlList,".concat(this.wsUrlList),
                            ),
                            (o = this.wsUrlList.shift()),
                            this.wsUrlList.push(o),
                            !o.includes("ws:") && !o.includes("wss:"))
                          ) {
                            e.next = 9;
                            break;
                          }
                          return (r(o), e.abrupt("return"));
                        case 9:
                          return (
                            (e.prev = 9),
                            (e.next = 12),
                            Ur.getAppConfig(o, t)
                          );
                        case 12:
                          return (
                            (a = e.sent) && this.setAppConfig(a.data),
                            (e.next = 16),
                            Ur.getWsUrl(this.roomId, o, t)
                          );
                        case 16:
                          ((c = ((s = e.sent).data || {}).metadata),
                            (o.includes("https://") || o.includes("http://")) &&
                              (o = o.split("//")[1]),
                            (u = o.split(":").length - 1 >= 2),
                            c
                              ? u
                                ? ((l = c.hostV6),
                                  (d = c.sslHostV6).includes(":") &&
                                    ((d = c.sslHostV6.includes("[")
                                      ? c.sslHostV6
                                      : "[".concat(d)),
                                    (d = c.sslHostV6.includes("]")
                                      ? c.sslHostV6
                                      : "".concat(d, "]"))),
                                  l.includes(":") &&
                                    ((l = c.hostV6.includes("[")
                                      ? c.hostV6
                                      : "[".concat(l)),
                                    (l = c.hostV6.includes("]")
                                      ? c.hostV6
                                      : "".concat(l, "]"))),
                                  (n = this.ssl
                                    ? "wss://".concat(d, ":").concat(c.sslPort)
                                    : "ws://".concat(l, ":").concat(c.port)))
                                : (n = this.ssl
                                    ? "wss://"
                                        .concat(c.sslHost, ":")
                                        .concat(c.sslPort)
                                    : "ws://"
                                        .concat(c.host, ":")
                                        .concat(c.port))
                              : (n = "wss://"
                                  .concat(s.data.host, ":")
                                  .concat(s.data.port)),
                            this.logger.info(
                              " httpUrl==>"
                                .concat(o, "  , serverIPUrl==>")
                                .concat(n),
                            ),
                            r(n),
                            (e.next = 40));
                          break;
                        case 25:
                          if (
                            ((e.prev = 25),
                            (e.t0 = e.catch(9)),
                            this.reconnectCount++,
                            !(this.reconnectCount < this.wsUrlList.length))
                          ) {
                            e.next = 36;
                            break;
                          }
                          if (
                            this.state !== K.Leaved &&
                            this.state !== K.Leaving
                          ) {
                            e.next = 31;
                            break;
                          }
                          return e.abrupt("return");
                        case 31:
                          ((h = "http connect faild ,sdk is reconnecting,count:"
                            .concat(this.reconnectCount, " ==>")
                            .concat(e.t0)),
                            this.logger.warn(h),
                            this.getWsUrl(t, r, i),
                            (e.next = 40));
                          break;
                        case 36:
                          ((p =
                            "http connect faild, SDK has tried reconnect , but faild,  please check your network and server ==>".concat(
                              e.t0,
                            )),
                            this.logger.onError(
                              { c: Xe.TOP_ERROR, v: te.JOIN_ROOM_FAILED },
                              p,
                              !0,
                            ),
                            this.logger.buriedLog({ c: Xe.JOIN_FAILED }, !0),
                            i(
                              new de({
                                code: te.JOIN_ROOM_FAILED,
                                message: e.t0,
                              }),
                            ));
                        case 40:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                  [[9, 25]],
                );
              }),
            )),
            function (e, t, r) {
              return m.apply(this, arguments);
            }),
        },
        {
          key: "leave",
          value:
            ((f = V(
              H.mark(function e() {
                var t = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (![K.Leaving, K.Leaved].includes(this.state)) {
                            e.next = 2;
                            break;
                          }
                          return e.abrupt("return");
                        case 2:
                          return (
                            this.logger.buriedLog({ c: Xe.LEAVE }),
                            e.abrupt(
                              "return",
                              new Promise(function (e, r) {
                                var i,
                                  n = jr(t.publications.entries());
                                try {
                                  var o = function () {
                                    var e = U(i.value, 2),
                                      r = e[0],
                                      n = e[1],
                                      o = t.localStreams.find(function (e) {
                                        return e.streamId === r;
                                      });
                                    (o && o.close(), n.close());
                                  };
                                  for (n.s(); !(i = n.n()).done; ) o();
                                } catch (e) {
                                  n.e(e);
                                } finally {
                                  n.f();
                                }
                                var a,
                                  s = jr(t.subscriptions.values());
                                try {
                                  for (s.s(); !(a = s.n()).done; ) {
                                    var c = a.value;
                                    (c.stream.close(), c.subscriber.close());
                                  }
                                } catch (e) {
                                  s.e(e);
                                } finally {
                                  s.f();
                                }
                                ((t.state = K.Leaving),
                                  t.xsigoClient.exitRoom(
                                    t.roomId,
                                    function (r, i, n) {
                                      if (1 === r)
                                        t.logger.info("leave room success");
                                      else {
                                        var o = "leave room failed:, ".concat(
                                          i,
                                        );
                                        t.logger.onError(
                                          {
                                            c: Xe.TOP_ERROR,
                                            v: te.LEAVE_ROOM_FAILED,
                                          },
                                          o,
                                          !0,
                                        );
                                      }
                                      (t.logger.buriedLog(
                                        { c: Xe.LEAVE_SUCCESS },
                                        !0,
                                      ),
                                        (t.state = K.Leaved),
                                        t.reset(),
                                        e(!0));
                                    },
                                  ));
                              }),
                            )
                          );
                        case 4:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function () {
              return f.apply(this, arguments);
            }),
        },
        {
          key: "publish",
          value:
            ((p = V(
              H.mark(function e(t) {
                var r,
                  i,
                  n = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if ((this.logger.info("publish stream"), t)) {
                            e.next = 5;
                            break;
                          }
                          throw (
                            this.logger.error("stream is undefined or null"),
                            new de({
                              code: te.INVALID_OPERATION,
                              message: "stream is undefined or null",
                            })
                          );
                        case 5:
                          if (
                            !(r = [Y.Publishing, Y.Published]).includes(
                              t.getPubState("audio"),
                            ) ||
                            !r.includes(t.getPubState("video"))
                          ) {
                            e.next = 8;
                            break;
                          }
                          throw new de({
                            code: te.INVALID_OPERATION,
                            message:
                              "duplicate publishing, please unpublish and then re-publish",
                          });
                        case 8:
                          if (
                            "live" !== this.mode ||
                            "audience" !== this.role
                          ) {
                            e.next = 10;
                            break;
                          }
                          throw new de({
                            code: te.INVALID_OPERATION,
                            message:
                              'no permission to publish() under live/audience, please call swithRole("anchor") firstly before publish()',
                          });
                        case 10:
                          if (t.mediaStream) {
                            e.next = 12;
                            break;
                          }
                          throw new de({
                            code: te.INVALID_OPERATION,
                            message: "stream not initialized!",
                          });
                        case 12:
                          return (
                            this.logger.buriedLog({
                              c: t.screen
                                ? Xe.PUBLISH_STREAM_SCREEN
                                : Xe.PUBLISH_STREAM,
                            }),
                            (i = t.mediaStream.getTracks().map(function (e) {
                              return new Promise(function (i, o) {
                                var a = new MediaStream();
                                a.addTrack(e);
                                var s = "audio" === e.kind,
                                  c = s && !e.enabled,
                                  u = "video" === e.kind,
                                  d = u && !e.enabled;
                                if (r.includes(t.getPubState(e.kind)))
                                  n.logger.warn(
                                    "".concat(
                                      s ? "audio" : "video",
                                      " is publishing or published",
                                    ),
                                  );
                                else {
                                  t.setPubState(e.kind, Y.Publishing);
                                  var l = {
                                    localStream: t,
                                    mediaStream: a,
                                    screen: t.screen,
                                    hasAudio: s,
                                    audioMuted: c,
                                    hasVideo: u,
                                    videoMuted: d,
                                    bitrate: t.getBitrate(),
                                    videoProfile: t.videoProfile,
                                  };
                                  n.doPublish(l, function (r, a, c) {
                                    if (
                                      (n.logger.info(
                                        "xsigo client publish stream success",
                                        c && c.streamId,
                                      ),
                                      t.getPubState(e.kind) !== Y.Unpublished)
                                    )
                                      if (1 === r)
                                        (t.published ||
                                          ((t.published = !0),
                                          (t.roomId = c.roomId),
                                          (t.streamId = c.streamId),
                                          (t.xsigoClient = n.xsigoClient),
                                          -1 ===
                                            n.localStreams.findIndex(
                                              function (e) {
                                                return (
                                                  e.streamId === c.streamId
                                                );
                                              },
                                            ) &&
                                            (n.localStreams.push(t),
                                            t.onTrackAdd(n.onAddTrack.bind(n)),
                                            t.onTrackRemove(
                                              n.onRemoveTrack.bind(n),
                                            ),
                                            t.onSwitchDevice(
                                              n.onReplaceTrack.bind(n),
                                            ),
                                            t.onReplaceTrack(
                                              n.onReplaceTrack.bind(n),
                                            ))),
                                          s &&
                                            (t.setHasAudio(!!s),
                                            t.setAudioStreamId(c.streamId)),
                                          u &&
                                            (t.setHasVideo(!!u),
                                            t.setVideoStreamId(c.streamId)),
                                          n.logger.buriedLog({
                                            c: t.screen
                                              ? Xe.PUBLISH_STREAM_SCREEN_SUCCESS
                                              : Xe.PUBLISH_STREAM_SUCCESS,
                                            v: s ? "audio" : "video",
                                          }),
                                          t.setPubState(e.kind, Y.Published),
                                          i(t));
                                      else if (
                                        (n.logger.buriedLog({
                                          c: t.screen
                                            ? Xe.PUBLISH_STREAM_SCREEN_FAILED
                                            : Xe.PUBLISH_STREAM_FAILED,
                                          v: s ? "audio" : "video",
                                        }),
                                        c && n.publications.delete(c.streamId),
                                        t.setPubState(e.kind, Y.Create),
                                        "H264 not supported" === a)
                                      ) {
                                        n.logger.onError({
                                          c: Xe.TOP_ERROR,
                                          v: te.H264_NOT_SUPPORTED,
                                        });
                                        var d = new de({
                                          code: te.H264_NOT_SUPPORTED,
                                          message:
                                            "publish stream failed h264 not supported",
                                        });
                                        (n._emitter.emit($, d), o(d));
                                      } else
                                        (n.logger.onError(
                                          {
                                            c: Xe.TOP_ERROR,
                                            v: te.PUBLISH_STREAM_FAILED,
                                          },
                                          a,
                                        ),
                                          o(
                                            new de({
                                              code: te.PUBLISH_STREAM_FAILED,
                                              message: a,
                                            }),
                                          ));
                                  });
                                }
                              });
                            })),
                            e.abrupt("return", Promise.all(i))
                          );
                        case 16:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function (e) {
              return p.apply(this, arguments);
            }),
        },
        {
          key: "onAddTrack",
          value: function (e) {
            var t = this,
              r = e.track,
              i = e.streamId,
              n = new MediaStream();
            n.addTrack(r);
            var o = "audio" === r.kind,
              a = o && !r.enabled,
              s = "video" === r.kind,
              c = s && !r.enabled,
              u = this.localStreams.find(function (e) {
                return e.streamId === i;
              });
            if (
              (this.logger.info("PublishState", u && u.getPubState(r.kind)),
              u && ![Y.Publishing, Y.Published].includes(u.getPubState(r.kind)))
            ) {
              var d = {
                localStream: u,
                screen: !1,
                hasAudio: o,
                audioMuted: a,
                hasVideo: s,
                videoMuted: c,
                mediaStream: n,
                bitrate: u.getBitrate(),
                videoProfile: u.videoProfile,
              };
              (u.setPubState(r.kind, Y.Publishing),
                this.doPublish(d, function (e, i, n) {
                  u.getPubState(r.kind) !== Y.Unpublished &&
                    (1 === e
                      ? (u.mediaStream.addTrack(r),
                        (u.published = !0),
                        o &&
                          (u.setHasAudio(o),
                          u.setAudioStreamId(n.streamId),
                          u.setAudioTrack(r)),
                        s &&
                          (u.setHasVideo(s),
                          u.setVideoStreamId(n.streamId),
                          u.setVideoTrack(r)),
                        u.setPubState(r.kind, Y.Published))
                      : (n && t.publications.delete(n.streamId),
                        u.setPubState(r.kind, Y.Create)),
                    t.logger.buriedLog({
                      c:
                        1 === e
                          ? Xe.PUBLISH_STREAM_SUCCESS
                          : Xe.PUBLISH_STREAM_FAILED,
                      v: o ? "addAudioTrack" : "addVideoTrack",
                    }),
                    u._emitter.emit("stream-track-update-result", {
                      code: e,
                      message: i,
                    }));
                }));
            } else
              (r.stop(),
                this.logger.warn(
                  u
                    ? "same track is publishing or published"
                    : "stream is not published",
                ));
          },
        },
        {
          key: "doPublish",
          value:
            ((h = V(
              H.mark(function e(t, r) {
                var i, n, o, a, s, c, u, d;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          return (
                            (e.prev = 0),
                            (c = (o = t || {}).localStream),
                            (u = new kt({
                              roomId: this.roomId,
                              userId: this.userId,
                              mediaStream: o.mediaStream,
                              screen: o.screen,
                              bitrate: o.bitrate,
                              isEnableSmallStream: this.isEnableSmallStream,
                              smallStreamConfig: this.smallStreamConfig,
                              hasAudio: (a = o.hasAudio),
                              audioMuted: o.audioMuted,
                              hasVideo: (s = o.hasVideo),
                              videoMuted: o.videoMuted,
                              minBitrate:
                                (null === (i = t.videoProfile) || void 0 === i
                                  ? void 0
                                  : i.minBitrate) || 0,
                              maxBitrate:
                                (null === (n = t.videoProfile) || void 0 === n
                                  ? void 0
                                  : n.maxBitrate) || 0,
                              logger: this.logger,
                              xsigoClient: this.xsigoClient,
                              onPublish: r,
                            })),
                            (e.next = 5),
                            u.publish()
                          );
                        case 5:
                          ("string" != typeof (d = e.sent) ||
                            this.publications.has(d) ||
                            (u.onPublishPeerConnectionFailed(
                              this.onPublishPeerConnectionFailed.bind(this),
                            ),
                            this.publications.set(d, u),
                            (c.streamId = d),
                            a && c.setAudioStreamId(d),
                            s && c.setVideoStreamId(d)),
                            (e.next = 12));
                          break;
                        case 9:
                          ((e.prev = 9), (e.t0 = e.catch(0)), r && r(0, e.t0));
                        case 12:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                  [[0, 9]],
                );
              }),
            )),
            function (e, t) {
              return h.apply(this, arguments);
            }),
        },
        {
          key: "onPublishPeerConnectionFailed",
          value: function (e) {
            var t = this,
              r = e.state,
              i = e.streamId,
              n = this.xsigoClient.getWsState(this.roomId);
            if (this.publications.has(i)) {
              var o = this.localStreams.find(function (e) {
                return [e.audioStreamId, e.videoStreamId].includes(i);
              });
              o &&
                ("failed" === r &&
                n &&
                ["CONNECTED", "RECOVERY"].includes(n.state)
                  ? (this.logger.warn(
                      "publish peerConnection failed try to republish streamId:".concat(
                        i,
                      ),
                    ),
                    o.updatePeerConnectionFailed(r),
                    this.doUnpublish(o, i).then(function () {
                      var e = new MediaStream(),
                        r = o.audioStreamId === i,
                        n = o.videoStreamId === i,
                        a = r ? o.getAudioTrack() : o.getVideoTrack(),
                        s = r && !a.enabled,
                        c = n && !a.enabled;
                      (t.logger.info(
                        "publish "
                          .concat(r ? "audio" : "video", ",trackId:")
                          .concat(a && a.id),
                      ),
                        e.addTrack(a));
                      var u = {
                        localStream: o,
                        screen: o.screen,
                        hasAudio: r,
                        audioMuted: s,
                        hasVideo: n,
                        videoMuted: c,
                        mediaStream: e,
                        bitrate: o.getBitrate(),
                      };
                      t.doPublish(u, function (e, i, a) {
                        1 === e
                          ? ((o.published = !0),
                            r &&
                              (o.setHasAudio(r),
                              o.setAudioStreamId(a.streamId)),
                            n &&
                              (o.setHasVideo(n),
                              o.setVideoStreamId(a.streamId)))
                          : a && t.publications.delete(a.streamId);
                      });
                    }))
                  : "connected" === r && o.updatePeerConnectionFailed(r));
            }
          },
        },
        {
          key: "onRemoveTrack",
          value: function (e) {
            var t = this,
              r = e.track,
              i = e.streamId,
              n = r.kind,
              o = this.localStreams.find(function (e) {
                return e.streamId === i;
              });
            if (
              o &&
              ![Y.Create, Y.Unpublished].includes(o.getPubState(r.kind))
            ) {
              var a = "audio" === n ? o.audioStreamId : o.videoStreamId;
              (o.mediaStream.removeTrack(r),
                "audio" === n && o.setHasAudio(!1),
                "video" === n && o.setHasVideo(!1),
                this.doUnpublish(o, a, function (e, r) {
                  (1 === e && t.logger.info("remove track success"),
                    o._emitter.emit("stream-track-update-result", {
                      code: e,
                      message: r,
                    }));
                }));
            } else this.logger.warn("stream is not published");
          },
        },
        {
          key: "onReplaceTrack",
          value: function (e) {
            var t = e.streamId,
              r = e.type,
              i = e.track,
              n = this.localStreams.find(function (e) {
                return e.streamId === t;
              });
            if (n) {
              var o = "audio" === r ? n.audioStreamId : n.videoStreamId;
              o &&
                this.publications.has(o) &&
                this.publications.get(o).replaceMediaStreamTrack(i);
            }
          },
        },
        {
          key: "unpublish",
          value: function (e) {
            var t = this;
            if ((this.logger.info("unpublish stream"), !e))
              throw (
                this.logger.error("stream is undefined or null"),
                new de({
                  code: te.INVALID_OPERATION,
                  message: "stream is undefined or null",
                })
              );
            this.logger.buriedLog({
              c: e.screen ? Xe.UNPUBLISH_STREAM_SCREEN : Xe.UNPUBLISH_STREAM,
            });
            var r,
              i = [],
              n = jr(this.publications.keys());
            try {
              for (n.s(); !(r = n.n()).done; ) {
                var o = r.value;
                [e.audioStreamId, e.videoStreamId].includes(o) &&
                  i.push(this.doUnpublish(e, o));
              }
            } catch (e) {
              n.e(e);
            } finally {
              n.f();
            }
            return Promise.all(i).then(function () {
              var r = t.localStreams.findIndex(function (t) {
                return t.getId() === e.getId();
              });
              -1 !== r && t.localStreams.splice(r, 1);
            });
          },
        },
        {
          key: "doUnpublish",
          value: function (e, t, r) {
            var i = this;
            return new Promise(function (n, o) {
              var a = i.publications.get(t);
              if (a) {
                (i.publications.delete(t),
                  e.audioStreamId === t && e.setHasAudio(!1),
                  e.videoStreamId === t && e.setHasVideo(!1));
                var s = e.screen
                  ? "share_".concat(e.getUserId())
                  : e.getUserId();
                if (
                  (e.hasAudio() || e.hasVideo() || (e.published = !1),
                  e.setPubState(
                    e.audioStreamId === t ? "audio" : "video",
                    Y.Unpublished,
                  ),
                  i.senderStats.has(s))
                ) {
                  var c = Vr({}, i.senderStats.get(s));
                  (e.hasAudio() ||
                    (c.audio = {
                      bytesSent: 0,
                      timestamp: 0,
                      retransmittedPacketsSent: 0,
                      packetsSent: 0,
                      packetLossRate: 0,
                    }),
                    e.hasVideo() ||
                      ((c.video = {
                        bytesSent: 0,
                        timestamp: 0,
                        retransmittedPacketsSent: 0,
                        packetsSent: 0,
                        packetLossRate: 0,
                      }),
                      (c.smallVideo = {
                        bytesSent: 0,
                        timestamp: 0,
                        retransmittedPacketsSent: 0,
                        packetsSent: 0,
                        packetLossRate: 0,
                      })),
                    i.senderStats.set(s, c));
                }
                (n(!0),
                  a.unpublish(function (n, o, a) {
                    1 === n
                      ? (i.logger.info("unpublish stream success", t),
                        r && r(n, o),
                        i.logger.buriedLog({
                          c: e.screen
                            ? Xe.UNPUBLISH_STREAM_SCREEN_SUCCESS
                            : Xe.UNPUBLISH_STREAM_SUCCESS,
                          v: e.audioStreamId === t ? "audio" : "video",
                        }))
                      : (i.logger.buriedLog({
                          c: e.screen
                            ? Xe.UNPUBLISH_STREAM_SCREEN_FAILED
                            : Xe.UNPUBLISH_STREAM_FAILED,
                          v: e.audioStreamId === t ? "audio" : "video",
                        }),
                        r && r(n, o),
                        i.logger.onError(
                          { c: Xe.TOP_ERROR, v: te.UNPUBLISH_STREAM_FAILED },
                          "unpublish stream with response:, "
                            .concat(n, ",")
                            .concat(o),
                        ));
                  }));
              } else (i.logger.warn("stream is not published", t), n(!0));
            });
          },
        },
        {
          key: "subscribe",
          value:
            ((l = V(
              H.mark(function e(t, r) {
                var i, n, o;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (t) {
                            e.next = 3;
                            break;
                          }
                          throw (
                            this.logger.error("stream is undefined or null"),
                            new de({
                              code: te.INVALID_OPERATION,
                              message: "stream is undefined or null",
                            })
                          );
                        case 3:
                          if (t.isRemote) {
                            e.next = 6;
                            break;
                          }
                          throw (
                            this.logger.error(
                              "try to subscribe a local stream",
                            ),
                            new de({
                              code: te.INVALID_OPERATION,
                              message: "try to subscribe a local stream",
                            })
                          );
                        case 6:
                          if (
                            !(i = [q.Subscribing, q.Subscribed]).includes(
                              t.getSubState("audio"),
                            ) ||
                            !i.includes(t.getSubState("video"))
                          ) {
                            e.next = 10;
                            break;
                          }
                          throw (
                            this.logger.error(
                              "Stream already subscribing or subscribed",
                            ),
                            new de({
                              code: te.INVALID_OPERATION,
                              message:
                                "Stream already subscribing or subscribed",
                            })
                          );
                        case 10:
                          return (
                            !r && (r = { audio: !0, video: !0, small: !1 }),
                            (n = t.getUserSeq()),
                            (t = this.remoteStreams.get(n)),
                            this.logger.info(
                              "subscribe with options:",
                              JSON.stringify(r, null, 4),
                              t,
                            ),
                            this.subscribeManager.setSubscriptionOpts(n, r),
                            (o = []),
                            t &&
                            t.audioStreamId &&
                            !i.includes(t.getSubState("audio"))
                              ? r.audio &&
                                o.push(
                                  this.doSubscribe(t, {
                                    audio: !0,
                                    video: !1,
                                    small: !!r.small && r.small,
                                  }),
                                )
                              : i.includes(t.getSubState("audio")) &&
                                this.logger.warn(
                                  "audio is subscribing or subscribed",
                                ),
                            t &&
                            t.videoStreamId &&
                            !i.includes(t.getSubState("video"))
                              ? r.video &&
                                o.push(
                                  this.doSubscribe(t, {
                                    audio: !1,
                                    video: !0,
                                    small: !!r.small && r.small,
                                  }),
                                )
                              : i.includes(t.getSubState("video")) &&
                                this.logger.warn(
                                  "video is subscribing or subscribed",
                                ),
                            e.abrupt("return", Promise.all(o))
                          );
                        case 19:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function (e, t) {
              return l.apply(this, arguments);
            }),
        },
        {
          key: "doSubscribe",
          value:
            ((d = V(
              H.mark(function e(t, r, i) {
                var n = this;
                return H.wrap(function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return e.abrupt(
                          "return",
                          new Promise(
                            (function () {
                              var e = V(
                                H.mark(function e(o, a) {
                                  var s, c, u, d, l, h, p, f, m, v;
                                  return H.wrap(
                                    function (e) {
                                      for (;;)
                                        switch ((e.prev = e.next)) {
                                          case 0:
                                            return (
                                              (e.prev = 0),
                                              n.logger.info(
                                                "doSubscribe options",
                                                JSON.stringify(r, null, 4),
                                              ),
                                              (s = t.getUserSeq()),
                                              (c = t.getSimulcasts()),
                                              (l = !!r.small && r.small),
                                              n.logger.info(
                                                "---do subscribe options",
                                                (u = r.audio
                                                  ? t.audio
                                                  : r.audio),
                                                (d = r.video
                                                  ? t.video
                                                  : r.video),
                                              ),
                                              n.logger.buriedLog({
                                                c:
                                                  t.getType() === Q
                                                    ? Xe.SUBSCRIBE_STREAM_SCREEN
                                                    : Xe.SUBSCRIBE_STREAM,
                                                v: "uid:"
                                                  .concat(t.getUserId(), ",")
                                                  .concat(
                                                    u ? "audio" : "video",
                                                  ),
                                              }),
                                              t.setSubState(
                                                u ? "audio" : "video",
                                                q.Subscribing,
                                              ),
                                              u &&
                                                n.subscribeManager.updateSubscriptedState(
                                                  s,
                                                  { audio: u, small: l },
                                                ),
                                              d &&
                                                n.subscribeManager.updateSubscriptedState(
                                                  s,
                                                  { video: d, small: l },
                                                ),
                                              (h = 0),
                                              (p = 0),
                                              (f = new Kt({
                                                userId: t.userId,
                                                publisherUserId: t.getUserId(),
                                                hasAudio: u,
                                                hasVideo: d,
                                                simulcast: c,
                                                audioStreamId: u
                                                  ? t.audioStreamId
                                                  : null,
                                                videoStreamId: d
                                                  ? t.videoStreamId
                                                  : null,
                                                logger: n.logger,
                                                xsigoClient: n.xsigoClient,
                                                roomId: n.roomId,
                                                small: l,
                                                onRemoteStream: (function () {
                                                  var e = V(
                                                    H.mark(
                                                      function e(r, a, c, l) {
                                                        var f, m, v;
                                                        return H.wrap(function (
                                                          e,
                                                        ) {
                                                          for (;;)
                                                            switch (
                                                              (e.prev = e.next)
                                                            ) {
                                                              case 0:
                                                                if (
                                                                  !u ||
                                                                  t.getSubState(
                                                                    "audio",
                                                                  ) !==
                                                                    q.Unsubscribed
                                                                ) {
                                                                  e.next = 2;
                                                                  break;
                                                                }
                                                                return e.abrupt(
                                                                  "return",
                                                                );
                                                              case 2:
                                                                if (
                                                                  !d ||
                                                                  t.getSubState(
                                                                    "video",
                                                                  ) !==
                                                                    q.Unsubscribed
                                                                ) {
                                                                  e.next = 4;
                                                                  break;
                                                                }
                                                                return e.abrupt(
                                                                  "return",
                                                                );
                                                              case 4:
                                                                ((f =
                                                                  n.remoteStreams.get(
                                                                    s,
                                                                  )),
                                                                  "audio" ===
                                                                    a.kind &&
                                                                    h++,
                                                                  "video" ===
                                                                    a.kind &&
                                                                    p++,
                                                                  f &&
                                                                    ((c !==
                                                                      ke.AudioVideo &&
                                                                      c !==
                                                                        ke.VideoOnly) ||
                                                                      f.setIsAlphaChannels(
                                                                        l,
                                                                      ),
                                                                    f.mediaStream ||
                                                                      f.setMediaStream(
                                                                        r,
                                                                      ),
                                                                    "audio" ===
                                                                      a.kind &&
                                                                      (h > 1 ||
                                                                        i ||
                                                                        !f.getAudioTrack()) &&
                                                                      (f.updateTrack(
                                                                        "audio",
                                                                        a,
                                                                      ),
                                                                      i || h > 1
                                                                        ? f.setAudioTrack(
                                                                            a,
                                                                          )
                                                                        : f.restartAudio()),
                                                                    "video" ===
                                                                      a.kind &&
                                                                      (p > 1 ||
                                                                        i ||
                                                                        !f.getVideoTrack()) &&
                                                                      (f.updateTrack(
                                                                        "video",
                                                                        a,
                                                                      ),
                                                                      i || p > 1
                                                                        ? f.setVideoTrack(
                                                                            a,
                                                                          )
                                                                        : f.restartVideo()),
                                                                    n.subscribeManager.addSubscriptionRecord(
                                                                      s,
                                                                      f,
                                                                    ),
                                                                    (m =
                                                                      t.getType() ===
                                                                      Q
                                                                        ? "share_".concat(
                                                                            t.getUserId(),
                                                                          )
                                                                        : t.getUserId()),
                                                                    f.subscribed
                                                                      ? (n._emitter.emit(
                                                                          "stream-updated",
                                                                          {
                                                                            stream:
                                                                              f,
                                                                          },
                                                                        ),
                                                                        (v =
                                                                          ""),
                                                                        c ===
                                                                        ke.AudioOnly
                                                                          ? (v =
                                                                              f.audioMuted
                                                                                ? "mute-audio"
                                                                                : "unmute-audio")
                                                                          : c ===
                                                                              ke.VideoOnly &&
                                                                            (v =
                                                                              f.videoMuted
                                                                                ? "mute-video"
                                                                                : "unmute-video"),
                                                                        n._emitter.emit(
                                                                          v,
                                                                          {
                                                                            userId:
                                                                              m,
                                                                          },
                                                                        ))
                                                                      : ((f.subscribed =
                                                                          !0),
                                                                        n.logger.buriedLog(
                                                                          {
                                                                            c:
                                                                              t.getType() ===
                                                                              Q
                                                                                ? Xe.ON_STREAM_SUBSCRIBED_SCREEN
                                                                                : Xe.ON_STREAM_SUBSCRIBED,
                                                                            v: "uid:".concat(
                                                                              t.getUserId(),
                                                                            ),
                                                                          },
                                                                        ),
                                                                        n._emitter.emit(
                                                                          "stream-subscribed",
                                                                          {
                                                                            stream:
                                                                              f,
                                                                          },
                                                                        ),
                                                                        f.getType() ===
                                                                          Q &&
                                                                          n.isWaterMark &&
                                                                          f.startWaterMark(
                                                                            n.waterMarkoptions,
                                                                            n.waterMarkImage,
                                                                          ),
                                                                        c ===
                                                                        ke.AudioOnly
                                                                          ? n._emitter.emit(
                                                                              f.audioMuted
                                                                                ? "mute-audio"
                                                                                : "unmute-audio",
                                                                              {
                                                                                userId:
                                                                                  m,
                                                                              },
                                                                            )
                                                                          : c ===
                                                                              ke.VideoOnly &&
                                                                            n._emitter.emit(
                                                                              f.videoMuted
                                                                                ? "mute-video"
                                                                                : "unmute-video",
                                                                              {
                                                                                userId:
                                                                                  m,
                                                                              },
                                                                            )),
                                                                    t.setSubState(
                                                                      u
                                                                        ? "audio"
                                                                        : "video",
                                                                      q.Subscribed,
                                                                    ),
                                                                    o(!0)));
                                                              case 8:
                                                              case "end":
                                                                return e.stop();
                                                            }
                                                        }, e);
                                                      },
                                                    ),
                                                  );
                                                  return function (t, r, i, n) {
                                                    return e.apply(
                                                      this,
                                                      arguments,
                                                    );
                                                  };
                                                })(),
                                                onSubscribe: function (
                                                  e,
                                                  r,
                                                  i,
                                                ) {
                                                  var o =
                                                    n.subscribeManager.getSubscriptedState(
                                                      s,
                                                    );
                                                  if (
                                                    !(
                                                      (u &&
                                                        t.getSubState(
                                                          "audio",
                                                        ) === q.Unsubscribed) ||
                                                      (d &&
                                                        t.getSubState(
                                                          "video",
                                                        ) === q.Unsubscribed)
                                                    )
                                                  )
                                                    if (1 === e)
                                                      (u && (o.audio = !0),
                                                        d && (o.video = !0),
                                                        n.subscribeManager.updateSubscriptedState(
                                                          s,
                                                          o,
                                                        ),
                                                        c.length &&
                                                          (l
                                                            ? c.find(
                                                                function (e) {
                                                                  return (
                                                                    e.type ===
                                                                    Ae.SmallStream
                                                                  );
                                                                },
                                                              ) &&
                                                              t.setSimulcastType(
                                                                Ae.SmallStream,
                                                              )
                                                            : t.setSimulcastType(
                                                                c[0].type,
                                                              )),
                                                        n.logger.info(
                                                          "subscribe stream success",
                                                        ),
                                                        n.logger.buriedLog({
                                                          c:
                                                            t.getType() === Q
                                                              ? Xe.SUBSCRIBE_STREAM_SCREEN_SUCCESS
                                                              : Xe.SUBSCRIBE_STREAM_SUCCESS,
                                                          v: "uid:"
                                                            .concat(
                                                              t.getUserId(),
                                                              ",",
                                                            )
                                                            .concat(
                                                              u
                                                                ? "audio"
                                                                : "video",
                                                            ),
                                                        }));
                                                    else {
                                                      (n.logger.onError(
                                                        {
                                                          c: Xe.TOP_ERROR,
                                                          v: te.SUBSCRIBE_FAILED,
                                                        },
                                                        "on subscribe stream with response:, "
                                                          .concat(e, ", ")
                                                          .concat(r),
                                                      ),
                                                        n.logger.buriedLog({
                                                          c:
                                                            t.getType() === Q
                                                              ? Xe.SUBSCRIBE_STREAM_SCREEN_FAILED
                                                              : Xe.SUBSCRIBE_STREAM_FAILED,
                                                          v: "uid:"
                                                            .concat(
                                                              t.getUserId(),
                                                              ",",
                                                            )
                                                            .concat(
                                                              u
                                                                ? "audio"
                                                                : "video",
                                                            ),
                                                        }),
                                                        n.subscriptions.delete(
                                                          i.subscriptionId,
                                                        ),
                                                        t.setSubState(
                                                          u ? "audio" : "video",
                                                          q.Create,
                                                        ));
                                                      var h =
                                                          n.subscribeManager.getSubscriptedState(
                                                            s,
                                                          ),
                                                        p =
                                                          n.subscribeManager.needSubscribeKind(
                                                            s,
                                                          );
                                                      (p === ke.AudioVideo &&
                                                        h.audio &&
                                                        h.video &&
                                                        (u &&
                                                          n.subscribeManager.updateSubscriptedState(
                                                            s,
                                                            { audio: !1 },
                                                          ),
                                                        d &&
                                                          n.subscribeManager.updateSubscriptedState(
                                                            s,
                                                            { video: !1 },
                                                          )),
                                                        p === ke.VideoOnly &&
                                                          d &&
                                                          n.subscribeManager.updateSubscriptedState(
                                                            s,
                                                            { video: !1 },
                                                          ),
                                                        p === ke.AudioVideo &&
                                                          u &&
                                                          n.subscribeManager.updateSubscriptedState(
                                                            s,
                                                            { audio: !1 },
                                                          ),
                                                        a(
                                                          new de({
                                                            code: te.SUBSCRIBE_FAILED,
                                                            message: r,
                                                          }),
                                                        ));
                                                    }
                                                },
                                              })),
                                              (e.next = 17),
                                              f.subscribe()
                                            );
                                          case 17:
                                            if (
                                              ((m = e.sent),
                                              n.logger.info(
                                                "time Date.now doSubscribe",
                                                n.remoteStreams.has(s),
                                                t.audioStreamId,
                                                t.videoStreamId,
                                              ),
                                              !u || t.audioStreamId)
                                            ) {
                                              e.next = 21;
                                              break;
                                            }
                                            return e.abrupt(
                                              "return",
                                              f.close(),
                                            );
                                          case 21:
                                            if (!d || t.videoStreamId) {
                                              e.next = 23;
                                              break;
                                            }
                                            return e.abrupt(
                                              "return",
                                              f.close(),
                                            );
                                          case 23:
                                            (n.subscriptions.has(m) ||
                                              (f.onSubscribePeerConnectionFailed(
                                                n.onSubscribePeerConnectionFailed.bind(
                                                  n,
                                                ),
                                              ),
                                              n.subscriptions.set(m, {
                                                subscriber: f,
                                                stream: t,
                                              })),
                                              u && t.setAudioSubscriptionId(m),
                                              d && t.setVideoSubscriptionId(m),
                                              (e.next = 31));
                                            break;
                                          case 28:
                                            ((e.prev = 28),
                                              (e.t0 = e.catch(0)),
                                              "H264 not supported" === e.t0
                                                ? (n.logger.onError(
                                                    {
                                                      c: Xe.TOP_ERROR,
                                                      v: te.H264_NOT_SUPPORTED,
                                                    },
                                                    "subscribe stream failed h264 not supported",
                                                  ),
                                                  (v = new de({
                                                    code: te.H264_NOT_SUPPORTED,
                                                    message:
                                                      "subscribe stream failed h264 not supported",
                                                  })),
                                                  n._emitter.emit($, v))
                                                : (n.logger.onError(
                                                    {
                                                      c: Xe.TOP_ERROR,
                                                      v: te.SUBSCRIBE_FAILED,
                                                    },
                                                    "subscribe stream error:, ".concat(
                                                      e.t0,
                                                      "}",
                                                    ),
                                                  ),
                                                  a(
                                                    new de({
                                                      code: te.SUBSCRIBE_FAILED,
                                                      message: e.t0,
                                                    }),
                                                  )));
                                          case 31:
                                          case "end":
                                            return e.stop();
                                        }
                                    },
                                    e,
                                    null,
                                    [[0, 28]],
                                  );
                                }),
                              );
                              return function (t, r) {
                                return e.apply(this, arguments);
                              };
                            })(),
                          ),
                        );
                      case 1:
                      case "end":
                        return e.stop();
                    }
                }, e);
              }),
            )),
            function (e, t, r) {
              return d.apply(this, arguments);
            }),
        },
        {
          key: "onSubscribePeerConnectionFailed",
          value: function (e) {
            var t = this,
              r = e.state,
              i = e.subscriptionId,
              n = this.xsigoClient.getWsState(this.roomId);
            if (this.subscriptions.has(i)) {
              var o = this.subscribeManager.getSubscriptionOpts(this.userId),
                a = this.subscriptions.get(i).stream;
              if (a)
                if (
                  "failed" === r &&
                  n &&
                  ["CONNECTED", "RECOVERY"].includes(n.state)
                ) {
                  (this.logger.warn(
                    "subscribe peerConnection failed try to resubscribe subscriptionId:".concat(
                      i,
                    ),
                  ),
                    a.updatePeerConnectionFailed(r));
                  var s = a.audioSubscriptionId,
                    c = a.videoSubscriptionId;
                  this.doUnsubscribe(a, i).then(function () {
                    (s === i &&
                      o.audio &&
                      t.doSubscribe(
                        a,
                        { audio: !0, video: !1, small: !!o.small && o.small },
                        !0,
                      ),
                      c === i &&
                        o.video &&
                        t.doSubscribe(
                          a,
                          { audio: !1, video: !0, small: !!o.small && o.small },
                          !0,
                        ));
                  });
                } else "connected" === r && a.updatePeerConnectionFailed(r);
            }
          },
        },
        {
          key: "unsubscribe",
          value: function (e) {
            if (!e)
              throw (
                this.logger.error("stream is undefined or null"),
                new de({
                  code: te.INVALID_OPERATION,
                  message: "stream is undefined or null",
                })
              );
            var t = [],
              r = this.subscribeManager.getSubscriptionOpts(e.getUserSeq());
            return (
              e.setSubState("audio", q.Unsubscribed),
              e.setSubState("video", q.Unsubscribed),
              r.audio &&
                e.audioSubscriptionId &&
                (t.push(this.doUnsubscribe(e, e.audioSubscriptionId)),
                e.setEnableTrackFlag("audio", !0)),
              r.video &&
                e.videoSubscriptionId &&
                (t.push(this.doUnsubscribe(e, e.videoSubscriptionId)),
                e.setEnableTrackFlag("video", !0)),
              Promise.all(t)
            );
          },
        },
        {
          key: "doUnsubscribe",
          value: function (e, t) {
            var r = this,
              i = e.audioSubscriptionId && e.audioSubscriptionId === t,
              n = e.videoSubscriptionId && e.videoSubscriptionId === t;
            this.logger.buriedLog({
              c:
                e.getType() === Q
                  ? Xe.UNSUBSCRIBE_STREAM_SCREEN
                  : Xe.UNSUBSCRIBE_STREAM,
              v: "uid:"
                .concat(e.getUserId(), ",")
                .concat(i ? "audio" : "video"),
            });
            var o = e.getUserSeq(),
              a = this.remoteStreams.get(o),
              s = this.subscribeManager.getSubscriptedState(o);
            return (
              a &&
                i &&
                (a.getAudioTrack() &&
                  a.mediaStream.removeTrack(a.getAudioTrack()),
                a.setSubState("audio", q.Unsubscribed),
                e.setAudioSubscriptionId(null),
                this.subscribeManager.updateSubscriptedState(
                  o,
                  Vr(Vr({}, s), {}, { audio: !1, small: !1 }),
                )),
              a &&
                n &&
                (a.getVideoTrack() &&
                  a.mediaStream.removeTrack(a.getVideoTrack()),
                a.setSubState("video", q.Unsubscribed),
                e.setVideoSubscriptionId(null),
                this.subscribeManager.updateSubscriptedState(
                  o,
                  Vr(Vr({}, s), {}, { video: !1, small: !1 }),
                )),
              !a ||
                e.getAudioTrack() ||
                e.getVideoTrack() ||
                ((a.subscribed = !1), (a.mediaStream = null)),
              this.receiverStats.has(o) && this.receiverStats.delete(o),
              new Promise(function (n, o) {
                if (r.subscriptions.has(t)) {
                  var a = r.subscriptions.get(t);
                  (r.subscriptions.delete(t),
                    n(!0),
                    a.subscriber.unsubscribe(function (t, n, o) {
                      1 === t
                        ? (r.logger.info("unsubscribe stream success"),
                          r.logger.buriedLog({
                            c:
                              e.getType() === Q
                                ? Xe.UNSUBSCRIBE_STREAM_SCREEN_SUCCESS
                                : Xe.UNSUBSCRIBE_STREAM_SUCCESS,
                            v: "uid:"
                              .concat(e.getUserId(), ",")
                              .concat(i ? "audio" : "video"),
                          }))
                        : (r.logger.buriedLog({
                            c:
                              e.getType() === Q
                                ? Xe.UNSUBSCRIBE_STREAM_SCREEN_FAILED
                                : Xe.UNSUBSCRIBE_STREAM_FAILED,
                            v: "uid:"
                              .concat(e.getUserId(), ",")
                              .concat(i ? "audio" : "video"),
                          }),
                          r.logger.onError(
                            { c: Xe.TOP_ERROR, v: te.UNSUBSCRIBE_FAILED },
                            "unsubscribe stream with response:,"
                              .concat(t, ", ")
                              .concat(n),
                          ));
                    }));
                } else
                  (r.logger.warn("stream is not subscribed", e.getUserId()),
                    r.logger.buriedLog({
                      c:
                        e.getType() === Q
                          ? Xe.UNSUBSCRIBE_STREAM_SCREEN_SUCCESS
                          : Xe.UNSUBSCRIBE_STREAM_SUCCESS,
                      v: "uid:"
                        .concat(e.getUserId(), ",")
                        .concat(i ? "audio" : "video"),
                    }),
                    n(!0));
              })
            );
          },
        },
        {
          key: "updateSimulcast",
          value: function (e, t) {
            var r = this;
            return new Promise(function (i, n) {
              var o = r.publications.get(e.videoStreamId);
              if (!o && e.screen)
                throw new de({
                  code: te.INVALID_OPERATION,
                  message: "stream is invalid",
                });
              var a = t.map(function (e) {
                  return {
                    type: Je(e.rid),
                    maxWidth: e.maxWidth,
                    maxHeight: e.maxHeight,
                  };
                }),
                s = e.getSimulcasts();
              if (JSON.stringify(a) === JSON.stringify(s))
                return r.logger.warn("simulcast  ".concat(t, " is same"));
              (r.logger.info("Update Simulcast ".concat(t)),
                o.updateSimulcast(a, function (e, o, a) {
                  if (1 === e)
                    (i(!0),
                      r.logger.info("Update Simulcast ".concat(t, " Success")));
                  else {
                    r.logger.onError({
                      c: Xe.TOP_ERROR,
                      v: te.LOCAL_SWITCH_SIMULCAST,
                    });
                    var s = new de({
                      code: te.LOCAL_SWITCH_SIMULCAST,
                      message: o,
                    });
                    n(s);
                  }
                }));
            });
          },
        },
        {
          key: "setRemoteVideoStreamType",
          value: function (e, t) {
            var r = this;
            if (!e || !t)
              throw (
                this.logger.error("stream or status is undefined or null"),
                new de({
                  code: te.INVALID_OPERATION,
                  message: "stream or status is undefined or null",
                })
              );
            return new Promise(function (i, n) {
              var o = { big: "h", small: "l" }[t];
              if (!o)
                throw new de({
                  code: te.INVALID_OPERATION,
                  message: "status: ".concat(t, " is invalid"),
                });
              var a = r.getRemoteMutedState().filter(function (t) {
                return t.userId === e.getUserId();
              })[0];
              if ("small" === t && a && !a.hasSmall)
                throw new de({
                  code: te.INVALID_OPERATION,
                  message: "does not publish small stream",
                });
              var s = r.subscriptions.get(e.videoSubscriptionId);
              if (!s)
                throw new de({
                  code: te.INVALID_OPERATION,
                  message: "remoteStream is invalid",
                });
              var c = Je(o);
              if (e.getSimulcastType() === c)
                return r.logger.warn("status ".concat(t, " is same"));
              (r.logger.info("Set Remote Video Stream Type ".concat(t)),
                r.logger.buriedLog({
                  c:
                    c === Ae.SmallStream
                      ? Xe.SET_REMOTE_VIDEO_STREAM_TYPE_SAMLL
                      : Xe.SET_REMOTE_VIDEO_STREAM_TYPE_BIG,
                }),
                s.subscriber.switchSimulcast(c, function (o, a, s) {
                  if (1 === o)
                    (e.setSimulcastType(c),
                      r.logger.info(
                        "Set Remote Video Stream Type ".concat(t, " Success"),
                      ),
                      r.logger.buriedLog({
                        c:
                          c === Ae.SmallStream
                            ? Xe.SET_REMOTE_VIDEO_STREAM_TYPE_SAMLL_SUCCESS
                            : Xe.SET_REMOTE_VIDEO_STREAM_TYPE_BIG_SUCCESSE,
                      }),
                      i(!0));
                  else {
                    var u = new de({
                      code: te.REMOTE_SWITCH_SIMULCAST,
                      message: a,
                    });
                    (r.logger.onError(
                      { c: Xe.TOP_ERROR, v: te.LOCAL_SWITCH_SIMULCAST },
                      a,
                    ),
                      r.logger.buriedLog({
                        c:
                          c === Ae.SmallStream
                            ? Xe.SET_REMOTE_VIDEO_STREAM_TYPE_SAMLL_FAILED
                            : Xe.SET_REMOTE_VIDEO_STREAM_TYPE_BIG_FAILED,
                      }),
                      n(u));
                  }
                }));
            });
          },
        },
        {
          key: "switchRole",
          value:
            ((u = V(
              H.mark(function e(t) {
                var r,
                  i,
                  n,
                  o = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (t) {
                            e.next = 2;
                            break;
                          }
                          throw new de({
                            code: te.INVALID_OPERATION,
                            message: "role is undefined or null",
                          });
                        case 2:
                          if ("rtc" !== this.mode) {
                            e.next = 4;
                            break;
                          }
                          throw new de({
                            code: te.INVALID_OPERATION,
                            message: "role is only valid in live mode",
                          });
                        case 4:
                          if ("anchor" === t || "audience" === t) {
                            e.next = 7;
                            break;
                          }
                          throw (
                            this.logger.onError({
                              c: Xe.TOP_ERROR,
                              v: te.INVALID_PARAMETER,
                            }),
                            new de({
                              code: te.INVALID_PARAMETER,
                              message:
                                "role could only be set to a value as anchor or audience",
                            })
                          );
                        case 7:
                          if (t !== this.role) {
                            e.next = 10;
                            break;
                          }
                          return (
                            this.logger.warn("can not switch the same role"),
                            e.abrupt("return", Promise.resolve(!0))
                          );
                        case 10:
                          if (
                            (this.logger.buriedLog({
                              c:
                                "anchor" === t
                                  ? Xe.SWITCH_ROLE_ANCHOR
                                  : Xe.SWITCH_ROLE_AUDIENCE,
                            }),
                            "audience" === t)
                          ) {
                            r = jr(this.publications.keys());
                            try {
                              for (
                                n = function () {
                                  var e = i.value,
                                    t = o.localStreams.find(function (t) {
                                      return [
                                        t.audioStreamId,
                                        t.videoStreamId,
                                      ].includes(e);
                                    });
                                  t && o.doUnpublish(t, e);
                                },
                                  r.s();
                                !(i = r.n()).done;
                              )
                                n();
                            } catch (e) {
                              r.e(e);
                            } finally {
                              r.f();
                            }
                          }
                          return e.abrupt(
                            "return",
                            new Promise(
                              (function () {
                                var e = V(
                                  H.mark(function e(r, i) {
                                    return H.wrap(function (e) {
                                      for (;;)
                                        switch ((e.prev = e.next)) {
                                          case 0:
                                            o.xsigoClient.switchPermission(
                                              o.roomId,
                                              z.get(t),
                                              function (e, n, a) {
                                                if (1 === e)
                                                  (o.logger.info(
                                                    "switch role from "
                                                      .concat(o.role, " to ")
                                                      .concat(t),
                                                  ),
                                                    (o.role = t),
                                                    (o.localStreams = []),
                                                    o.logger.buriedLog({
                                                      c:
                                                        "anchor" === t
                                                          ? Xe.SWITCH_ROLE_ANCHOR_SUCCESS
                                                          : Xe.SWITCH_ROLE_AUDIENCE_SUCCESS,
                                                    }),
                                                    r(!0));
                                                else {
                                                  (o.logger.buriedLog({
                                                    c:
                                                      "anchor" === t
                                                        ? Xe.SWITCH_ROLE_ANCHOR_FAILED
                                                        : Xe.SWITCH_ROLE_AUDIENCE_FAILED,
                                                  }),
                                                    o.logger.onError({
                                                      c: Xe.TOP_ERROR,
                                                      v: te.SWITCH_ROLE_ERROR,
                                                    }));
                                                  var s = new de({
                                                    code: te.SWITCH_ROLE_ERROR,
                                                    message: n,
                                                  });
                                                  i(s);
                                                }
                                              },
                                            );
                                          case 1:
                                          case "end":
                                            return e.stop();
                                        }
                                    }, e);
                                  }),
                                );
                                return function (t, r) {
                                  return e.apply(this, arguments);
                                };
                              })(),
                            ),
                          );
                        case 13:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function (e) {
              return u.apply(this, arguments);
            }),
        },
        {
          key: "on",
          value: function (e, t) {
            this._emitter.on(e, t);
          },
        },
        {
          key: "off",
          value: function (e, t) {
            (this.logger &&
              this.logger.buriedLog({
                c: Xe["OFF_".concat(e.replace("-", "_").toUpperCase())],
              }),
              this._emitter.off(e, t));
          },
        },
        {
          key: "getRemoteMutedState",
          value: function () {
            this.logger.buriedLog({ c: Xe.GET_REMOTE_MUTED_STATE });
            var e,
              t = [],
              r = jr(this._remoteMutedStateMap);
            try {
              for (r.s(); !(e = r.n()).done; ) {
                var i = U(e.value, 2);
                t.push(Vr({ userId: i[0] }, i[1]));
              }
            } catch (e) {
              r.e(e);
            } finally {
              r.f();
            }
            return t.filter(function (e) {
              return !e.userId.includes("share_");
            });
          },
        },
        {
          key: "updateRemoteMutedState",
          value: function (e, t) {
            if (![e, "share_".concat(e)].includes(this.userId)) {
              var r = {
                hasAudio: !1,
                hasVideo: !1,
                audioMuted: !0,
                videoMuted: !0,
                hasSmall: !1,
              };
              t = t || r;
              var i = this._remoteMutedStateMap.get(e) || r;
              this._remoteMutedStateMap.set(e, Vr(Vr({}, i), t));
            }
          },
        },
        {
          key: "getTransportStats",
          value:
            ((c = V(
              H.mark(function e() {
                var t,
                  r,
                  i,
                  n = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (this.publications.size) {
                            e.next = 2;
                            break;
                          }
                          throw new de({
                            code: te.INVALID_OPERATION,
                            message: "local stream is not published",
                          });
                        case 2:
                          ((t = null),
                            (r = jr(this.publications.values())),
                            (e.prev = 4),
                            r.s());
                        case 6:
                          if ((i = r.n()).done) {
                            e.next = 12;
                            break;
                          }
                          return ((t = i.value), e.abrupt("break", 12));
                        case 10:
                          e.next = 6;
                          break;
                        case 12:
                          e.next = 17;
                          break;
                        case 14:
                          ((e.prev = 14), (e.t0 = e.catch(4)), r.e(e.t0));
                        case 17:
                          return ((e.prev = 17), r.f(), e.finish(17));
                        case 20:
                          return e.abrupt(
                            "return",
                            new Promise(function (e, r) {
                              t.getTransportStats()
                                .then(function (r) {
                                  var i = t.userId,
                                    o = 0;
                                  if (n.senderStats.has(i)) {
                                    var a = n.senderStats.get(i);
                                    a.video.timestamp
                                      ? (o = a.video.packetLossRate)
                                      : a.audio.timestamp
                                        ? (o = a.audio.packetLossRate)
                                        : a.smallVideo.timestamp &&
                                          (o = a.smallVideo.packetLossRate);
                                  }
                                  ((r.packetLossRate = o), e(r));
                                })
                                .catch(function (e) {
                                  n.logger.onError({
                                    c: Xe.TOP_ERROR,
                                    v: te.INVALID_TRANSPORT_STATA,
                                  });
                                  var t = new de({
                                    code: te.INVALID_TRANSPORT_STATA,
                                    message: e,
                                  });
                                  r(t);
                                });
                            }),
                          );
                        case 21:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                  [[4, 14, 17, 20]],
                );
              }),
            )),
            function () {
              return c.apply(this, arguments);
            }),
        },
        {
          key: "getRemoteTransportStats",
          value:
            ((s = V(
              H.mark(function e() {
                var t = this;
                return H.wrap(function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return e.abrupt(
                          "return",
                          new Promise(function (e) {
                            try {
                              var r,
                                i = [],
                                n = [],
                                o = [],
                                a = function (e, t, r) {
                                  e.getTransportStats()
                                    .then(function (e) {
                                      -1 ===
                                        o.findIndex(function (e) {
                                          return e.userId === t;
                                        }) &&
                                        o.push({
                                          userId: t,
                                          packetLossRate: r,
                                          rtt: e,
                                        });
                                    })
                                    .catch(function () {
                                      -1 ===
                                        o.findIndex(function (e) {
                                          return e.userId === t;
                                        }) &&
                                        o.push({
                                          userId: t,
                                          packetLossRate: -1,
                                          rtt: -1,
                                        });
                                    });
                                },
                                s = jr(t.subscriptions.values());
                              try {
                                for (s.s(); !(r = s.n()).done; ) {
                                  var c = r.value,
                                    u = c.subscriber.userId,
                                    d = 0;
                                  if (t.receiverStats.has(u)) {
                                    var l = t.receiverStats.get(u);
                                    l.video.timestamp
                                      ? a(
                                          c.subscriber,
                                          u,
                                          (d = l.video.packetLossRate),
                                        )
                                      : l.audio.timestamp &&
                                        a(
                                          c.subscriber,
                                          u,
                                          (d = l.audio.packetLossRate),
                                        );
                                  }
                                  (n.push(d),
                                    i.push(c.subscriber.getTransportStats()));
                                }
                              } catch (e) {
                                s.e(e);
                              } finally {
                                s.f();
                              }
                              Promise.all(i).then(function (r) {
                                j(t._remoteMutedStateMap.keys()).forEach(
                                  function (e) {
                                    -1 ===
                                      o.findIndex(function (t) {
                                        return t.userId === e;
                                      }) &&
                                      o.push({
                                        userId: e,
                                        packetLossRate: -1,
                                        rtt: -1,
                                      });
                                  },
                                );
                                var i =
                                    r.length > 0
                                      ? r.reduce(function (e, t) {
                                          return e + t;
                                        }) / r.length
                                      : -1,
                                  a =
                                    n.length > 0
                                      ? n.reduce(function (e, t) {
                                          return e + t;
                                        }) / n.length
                                      : -1;
                                e({ packetLossRate: a, rtt: i, list: o });
                              });
                            } catch (r) {
                              var h = j(t._remoteMutedStateMap.keys()).map(
                                function (e) {
                                  return {
                                    userId: e,
                                    packetLossRate: -1,
                                    rtt: -1,
                                  };
                                },
                              );
                              e({ packetLossRate: -1, rtt: -1, list: h });
                            }
                          }),
                        );
                      case 1:
                      case "end":
                        return e.stop();
                    }
                }, e);
              }),
            )),
            function () {
              return s.apply(this, arguments);
            }),
        },
        {
          key: "getNetworkQuality",
          value: function () {
            var e = this;
            if (-1 === this._interval) {
              var t = {
                uplinkNetworkQuality: 0,
                downlinkNetworkQuality: 0,
                downlinkNetworkQualityList: [],
              };
              this._interval = window.setInterval(function () {
                if (e.xsigoClient) {
                  var r,
                    i = e.xsigoClient.getWsState(e.roomId),
                    n = i || {},
                    o = n.state;
                  (i &&
                  ("DISCONNECTED" === o ||
                    "RECONNECTING" === o ||
                    ("CONNECTING" === o && "RECONNECTING" === n.prevState))
                    ? ((t.uplinkNetworkQuality = 6),
                      (t.downlinkNetworkQuality = 6),
                      (t.downlinkNetworkQualityList = j(
                        e._remoteMutedStateMap.keys(),
                      ).map(function (e) {
                        return { userId: e, downlinkNetworkQuality: 6 };
                      })))
                    : (e
                        .getTransportStats()
                        .then(function (r) {
                          t.uplinkNetworkQuality = e.networkLevel(
                            r.packetLossRate,
                            r.rtt,
                          );
                        })
                        .catch(function () {
                          t.uplinkNetworkQuality = 0;
                        }),
                      e
                        .getRemoteTransportStats()
                        .then(function (r) {
                          ((t.downlinkNetworkQuality = e.networkLevel(
                            r.packetLossRate,
                            r.rtt,
                          )),
                            r.list &&
                              (t.downlinkNetworkQualityList = r.list.map(
                                function (t) {
                                  return {
                                    userId: t.userId,
                                    downlinkNetworkQuality: e.networkLevel(
                                      t.packetLossRate,
                                      t.rtt,
                                    ),
                                  };
                                },
                              )));
                        })
                        .catch(function (e) {
                          ((t.downlinkNetworkQuality = 0),
                            (t.downlinkNetworkQualityList = e.list.map(
                              function (e) {
                                return {
                                  userId: e.userId,
                                  downlinkNetworkQuality: 0,
                                };
                              },
                            )));
                        })),
                    (t.uplinkNetworkQuality >= 3 ||
                      t.downlinkNetworkQuality >= 3) &&
                      e.logger.warn(
                        "network-quality",
                        JSON.stringify(t, null, 4),
                      ),
                    e._emitter.emit("network-quality", t),
                    null !== (r = e.appConfig) &&
                      void 0 !== r &&
                      r.enableEvent &&
                      (e.getSenderStats(), e.getReceiverStats()));
                }
              }, 2e3);
            } else
              this.logger.warn(
                "network quality calculating is already started",
              );
          },
        },
        {
          key: "getSenderStats",
          value:
            ((a = V(
              H.mark(function e() {
                var t,
                  r,
                  i,
                  n,
                  o,
                  a,
                  s,
                  c,
                  u,
                  d,
                  l,
                  h,
                  p,
                  f,
                  m,
                  v,
                  g,
                  y,
                  b,
                  S,
                  E,
                  C,
                  T,
                  R,
                  I,
                  _,
                  k,
                  w,
                  O,
                  P,
                  A,
                  L,
                  x,
                  D,
                  M,
                  N,
                  V,
                  j,
                  F,
                  B,
                  W,
                  G,
                  J,
                  z,
                  K;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          ((t = jr(this.publications.entries())),
                            (e.prev = 1),
                            t.s());
                        case 3:
                          if ((r = t.n()).done) {
                            e.next = 27;
                            break;
                          }
                          ((i = U(r.value, 2)),
                            (n = i[0]),
                            (o = i[1]),
                            (e.t0 = H.keys(this.localStreams)));
                        case 6:
                          if ((e.t1 = e.t0()).done) {
                            e.next = 25;
                            break;
                          }
                          if (
                            ((s = (a = this.localStreams[e.t1.value]).screen
                              ? "share_".concat(a.getUserId())
                              : a.getUserId()),
                            this.senderStats.has(s) ||
                              this.senderStats.set(s, {
                                audio: {
                                  bytesSent: 0,
                                  timestamp: 0,
                                  retransmittedPacketsSent: 0,
                                  packetsSent: 0,
                                  packetLossRate: 0,
                                },
                                video: {
                                  bytesSent: 0,
                                  timestamp: 0,
                                  retransmittedPacketsSent: 0,
                                  packetsSent: 0,
                                  packetLossRate: 0,
                                },
                                smallVideo: {
                                  bytesSent: 0,
                                  timestamp: 0,
                                  retransmittedPacketsSent: 0,
                                  packetsSent: 0,
                                  packetLossRate: 0,
                                },
                              }),
                            !a.audioStreamId ||
                              a.audioStreamId !== n ||
                              a.screen)
                          ) {
                            e.next = 18;
                            break;
                          }
                          return (
                            (c = this.senderStats.get(s)),
                            (d = (u = c.audio).bytesSent),
                            (l = u.timestamp),
                            (h = u.retransmittedPacketsSent),
                            (p = u.packetsSent),
                            (e.next = 16),
                            o.getLocalStats("audio")
                          );
                        case 16:
                          (f = e.sent) &&
                            ((v = (f.timestamp - l) / 1e3),
                            (y =
                              (g = (m = f.audio).bytesSent - d) <= 0
                                ? 0
                                : Number(((8 * g) / v / 1024).toFixed(2))),
                            (S =
                              (b = m.retransmittedPacketsSent - h) <= 0
                                ? 0
                                : parseFloat(
                                    (b / (m.packetsSent - p)).toFixed(6),
                                  )),
                            this.senderStats.set(
                              s,
                              Vr(
                                Vr({}, c),
                                {},
                                {
                                  audio: {
                                    bytesSent: m.bytesSent,
                                    timestamp: f.timestamp,
                                    packetsSent: m.packetsSent,
                                    retransmittedPacketsSent:
                                      m.retransmittedPacketsSent,
                                    packetLossRate: S,
                                  },
                                },
                              ),
                            ),
                            this.logger.mediaLog({
                              med_type: "mic",
                              pub: !0,
                              ruid: this.roomUniqueId,
                              uid: this.userId,
                              streams: [{ rate: y, lost: S, rtt: f.rtt }],
                            }),
                            (E = this.xsigoClient.getWsState(this.roomId)),
                            ["CONNECTED", "RECOVERY"].includes(
                              (E || {}).state,
                            ) &&
                              0 === m.bytesSent &&
                              o.updateBytesSentIs0Count("audio"));
                        case 18:
                          if (!a.videoStreamId || a.videoStreamId !== n) {
                            e.next = 23;
                            break;
                          }
                          return ((e.next = 21), o.getLocalStats("video"));
                        case 21:
                          (C = e.sent) &&
                            ((T = {
                              med_type: a.screen ? "screen" : "camera",
                              pub: !0,
                              ruid: this.roomUniqueId,
                              uid: this.userId,
                              sess_id: n,
                              streams: [],
                            }),
                            (R = this.senderStats.get(s)),
                            (k = (I = R.video).retransmittedPacketsSent),
                            (w = I.packetsSent),
                            (P = (C.timestamp - I.timestamp) / 1e3),
                            (L =
                              (A =
                                (O = C.video).bytesSent - (_ = I.bytesSent)) <=
                              0
                                ? 0
                                : ((8 * A) / P / 1024).toFixed(2)),
                            this.logger.debug(
                              "video vStats.bytesSent:"
                                .concat(O.bytesSent, ",bytesSent:")
                                .concat(_, ",bitrate:")
                                .concat(L),
                            ),
                            (D =
                              (x = O.retransmittedPacketsSent - k) <= 0
                                ? 0
                                : parseFloat(
                                    (x / (O.packetsSent - w)).toFixed(6),
                                  )),
                            T.streams.push({
                              rate: L,
                              lost: D,
                              rtt: C.rtt,
                              fps: O.framesPerSecond,
                              rid: O.rid,
                              width: O.frameWidth,
                              height: O.frameHeight,
                            }),
                            (M = R.smallVideo),
                            !a.screen &&
                              this.isEnableSmallStream &&
                              ((V = (N = M).retransmittedPacketsSent),
                              (j = N.packetsSent),
                              (B = (C.timestamp - N.timestamp) / 1e3),
                              (G =
                                (W =
                                  (F = C.smallVideo).bytesSent - N.bytesSent) <=
                                0
                                  ? 0
                                  : ((8 * W) / B / 1024).toFixed(2)),
                              (z =
                                (J = F.retransmittedPacketsSent - V) <= 0
                                  ? 0
                                  : parseFloat(
                                      (J / (F.packetsSent - j)).toFixed(6),
                                    )),
                              (M = {
                                bytesSent: F.bytesSent,
                                timestamp: C.timestamp,
                                packetsSent: F.packetsSent,
                                retransmittedPacketsSent:
                                  F.retransmittedPacketsSent,
                                packetLossRate: z,
                              }),
                              T.streams.push({
                                rate: G,
                                lost: z,
                                rtt: C.rtt,
                                fps: F.framesPerSecond,
                                rid: F.rid,
                                width: F.frameWidth,
                                height: F.frameHeight,
                              })),
                            this.senderStats.set(
                              s,
                              Vr(
                                Vr({}, R),
                                {},
                                {
                                  video: {
                                    bytesSent: O.bytesSent,
                                    timestamp: C.timestamp,
                                    packetsSent: O.packetsSent,
                                    retransmittedPacketsSent:
                                      O.retransmittedPacketsSent,
                                    packetLossRate: D,
                                  },
                                  smallVideo: M,
                                },
                              ),
                            ),
                            this.logger.mediaLog(T),
                            (K = this.xsigoClient.getWsState(this.roomId)),
                            ["CONNECTED", "RECOVERY"].includes(
                              (K || {}).state,
                            ) &&
                              0 === O.bytesSent &&
                              o.updateBytesSentIs0Count("video"));
                        case 23:
                          e.next = 6;
                          break;
                        case 25:
                          e.next = 3;
                          break;
                        case 27:
                          e.next = 32;
                          break;
                        case 29:
                          ((e.prev = 29), (e.t2 = e.catch(1)), t.e(e.t2));
                        case 32:
                          return ((e.prev = 32), t.f(), e.finish(32));
                        case 35:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                  [[1, 29, 32, 35]],
                );
              }),
            )),
            function () {
              return a.apply(this, arguments);
            }),
        },
        {
          key: "getReceiverStats",
          value:
            ((o = V(
              H.mark(function e() {
                var t,
                  r,
                  i,
                  n,
                  o,
                  a,
                  s,
                  c,
                  u,
                  d,
                  l,
                  h,
                  p,
                  f,
                  m,
                  v,
                  g,
                  y,
                  b,
                  S,
                  E,
                  C,
                  T,
                  R,
                  I,
                  _,
                  k,
                  w,
                  O,
                  P,
                  A,
                  L,
                  x,
                  D,
                  M,
                  N,
                  V,
                  j,
                  F,
                  B,
                  W;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          ((t = jr(this.subscriptions.entries())),
                            (e.prev = 1),
                            t.s());
                        case 3:
                          if ((r = t.n()).done) {
                            e.next = 25;
                            break;
                          }
                          if (
                            ((i = U(r.value, 2)),
                            (n = i[0]),
                            (a = (o = i[1]).stream.getUserSeq()),
                            (s = o.stream.getUserId()),
                            this.receiverStats.has(a) ||
                              this.receiverStats.set(a, {
                                audio: {
                                  bytesReceived: 0,
                                  timestamp: 0,
                                  packetsReceived: 0,
                                  packetsLost: 0,
                                  nackCount: 0,
                                  packetLossRate: 0,
                                },
                                video: {
                                  bytesReceived: 0,
                                  timestamp: 0,
                                  packetsReceived: 0,
                                  packetsLost: 0,
                                  nackCount: 0,
                                  packetLossRate: 0,
                                },
                              }),
                            (c = o.stream.getType()),
                            n !== o.stream.audioSubscriptionId || c === Q)
                          ) {
                            e.next = 16;
                            break;
                          }
                          return (
                            (u = this.receiverStats.get(a)),
                            (l = (d = u.audio).bytesReceived),
                            (h = d.timestamp),
                            (p = d.packetsLost),
                            (f = d.packetsReceived),
                            (m = d.nackCount),
                            (e.next = 14),
                            o.subscriber.getRemoteAudioOrVideoStats("audio")
                          );
                        case 14:
                          (v = e.sent) &&
                            ((y = (v.timestamp - h) / 1e3),
                            (S =
                              (b = (g = v.audio).bytesReceived - l) <= 0
                                ? 0
                                : Number(((8 * b) / y / 1024).toFixed(2))),
                            (E = g.packetsLost - p),
                            (C = g.packetsReceived - f),
                            0,
                            (R =
                              (T = g.nackCount - m) <= 0 || C <= 0
                                ? 0
                                : T > C
                                  ? 100
                                  : E < 0
                                    ? parseFloat((T / C).toFixed(6))
                                    : parseFloat(
                                        ((E + T) / (E + C)).toFixed(6),
                                      )),
                            this.receiverStats.set(
                              a,
                              Vr(
                                Vr({}, u),
                                {},
                                {
                                  audio: {
                                    bytesReceived: g.bytesReceived,
                                    timestamp: v.timestamp,
                                    packetsReceived: g.packetsReceived,
                                    packetsLost: g.packetsLost,
                                    nackCount: g.nackCount,
                                    packetLossRate: R,
                                  },
                                },
                              ),
                            ),
                            this.logger.mediaLog({
                              med_type: "mic",
                              pub: !1,
                              ruid: this.roomUniqueId,
                              uid: s,
                              streams: [{ rate: S, lost: R, rtt: v.rtt }],
                            }));
                        case 16:
                          if (n !== o.stream.videoSubscriptionId) {
                            e.next = 23;
                            break;
                          }
                          return (
                            (I = this.receiverStats.get(a)),
                            (k = (_ = I.video).bytesReceived),
                            (w = _.timestamp),
                            (O = _.packetsLost),
                            (P = _.packetsReceived),
                            (A = _.nackCount),
                            (e.next = 21),
                            o.subscriber.getRemoteAudioOrVideoStats("video")
                          );
                        case 21:
                          (L = e.sent) &&
                            ((D = (L.timestamp - w) / 1e3),
                            (N =
                              (M = (x = L.video).bytesReceived - k) <= 0
                                ? 0
                                : Number(((8 * M) / D / 1024).toFixed(2))),
                            (V = x.packetsLost - O),
                            (j = x.packetsReceived - P),
                            0,
                            (B =
                              (F = x.nackCount - A) <= 0 || j <= 0
                                ? 0
                                : F > j
                                  ? 100
                                  : V < 0
                                    ? parseFloat((F / j).toFixed(6))
                                    : parseFloat(
                                        ((V + F) / (V + j)).toFixed(6),
                                      )),
                            this.receiverStats.set(
                              a,
                              Vr(
                                Vr({}, I),
                                {},
                                {
                                  video: {
                                    bytesReceived: x.bytesReceived,
                                    timestamp: L.timestamp,
                                    packetsReceived: x.packetsReceived,
                                    packetsLost: x.packetsLost,
                                    nackCount: x.nackCount,
                                    packetLossRate: B,
                                  },
                                },
                              ),
                            ),
                            (W = o.stream.getSimulcastType()),
                            this.logger.mediaLog({
                              med_type: c !== Q ? "camera" : "screen",
                              pub: !1,
                              ruid: this.roomUniqueId,
                              uid: s,
                              streams: [
                                {
                                  rate: N,
                                  lost: B,
                                  rtt: L.rtt,
                                  fps: x.framesPerSecond,
                                  rid: W === Ae.SmallStream ? "l" : "h",
                                  width: x.frameWidth,
                                  height: x.frameHeight,
                                },
                              ],
                            }));
                        case 23:
                          e.next = 3;
                          break;
                        case 25:
                          e.next = 30;
                          break;
                        case 27:
                          ((e.prev = 27), (e.t0 = e.catch(1)), t.e(e.t0));
                        case 30:
                          return ((e.prev = 30), t.f(), e.finish(30));
                        case 33:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                  [[1, 27, 30, 33]],
                );
              }),
            )),
            function () {
              return o.apply(this, arguments);
            }),
        },
        {
          key: "networkLevel",
          value: function (e, t) {
            return e > 50 || t > 500
              ? 5
              : e > 30 || t > 350
                ? 4
                : e > 20 || t > 200
                  ? 3
                  : e > 10 || t > 100
                    ? 2
                    : e >= 0 || t >= 0
                      ? 1
                      : 0;
          },
        },
        {
          key: "getLocalAudioStats",
          value: function () {
            return this.getLocalStatsMap("audio");
          },
        },
        {
          key: "getLocalVideoStats",
          value: function () {
            return this.getLocalStatsMap("video");
          },
        },
        {
          key: "getLocalStatsMap",
          value:
            ((n = V(
              H.mark(function e(t) {
                var r, i, n, o, a, s, c, u, d, l, h, p, f, m, v, g, y, b;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (
                            this.localStreams.some(function (e) {
                              return (
                                e.published &&
                                ("audio" === t
                                  ? e.audioStreamId
                                  : e.videoStreamId)
                              );
                            })
                          ) {
                            e.next = 3;
                            break;
                          }
                          throw new de({
                            code: te.INVALID_OPERATION,
                            message: "local stream is not published",
                          });
                        case 3:
                          ((r = new Map()),
                            (e.prev = 4),
                            (i = jr(this.publications.entries())),
                            (e.prev = 6),
                            i.s());
                        case 8:
                          if ((n = i.n()).done) {
                            e.next = 25;
                            break;
                          }
                          ((o = U(n.value, 2)),
                            (a = o[0]),
                            (s = o[1]),
                            (e.t0 = H.keys(this.localStreams)));
                        case 11:
                          if ((e.t1 = e.t0()).done) {
                            e.next = 23;
                            break;
                          }
                          if (
                            ((c = this.localStreams[e.t1.value]),
                            !("audio" === t
                              ? c.audioStreamId === a
                              : c.videoStreamId === a))
                          ) {
                            e.next = 21;
                            break;
                          }
                          return (
                            (u = c.screen
                              ? "share_".concat(c.getUserId())
                              : c.getUserId()),
                            (e.next = 18),
                            s.getLocalStats(t)
                          );
                        case 18:
                          ((d = e.sent),
                            "audio" === t &&
                              d &&
                              (this.senderLocalStats.has(u) ||
                                this.senderLocalStats.set(u, {
                                  audio: {
                                    bytesSent: 0,
                                    timestamp: 0,
                                    packetsSent: 0,
                                  },
                                }),
                              (l = this.senderLocalStats.get(u)),
                              (f = (h = d[t]).packetsSent),
                              (m = (d.timestamp - l.audio.timestamp) / 1e3),
                              (g =
                                (v = (p = h.bytesSent) - l.audio.bytesSent) <= 0
                                  ? 0
                                  : Number(((8 * v) / m / 1024).toFixed())),
                              r.set(u, {
                                bytesSent: p,
                                packetsSent: f,
                                bitrate: g,
                              }),
                              this.senderLocalStats.set(
                                c.getUserId(),
                                Vr(
                                  Vr({}, l),
                                  {},
                                  {
                                    audio: {
                                      bytesSent: p,
                                      timestamp: d.timestamp,
                                      packetsSent: f,
                                    },
                                  },
                                ),
                              )),
                            "video" === t &&
                              d &&
                              r.set(u, {
                                bytesSent: (y = d[t]).bytesSent,
                                packetsSent: y.packetsSent,
                                framesEncoded: y.framesEncoded,
                                frameWidth: y.frameWidth,
                                frameHeight: y.frameHeight,
                                framesSent: y.framesSent,
                              }));
                        case 21:
                          e.next = 11;
                          break;
                        case 23:
                          e.next = 8;
                          break;
                        case 25:
                          e.next = 30;
                          break;
                        case 27:
                          ((e.prev = 27), (e.t2 = e.catch(6)), i.e(e.t2));
                        case 30:
                          return ((e.prev = 30), i.f(), e.finish(30));
                        case 33:
                          return e.abrupt("return", Promise.resolve(r));
                        case 36:
                          return (
                            (e.prev = 36),
                            (e.t3 = e.catch(4)),
                            this.logger.info(
                              "Get local ".concat(t, " stats failed"),
                              e.t3,
                            ),
                            this.logger.onError({
                              c: Xe.TOP_ERROR,
                              v:
                                "audio" === t
                                  ? te.LOCAL_AUDIO_STATA_ERROR
                                  : te.LOCAL_VIDEO_STATA_ERROR,
                            }),
                            (b = new de({
                              code:
                                "audio" === t
                                  ? te.LOCAL_AUDIO_STATA_ERROR
                                  : te.LOCAL_VIDEO_STATA_ERROR,
                              message: e.t3.message,
                            })),
                            e.abrupt("return", Promise.reject(b))
                          );
                        case 42:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                  [
                    [4, 36],
                    [6, 27, 30, 33],
                  ],
                );
              }),
            )),
            function (e) {
              return n.apply(this, arguments);
            }),
        },
        {
          key: "getRemoteAudioStats",
          value: function () {
            var e = this;
            return new Promise(
              (function () {
                var t = V(
                  H.mark(function t(r, i) {
                    var n, o, a, s, c, u, d, l, h;
                    return H.wrap(
                      function (t) {
                        for (;;)
                          switch ((t.prev = t.next)) {
                            case 0:
                              ((n = new Map()),
                                (t.prev = 1),
                                e.logger.info(
                                  "get remote audio Stats",
                                  e.subscriptions,
                                ),
                                (o = jr(e.subscriptions.entries())),
                                (t.prev = 4),
                                o.s());
                            case 6:
                              if ((a = o.n()).done) {
                                t.next = 16;
                                break;
                              }
                              if (
                                ((s = U(a.value, 2)),
                                (c = s[0]),
                                (d = (u = s[1]).stream.getUserSeq()),
                                c !== u.stream.audioSubscriptionId)
                              ) {
                                t.next = 14;
                                break;
                              }
                              return (
                                (t.next = 12),
                                u.subscriber.getRemoteAudioOrVideoStats("audio")
                              );
                            case 12:
                              (l = t.sent) && n.set(d, l.audio);
                            case 14:
                              t.next = 6;
                              break;
                            case 16:
                              t.next = 21;
                              break;
                            case 18:
                              ((t.prev = 18), (t.t0 = t.catch(4)), o.e(t.t0));
                            case 21:
                              return ((t.prev = 21), o.f(), t.finish(21));
                            case 24:
                              (r(n), (t.next = 32));
                              break;
                            case 27:
                              ((t.prev = 27),
                                (t.t1 = t.catch(1)),
                                e.logger.onError(
                                  {
                                    c: Xe.TOP_ERROR,
                                    v: te.REMOTE_AUDIO_STATA_ERROR,
                                  },
                                  "Get Remote Audio Stats Failed, ".concat(
                                    t.t1,
                                  ),
                                ),
                                (h = new de({
                                  code: te.REMOTE_AUDIO_STATA_ERROR,
                                  message: t.t1.message,
                                })),
                                i(h));
                            case 32:
                            case "end":
                              return t.stop();
                          }
                      },
                      t,
                      null,
                      [
                        [1, 27],
                        [4, 18, 21, 24],
                      ],
                    );
                  }),
                );
                return function (e, r) {
                  return t.apply(this, arguments);
                };
              })(),
            );
          },
        },
        {
          key: "getRemoteVideoStats",
          value: function () {
            var e = this;
            return new Promise(
              (function () {
                var t = V(
                  H.mark(function t(r, i) {
                    var n, o, a, s, c, u, d, l, h, p;
                    return H.wrap(
                      function (t) {
                        for (;;)
                          switch ((t.prev = t.next)) {
                            case 0:
                              ((n = new Map()),
                                (t.prev = 1),
                                e.logger.info(
                                  "get remote video Stats",
                                  e.subscriptions,
                                ),
                                (o = jr(e.subscriptions.entries())),
                                (t.prev = 4),
                                o.s());
                            case 6:
                              if ((a = o.n()).done) {
                                t.next = 16;
                                break;
                              }
                              if (
                                ((s = U(a.value, 2)),
                                (c = s[0]),
                                (d = (u = s[1]).stream.getUserSeq()),
                                c !== u.stream.videoSubscriptionId)
                              ) {
                                t.next = 14;
                                break;
                              }
                              return (
                                (t.next = 12),
                                u.subscriber.getRemoteAudioOrVideoStats("video")
                              );
                            case 12:
                              (l = t.sent) &&
                                n.set(d, {
                                  bytesReceived: (h = l.video).bytesReceived,
                                  packetsReceived: h.packetsReceived,
                                  packetsLost: h.packetsLost,
                                  framesDecoded: h.framesDecoded,
                                  frameWidth: h.frameWidth,
                                  frameHeight: h.frameHeight,
                                });
                            case 14:
                              t.next = 6;
                              break;
                            case 16:
                              t.next = 21;
                              break;
                            case 18:
                              ((t.prev = 18), (t.t0 = t.catch(4)), o.e(t.t0));
                            case 21:
                              return ((t.prev = 21), o.f(), t.finish(21));
                            case 24:
                              (r(n), (t.next = 32));
                              break;
                            case 27:
                              ((t.prev = 27),
                                (t.t1 = t.catch(1)),
                                e.logger.onError(
                                  {
                                    c: Xe.TOP_ERROR,
                                    v: te.REMOTE_VIDEO_STATA_ERROR,
                                  },
                                  "Get Remote Video Stats Failed, ".concat(
                                    t.t1,
                                  ),
                                ),
                                (p = new de({
                                  code: te.REMOTE_VIDEO_STATA_ERROR,
                                  message: t.t1.message,
                                })),
                                i(p));
                            case 32:
                            case "end":
                              return t.stop();
                          }
                      },
                      t,
                      null,
                      [
                        [1, 27],
                        [4, 18, 21, 24],
                      ],
                    );
                  }),
                );
                return function (e, r) {
                  return t.apply(this, arguments);
                };
              })(),
            );
          },
        },
        {
          key: "onWsStateChange",
          value: function (e, t, r) {
            (this.logger.info("Ws state from ".concat(t, " to ").concat(r)),
              this._emitter.emit("connection-state-changed", {
                state: r,
                prevState: t,
              }));
          },
        },
        {
          key: "onError",
          value: function (e) {
            (this.logger.buriedLog({ c: Xe.ON_ERROR, v: "".concat(e.message) }),
              this._emitter.emit($, e));
          },
        },
        {
          key: "onWsReconnectFailed",
          value: function (e) {
            (this.logger.warn("room: ".concat(e, " reconnection failed")),
              this.logger.onError({
                c: Xe.TOP_ERROR,
                v: te.SIGNAL_CHANNEL_RECONNECTION_FAILED,
              }));
            var t = new de({
              code: te.SIGNAL_CHANNEL_RECONNECTION_FAILED,
              message:
                "signal channel reconnection failed, please check your network",
            });
            (this._emitter.emit($, t), this.leave());
          },
        },
        {
          key: "onParticipantLeave",
          value: function (e) {
            var t = this;
            this.logger.info("======notification: ".concat(e, " leave======"));
            try {
              var r = "share_".concat(e),
                i = this.remoteStreams.get(e),
                n = this.remoteStreams.get(r),
                o = function (r, i) {
                  (t.logger.buriedLog({
                    c:
                      r.type === Q
                        ? Xe.ON_STREAM_REMOVED_SCREEN
                        : Xe.ON_STREAM_REMOVED,
                    v: "uid:".concat(e),
                  }),
                    t._emitter.emit("stream-removed", { stream: r }),
                    r.close(),
                    t.remoteStreams.delete(i),
                    t.subscribeManager.subscriptedState.delete(i),
                    t.receiverStats.has(i) && t.receiverStats.delete(i));
                  var n,
                    o = jr(t.subscriptions.entries());
                  try {
                    for (o.s(); !(n = o.n()).done; ) {
                      var a = U(n.value, 2),
                        s = a[0],
                        c = a[1];
                      [r.audioSubscriptionId, r.videoSubscriptionId].includes(
                        s,
                      ) && (c.subscriber.close(), t.subscriptions.delete(s));
                    }
                  } catch (e) {
                    o.e(e);
                  } finally {
                    o.f();
                  }
                };
              (i && o(i, e),
                n && o(n, r),
                this._remoteMutedStateMap.has(e) &&
                  this._remoteMutedStateMap.delete(e));
            } catch (e) {
              this.logger.info(e);
            }
            (this.logger.buriedLog({
              c: Xe.ON_PEER_LEVAE,
              v: "uid:".concat(e),
            }),
              this._emitter.emit("peer-leave", { userId: e }));
          },
        },
        {
          key: "onStreamAdd",
          value: function (e) {
            var t = e || {},
              r = t.userId,
              i = t.streamId,
              n = t.info,
              o = t.mixedInfo,
              a = n || {},
              s = a.audio,
              c = a.video;
            if (
              (this.logger.info("time  Date.now stream-add", Date.now()),
              r !== this.userId)
            ) {
              var u = (s || c || {}).source;
              u === Pe.ScreenShare && (r = "share_".concat(r));
              var d = this.remoteStreams.get(r);
              if ((this.logger.info("userId: " + r, "remote stream", d), d)) {
                var l = this.subscribeManager.needSubscribeKind(r),
                  h = this.subscribeManager.getSubscriptionOpts(r);
                this.logger.info("userId: " + r, l, h, null, 4);
                var p = { audio: !1, video: !1, small: h.small };
                if (
                  (l === ke.AudioOnly && (p.audio = !0),
                  l === ke.VideoOnly && (p.video = !0),
                  l === ke.AudioVideo && ((p.audio = !0), (p.video = !0)),
                  s &&
                    (d.setAudio(!!s),
                    d.setHasAudio(!!s),
                    d.setAudioStreamId(i),
                    d.setMutedState("audio", s.muted),
                    this.updateRemoteMutedState(r, {
                      hasAudio: !0,
                      audioMuted: s.muted,
                    })),
                  c)
                ) {
                  (d.setVideo(!!c),
                    d.setHasVideo(!!c),
                    d.setVideoStreamId(i),
                    d.setInfo(n));
                  var f = (c.simulcast || []).find(function (e) {
                    return e.type === Ae.SmallStream;
                  });
                  (d.setMutedState("video", c.muted),
                    this.updateRemoteMutedState(r, {
                      hasVideo: !0,
                      videoMuted: c.muted,
                      hasSmall: !!f,
                    }));
                }
                (this._emitter.emit("stream-updated", { stream: d }),
                  this.logger.info("Auto subscribe options", JSON.stringify(p)),
                  (p.audio || p.video) && this.doSubscribe(d, p));
              } else {
                if (
                  ((d = new bt(
                    {
                      userId: r,
                      type: u === Pe.ScreenShare ? Q : "main",
                      info: n,
                      mixedInfo: o,
                    },
                    this.logger,
                  )),
                  u === Pe.ScreenShare && d.setLocalUserId(this.userId),
                  (d.streamId = i),
                  this.remoteStreams.set(r, d),
                  s &&
                    (d.setAudio(!!s),
                    d.setHasAudio(!!s),
                    d.setAudioStreamId(i),
                    d.setMutedState("audio", s.muted),
                    this.updateRemoteMutedState(r, {
                      hasAudio: !0,
                      audioMuted: s.muted,
                    })),
                  c)
                ) {
                  (d.setVideo(!!c), d.setHasVideo(!!c), d.setVideoStreamId(i));
                  var m = (c.simulcast || []).find(function (e) {
                    return e.type === Ae.SmallStream;
                  });
                  (d.setMutedState("video", c.muted),
                    this.updateRemoteMutedState(r, {
                      hasVideo: !0,
                      videoMuted: c.muted,
                      hasSmall: !!m,
                    }));
                }
                (this.logger.buriedLog({
                  c:
                    d.type === Q
                      ? Xe.ON_STREAM_ADDED_SCREEN
                      : Xe.ON_STREAM_ADDED,
                  v: "uid:".concat(d.getUserId()),
                }),
                  this._emitter.emit("stream-added", { stream: d }));
              }
            }
          },
        },
        {
          key: "onStreamChange",
          value: function (e, t) {
            var r = e;
            (this.getType(t) === Q &&
              ((r = "share_".concat(r)),
              this.remoteStreams.get(r).closeWaterMark()),
              this.logger.info("time  Date.now stream-remove", Date.now()));
            var i = this.remoteStreams.get(r);
            if (r !== this.userId && r !== "share_".concat(r) && i) {
              var n = this.subscribeManager.getSubscriptedState(r);
              if (i && i.getStreamKind(t) === ke.AudioOnly) {
                if (!i.videoStreamId) return void this.doStreamRemove(r);
                if (i.audioStreamId) {
                  if (i.hasAudio()) {
                    var o = i.getAudioTrack();
                    o && i.mediaStream.removeTrack(o);
                  }
                  ((n.audio = !1),
                    i.setHasAudio(!1),
                    i.setAudioStreamId(null),
                    this.subscriptions.has(i.audioSubscriptionId) &&
                      (this.subscriptions
                        .get(i.audioSubscriptionId)
                        .subscriber.close(),
                      this.subscriptions.delete(i.audioSubscriptionId),
                      i.setAudioSubscriptionId(null)),
                    i.setMutedState("audio", !0),
                    this.updateRemoteMutedState(r, {
                      hasAudio: !1,
                      audioMuted: !0,
                    }),
                    this.receiverStats.has(r) &&
                      (this.receiverStats.get(r).audio = {
                        bytesReceived: 0,
                        timestamp: 0,
                        packetsReceived: 0,
                        packetsLost: 0,
                        nackCount: 0,
                        packetLossRate: 0,
                      }),
                    this._emitter.emit("mute-audio", { userId: r }));
                }
              }
              if (i && i.getStreamKind(t) === ke.VideoOnly) {
                if (!i.audioStreamId) return void this.doStreamRemove(r);
                if (i.videoStreamId) {
                  if (i.hasVideo()) {
                    var a = i.getVideoTrack();
                    a && i.mediaStream.removeTrack(a);
                  }
                  ((n.video = !1),
                    i.setHasVideo(!1),
                    i.setVideoStreamId(null),
                    this.subscriptions.has(i.videoSubscriptionId) &&
                      (this.subscriptions
                        .get(i.videoSubscriptionId)
                        .subscriber.close(),
                      this.subscriptions.delete(i.videoSubscriptionId),
                      i.setVideoSubscriptionId(null)),
                    i.setSimulcasts([]),
                    i.setMutedState("video", !0),
                    this.updateRemoteMutedState(r, {
                      hasVideo: !1,
                      videoMuted: !0,
                      hasSmall: !1,
                    }),
                    this.receiverStats.has(r) &&
                      (this.receiverStats.get(r).video = {
                        bytesReceived: 0,
                        timestamp: 0,
                        packetsReceived: 0,
                        packetsLost: 0,
                        nackCount: 0,
                        packetLossRate: 0,
                      }),
                    this._emitter.emit("mute-video", { userId: r }));
                }
              }
              (this.subscribeManager.updateSubscriptedState(r, n),
                this._emitter.emit("stream-updated", { stream: i }));
            }
          },
        },
        {
          key: "doStreamRemove",
          value: function (e) {
            var t = this,
              r = this.remoteStreams.get(e),
              i = this.subscribeManager.getSubscriptedState(e);
            if (
              ((i.audio = !1),
              (i.video = !1),
              this.subscribeManager.updateSubscriptedState(e, i),
              r)
            ) {
              (r.getType() === Q && r.closeWaterMark(),
                r.setAudioStreamId(null),
                r.setVideoStreamId(null),
                r.setMutedState("audio", !0),
                r.setMutedState("video", !0),
                this.remoteStreams.delete(e),
                this.logger.info(
                  "time  Date.now delete remoteStreams",
                  Date.now(),
                  r.audioSubscriptionId,
                  r.videoSubscriptionId,
                ),
                this.receiverStats.has(e) && this.receiverStats.delete(e));
              var n = [];
              (r.audioSubscriptionId && n.push(r.audioSubscriptionId),
                r.videoSubscriptionId && n.push(r.videoSubscriptionId),
                n.forEach(function (e) {
                  t.subscriptions.has(e) &&
                    (t.subscriptions.get(e).subscriber.close(),
                    t.subscriptions.delete(e),
                    e === r.audioSubscriptionId &&
                      r.setAudioSubscriptionId(null),
                    e === r.videoSubscriptionId &&
                      r.setVideoSubscriptionId(null));
                }),
                this.logger.info("do stream remove with ", this.subscriptions),
                this.logger.buriedLog({
                  c:
                    r.type === Q
                      ? Xe.ON_STREAM_REMOVED_SCREEN
                      : Xe.ON_STREAM_REMOVED,
                  v: "uid:".concat(r.getUserId()),
                }),
                this.updateRemoteMutedState(e),
                this._emitter.emit("stream-removed", { stream: r }));
            }
          },
        },
        {
          key: "onClientBanned",
          value: function (e) {
            var t = this;
            this.logger.buriedLog(
              { c: Xe.ON_CLIENT_BANNED, v: "cause:".concat(e) },
              !0,
            );
            var r,
              i = jr(this.publications.entries());
            try {
              var n = function () {
                var e = U(r.value, 2),
                  i = e[0],
                  n = e[1],
                  o = t.localStreams.find(function (e) {
                    return e.streamId === i;
                  });
                (o && o.close(), n.close());
              };
              for (i.s(); !(r = i.n()).done; ) n();
            } catch (e) {
              i.e(e);
            } finally {
              i.f();
            }
            var o,
              a = jr(this.subscriptions.values());
            try {
              for (a.s(); !(o = a.n()).done; ) {
                var s = o.value;
                (s.stream.close(), s.subscriber.close());
              }
            } catch (e) {
              a.e(e);
            } finally {
              a.f();
            }
            ((this.state = K.Leaved),
              this.reset(),
              this._emitter.emit("client-banned", { cause: e }));
          },
        },
        {
          key: "onStreamUpdate",
          value: function (e, t, r, i) {
            var n = e;
            if (this.remoteStreams.has("share_".concat(e))) {
              var o = this.remoteStreams.get("share_".concat(e));
              [o.audioStreamId, o.videoStreamId].includes(t) &&
                (n = "share_".concat(e));
            }
            var a = this.localStreams.find(function (e) {
              return [e.audioStreamId, e.videoStreamId].includes(t);
            });
            if (
              (a || (a = this.remoteStreams.get(n)),
              null != r &&
                r.audio &&
                (e !== this.userId &&
                  (this.logger.buriedLog({
                    c: r.audio.muted ? Xe.ON_MUTE_AUDIO : Xe.ON_UNMUTE_AUDIO,
                    v: "uid:".concat(e),
                  }),
                  this._emitter.emit(
                    r.audio.muted ? "mute-audio" : "unmute-audio",
                    { userId: n },
                  )),
                a.setMutedState("audio", r.audio.muted),
                this.updateRemoteMutedState(e, { audioMuted: r.audio.muted })),
              null != r &&
                r.video &&
                (e !== this.userId &&
                  (this.logger.buriedLog({
                    c: r.video.muted ? Xe.ON_MUTE_VIDEO : Xe.ON_UNMUTE_VIDEO,
                    v: "uid:".concat(e),
                  }),
                  this._emitter.emit(
                    r.video.muted ? "mute-video" : "unmute-video",
                    { userId: n },
                  )),
                a.setMutedState("video", r.video.muted),
                this.updateRemoteMutedState(e, { videoMuted: r.video.muted })),
              i && i.length)
            ) {
              var s = (i || []).find(function (e) {
                return e.type === Ae.SmallStream;
              });
              if (this.remoteStreams.has(e)) {
                var c = this.remoteStreams.get(e);
                (c.setSimulcasts(i),
                  this.logger.buriedLog({
                    c:
                      c.getType() === Q
                        ? Xe.ON_STREAM_UPDATED_SCREEN
                        : Xe.ON_STREAM_UPDATED,
                    v: "uid:".concat(c.getUserId()),
                  }),
                  this._emitter.emit("stream-updated", { stream: c }),
                  s ||
                    (c.getSimulcastType() === Ae.SmallStream &&
                      (this.logger.info("auto setRemoteVideoStreamType big"),
                      this.setRemoteVideoStreamType(c, "big"))));
              }
              this.updateRemoteMutedState(e, { hasVideo: !0, hasSmall: !!s });
            }
          },
        },
        {
          key: "onMuteLocal",
          value: function (e, t) {
            switch (e) {
              case Le.Amute:
                this._emitter.emit("mute-audio", { userId: t });
                break;
              case Le.Aunmute:
                this._emitter.emit("unmute-audio", { userId: t });
                break;
              case Le.Vmute:
                this._emitter.emit("mute-video", { userId: t });
                break;
              case Le.Vunmute:
                this._emitter.emit("unmute-video", { userId: t });
            }
          },
        },
        {
          key: "getType",
          value: function (e) {
            var t,
              r,
              i = jr(this.remoteStreams);
            try {
              for (i.s(); !(r = i.n()).done; ) {
                var n = U(r.value, 2)[1];
                if (n.audioStreamId === e || n.videoStreamId === e) {
                  t = n.getType();
                  break;
                }
              }
            } catch (e) {
              i.e(e);
            } finally {
              i.f();
            }
            return t;
          },
        },
        {
          key: "hasPublishedStream",
          value: function () {
            return this.localStreams.some(function (e) {
              return e.published;
            });
          },
        },
        {
          key: "getClientState",
          value: function () {
            return this.state;
          },
        },
        {
          key: "onDeviceChange",
          value:
            ((i = V(
              H.mark(function e() {
                var t,
                  r,
                  i,
                  n,
                  o,
                  a,
                  s,
                  c,
                  u,
                  d,
                  l,
                  h,
                  p,
                  f,
                  m,
                  v,
                  g,
                  y,
                  b,
                  S,
                  E,
                  C,
                  T,
                  R = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          return ((e.prev = 0), (e.next = 3), et());
                        case 3:
                          if (
                            ((t = e.sent),
                            (r = JSON.parse(
                              JSON.stringify(this._preDiviceList),
                            )),
                            (this._preDiviceList = t),
                            (i = t.filter(function (e) {
                              return (
                                -1 ===
                                r.findIndex(function (t) {
                                  return t.deviceId === e.deviceId;
                                })
                              );
                            })).length &&
                              this.logger.info(
                                "onDeviceChange addedDevices",
                                JSON.stringify(i, null, 4),
                              ),
                            (n = r.filter(function (e) {
                              return (
                                -1 ===
                                t.findIndex(function (t) {
                                  return t.deviceId === e.deviceId;
                                })
                              );
                            })).length &&
                              this.logger.info(
                                "onDeviceChange removedDevices",
                                JSON.stringify(n, null, 4),
                              ),
                            (o = this.localStreams.find(function (e) {
                              return !e.screen;
                            })),
                            (a = i.filter(function (e) {
                              return "audiooutput" === e.kind;
                            })),
                            (s = t.filter(function (e) {
                              return "default" === e.deviceId;
                            })),
                            !o)
                          ) {
                            e.next = 63;
                            break;
                          }
                          if (
                            ((c = t.filter(function (e) {
                              return (
                                "audioinput" === e.kind &&
                                "default" === e.deviceId
                              );
                            })),
                            !i || !i.length)
                          ) {
                            e.next = 42;
                            break;
                          }
                          if (
                            ((u = r.find(function (e) {
                              return "audioinput" === e.kind;
                            })),
                            (d = r.find(function (e) {
                              return "videoinput" === e.kind;
                            })),
                            (l = i.filter(function (e) {
                              return "audioinput" === e.kind;
                            })),
                            (h = i.filter(function (e) {
                              return "videoinput" === e.kind;
                            })),
                            (p = !u && l.length > 0 && o.hasAudio()),
                            (f = !d && h.length > 0 && o.hasVideo()),
                            !p || !f)
                          ) {
                            e.next = 30;
                            break;
                          }
                          return (
                            this.logger.warn(
                              "new microphone and camera detected, but there was no device before.",
                            ),
                            (e.next = 26),
                            o.updateStream({
                              audio: !0,
                              video: !0,
                              cameraId: h[0].deviceId,
                              microphoneId: c.length
                                ? c[0].deviceId
                                : l[0].deviceId,
                            })
                          );
                        case 26:
                          (this._emitter.emit("auto-switch-device", {
                            type: "audio",
                            deviceId: c.length ? c[0].deviceId : l[0].deviceId,
                          }),
                            this._emitter.emit("auto-switch-device", {
                              type: "video",
                              deviceId: h[0].deviceId,
                            }),
                            (e.next = 42));
                          break;
                        case 30:
                          if (!p) {
                            e.next = 37;
                            break;
                          }
                          return (
                            this.logger.warn(
                              "new microphone  detected, but there was no device before.",
                            ),
                            (e.next = 34),
                            o.updateStream({
                              audio: !0,
                              video: !1,
                              microphoneId: l[0].deviceId,
                            })
                          );
                        case 34:
                          (this._emitter.emit("auto-switch-device", {
                            type: "audio",
                            deviceId: l[0].deviceId,
                          }),
                            (e.next = 42));
                          break;
                        case 37:
                          if (!f) {
                            e.next = 42;
                            break;
                          }
                          return (
                            this.logger.warn(
                              "new camera  detected, but there was no device before.",
                            ),
                            (e.next = 41),
                            o.updateStream({
                              audio: !1,
                              video: !0,
                              cameraId: h[0].deviceId,
                            })
                          );
                        case 41:
                          this._emitter.emit("auto-switch-device", {
                            type: "video",
                            deviceId: h[0].deviceId,
                          });
                        case 42:
                          if (!n || !n.length) {
                            e.next = 63;
                            break;
                          }
                          if (
                            ((m = o.getDevicesInfoInUse()),
                            (v = m.microphone),
                            (g = m.camera),
                            this.logger.warn(
                              "Devices in use microphone:"
                                .concat(JSON.stringify(v, null, 4), ",camera:")
                                .concat(JSON.stringify(g, null, 4)),
                            ),
                            (y = n.find(function (e) {
                              return e.groupId && v.groupId
                                ? e.deviceId === v.deviceId &&
                                    e.groupId === v.groupId
                                : e.deviceId === v.deviceId;
                            })),
                            (b = n.find(function (e) {
                              return e.groupId && g.groupId
                                ? e.deviceId === g.deviceId &&
                                    e.groupId === g.groupId
                                : e.deviceId === g.deviceId;
                            })),
                            (S = t.find(function (e) {
                              return "audioinput" === e.kind;
                            })),
                            (E = t.find(function (e) {
                              return "videoinput" === e.kind;
                            })),
                            (C = y && o.hasAudio()),
                            (T = b && o.hasVideo()),
                            !C)
                          ) {
                            e.next = 57;
                            break;
                          }
                          if (
                            (this.logger.warn(
                              "current microphone in use is lost, deviceId: ".concat(
                                v.deviceId,
                              ),
                            ),
                            !S)
                          ) {
                            e.next = 57;
                            break;
                          }
                          return (
                            (e.next = 56),
                            o.updateStream({ audio: !0, video: !1 })
                          );
                        case 56:
                          this._emitter.emit("auto-switch-device", {
                            type: "audio",
                          });
                        case 57:
                          if (!T) {
                            e.next = 63;
                            break;
                          }
                          if (
                            (this.logger.warn(
                              "current camera in use is lost, deviceId: ".concat(
                                g.deviceId,
                              ),
                            ),
                            !E)
                          ) {
                            e.next = 63;
                            break;
                          }
                          return (
                            (e.next = 62),
                            o.updateStream({ audio: !1, video: !0 })
                          );
                        case 62:
                          this._emitter.emit("auto-switch-device", {
                            type: "video",
                          });
                        case 63:
                          (a.length &&
                            s.length &&
                            this.remoteStreams.forEach(function (e) {
                              e.setAudioOutput("default");
                            }),
                            i.forEach(function (e) {
                              switch (e.kind) {
                                case "audioinput":
                                  (R.logger.info(
                                    "The new microphone device be detected is",
                                    e.label,
                                  ),
                                    R._emitter.emit(
                                      "recording-device-changed",
                                      { deviceId: e.deviceId, state: "ADD" },
                                    ));
                                  break;
                                case "videoinput":
                                  (R.logger.info(
                                    "The new camera device be detected is",
                                    e.label,
                                  ),
                                    R._emitter.emit("camera-changed", {
                                      deviceId: e.deviceId,
                                      state: "ADD",
                                    }));
                                  break;
                                case "audiooutput":
                                  (R.logger.info(
                                    "The new speaker device be detected is",
                                    e.label,
                                  ),
                                    R._emitter.emit("playback-device-changed", {
                                      deviceId: e.deviceId,
                                      state: "ADD",
                                    }));
                              }
                            }),
                            n.forEach(function (e) {
                              switch (e.kind) {
                                case "audioinput":
                                  (R.logger.info(
                                    "The microphone device is detected to be removed: ",
                                    e.label,
                                  ),
                                    R._emitter.emit(
                                      "recording-device-changed",
                                      { deviceId: e.deviceId, state: "REMOVE" },
                                    ));
                                  break;
                                case "videoinput":
                                  (R.logger.info(
                                    "The camera device is detected to be removed: ",
                                    e.label,
                                  ),
                                    R._emitter.emit("camera-changed", {
                                      deviceId: e.deviceId,
                                      state: "REMOVE",
                                    }));
                                  break;
                                case "audiooutput":
                                  (R.logger.info(
                                    "The speaker device is detected to be removed: ",
                                    e.label,
                                  ),
                                    R._emitter.emit("playback-device-changed", {
                                      deviceId: e.deviceId,
                                      state: "REMOVE",
                                    }));
                              }
                            }),
                            (e.next = 71));
                          break;
                        case 68:
                          ((e.prev = 68),
                            (e.t0 = e.catch(0)),
                            this.logger.onError(
                              { c: Xe.TOP_ERROR, v: te.SWITCH_DEVICE_FAILED },
                              "on device change error, ".concat(e.t0),
                            ));
                        case 71:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                  [[0, 68]],
                );
              }),
            )),
            function () {
              return i.apply(this, arguments);
            }),
        },
        {
          key: "enableAudioVolumeEvaluation",
          value: function () {
            var e = this,
              t =
                arguments.length > 0 && void 0 !== arguments[0]
                  ? arguments[0]
                  : 2e3;
            if (
              (this.logger.info(
                "enableAudioVolumeEvaluation with interval: " + t,
              ),
              this.logger.buriedLog({
                c: Xe.ENABLE_AUDIO_VOLUME_EVALUATION,
                v: "time:".concat(t),
              }),
              "number" != typeof t)
            )
              throw (
                this.logger.onError({
                  c: Xe.TOP_ERROR,
                  v: te.INVALID_PARAMETER,
                }),
                new de({
                  code: te.INVALID_PARAMETER,
                  message: "parameter must be numeric type",
                })
              );
            t <= 0
              ? (window.clearInterval(this.audioVolumeInterval),
                (this.audioVolumeInterval = null))
              : (this.audioVolumeInterval &&
                  (window.clearInterval(this.audioVolumeInterval),
                  (this.audioVolumeInterval = null)),
                (this.audioVolumeInterval = window.setInterval(
                  function () {
                    var t = [];
                    e.localStreams.forEach(function (e) {
                      if (!e.screen && e.published) {
                        var r = Math.floor(100 * e.getAudioLevel());
                        t.push({
                          userId: e.getUserId(),
                          audioVolume: r,
                          stream: e,
                        });
                      }
                    });
                    var r,
                      i = jr(e.remoteStreams);
                    try {
                      for (i.s(); !(r = i.n()).done; ) {
                        var n = U(r.value, 2)[1];
                        if ("main" === n.getType() && n.subscribed) {
                          var o = Math.floor(100 * n.getAudioLevel());
                          t.push({
                            userId: n.getUserId(),
                            audioVolume: o,
                            stream: n,
                          });
                        }
                      }
                    } catch (e) {
                      i.e(e);
                    } finally {
                      i.f();
                    }
                    e._emitter.emit("audio-volume", { result: t });
                  },
                  Math.floor(Math.max(t, 16)),
                )));
          },
        },
        {
          key: "addEventListenser",
          value: function (e) {
            (this.ssl &&
              navigator.mediaDevices &&
              "devicechange" === e &&
              navigator.mediaDevices.addEventListener(e, this.deviceChange),
              "visibilitychange" === e &&
                document.addEventListener(e, this.visibilitychange));
          },
        },
        {
          key: "removeEventListenser",
          value: function (e) {
            (this.ssl &&
              navigator.mediaDevices &&
              "devicechange" === e &&
              navigator.mediaDevices.removeEventListener(e, this.deviceChange),
              "visibilitychange" === e &&
                document.removeEventListener(e, this.visibilitychange));
          },
        },
        {
          key: "startWaterMark",
          value:
            ((r = V(
              H.mark(function e(t) {
                var r,
                  i,
                  n,
                  o,
                  a = this;
                return H.wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (!this.isWaterMark) {
                            e.next = 2;
                            break;
                          }
                          return e.abrupt("return");
                        case 2:
                          return (
                            (this.isWaterMark = !0),
                            (r = {
                              fontColor: "rgba(200,200,200,0.6)",
                              fontSize: "12",
                              fontType: "Microsoft Yahei",
                            }),
                            (i = t.fontColor),
                            (n = t.fontSize),
                            (o = t.fontType),
                            t &&
                              (i && (r.fontColor = i),
                              n && (r.fontSize = n),
                              o && (r.fontType = o)),
                            (e.next = 8),
                            mt(r, this.userId)
                          );
                        case 8:
                          ((this.waterMarkImage = e.sent),
                            (this.waterMarkoptions = r),
                            this.remoteStreams.size &&
                              this.remoteStreams.forEach(
                                (function () {
                                  var e = V(
                                    H.mark(function e(t) {
                                      return H.wrap(function (e) {
                                        for (;;)
                                          switch ((e.prev = e.next)) {
                                            case 0:
                                              if (t.getType() !== Q) {
                                                e.next = 3;
                                                break;
                                              }
                                              return (
                                                (e.next = 3),
                                                t.startWaterMark(
                                                  r,
                                                  a.waterMarkImage,
                                                )
                                              );
                                            case 3:
                                            case "end":
                                              return e.stop();
                                          }
                                      }, e);
                                    }),
                                  );
                                  return function (t) {
                                    return e.apply(this, arguments);
                                  };
                                })(),
                              ));
                        case 11:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            )),
            function (e) {
              return r.apply(this, arguments);
            }),
        },
        {
          key: "closeWaterMark",
          value: function () {
            this.isWaterMark &&
              ((this.isWaterMark = !1),
              (this.waterMarkImage = null),
              this.remoteStreams.size &&
                this.remoteStreams.forEach(function (e) {
                  e.getType() === Q && e.closeWaterMark();
                }));
          },
        },
        {
          key: "enableSmallStream",
          value: function () {
            var e = this.localStreams.find(function (e) {
              return e.videoStreamId && !e.screen;
            });
            if (e && e.published)
              throw new de({
                code: te.INVALID_OPERATION,
                message:
                  "Cannot enable small stream after localStream published.",
              });
            if (!nt())
              throw new de({
                code: te.INVALID_OPERATION,
                message: "Your browser does not support opening small stream",
              });
            return (
              this.setIsEnableSmallStream(!0),
              this.logger.info("SmallStream successfully enabled"),
              this.logger.buriedLog({ c: Xe.ENABLE_SMALL_STREAM }),
              Promise.resolve(!0)
            );
          },
        },
        {
          key: "disableSmallStream",
          value: function () {
            var e = this.localStreams.find(function (e) {
              return e.videoStreamId && !e.screen;
            });
            if (e && e.published)
              throw new de({
                code: te.INVALID_OPERATION,
                message: "Cannot enable small stream after having published.",
              });
            return (
              this.setIsEnableSmallStream(!1),
              this.logger.info("SmallStream successfully disabled"),
              this.logger.buriedLog({ c: Xe.DISABLE_SMALL_STREAM }),
              Promise.resolve(!0)
            );
          },
        },
        {
          key: "setSmallStreamProfile",
          value: function (e) {
            var t = e.width,
              r = e.height,
              i = e.bitrate,
              n = e.framerate;
            if (
              (this.logger.info(
                "setSmallStreamProfile:width="
                  .concat(t, ",height=")
                  .concat(r, ",bitrate=")
                  .concat(i, ",framerate=")
                  .concat(n),
              ),
              t < 0 || r < 0 || i < 0 || n < 0)
            )
              throw new de({
                code: te.INVALID_OPERATION,
                message: "Small stream profile is invalid.",
              });
            (this.logger.buriedLog({
              c: Xe.SET_SMALL_STREAM_PROFILE,
              v: JSON.stringify(e),
            }),
              (this.smallStreamConfig = {
                width: t,
                height: r,
                bitrate: i,
                framerate: n,
              }));
          },
        },
        {
          key: "setIsEnableSmallStream",
          value: function (e) {
            this.isEnableSmallStream = e;
          },
        },
        {
          key: "onVisibilitychange",
          value: function () {
            "visible" === document.visibilityState
              ? (this.logger.warn("User enter the page"),
                this._emitter.emit("page-visibility-state", {
                  state: "visible",
                }))
              : "hidden" === document.visibilityState &&
                (this.logger.warn("User leave the pag"),
                this._emitter.emit("page-visibility-state", {
                  state: "hidden",
                }));
          },
        },
        {
          key: "isJoinRoomSupported",
          value:
            ((t = V(
              H.mark(function e() {
                var t, r, i, n, o, a, s, c, u;
                return H.wrap(function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return ((e.next = 2), Ze());
                      case 2:
                        if (
                          ((r = (t = e.sent.detail).isBrowserSupported),
                          (n = t.isH264Supported),
                          (i = t.isWebRTCSupported) && n && r)
                        ) {
                          e.next = 9;
                          break;
                        }
                        return (
                          (o = fe()),
                          (a = o.browser),
                          (s = o.version),
                          (c = i
                            ? n
                              ? te.BROWSER_NOT_SUPPORTED
                              : te.H264_NOT_SUPPORTED
                            : te.WEBRTC_NOT_SUPPORTED),
                          (u = i
                            ? n
                              ? ""
                                  .concat(a)
                                  .concat(s, " browser is not supported")
                              : "your device does not support H.264 encoding."
                            : "your browser does NOT support WebRTC!"),
                          e.abrupt(
                            "return",
                            Promise.resolve({
                              isSupported: !1,
                              code: c,
                              message: u,
                            }),
                          )
                        );
                      case 9:
                        return e.abrupt(
                          "return",
                          Promise.resolve({
                            isSupported: !0,
                            code: 0,
                            message: "",
                          }),
                        );
                      case 10:
                      case "end":
                        return e.stop();
                    }
                }, e);
              }),
            )),
            function () {
              return t.apply(this, arguments);
            }),
        },
        {
          key: "enableMicVolume",
          value: function () {
            var e =
                arguments.length > 0 && void 0 !== arguments[0]
                  ? arguments[0]
                  : 1e3,
              t = arguments.length > 1 ? arguments[1] : void 0,
              r = this;
            if (e >= 0) {
              if ("number" != typeof e)
                throw new de({
                  code: te.INVALID_PARAMETER,
                  message: "parameter must be numeric type",
                });
              navigator.mediaDevices
                .getUserMedia({ audio: { deviceId: { exact: t } } })
                .then(function (t) {
                  (r.logger.info("microphone permission is ok"),
                    (r.micStream = t),
                    (r.soundMeter = new le()),
                    r.soundMeter.connectToSource(
                      r.micStream.getAudioTracks()[0],
                    ),
                    (r.timer = setInterval(
                      function () {
                        r._emitter.emit("mic-volume", {
                          volumes: Math.round(100 * r.soundMeter.getVolume()),
                        });
                      },
                      Math.floor(Math.max(e, 100)),
                    )));
                })
                .catch(function (e) {
                  r.logger.error("init error ", e);
                });
            } else
              (clearInterval(r.timer),
                (r.timer = null),
                r.micStream && r.micStream.getAudioTracks()[0].stop());
          },
        },
      ]),
      e
    );
  })();
function Hr(e, t) {
  var r = Object.keys(e);
  if (Object.getOwnPropertySymbols) {
    var i = Object.getOwnPropertySymbols(e);
    (t &&
      (i = i.filter(function (t) {
        return Object.getOwnPropertyDescriptor(e, t).enumerable;
      })),
      r.push.apply(r, i));
  }
  return r;
}
function Jr(e) {
  for (var t = 1; t < arguments.length; t++) {
    var r = null != arguments[t] ? arguments[t] : {};
    t % 2
      ? Hr(Object(r), !0).forEach(function (t) {
          x(e, t, r[t]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(r))
        : Hr(Object(r)).forEach(function (t) {
            Object.defineProperty(e, t, Object.getOwnPropertyDescriptor(r, t));
          });
  }
  return e;
}
(!(function (e) {
  ((e[(e.TRACE = 0)] = "TRACE"),
    (e[(e.DEBUG = 1)] = "DEBUG"),
    (e[(e.INFO = 2)] = "INFO"),
    (e[(e.WARN = 3)] = "WARN"),
    (e[(e.ERROR = 4)] = "ERROR"),
    (e[(e.NONE = 5)] = "NONE"));
})(Br || (Br = {})),
  (function (e) {
    ((e.NORMAL = "normal"), (e.POINT = "point"), (e.MEDIA = "media"));
  })(Wr || (Wr = {})));
var zr = (function () {
  function e() {
    (F(this, e),
      (this.LogLevel = {
        TRACE: Br.TRACE,
        DEBUG: Br.DEBUG,
        INFO: Br.INFO,
        WARN: Br.WARN,
        ERROR: Br.ERROR,
        NONE: Br.NONE,
      }),
      (this.level = Br.INFO),
      (this.myConsole = window.console),
      (this.uploadLog = !1),
      (this.logList = []),
      (this.buriedLogList = []),
      (this.mediaLogList = []),
      (this.maxNumber = 10),
      (this.timeout = 1e4),
      (this._interval = 0),
      (this._intervalBuried = 0),
      (this.roomId = null),
      (this.serverUrl = ""),
      (this.appConfig = null),
      (this.roomUniqueId = null),
      (this.reUploadMaxCount = 30),
      (this.logReUploadCount = 0),
      (this.buriedlogReUploadCount = 0),
      this.enableUploadLog(),
      window.addEventListener("beforeunload", this.beforeUnload.bind(this), {
        once: !0,
      }));
  }
  return (
    W(e, [
      {
        key: "setLogLevel",
        value: function (e) {
          ((this.level = e),
            this.buriedLog({
              c: Rt.SET_LOG_LEVEL,
              v: ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "NONE"][e],
            }));
        },
      },
      {
        key: "getLogLevel",
        value: function () {
          return this.level;
        },
      },
      {
        key: "setUserId",
        value: function (e) {
          this.userId = e;
        },
      },
      {
        key: "setRoomId",
        value: function (e) {
          this.roomId = e;
        },
      },
      {
        key: "setRoomUniqueId",
        value: function (e) {
          this.roomUniqueId = e;
        },
      },
      {
        key: "setServerUrl",
        value: function (e) {
          (e ||
            ((this.uploadLogList = this.logList.splice(0, this.logList.length)),
            this.upload(this.uploadLogList)),
            (this.serverUrl = e));
        },
      },
      {
        key: "setAppConfig",
        value: function (e) {
          var t, r;
          ((this.appConfig = e),
            null !== (t = this.appConfig) && void 0 !== t && t.enableLog
              ? this.enableUploadLog()
              : this.disableUploadLog(),
            null !== (r = this.appConfig) && void 0 !== r && r.enableEvent
              ? this.enableUploadBuriedLogs()
              : this.disableUploadBuriedLogs());
        },
      },
      {
        key: "debug",
        value: function (e) {
          var t;
          if (!(this.level === Br.NONE || Br.DEBUG < this.level)) {
            for (
              var r = arguments.length, i = new Array(r > 1 ? r - 1 : 0), n = 1;
              n < r;
              n++
            )
              i[n - 1] = arguments[n];
            ((t = this.myConsole).debug.apply(
              t,
              [
                "XRTC <Debug> ".concat(
                  this.userId ? "[".concat(this.userId, "]") : "",
                ),
                e,
              ].concat(i),
            ),
              this.collect(Br.DEBUG, e, i));
          }
        },
      },
      {
        key: "info",
        value: function (e) {
          for (
            var t,
              r = arguments.length,
              i = new Array(r > 1 ? r - 1 : 0),
              n = 1;
            n < r;
            n++
          )
            i[n - 1] = arguments[n];
          (this.collect(Br.INFO, e, i),
            this.level === Br.NONE ||
              Br.INFO < this.level ||
              (t = this.myConsole).info.apply(
                t,
                [
                  "XRTC <Info> ".concat(
                    this.userId ? "[".concat(this.userId, "]") : "",
                  ),
                  e,
                ].concat(i),
              ));
        },
      },
      {
        key: "warn",
        value: function (e) {
          for (
            var t,
              r = arguments.length,
              i = new Array(r > 1 ? r - 1 : 0),
              n = 1;
            n < r;
            n++
          )
            i[n - 1] = arguments[n];
          (this.collect(Br.WARN, e, i),
            this.level === Br.NONE ||
              Br.WARN < this.level ||
              (t = this.myConsole).warn.apply(
                t,
                [
                  "XRTC <Warn> ".concat(
                    this.userId ? "[".concat(this.userId, "]") : "",
                  ),
                  e,
                ].concat(i),
              ));
        },
      },
      {
        key: "error",
        value: function (e) {
          for (
            var t,
              r = arguments.length,
              i = new Array(r > 1 ? r - 1 : 0),
              n = 1;
            n < r;
            n++
          )
            i[n - 1] = arguments[n];
          (this.collect(Br.ERROR, e, i),
            this.level === Br.NONE ||
              Br.ERROR < this.level ||
              (t = this.myConsole).error.apply(
                t,
                [
                  "XRTC <Error> ".concat(
                    this.userId ? "[".concat(this.userId, "]") : "",
                  ),
                  e,
                ].concat(i),
              ));
        },
      },
      {
        key: "enableUploadLog",
        value: function () {
          var e = this;
          this._interval ||
            ((this.uploadLog = !0),
            (this._interval = window.setInterval(function () {
              e.roomId &&
                e.logList.length > 0 &&
                ((e.uploadLogList = e.logList.splice(0, e.logList.length)),
                e.upload(e.uploadLogList));
            }, this.timeout)),
            this.buriedLog({ c: Rt.ENABLE_UPLOAD_LOG }));
        },
      },
      {
        key: "disableUploadLog",
        value: function () {
          ((this.uploadLog = !1),
            window.clearInterval(this._interval),
            (this._interval = 0),
            this.buriedLog({ c: Rt.DISABLE_UPLOAD_LOG }));
        },
      },
      {
        key: "collect",
        value: function (e, t, r) {
          this.uploadLog &&
            (this.logList.push({
              t: Date.now(),
              lv: e,
              mdu: "XRTC",
              msg: "XRTC "
                .concat(this.userId ? "[".concat(this.userId, "]") : "", " ")
                .concat(t, " ")
                .concat((r || []).join(" "), "\r\n"),
            }),
            this.roomId &&
              this.logList.length >= this.maxNumber &&
              ((this.uploadLogList = this.logList.splice(
                0,
                this.logList.length,
              )),
              this.upload(this.uploadLogList)));
        },
      },
      {
        key: "upload",
        value: function (e) {
          var t = this;
          this.serverUrl &&
            Ur.upload({
              type: Wr.NORMAL,
              app: Ur.appKey,
              rid: this.roomId,
              uid: this.userId,
              pf: "web",
              list: e,
            })
              .then(function () {})
              .catch(function () {
                ((t.logReUploadCount = t.logReUploadCount + 1),
                  t.logReUploadCount > t.reUploadMaxCount
                    ? ((t.logList = []),
                      (t.logReUploadCount = 0),
                      t.info(
                        "SDK has tried reupload log ".concat(
                          t.reUploadMaxCount,
                          " times, but all failed, and old log cleared",
                        ),
                      ))
                    : (t.logList = [].concat(j(e), j(t.logList))));
              });
        },
      },
      {
        key: "buriedLog",
        value: function (e, t) {
          var r,
            i = this;
          if (
            (!this.appConfig || this.appConfig.enableEvent) &&
            (this.buriedLogList.push(
              Jr(Jr({}, e), {}, { t: this.adjustServerTime(Date.now()) }),
            ),
            e.c === Rt.JOIN_SUCCESS &&
              this.buriedLogList.forEach(function (e) {
                e.c !== Rt.JOIN_SUCCESS && (e.t = i.adjustServerTime(e.t));
              }),
            null !== (r = this.appConfig) &&
              void 0 !== r &&
              r.enableEvent &&
              this.roomUniqueId &&
              (t || this.buriedLogList.length >= this.maxNumber))
          ) {
            var n = this.buriedLogList.splice(0, this.buriedLogList.length);
            this.uploadBuriedLogs(n, Wr.POINT);
          }
        },
      },
      {
        key: "mediaLog",
        value: function (e, t) {
          var r;
          if (
            (!this.appConfig || this.appConfig.enableEvent) &&
            (this.mediaLogList.push(
              Jr(Jr({}, e), {}, { t: this.adjustServerTime(Date.now()) }),
            ),
            null !== (r = this.appConfig) &&
              void 0 !== r &&
              r.enableEvent &&
              this.roomUniqueId &&
              (t || this.mediaLogList.length >= this.maxNumber))
          ) {
            var i = this.mediaLogList.splice(0, this.mediaLogList.length);
            this.uploadBuriedLogs(i, Wr.MEDIA);
          }
        },
      },
      {
        key: "uploadBuriedLogs",
        value: function (e, t) {
          var r = this;
          !this.serverUrl ||
            (this.appConfig && !this.appConfig.enableEvent) ||
            Ur.upload({
              type: t,
              app: Ur.appKey,
              ruid: this.roomUniqueId,
              uid: this.userId,
              pf: "web",
              list: e,
            })
              .then(function () {})
              .catch(function (i) {
                ((r.buriedlogReUploadCount = r.buriedlogReUploadCount + 1),
                  r.buriedlogReUploadCount > r.reUploadMaxCount
                    ? (t === Wr.POINT && (r.buriedLogList = []),
                      t === Wr.MEDIA && (r.mediaLogList = []),
                      (r.buriedlogReUploadCount = 0),
                      r.info(
                        "SDK has tried reupload buried log ".concat(
                          r.reUploadMaxCount,
                          " times, but all failed, and old log cleared",
                        ),
                      ))
                    : t === Wr.POINT
                      ? (r.buriedLogList = [].concat(j(e), j(r.buriedLogList)))
                      : t === Wr.MEDIA &&
                        (r.mediaLogList = [].concat(j(e), j(r.mediaLogList))));
              });
        },
      },
      {
        key: "enableUploadBuriedLogs",
        value: function () {
          var e = this;
          this._intervalBuried ||
            (this._intervalBuried = window.setInterval(function () {
              if (e.buriedLogList.length > 0) {
                var t = e.buriedLogList.splice(0, e.buriedLogList.length);
                e.uploadBuriedLogs(t, Wr.POINT);
              }
              if (e.mediaLogList.length > 0) {
                var r = e.mediaLogList.splice(0, e.mediaLogList.length);
                e.uploadBuriedLogs(r, Wr.MEDIA);
              }
            }, this.timeout));
        },
      },
      {
        key: "disableUploadBuriedLogs",
        value: function () {
          (window.clearInterval(this._intervalBuried),
            (this._intervalBuried = 0));
        },
      },
      {
        key: "beforeUnload",
        value: function () {
          if (this.logList.length > 0) {
            var e = this.logList.splice(0, this.logList.length);
            this.upload(e);
          }
          if (this.buriedLogList.length > 0) {
            var t = this.buriedLogList.splice(0, this.buriedLogList.length);
            this.uploadBuriedLogs(t, Wr.POINT);
          }
          if (this.mediaLogList.length > 0) {
            var r = this.mediaLogList.splice(0, this.mediaLogList.length);
            this.uploadBuriedLogs(r, Wr.MEDIA);
          }
          (this.disableUploadLog(), this.disableUploadBuriedLogs());
        },
      },
      {
        key: "adjustServerTime",
        value: function (e) {
          var t;
          return null !== (t = this.appConfig) && void 0 !== t && t.timeDiff
            ? e - this.appConfig.timeDiff
            : e;
        },
      },
      {
        key: "onError",
        value: function (e, t, r) {
          (r ? this.buriedLog(e, r) : this.buriedLog(e), t && this.error(t));
        },
      },
    ]),
    e
  );
})();
let Kr = !0,
  Yr = !0;
function qr(e, t, r) {
  const i = e.match(t);
  return i && i.length >= r && parseInt(i[r], 10);
}
function Xr(e, t, r) {
  if (!e.RTCPeerConnection) return;
  const i = e.RTCPeerConnection.prototype,
    n = i.addEventListener;
  i.addEventListener = function (e, i) {
    if (e !== t) return n.apply(this, arguments);
    const o = (e) => {
      const t = r(e);
      t && (i.handleEvent ? i.handleEvent(t) : i(t));
    };
    return (
      (this._eventMap = this._eventMap || {}),
      this._eventMap[t] || (this._eventMap[t] = new Map()),
      this._eventMap[t].set(i, o),
      n.apply(this, [e, o])
    );
  };
  const o = i.removeEventListener;
  ((i.removeEventListener = function (e, r) {
    if (e !== t || !this._eventMap || !this._eventMap[t])
      return o.apply(this, arguments);
    if (!this._eventMap[t].has(r)) return o.apply(this, arguments);
    const i = this._eventMap[t].get(r);
    return (
      this._eventMap[t].delete(r),
      0 === this._eventMap[t].size && delete this._eventMap[t],
      0 === Object.keys(this._eventMap).length && delete this._eventMap,
      o.apply(this, [e, i])
    );
  }),
    Object.defineProperty(i, "on" + t, {
      get() {
        return this["_on" + t];
      },
      set(e) {
        (this["_on" + t] &&
          (this.removeEventListener(t, this["_on" + t]),
          delete this["_on" + t]),
          e && this.addEventListener(t, (this["_on" + t] = e)));
      },
      enumerable: !0,
      configurable: !0,
    }));
}
function Qr(e) {
  return "boolean" != typeof e
    ? new Error("Argument type: " + typeof e + ". Please use a boolean.")
    : ((Kr = e),
      e ? "adapter.js logging disabled" : "adapter.js logging enabled");
}
function $r(e) {
  return "boolean" != typeof e
    ? new Error("Argument type: " + typeof e + ". Please use a boolean.")
    : ((Yr = !e),
      "adapter.js deprecation warnings " + (e ? "disabled" : "enabled"));
}
function Zr() {
  if ("object" == typeof window) {
    if (Kr) return;
    "undefined" != typeof console &&
      "function" == typeof console.log &&
      console.log.apply(console, arguments);
  }
}
function ei(e, t) {
  Yr && console.warn(e + " is deprecated, please use " + t + " instead.");
}
function ti(e) {
  return "[object Object]" === Object.prototype.toString.call(e);
}
function ri(e) {
  return ti(e)
    ? Object.keys(e).reduce(function (t, r) {
        const i = ti(e[r]),
          n = i ? ri(e[r]) : e[r],
          o = i && !Object.keys(n).length;
        return void 0 === n || o ? t : Object.assign(t, { [r]: n });
      }, {})
    : e;
}
function ii(e, t, r) {
  t &&
    !r.has(t.id) &&
    (r.set(t.id, t),
    Object.keys(t).forEach((i) => {
      i.endsWith("Id")
        ? ii(e, e.get(t[i]), r)
        : i.endsWith("Ids") &&
          t[i].forEach((t) => {
            ii(e, e.get(t), r);
          });
    }));
}
function ni(e, t, r) {
  const i = r ? "outbound-rtp" : "inbound-rtp",
    n = new Map();
  if (null === t) return n;
  const o = [];
  return (
    e.forEach((e) => {
      "track" === e.type && e.trackIdentifier === t.id && o.push(e);
    }),
    o.forEach((t) => {
      e.forEach((r) => {
        r.type === i && r.trackId === t.id && ii(e, r, n);
      });
    }),
    n
  );
}
const oi = Zr;
function ai(e, t) {
  const r = e && e.navigator;
  if (!r.mediaDevices) return;
  const i = function (e) {
      if ("object" != typeof e || e.mandatory || e.optional) return e;
      const t = {};
      return (
        Object.keys(e).forEach((r) => {
          if ("require" === r || "advanced" === r || "mediaSource" === r)
            return;
          const i = "object" == typeof e[r] ? e[r] : { ideal: e[r] };
          void 0 !== i.exact &&
            "number" == typeof i.exact &&
            (i.min = i.max = i.exact);
          const n = function (e, t) {
            return e
              ? e + t.charAt(0).toUpperCase() + t.slice(1)
              : "deviceId" === t
                ? "sourceId"
                : t;
          };
          if (void 0 !== i.ideal) {
            t.optional = t.optional || [];
            let e = {};
            "number" == typeof i.ideal
              ? ((e[n("min", r)] = i.ideal),
                t.optional.push(e),
                (e = {}),
                (e[n("max", r)] = i.ideal),
                t.optional.push(e))
              : ((e[n("", r)] = i.ideal), t.optional.push(e));
          }
          void 0 !== i.exact && "number" != typeof i.exact
            ? ((t.mandatory = t.mandatory || {}),
              (t.mandatory[n("", r)] = i.exact))
            : ["min", "max"].forEach((e) => {
                void 0 !== i[e] &&
                  ((t.mandatory = t.mandatory || {}),
                  (t.mandatory[n(e, r)] = i[e]));
              });
        }),
        e.advanced && (t.optional = (t.optional || []).concat(e.advanced)),
        t
      );
    },
    n = function (e, n) {
      if (t.version >= 61) return n(e);
      if ((e = JSON.parse(JSON.stringify(e))) && "object" == typeof e.audio) {
        const t = function (e, t, r) {
          t in e && !(r in e) && ((e[r] = e[t]), delete e[t]);
        };
        (t(
          (e = JSON.parse(JSON.stringify(e))).audio,
          "autoGainControl",
          "googAutoGainControl",
        ),
          t(e.audio, "noiseSuppression", "googNoiseSuppression"),
          (e.audio = i(e.audio)));
      }
      if (e && "object" == typeof e.video) {
        let o = e.video.facingMode;
        o = o && ("object" == typeof o ? o : { ideal: o });
        const a = t.version < 66;
        if (
          o &&
          ("user" === o.exact ||
            "environment" === o.exact ||
            "user" === o.ideal ||
            "environment" === o.ideal) &&
          (!r.mediaDevices.getSupportedConstraints ||
            !r.mediaDevices.getSupportedConstraints().facingMode ||
            a)
        ) {
          let t;
          if (
            (delete e.video.facingMode,
            "environment" === o.exact || "environment" === o.ideal
              ? (t = ["back", "rear"])
              : ("user" !== o.exact && "user" !== o.ideal) || (t = ["front"]),
            t)
          )
            return r.mediaDevices.enumerateDevices().then((r) => {
              let a = (r = r.filter((e) => "videoinput" === e.kind)).find((e) =>
                t.some((t) => e.label.toLowerCase().includes(t)),
              );
              return (
                !a && r.length && t.includes("back") && (a = r[r.length - 1]),
                a &&
                  (e.video.deviceId = o.exact
                    ? { exact: a.deviceId }
                    : { ideal: a.deviceId }),
                (e.video = i(e.video)),
                oi("chrome: " + JSON.stringify(e)),
                n(e)
              );
            });
        }
        e.video = i(e.video);
      }
      return (oi("chrome: " + JSON.stringify(e)), n(e));
    },
    o = function (e) {
      return t.version >= 64
        ? e
        : {
            name:
              {
                PermissionDeniedError: "NotAllowedError",
                PermissionDismissedError: "NotAllowedError",
                InvalidStateError: "NotAllowedError",
                DevicesNotFoundError: "NotFoundError",
                ConstraintNotSatisfiedError: "OverconstrainedError",
                TrackStartError: "NotReadableError",
                MediaDeviceFailedDueToShutdown: "NotAllowedError",
                MediaDeviceKillSwitchOn: "NotAllowedError",
                TabCaptureError: "AbortError",
                ScreenCaptureError: "AbortError",
                DeviceCaptureError: "AbortError",
              }[e.name] || e.name,
            message: e.message,
            constraint: e.constraint || e.constraintName,
            toString() {
              return this.name + (this.message && ": ") + this.message;
            },
          };
    };
  if (
    ((r.getUserMedia = function (e, t, i) {
      n(e, (e) => {
        r.webkitGetUserMedia(e, t, (e) => {
          i && i(o(e));
        });
      });
    }.bind(r)),
    r.mediaDevices.getUserMedia)
  ) {
    const e = r.mediaDevices.getUserMedia.bind(r.mediaDevices);
    r.mediaDevices.getUserMedia = function (t) {
      return n(t, (t) =>
        e(t).then(
          (e) => {
            if (
              (t.audio && !e.getAudioTracks().length) ||
              (t.video && !e.getVideoTracks().length)
            )
              throw (
                e.getTracks().forEach((e) => {
                  e.stop();
                }),
                new DOMException("", "NotFoundError")
              );
            return e;
          },
          (e) => Promise.reject(o(e)),
        ),
      );
    };
  }
}
function si(e) {
  e.MediaStream = e.MediaStream || e.webkitMediaStream;
}
function ci(e) {
  if (
    "object" == typeof e &&
    e.RTCPeerConnection &&
    !("ontrack" in e.RTCPeerConnection.prototype)
  ) {
    Object.defineProperty(e.RTCPeerConnection.prototype, "ontrack", {
      get() {
        return this._ontrack;
      },
      set(e) {
        (this._ontrack && this.removeEventListener("track", this._ontrack),
          this.addEventListener("track", (this._ontrack = e)));
      },
      enumerable: !0,
      configurable: !0,
    });
    const t = e.RTCPeerConnection.prototype.setRemoteDescription;
    e.RTCPeerConnection.prototype.setRemoteDescription = function () {
      return (
        this._ontrackpoly ||
          ((this._ontrackpoly = (t) => {
            (t.stream.addEventListener("addtrack", (r) => {
              let i;
              i = e.RTCPeerConnection.prototype.getReceivers
                ? this.getReceivers().find(
                    (e) => e.track && e.track.id === r.track.id,
                  )
                : { track: r.track };
              const n = new Event("track");
              ((n.track = r.track),
                (n.receiver = i),
                (n.transceiver = { receiver: i }),
                (n.streams = [t.stream]),
                this.dispatchEvent(n));
            }),
              t.stream.getTracks().forEach((r) => {
                let i;
                i = e.RTCPeerConnection.prototype.getReceivers
                  ? this.getReceivers().find(
                      (e) => e.track && e.track.id === r.id,
                    )
                  : { track: r };
                const n = new Event("track");
                ((n.track = r),
                  (n.receiver = i),
                  (n.transceiver = { receiver: i }),
                  (n.streams = [t.stream]),
                  this.dispatchEvent(n));
              }));
          }),
          this.addEventListener("addstream", this._ontrackpoly)),
        t.apply(this, arguments)
      );
    };
  } else
    Xr(
      e,
      "track",
      (e) => (
        e.transceiver ||
          Object.defineProperty(e, "transceiver", {
            value: { receiver: e.receiver },
          }),
        e
      ),
    );
}
function ui(e) {
  if (
    "object" == typeof e &&
    e.RTCPeerConnection &&
    !("getSenders" in e.RTCPeerConnection.prototype) &&
    "createDTMFSender" in e.RTCPeerConnection.prototype
  ) {
    const t = function (e, t) {
      return {
        track: t,
        get dtmf() {
          return (
            void 0 === this._dtmf &&
              (this._dtmf = "audio" === t.kind ? e.createDTMFSender(t) : null),
            this._dtmf
          );
        },
        _pc: e,
      };
    };
    if (!e.RTCPeerConnection.prototype.getSenders) {
      e.RTCPeerConnection.prototype.getSenders = function () {
        return ((this._senders = this._senders || []), this._senders.slice());
      };
      const r = e.RTCPeerConnection.prototype.addTrack;
      e.RTCPeerConnection.prototype.addTrack = function (e, i) {
        let n = r.apply(this, arguments);
        return (n || ((n = t(this, e)), this._senders.push(n)), n);
      };
      const i = e.RTCPeerConnection.prototype.removeTrack;
      e.RTCPeerConnection.prototype.removeTrack = function (e) {
        i.apply(this, arguments);
        const t = this._senders.indexOf(e);
        -1 !== t && this._senders.splice(t, 1);
      };
    }
    const r = e.RTCPeerConnection.prototype.addStream;
    e.RTCPeerConnection.prototype.addStream = function (e) {
      ((this._senders = this._senders || []),
        r.apply(this, [e]),
        e.getTracks().forEach((e) => {
          this._senders.push(t(this, e));
        }));
    };
    const i = e.RTCPeerConnection.prototype.removeStream;
    e.RTCPeerConnection.prototype.removeStream = function (e) {
      ((this._senders = this._senders || []),
        i.apply(this, [e]),
        e.getTracks().forEach((e) => {
          const t = this._senders.find((t) => t.track === e);
          t && this._senders.splice(this._senders.indexOf(t), 1);
        }));
    };
  } else if (
    "object" == typeof e &&
    e.RTCPeerConnection &&
    "getSenders" in e.RTCPeerConnection.prototype &&
    "createDTMFSender" in e.RTCPeerConnection.prototype &&
    e.RTCRtpSender &&
    !("dtmf" in e.RTCRtpSender.prototype)
  ) {
    const t = e.RTCPeerConnection.prototype.getSenders;
    ((e.RTCPeerConnection.prototype.getSenders = function () {
      const e = t.apply(this, []);
      return (e.forEach((e) => (e._pc = this)), e);
    }),
      Object.defineProperty(e.RTCRtpSender.prototype, "dtmf", {
        get() {
          return (
            void 0 === this._dtmf &&
              (this._dtmf =
                "audio" === this.track.kind
                  ? this._pc.createDTMFSender(this.track)
                  : null),
            this._dtmf
          );
        },
      }));
  }
}
function di(e) {
  if (!e.RTCPeerConnection) return;
  const t = e.RTCPeerConnection.prototype.getStats;
  e.RTCPeerConnection.prototype.getStats = function () {
    const [e, r, i] = arguments;
    if (arguments.length > 0 && "function" == typeof e)
      return t.apply(this, arguments);
    if (0 === t.length && (0 === arguments.length || "function" != typeof e))
      return t.apply(this, []);
    const n = function (e) {
        const t = {};
        return (
          e.result().forEach((e) => {
            const r = {
              id: e.id,
              timestamp: e.timestamp,
              type:
                {
                  localcandidate: "local-candidate",
                  remotecandidate: "remote-candidate",
                }[e.type] || e.type,
            };
            (e.names().forEach((t) => {
              r[t] = e.stat(t);
            }),
              (t[r.id] = r));
          }),
          t
        );
      },
      o = function (e) {
        return new Map(Object.keys(e).map((t) => [t, e[t]]));
      };
    return arguments.length >= 2
      ? t.apply(this, [
          function (e) {
            r(o(n(e)));
          },
          e,
        ])
      : new Promise((e, r) => {
          t.apply(this, [
            function (t) {
              e(o(n(t)));
            },
            r,
          ]);
        }).then(r, i);
  };
}
function li(e) {
  if (
    !(
      "object" == typeof e &&
      e.RTCPeerConnection &&
      e.RTCRtpSender &&
      e.RTCRtpReceiver
    )
  )
    return;
  if (!("getStats" in e.RTCRtpSender.prototype)) {
    const t = e.RTCPeerConnection.prototype.getSenders;
    t &&
      (e.RTCPeerConnection.prototype.getSenders = function () {
        const e = t.apply(this, []);
        return (e.forEach((e) => (e._pc = this)), e);
      });
    const r = e.RTCPeerConnection.prototype.addTrack;
    (r &&
      (e.RTCPeerConnection.prototype.addTrack = function () {
        const e = r.apply(this, arguments);
        return ((e._pc = this), e);
      }),
      (e.RTCRtpSender.prototype.getStats = function () {
        const e = this;
        return this._pc.getStats().then((t) => ni(t, e.track, !0));
      }));
  }
  if (!("getStats" in e.RTCRtpReceiver.prototype)) {
    const t = e.RTCPeerConnection.prototype.getReceivers;
    (t &&
      (e.RTCPeerConnection.prototype.getReceivers = function () {
        const e = t.apply(this, []);
        return (e.forEach((e) => (e._pc = this)), e);
      }),
      Xr(e, "track", (e) => ((e.receiver._pc = e.srcElement), e)),
      (e.RTCRtpReceiver.prototype.getStats = function () {
        const e = this;
        return this._pc.getStats().then((t) => ni(t, e.track, !1));
      }));
  }
  if (
    !("getStats" in e.RTCRtpSender.prototype) ||
    !("getStats" in e.RTCRtpReceiver.prototype)
  )
    return;
  const t = e.RTCPeerConnection.prototype.getStats;
  e.RTCPeerConnection.prototype.getStats = function () {
    if (arguments.length > 0 && arguments[0] instanceof e.MediaStreamTrack) {
      const e = arguments[0];
      let t, r, i;
      return (
        this.getSenders().forEach((r) => {
          r.track === e && (t ? (i = !0) : (t = r));
        }),
        this.getReceivers().forEach(
          (t) => (t.track === e && (r ? (i = !0) : (r = t)), t.track === e),
        ),
        i || (t && r)
          ? Promise.reject(
              new DOMException(
                "There are more than one sender or receiver for the track.",
                "InvalidAccessError",
              ),
            )
          : t
            ? t.getStats()
            : r
              ? r.getStats()
              : Promise.reject(
                  new DOMException(
                    "There is no sender or receiver for the track.",
                    "InvalidAccessError",
                  ),
                )
      );
    }
    return t.apply(this, arguments);
  };
}
function hi(e) {
  e.RTCPeerConnection.prototype.getLocalStreams = function () {
    return (
      (this._shimmedLocalStreams = this._shimmedLocalStreams || {}),
      Object.keys(this._shimmedLocalStreams).map(
        (e) => this._shimmedLocalStreams[e][0],
      )
    );
  };
  const t = e.RTCPeerConnection.prototype.addTrack;
  e.RTCPeerConnection.prototype.addTrack = function (e, r) {
    if (!r) return t.apply(this, arguments);
    this._shimmedLocalStreams = this._shimmedLocalStreams || {};
    const i = t.apply(this, arguments);
    return (
      this._shimmedLocalStreams[r.id]
        ? -1 === this._shimmedLocalStreams[r.id].indexOf(i) &&
          this._shimmedLocalStreams[r.id].push(i)
        : (this._shimmedLocalStreams[r.id] = [r, i]),
      i
    );
  };
  const r = e.RTCPeerConnection.prototype.addStream;
  e.RTCPeerConnection.prototype.addStream = function (e) {
    ((this._shimmedLocalStreams = this._shimmedLocalStreams || {}),
      e.getTracks().forEach((e) => {
        if (this.getSenders().find((t) => t.track === e))
          throw new DOMException("Track already exists.", "InvalidAccessError");
      }));
    const t = this.getSenders();
    r.apply(this, arguments);
    const i = this.getSenders().filter((e) => -1 === t.indexOf(e));
    this._shimmedLocalStreams[e.id] = [e].concat(i);
  };
  const i = e.RTCPeerConnection.prototype.removeStream;
  e.RTCPeerConnection.prototype.removeStream = function (e) {
    return (
      (this._shimmedLocalStreams = this._shimmedLocalStreams || {}),
      delete this._shimmedLocalStreams[e.id],
      i.apply(this, arguments)
    );
  };
  const n = e.RTCPeerConnection.prototype.removeTrack;
  e.RTCPeerConnection.prototype.removeTrack = function (e) {
    return (
      (this._shimmedLocalStreams = this._shimmedLocalStreams || {}),
      e &&
        Object.keys(this._shimmedLocalStreams).forEach((t) => {
          const r = this._shimmedLocalStreams[t].indexOf(e);
          (-1 !== r && this._shimmedLocalStreams[t].splice(r, 1),
            1 === this._shimmedLocalStreams[t].length &&
              delete this._shimmedLocalStreams[t]);
        }),
      n.apply(this, arguments)
    );
  };
}
function pi(e, t) {
  if (!e.RTCPeerConnection) return;
  if (e.RTCPeerConnection.prototype.addTrack && t.version >= 65) return hi(e);
  const r = e.RTCPeerConnection.prototype.getLocalStreams;
  e.RTCPeerConnection.prototype.getLocalStreams = function () {
    const e = r.apply(this);
    return (
      (this._reverseStreams = this._reverseStreams || {}),
      e.map((e) => this._reverseStreams[e.id])
    );
  };
  const i = e.RTCPeerConnection.prototype.addStream;
  e.RTCPeerConnection.prototype.addStream = function (t) {
    if (
      ((this._streams = this._streams || {}),
      (this._reverseStreams = this._reverseStreams || {}),
      t.getTracks().forEach((e) => {
        if (this.getSenders().find((t) => t.track === e))
          throw new DOMException("Track already exists.", "InvalidAccessError");
      }),
      !this._reverseStreams[t.id])
    ) {
      const r = new e.MediaStream(t.getTracks());
      ((this._streams[t.id] = r), (this._reverseStreams[r.id] = t), (t = r));
    }
    i.apply(this, [t]);
  };
  const n = e.RTCPeerConnection.prototype.removeStream;
  function o(e, t) {
    let r = t.sdp;
    return (
      Object.keys(e._reverseStreams || []).forEach((t) => {
        const i = e._reverseStreams[t];
        r = r.replace(new RegExp(e._streams[i.id].id, "g"), i.id);
      }),
      new RTCSessionDescription({ type: t.type, sdp: r })
    );
  }
  ((e.RTCPeerConnection.prototype.removeStream = function (e) {
    ((this._streams = this._streams || {}),
      (this._reverseStreams = this._reverseStreams || {}),
      n.apply(this, [this._streams[e.id] || e]),
      delete this._reverseStreams[
        this._streams[e.id] ? this._streams[e.id].id : e.id
      ],
      delete this._streams[e.id]);
  }),
    (e.RTCPeerConnection.prototype.addTrack = function (t, r) {
      if ("closed" === this.signalingState)
        throw new DOMException(
          "The RTCPeerConnection's signalingState is 'closed'.",
          "InvalidStateError",
        );
      const i = [].slice.call(arguments, 1);
      if (1 !== i.length || !i[0].getTracks().find((e) => e === t))
        throw new DOMException(
          "The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.",
          "NotSupportedError",
        );
      const n = this.getSenders().find((e) => e.track === t);
      if (n)
        throw new DOMException("Track already exists.", "InvalidAccessError");
      ((this._streams = this._streams || {}),
        (this._reverseStreams = this._reverseStreams || {}));
      const o = this._streams[r.id];
      if (o)
        (o.addTrack(t),
          Promise.resolve().then(() => {
            this.dispatchEvent(new Event("negotiationneeded"));
          }));
      else {
        const i = new e.MediaStream([t]);
        ((this._streams[r.id] = i),
          (this._reverseStreams[i.id] = r),
          this.addStream(i));
      }
      return this.getSenders().find((e) => e.track === t);
    }),
    ["createOffer", "createAnswer"].forEach(function (t) {
      const r = e.RTCPeerConnection.prototype[t];
      e.RTCPeerConnection.prototype[t] = {
        [t]() {
          const e = arguments;
          return arguments.length && "function" == typeof arguments[0]
            ? r.apply(this, [
                (t) => {
                  const r = o(this, t);
                  e[0].apply(null, [r]);
                },
                (t) => {
                  e[1] && e[1].apply(null, t);
                },
                arguments[2],
              ])
            : r.apply(this, arguments).then((e) => o(this, e));
        },
      }[t];
    }));
  const a = e.RTCPeerConnection.prototype.setLocalDescription;
  e.RTCPeerConnection.prototype.setLocalDescription = function () {
    return arguments.length && arguments[0].type
      ? ((arguments[0] = (function (e, t) {
          let r = t.sdp;
          return (
            Object.keys(e._reverseStreams || []).forEach((t) => {
              const i = e._reverseStreams[t],
                n = e._streams[i.id];
              r = r.replace(new RegExp(i.id, "g"), n.id);
            }),
            new RTCSessionDescription({ type: t.type, sdp: r })
          );
        })(this, arguments[0])),
        a.apply(this, arguments))
      : a.apply(this, arguments);
  };
  const s = Object.getOwnPropertyDescriptor(
    e.RTCPeerConnection.prototype,
    "localDescription",
  );
  (Object.defineProperty(e.RTCPeerConnection.prototype, "localDescription", {
    get() {
      const e = s.get.apply(this);
      return "" === e.type ? e : o(this, e);
    },
  }),
    (e.RTCPeerConnection.prototype.removeTrack = function (e) {
      if ("closed" === this.signalingState)
        throw new DOMException(
          "The RTCPeerConnection's signalingState is 'closed'.",
          "InvalidStateError",
        );
      if (!e._pc)
        throw new DOMException(
          "Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.",
          "TypeError",
        );
      if (e._pc !== this)
        throw new DOMException(
          "Sender was not created by this connection.",
          "InvalidAccessError",
        );
      let t;
      ((this._streams = this._streams || {}),
        Object.keys(this._streams).forEach((r) => {
          this._streams[r].getTracks().find((t) => e.track === t) &&
            (t = this._streams[r]);
        }),
        t &&
          (1 === t.getTracks().length
            ? this.removeStream(this._reverseStreams[t.id])
            : t.removeTrack(e.track),
          this.dispatchEvent(new Event("negotiationneeded"))));
    }));
}
function fi(e, t) {
  (!e.RTCPeerConnection &&
    e.webkitRTCPeerConnection &&
    (e.RTCPeerConnection = e.webkitRTCPeerConnection),
    e.RTCPeerConnection &&
      t.version < 53 &&
      [
        "setLocalDescription",
        "setRemoteDescription",
        "addIceCandidate",
      ].forEach(function (t) {
        const r = e.RTCPeerConnection.prototype[t];
        e.RTCPeerConnection.prototype[t] = {
          [t]() {
            return (
              (arguments[0] = new (
                "addIceCandidate" === t
                  ? e.RTCIceCandidate
                  : e.RTCSessionDescription
              )(arguments[0])),
              r.apply(this, arguments)
            );
          },
        }[t];
      }));
}
function mi(e, t) {
  Xr(e, "negotiationneeded", (e) => {
    const r = e.target;
    if (
      !(
        t.version < 72 ||
        (r.getConfiguration && "plan-b" === r.getConfiguration().sdpSemantics)
      ) ||
      "stable" === r.signalingState
    )
      return e;
  });
}
var vi = Object.freeze({
  __proto__: null,
  shimMediaStream: si,
  shimOnTrack: ci,
  shimGetSendersWithDtmf: ui,
  shimGetStats: di,
  shimSenderReceiverGetStats: li,
  shimAddTrackRemoveTrackWithNative: hi,
  shimAddTrackRemoveTrack: pi,
  shimPeerConnection: fi,
  fixNegotiationNeeded: mi,
  shimGetUserMedia: ai,
  shimGetDisplayMedia: function (e, t) {
    (e.navigator.mediaDevices &&
      "getDisplayMedia" in e.navigator.mediaDevices) ||
      (e.navigator.mediaDevices &&
        ("function" == typeof t
          ? (e.navigator.mediaDevices.getDisplayMedia = function (r) {
              return t(r).then((t) => {
                const i = r.video && r.video.width,
                  n = r.video && r.video.height;
                return (
                  (r.video = {
                    mandatory: {
                      chromeMediaSource: "desktop",
                      chromeMediaSourceId: t,
                      maxFrameRate: (r.video && r.video.frameRate) || 3,
                    },
                  }),
                  i && (r.video.mandatory.maxWidth = i),
                  n && (r.video.mandatory.maxHeight = n),
                  e.navigator.mediaDevices.getUserMedia(r)
                );
              });
            })
          : console.error(
              "shimGetDisplayMedia: getSourceId argument is not a function",
            )));
  },
});
function gi(e, t) {
  const r = e && e.navigator,
    i = e && e.MediaStreamTrack;
  if (
    ((r.getUserMedia = function (e, t, i) {
      (ei("navigator.getUserMedia", "navigator.mediaDevices.getUserMedia"),
        r.mediaDevices.getUserMedia(e).then(t, i));
    }),
    !(
      t.version > 55 &&
      "autoGainControl" in r.mediaDevices.getSupportedConstraints()
    ))
  ) {
    const e = function (e, t, r) {
        t in e && !(r in e) && ((e[r] = e[t]), delete e[t]);
      },
      t = r.mediaDevices.getUserMedia.bind(r.mediaDevices);
    if (
      ((r.mediaDevices.getUserMedia = function (r) {
        return (
          "object" == typeof r &&
            "object" == typeof r.audio &&
            ((r = JSON.parse(JSON.stringify(r))),
            e(r.audio, "autoGainControl", "mozAutoGainControl"),
            e(r.audio, "noiseSuppression", "mozNoiseSuppression")),
          t(r)
        );
      }),
      i && i.prototype.getSettings)
    ) {
      const t = i.prototype.getSettings;
      i.prototype.getSettings = function () {
        const r = t.apply(this, arguments);
        return (
          e(r, "mozAutoGainControl", "autoGainControl"),
          e(r, "mozNoiseSuppression", "noiseSuppression"),
          r
        );
      };
    }
    if (i && i.prototype.applyConstraints) {
      const t = i.prototype.applyConstraints;
      i.prototype.applyConstraints = function (r) {
        return (
          "audio" === this.kind &&
            "object" == typeof r &&
            ((r = JSON.parse(JSON.stringify(r))),
            e(r, "autoGainControl", "mozAutoGainControl"),
            e(r, "noiseSuppression", "mozNoiseSuppression")),
          t.apply(this, [r])
        );
      };
    }
  }
}
function yi(e) {
  "object" == typeof e &&
    e.RTCTrackEvent &&
    "receiver" in e.RTCTrackEvent.prototype &&
    !("transceiver" in e.RTCTrackEvent.prototype) &&
    Object.defineProperty(e.RTCTrackEvent.prototype, "transceiver", {
      get() {
        return { receiver: this.receiver };
      },
    });
}
function bi(e, t) {
  if ("object" != typeof e || (!e.RTCPeerConnection && !e.mozRTCPeerConnection))
    return;
  (!e.RTCPeerConnection &&
    e.mozRTCPeerConnection &&
    (e.RTCPeerConnection = e.mozRTCPeerConnection),
    t.version < 53 &&
      [
        "setLocalDescription",
        "setRemoteDescription",
        "addIceCandidate",
      ].forEach(function (t) {
        const r = e.RTCPeerConnection.prototype[t];
        e.RTCPeerConnection.prototype[t] = {
          [t]() {
            return (
              (arguments[0] = new (
                "addIceCandidate" === t
                  ? e.RTCIceCandidate
                  : e.RTCSessionDescription
              )(arguments[0])),
              r.apply(this, arguments)
            );
          },
        }[t];
      }));
  const r = {
      inboundrtp: "inbound-rtp",
      outboundrtp: "outbound-rtp",
      candidatepair: "candidate-pair",
      localcandidate: "local-candidate",
      remotecandidate: "remote-candidate",
    },
    i = e.RTCPeerConnection.prototype.getStats;
  e.RTCPeerConnection.prototype.getStats = function () {
    const [e, n, o] = arguments;
    return i
      .apply(this, [e || null])
      .then((e) => {
        if (t.version < 53 && !n)
          try {
            e.forEach((e) => {
              e.type = r[e.type] || e.type;
            });
          } catch (t) {
            if ("TypeError" !== t.name) throw t;
            e.forEach((t, i) => {
              e.set(i, Object.assign({}, t, { type: r[t.type] || t.type }));
            });
          }
        return e;
      })
      .then(n, o);
  };
}
function Si(e) {
  if ("object" != typeof e || !e.RTCPeerConnection || !e.RTCRtpSender) return;
  if (e.RTCRtpSender && "getStats" in e.RTCRtpSender.prototype) return;
  const t = e.RTCPeerConnection.prototype.getSenders;
  t &&
    (e.RTCPeerConnection.prototype.getSenders = function () {
      const e = t.apply(this, []);
      return (e.forEach((e) => (e._pc = this)), e);
    });
  const r = e.RTCPeerConnection.prototype.addTrack;
  (r &&
    (e.RTCPeerConnection.prototype.addTrack = function () {
      const e = r.apply(this, arguments);
      return ((e._pc = this), e);
    }),
    (e.RTCRtpSender.prototype.getStats = function () {
      return this.track
        ? this._pc.getStats(this.track)
        : Promise.resolve(new Map());
    }));
}
function Ei(e) {
  if ("object" != typeof e || !e.RTCPeerConnection || !e.RTCRtpSender) return;
  if (e.RTCRtpSender && "getStats" in e.RTCRtpReceiver.prototype) return;
  const t = e.RTCPeerConnection.prototype.getReceivers;
  (t &&
    (e.RTCPeerConnection.prototype.getReceivers = function () {
      const e = t.apply(this, []);
      return (e.forEach((e) => (e._pc = this)), e);
    }),
    Xr(e, "track", (e) => ((e.receiver._pc = e.srcElement), e)),
    (e.RTCRtpReceiver.prototype.getStats = function () {
      return this._pc.getStats(this.track);
    }));
}
function Ci(e) {
  e.RTCPeerConnection &&
    !("removeStream" in e.RTCPeerConnection.prototype) &&
    (e.RTCPeerConnection.prototype.removeStream = function (e) {
      (ei("removeStream", "removeTrack"),
        this.getSenders().forEach((t) => {
          t.track && e.getTracks().includes(t.track) && this.removeTrack(t);
        }));
    });
}
function Ti(e) {
  e.DataChannel && !e.RTCDataChannel && (e.RTCDataChannel = e.DataChannel);
}
function Ri(e) {
  if ("object" != typeof e || !e.RTCPeerConnection) return;
  const t = e.RTCPeerConnection.prototype.addTransceiver;
  t &&
    (e.RTCPeerConnection.prototype.addTransceiver = function () {
      this.setParametersPromises = [];
      const e = arguments[1],
        r = e && "sendEncodings" in e;
      r &&
        e.sendEncodings.forEach((e) => {
          if ("rid" in e && !/^[a-z0-9]{0,16}$/i.test(e.rid))
            throw new TypeError("Invalid RID value provided.");
          if (
            "scaleResolutionDownBy" in e &&
            !(parseFloat(e.scaleResolutionDownBy) >= 1)
          )
            throw new RangeError("scale_resolution_down_by must be >= 1.0");
          if ("maxFramerate" in e && !(parseFloat(e.maxFramerate) >= 0))
            throw new RangeError("max_framerate must be >= 0.0");
        });
      const i = t.apply(this, arguments);
      if (r) {
        const { sender: t } = i,
          r = t.getParameters();
        (!("encodings" in r) ||
          (1 === r.encodings.length &&
            0 === Object.keys(r.encodings[0]).length)) &&
          ((r.encodings = e.sendEncodings),
          (t.sendEncodings = e.sendEncodings),
          this.setParametersPromises.push(
            t
              .setParameters(r)
              .then(() => {
                delete t.sendEncodings;
              })
              .catch(() => {
                delete t.sendEncodings;
              }),
          ));
      }
      return i;
    });
}
function Ii(e) {
  if ("object" != typeof e || !e.RTCRtpSender) return;
  const t = e.RTCRtpSender.prototype.getParameters;
  t &&
    (e.RTCRtpSender.prototype.getParameters = function () {
      const e = t.apply(this, arguments);
      return (
        "encodings" in e ||
          (e.encodings = [].concat(this.sendEncodings || [{}])),
        e
      );
    });
}
function _i(e) {
  if ("object" != typeof e || !e.RTCPeerConnection) return;
  const t = e.RTCPeerConnection.prototype.createOffer;
  e.RTCPeerConnection.prototype.createOffer = function () {
    return this.setParametersPromises && this.setParametersPromises.length
      ? Promise.all(this.setParametersPromises)
          .then(() => t.apply(this, arguments))
          .finally(() => {
            this.setParametersPromises = [];
          })
      : t.apply(this, arguments);
  };
}
function ki(e) {
  if ("object" != typeof e || !e.RTCPeerConnection) return;
  const t = e.RTCPeerConnection.prototype.createAnswer;
  e.RTCPeerConnection.prototype.createAnswer = function () {
    return this.setParametersPromises && this.setParametersPromises.length
      ? Promise.all(this.setParametersPromises)
          .then(() => t.apply(this, arguments))
          .finally(() => {
            this.setParametersPromises = [];
          })
      : t.apply(this, arguments);
  };
}
var wi = Object.freeze({
  __proto__: null,
  shimOnTrack: yi,
  shimPeerConnection: bi,
  shimSenderGetStats: Si,
  shimReceiverGetStats: Ei,
  shimRemoveStream: Ci,
  shimRTCDataChannel: Ti,
  shimAddTransceiver: Ri,
  shimGetParameters: Ii,
  shimCreateOffer: _i,
  shimCreateAnswer: ki,
  shimGetUserMedia: gi,
  shimGetDisplayMedia: function (e, t) {
    (e.navigator.mediaDevices &&
      "getDisplayMedia" in e.navigator.mediaDevices) ||
      (e.navigator.mediaDevices &&
        (e.navigator.mediaDevices.getDisplayMedia = function (r) {
          if (!r || !r.video) {
            const e = new DOMException(
              "getDisplayMedia without video constraints is undefined",
            );
            return (
              (e.name = "NotFoundError"),
              (e.code = 8),
              Promise.reject(e)
            );
          }
          return (
            !0 === r.video
              ? (r.video = { mediaSource: t })
              : (r.video.mediaSource = t),
            e.navigator.mediaDevices.getUserMedia(r)
          );
        }));
  },
});
function Oi(e) {
  if ("object" == typeof e && e.RTCPeerConnection) {
    if (
      ("getLocalStreams" in e.RTCPeerConnection.prototype ||
        (e.RTCPeerConnection.prototype.getLocalStreams = function () {
          return (
            this._localStreams || (this._localStreams = []),
            this._localStreams
          );
        }),
      !("addStream" in e.RTCPeerConnection.prototype))
    ) {
      const t = e.RTCPeerConnection.prototype.addTrack;
      ((e.RTCPeerConnection.prototype.addStream = function (e) {
        (this._localStreams || (this._localStreams = []),
          this._localStreams.includes(e) || this._localStreams.push(e),
          e.getAudioTracks().forEach((r) => t.call(this, r, e)),
          e.getVideoTracks().forEach((r) => t.call(this, r, e)));
      }),
        (e.RTCPeerConnection.prototype.addTrack = function (e, ...r) {
          return (
            r &&
              r.forEach((e) => {
                this._localStreams
                  ? this._localStreams.includes(e) || this._localStreams.push(e)
                  : (this._localStreams = [e]);
              }),
            t.apply(this, arguments)
          );
        }));
    }
    "removeStream" in e.RTCPeerConnection.prototype ||
      (e.RTCPeerConnection.prototype.removeStream = function (e) {
        this._localStreams || (this._localStreams = []);
        const t = this._localStreams.indexOf(e);
        if (-1 === t) return;
        this._localStreams.splice(t, 1);
        const r = e.getTracks();
        this.getSenders().forEach((e) => {
          r.includes(e.track) && this.removeTrack(e);
        });
      });
  }
}
function Pi(e) {
  if (
    "object" == typeof e &&
    e.RTCPeerConnection &&
    ("getRemoteStreams" in e.RTCPeerConnection.prototype ||
      (e.RTCPeerConnection.prototype.getRemoteStreams = function () {
        return this._remoteStreams ? this._remoteStreams : [];
      }),
    !("onaddstream" in e.RTCPeerConnection.prototype))
  ) {
    Object.defineProperty(e.RTCPeerConnection.prototype, "onaddstream", {
      get() {
        return this._onaddstream;
      },
      set(e) {
        (this._onaddstream &&
          (this.removeEventListener("addstream", this._onaddstream),
          this.removeEventListener("track", this._onaddstreampoly)),
          this.addEventListener("addstream", (this._onaddstream = e)),
          this.addEventListener(
            "track",
            (this._onaddstreampoly = (e) => {
              e.streams.forEach((e) => {
                if (
                  (this._remoteStreams || (this._remoteStreams = []),
                  this._remoteStreams.includes(e))
                )
                  return;
                this._remoteStreams.push(e);
                const t = new Event("addstream");
                ((t.stream = e), this.dispatchEvent(t));
              });
            }),
          ));
      },
    });
    const t = e.RTCPeerConnection.prototype.setRemoteDescription;
    e.RTCPeerConnection.prototype.setRemoteDescription = function () {
      const e = this;
      return (
        this._onaddstreampoly ||
          this.addEventListener(
            "track",
            (this._onaddstreampoly = function (t) {
              t.streams.forEach((t) => {
                if (
                  (e._remoteStreams || (e._remoteStreams = []),
                  e._remoteStreams.indexOf(t) >= 0)
                )
                  return;
                e._remoteStreams.push(t);
                const r = new Event("addstream");
                ((r.stream = t), e.dispatchEvent(r));
              });
            }),
          ),
        t.apply(e, arguments)
      );
    };
  }
}
function Ai(e) {
  if ("object" != typeof e || !e.RTCPeerConnection) return;
  const t = e.RTCPeerConnection.prototype,
    r = t.createOffer,
    i = t.createAnswer,
    n = t.setLocalDescription,
    o = t.setRemoteDescription,
    a = t.addIceCandidate;
  ((t.createOffer = function (e, t) {
    const i = arguments.length >= 2 ? arguments[2] : arguments[0],
      n = r.apply(this, [i]);
    return t ? (n.then(e, t), Promise.resolve()) : n;
  }),
    (t.createAnswer = function (e, t) {
      const r = arguments.length >= 2 ? arguments[2] : arguments[0],
        n = i.apply(this, [r]);
      return t ? (n.then(e, t), Promise.resolve()) : n;
    }));
  let s = function (e, t, r) {
    const i = n.apply(this, [e]);
    return r ? (i.then(t, r), Promise.resolve()) : i;
  };
  ((t.setLocalDescription = s),
    (s = function (e, t, r) {
      const i = o.apply(this, [e]);
      return r ? (i.then(t, r), Promise.resolve()) : i;
    }),
    (t.setRemoteDescription = s),
    (s = function (e, t, r) {
      const i = a.apply(this, [e]);
      return r ? (i.then(t, r), Promise.resolve()) : i;
    }),
    (t.addIceCandidate = s));
}
function Li(e) {
  const t = e && e.navigator;
  if (t.mediaDevices && t.mediaDevices.getUserMedia) {
    const e = t.mediaDevices,
      r = e.getUserMedia.bind(e);
    t.mediaDevices.getUserMedia = (e) => r(xi(e));
  }
  !t.getUserMedia &&
    t.mediaDevices &&
    t.mediaDevices.getUserMedia &&
    (t.getUserMedia = function (e, r, i) {
      t.mediaDevices.getUserMedia(e).then(r, i);
    }.bind(t));
}
function xi(e) {
  return e && void 0 !== e.video
    ? Object.assign({}, e, { video: ri(e.video) })
    : e;
}
function Di(e) {
  if (!e.RTCPeerConnection) return;
  const t = e.RTCPeerConnection;
  ((e.RTCPeerConnection = function (e, r) {
    if (e && e.iceServers) {
      const t = [];
      for (let r = 0; r < e.iceServers.length; r++) {
        let i = e.iceServers[r];
        !i.hasOwnProperty("urls") && i.hasOwnProperty("url")
          ? (ei("RTCIceServer.url", "RTCIceServer.urls"),
            (i = JSON.parse(JSON.stringify(i))),
            (i.urls = i.url),
            delete i.url,
            t.push(i))
          : t.push(e.iceServers[r]);
      }
      e.iceServers = t;
    }
    return new t(e, r);
  }),
    (e.RTCPeerConnection.prototype = t.prototype),
    "generateCertificate" in t &&
      Object.defineProperty(e.RTCPeerConnection, "generateCertificate", {
        get: () => t.generateCertificate,
      }));
}
function Mi(e) {
  "object" == typeof e &&
    e.RTCTrackEvent &&
    "receiver" in e.RTCTrackEvent.prototype &&
    !("transceiver" in e.RTCTrackEvent.prototype) &&
    Object.defineProperty(e.RTCTrackEvent.prototype, "transceiver", {
      get() {
        return { receiver: this.receiver };
      },
    });
}
function Ui(e) {
  const t = e.RTCPeerConnection.prototype.createOffer;
  e.RTCPeerConnection.prototype.createOffer = function (e) {
    if (e) {
      void 0 !== e.offerToReceiveAudio &&
        (e.offerToReceiveAudio = !!e.offerToReceiveAudio);
      const t = this.getTransceivers().find(
        (e) => "audio" === e.receiver.track.kind,
      );
      (!1 === e.offerToReceiveAudio && t
        ? "sendrecv" === t.direction
          ? t.setDirection
            ? t.setDirection("sendonly")
            : (t.direction = "sendonly")
          : "recvonly" === t.direction &&
            (t.setDirection
              ? t.setDirection("inactive")
              : (t.direction = "inactive"))
        : !0 !== e.offerToReceiveAudio || t || this.addTransceiver("audio"),
        void 0 !== e.offerToReceiveVideo &&
          (e.offerToReceiveVideo = !!e.offerToReceiveVideo));
      const r = this.getTransceivers().find(
        (e) => "video" === e.receiver.track.kind,
      );
      !1 === e.offerToReceiveVideo && r
        ? "sendrecv" === r.direction
          ? r.setDirection
            ? r.setDirection("sendonly")
            : (r.direction = "sendonly")
          : "recvonly" === r.direction &&
            (r.setDirection
              ? r.setDirection("inactive")
              : (r.direction = "inactive"))
        : !0 !== e.offerToReceiveVideo || r || this.addTransceiver("video");
    }
    return t.apply(this, arguments);
  };
}
function Ni(e) {
  "object" != typeof e ||
    e.AudioContext ||
    (e.AudioContext = e.webkitAudioContext);
}
var Vi = Object.freeze({
    __proto__: null,
    shimLocalStreamsAPI: Oi,
    shimRemoteStreamsAPI: Pi,
    shimCallbacksAPI: Ai,
    shimGetUserMedia: Li,
    shimConstraints: xi,
    shimRTCIceServerUrls: Di,
    shimTrackEventTransceiver: Mi,
    shimCreateOfferLegacy: Ui,
    shimAudioContext: Ni,
  }),
  ji = G(function (e) {
    const t = {
      generateIdentifier: function () {
        return Math.random().toString(36).substr(2, 10);
      },
    };
    ((t.localCName = t.generateIdentifier()),
      (t.splitLines = function (e) {
        return e
          .trim()
          .split("\n")
          .map((e) => e.trim());
      }),
      (t.splitSections = function (e) {
        return e
          .split("\nm=")
          .map((e, t) => (t > 0 ? "m=" + e : e).trim() + "\r\n");
      }),
      (t.getDescription = function (e) {
        const r = t.splitSections(e);
        return r && r[0];
      }),
      (t.getMediaSections = function (e) {
        const r = t.splitSections(e);
        return (r.shift(), r);
      }),
      (t.matchPrefix = function (e, r) {
        return t.splitLines(e).filter((e) => 0 === e.indexOf(r));
      }),
      (t.parseCandidate = function (e) {
        let t;
        t =
          0 === e.indexOf("a=candidate:")
            ? e.substring(12).split(" ")
            : e.substring(10).split(" ");
        const r = {
          foundation: t[0],
          component: { 1: "rtp", 2: "rtcp" }[t[1]] || t[1],
          protocol: t[2].toLowerCase(),
          priority: parseInt(t[3], 10),
          ip: t[4],
          address: t[4],
          port: parseInt(t[5], 10),
          type: t[7],
        };
        for (let e = 8; e < t.length; e += 2)
          switch (t[e]) {
            case "raddr":
              r.relatedAddress = t[e + 1];
              break;
            case "rport":
              r.relatedPort = parseInt(t[e + 1], 10);
              break;
            case "tcptype":
              r.tcpType = t[e + 1];
              break;
            case "ufrag":
              ((r.ufrag = t[e + 1]), (r.usernameFragment = t[e + 1]));
              break;
            default:
              void 0 === r[t[e]] && (r[t[e]] = t[e + 1]);
          }
        return r;
      }),
      (t.writeCandidate = function (e) {
        const t = [];
        t.push(e.foundation);
        const r = e.component;
        (t.push("rtp" === r ? 1 : "rtcp" === r ? 2 : r),
          t.push(e.protocol.toUpperCase()),
          t.push(e.priority),
          t.push(e.address || e.ip),
          t.push(e.port));
        const i = e.type;
        return (
          t.push("typ"),
          t.push(i),
          "host" !== i &&
            e.relatedAddress &&
            e.relatedPort &&
            (t.push("raddr"),
            t.push(e.relatedAddress),
            t.push("rport"),
            t.push(e.relatedPort)),
          e.tcpType &&
            "tcp" === e.protocol.toLowerCase() &&
            (t.push("tcptype"), t.push(e.tcpType)),
          (e.usernameFragment || e.ufrag) &&
            (t.push("ufrag"), t.push(e.usernameFragment || e.ufrag)),
          "candidate:" + t.join(" ")
        );
      }),
      (t.parseIceOptions = function (e) {
        return e.substr(14).split(" ");
      }),
      (t.parseRtpMap = function (e) {
        let t = e.substr(9).split(" ");
        const r = { payloadType: parseInt(t.shift(), 10) };
        return (
          (t = t[0].split("/")),
          (r.name = t[0]),
          (r.clockRate = parseInt(t[1], 10)),
          (r.channels = 3 === t.length ? parseInt(t[2], 10) : 1),
          (r.numChannels = r.channels),
          r
        );
      }),
      (t.writeRtpMap = function (e) {
        let t = e.payloadType;
        void 0 !== e.preferredPayloadType && (t = e.preferredPayloadType);
        const r = e.channels || e.numChannels || 1;
        return (
          "a=rtpmap:" +
          t +
          " " +
          e.name +
          "/" +
          e.clockRate +
          (1 !== r ? "/" + r : "") +
          "\r\n"
        );
      }),
      (t.parseExtmap = function (e) {
        const t = e.substr(9).split(" ");
        return {
          id: parseInt(t[0], 10),
          direction: t[0].indexOf("/") > 0 ? t[0].split("/")[1] : "sendrecv",
          uri: t[1],
        };
      }),
      (t.writeExtmap = function (e) {
        return (
          "a=extmap:" +
          (e.id || e.preferredId) +
          (e.direction && "sendrecv" !== e.direction ? "/" + e.direction : "") +
          " " +
          e.uri +
          "\r\n"
        );
      }),
      (t.parseFmtp = function (e) {
        const t = {};
        let r;
        const i = e.substr(e.indexOf(" ") + 1).split(";");
        for (let e = 0; e < i.length; e++)
          ((r = i[e].trim().split("=")), (t[r[0].trim()] = r[1]));
        return t;
      }),
      (t.writeFmtp = function (e) {
        let t = "",
          r = e.payloadType;
        if (
          (void 0 !== e.preferredPayloadType && (r = e.preferredPayloadType),
          e.parameters && Object.keys(e.parameters).length)
        ) {
          const i = [];
          (Object.keys(e.parameters).forEach((t) => {
            i.push(void 0 !== e.parameters[t] ? t + "=" + e.parameters[t] : t);
          }),
            (t += "a=fmtp:" + r + " " + i.join(";") + "\r\n"));
        }
        return t;
      }),
      (t.parseRtcpFb = function (e) {
        const t = e.substr(e.indexOf(" ") + 1).split(" ");
        return { type: t.shift(), parameter: t.join(" ") };
      }),
      (t.writeRtcpFb = function (e) {
        let t = "",
          r = e.payloadType;
        return (
          void 0 !== e.preferredPayloadType && (r = e.preferredPayloadType),
          e.rtcpFeedback &&
            e.rtcpFeedback.length &&
            e.rtcpFeedback.forEach((e) => {
              t +=
                "a=rtcp-fb:" +
                r +
                " " +
                e.type +
                (e.parameter && e.parameter.length ? " " + e.parameter : "") +
                "\r\n";
            }),
          t
        );
      }),
      (t.parseSsrcMedia = function (e) {
        const t = e.indexOf(" "),
          r = { ssrc: parseInt(e.substr(7, t - 7), 10) },
          i = e.indexOf(":", t);
        return (
          i > -1
            ? ((r.attribute = e.substr(t + 1, i - t - 1)),
              (r.value = e.substr(i + 1)))
            : (r.attribute = e.substr(t + 1)),
          r
        );
      }),
      (t.parseSsrcGroup = function (e) {
        const t = e.substr(13).split(" ");
        return { semantics: t.shift(), ssrcs: t.map((e) => parseInt(e, 10)) };
      }),
      (t.getMid = function (e) {
        const r = t.matchPrefix(e, "a=mid:")[0];
        if (r) return r.substr(6);
      }),
      (t.parseFingerprint = function (e) {
        const t = e.substr(14).split(" ");
        return { algorithm: t[0].toLowerCase(), value: t[1].toUpperCase() };
      }),
      (t.getDtlsParameters = function (e, r) {
        return {
          role: "auto",
          fingerprints: t
            .matchPrefix(e + r, "a=fingerprint:")
            .map(t.parseFingerprint),
        };
      }),
      (t.writeDtlsParameters = function (e, t) {
        let r = "a=setup:" + t + "\r\n";
        return (
          e.fingerprints.forEach((e) => {
            r += "a=fingerprint:" + e.algorithm + " " + e.value + "\r\n";
          }),
          r
        );
      }),
      (t.parseCryptoLine = function (e) {
        const t = e.substr(9).split(" ");
        return {
          tag: parseInt(t[0], 10),
          cryptoSuite: t[1],
          keyParams: t[2],
          sessionParams: t.slice(3),
        };
      }),
      (t.writeCryptoLine = function (e) {
        return (
          "a=crypto:" +
          e.tag +
          " " +
          e.cryptoSuite +
          " " +
          ("object" == typeof e.keyParams
            ? t.writeCryptoKeyParams(e.keyParams)
            : e.keyParams) +
          (e.sessionParams ? " " + e.sessionParams.join(" ") : "") +
          "\r\n"
        );
      }),
      (t.parseCryptoKeyParams = function (e) {
        if (0 !== e.indexOf("inline:")) return null;
        const t = e.substr(7).split("|");
        return {
          keyMethod: "inline",
          keySalt: t[0],
          lifeTime: t[1],
          mkiValue: t[2] ? t[2].split(":")[0] : void 0,
          mkiLength: t[2] ? t[2].split(":")[1] : void 0,
        };
      }),
      (t.writeCryptoKeyParams = function (e) {
        return (
          e.keyMethod +
          ":" +
          e.keySalt +
          (e.lifeTime ? "|" + e.lifeTime : "") +
          (e.mkiValue && e.mkiLength
            ? "|" + e.mkiValue + ":" + e.mkiLength
            : "")
        );
      }),
      (t.getCryptoParameters = function (e, r) {
        return t.matchPrefix(e + r, "a=crypto:").map(t.parseCryptoLine);
      }),
      (t.getIceParameters = function (e, r) {
        const i = t.matchPrefix(e + r, "a=ice-ufrag:")[0],
          n = t.matchPrefix(e + r, "a=ice-pwd:")[0];
        return i && n
          ? { usernameFragment: i.substr(12), password: n.substr(10) }
          : null;
      }),
      (t.writeIceParameters = function (e) {
        let t =
          "a=ice-ufrag:" +
          e.usernameFragment +
          "\r\na=ice-pwd:" +
          e.password +
          "\r\n";
        return (e.iceLite && (t += "a=ice-lite\r\n"), t);
      }),
      (t.parseRtpParameters = function (e) {
        const r = {
            codecs: [],
            headerExtensions: [],
            fecMechanisms: [],
            rtcp: [],
          },
          i = t.splitLines(e)[0].split(" ");
        for (let n = 3; n < i.length; n++) {
          const o = i[n],
            a = t.matchPrefix(e, "a=rtpmap:" + o + " ")[0];
          if (a) {
            const i = t.parseRtpMap(a),
              n = t.matchPrefix(e, "a=fmtp:" + o + " ");
            switch (
              ((i.parameters = n.length ? t.parseFmtp(n[0]) : {}),
              (i.rtcpFeedback = t
                .matchPrefix(e, "a=rtcp-fb:" + o + " ")
                .map(t.parseRtcpFb)),
              r.codecs.push(i),
              i.name.toUpperCase())
            ) {
              case "RED":
              case "ULPFEC":
                r.fecMechanisms.push(i.name.toUpperCase());
            }
          }
        }
        return (
          t.matchPrefix(e, "a=extmap:").forEach((e) => {
            r.headerExtensions.push(t.parseExtmap(e));
          }),
          r
        );
      }),
      (t.writeRtpDescription = function (e, r) {
        let i = "";
        ((i += "m=" + e + " "),
          (i += r.codecs.length > 0 ? "9" : "0"),
          (i += " UDP/TLS/RTP/SAVPF "),
          (i +=
            r.codecs
              .map((e) =>
                void 0 !== e.preferredPayloadType
                  ? e.preferredPayloadType
                  : e.payloadType,
              )
              .join(" ") + "\r\n"),
          (i += "c=IN IP4 0.0.0.0\r\n"),
          (i += "a=rtcp:9 IN IP4 0.0.0.0\r\n"),
          r.codecs.forEach((e) => {
            ((i += t.writeRtpMap(e)),
              (i += t.writeFmtp(e)),
              (i += t.writeRtcpFb(e)));
          }));
        let n = 0;
        return (
          r.codecs.forEach((e) => {
            e.maxptime > n && (n = e.maxptime);
          }),
          n > 0 && (i += "a=maxptime:" + n + "\r\n"),
          r.headerExtensions &&
            r.headerExtensions.forEach((e) => {
              i += t.writeExtmap(e);
            }),
          i
        );
      }),
      (t.parseRtpEncodingParameters = function (e) {
        const r = [],
          i = t.parseRtpParameters(e),
          n = -1 !== i.fecMechanisms.indexOf("RED"),
          o = -1 !== i.fecMechanisms.indexOf("ULPFEC"),
          a = t
            .matchPrefix(e, "a=ssrc:")
            .map((e) => t.parseSsrcMedia(e))
            .filter((e) => "cname" === e.attribute),
          s = a.length > 0 && a[0].ssrc;
        let c;
        const u = t.matchPrefix(e, "a=ssrc-group:FID").map((e) =>
          e
            .substr(17)
            .split(" ")
            .map((e) => parseInt(e, 10)),
        );
        (u.length > 0 && u[0].length > 1 && u[0][0] === s && (c = u[0][1]),
          i.codecs.forEach((e) => {
            if ("RTX" === e.name.toUpperCase() && e.parameters.apt) {
              let t = {
                ssrc: s,
                codecPayloadType: parseInt(e.parameters.apt, 10),
              };
              (s && c && (t.rtx = { ssrc: c }),
                r.push(t),
                n &&
                  ((t = JSON.parse(JSON.stringify(t))),
                  (t.fec = { ssrc: s, mechanism: o ? "red+ulpfec" : "red" }),
                  r.push(t)));
            }
          }),
          0 === r.length && s && r.push({ ssrc: s }));
        let d = t.matchPrefix(e, "b=");
        return (
          d.length &&
            ((d =
              0 === d[0].indexOf("b=TIAS:")
                ? parseInt(d[0].substr(7), 10)
                : 0 === d[0].indexOf("b=AS:")
                  ? 1e3 * parseInt(d[0].substr(5), 10) * 0.95 - 16e3
                  : void 0),
            r.forEach((e) => {
              e.maxBitrate = d;
            })),
          r
        );
      }),
      (t.parseRtcpParameters = function (e) {
        const r = {},
          i = t
            .matchPrefix(e, "a=ssrc:")
            .map((e) => t.parseSsrcMedia(e))
            .filter((e) => "cname" === e.attribute)[0];
        i && ((r.cname = i.value), (r.ssrc = i.ssrc));
        const n = t.matchPrefix(e, "a=rtcp-rsize");
        ((r.reducedSize = n.length > 0), (r.compound = 0 === n.length));
        const o = t.matchPrefix(e, "a=rtcp-mux");
        return ((r.mux = o.length > 0), r);
      }),
      (t.writeRtcpParameters = function (e) {
        let t = "";
        return (
          e.reducedSize && (t += "a=rtcp-rsize\r\n"),
          e.mux && (t += "a=rtcp-mux\r\n"),
          void 0 !== e.ssrc &&
            e.cname &&
            (t += "a=ssrc:" + e.ssrc + " cname:" + e.cname + "\r\n"),
          t
        );
      }),
      (t.parseMsid = function (e) {
        let r;
        const i = t.matchPrefix(e, "a=msid:");
        if (1 === i.length)
          return (
            (r = i[0].substr(7).split(" ")),
            { stream: r[0], track: r[1] }
          );
        const n = t
          .matchPrefix(e, "a=ssrc:")
          .map((e) => t.parseSsrcMedia(e))
          .filter((e) => "msid" === e.attribute);
        return n.length > 0
          ? ((r = n[0].value.split(" ")), { stream: r[0], track: r[1] })
          : void 0;
      }),
      (t.parseSctpDescription = function (e) {
        const r = t.parseMLine(e),
          i = t.matchPrefix(e, "a=max-message-size:");
        let n;
        (i.length > 0 && (n = parseInt(i[0].substr(19), 10)),
          isNaN(n) && (n = 65536));
        const o = t.matchPrefix(e, "a=sctp-port:");
        if (o.length > 0)
          return {
            port: parseInt(o[0].substr(12), 10),
            protocol: r.fmt,
            maxMessageSize: n,
          };
        const a = t.matchPrefix(e, "a=sctpmap:");
        if (a.length > 0) {
          const e = a[0].substr(10).split(" ");
          return {
            port: parseInt(e[0], 10),
            protocol: e[1],
            maxMessageSize: n,
          };
        }
      }),
      (t.writeSctpDescription = function (e, t) {
        let r = [];
        return (
          (r =
            "DTLS/SCTP" !== e.protocol
              ? [
                  "m=" +
                    e.kind +
                    " 9 " +
                    e.protocol +
                    " " +
                    t.protocol +
                    "\r\n",
                  "c=IN IP4 0.0.0.0\r\n",
                  "a=sctp-port:" + t.port + "\r\n",
                ]
              : [
                  "m=" + e.kind + " 9 " + e.protocol + " " + t.port + "\r\n",
                  "c=IN IP4 0.0.0.0\r\n",
                  "a=sctpmap:" + t.port + " " + t.protocol + " 65535\r\n",
                ]),
          void 0 !== t.maxMessageSize &&
            r.push("a=max-message-size:" + t.maxMessageSize + "\r\n"),
          r.join("")
        );
      }),
      (t.generateSessionId = function () {
        return Math.random().toString().substr(2, 21);
      }),
      (t.writeSessionBoilerplate = function (e, r, i) {
        let n;
        const o = void 0 !== r ? r : 2;
        return (
          (n = e || t.generateSessionId()),
          "v=0\r\no=" +
            (i || "thisisadapterortc") +
            " " +
            n +
            " " +
            o +
            " IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"
        );
      }),
      (t.getDirection = function (e, r) {
        const i = t.splitLines(e);
        for (let e = 0; e < i.length; e++)
          switch (i[e]) {
            case "a=sendrecv":
            case "a=sendonly":
            case "a=recvonly":
            case "a=inactive":
              return i[e].substr(2);
          }
        return r ? t.getDirection(r) : "sendrecv";
      }),
      (t.getKind = function (e) {
        return t.splitLines(e)[0].split(" ")[0].substr(2);
      }),
      (t.isRejected = function (e) {
        return "0" === e.split(" ", 2)[1];
      }),
      (t.parseMLine = function (e) {
        const r = t.splitLines(e)[0].substr(2).split(" ");
        return {
          kind: r[0],
          port: parseInt(r[1], 10),
          protocol: r[2],
          fmt: r.slice(3).join(" "),
        };
      }),
      (t.parseOLine = function (e) {
        const r = t.matchPrefix(e, "o=")[0].substr(2).split(" ");
        return {
          username: r[0],
          sessionId: r[1],
          sessionVersion: parseInt(r[2], 10),
          netType: r[3],
          addressType: r[4],
          address: r[5],
        };
      }),
      (t.isValidSDP = function (e) {
        if ("string" != typeof e || 0 === e.length) return !1;
        const r = t.splitLines(e);
        for (let e = 0; e < r.length; e++)
          if (r[e].length < 2 || "=" !== r[e].charAt(1)) return !1;
        return !0;
      }),
      (e.exports = t));
  }),
  Fi = Object.freeze(Object.assign(Object.create(null), ji, { default: ji }));
function Bi(e) {
  if (
    !e.RTCIceCandidate ||
    (e.RTCIceCandidate && "foundation" in e.RTCIceCandidate.prototype)
  )
    return;
  const t = e.RTCIceCandidate;
  ((e.RTCIceCandidate = function (e) {
    if (
      ("object" == typeof e &&
        e.candidate &&
        0 === e.candidate.indexOf("a=") &&
        ((e = JSON.parse(JSON.stringify(e))).candidate = e.candidate.substr(2)),
      e.candidate && e.candidate.length)
    ) {
      const r = new t(e),
        i = ji.parseCandidate(e.candidate),
        n = Object.assign(r, i);
      return (
        (n.toJSON = function () {
          return {
            candidate: n.candidate,
            sdpMid: n.sdpMid,
            sdpMLineIndex: n.sdpMLineIndex,
            usernameFragment: n.usernameFragment,
          };
        }),
        n
      );
    }
    return new t(e);
  }),
    (e.RTCIceCandidate.prototype = t.prototype),
    Xr(
      e,
      "icecandidate",
      (t) => (
        t.candidate &&
          Object.defineProperty(t, "candidate", {
            value: new e.RTCIceCandidate(t.candidate),
            writable: "false",
          }),
        t
      ),
    ));
}
function Wi(e, t) {
  if (!e.RTCPeerConnection) return;
  "sctp" in e.RTCPeerConnection.prototype ||
    Object.defineProperty(e.RTCPeerConnection.prototype, "sctp", {
      get() {
        return void 0 === this._sctp ? null : this._sctp;
      },
    });
  const r = function (e) {
      let r = 65536;
      return (
        "firefox" === t.browser &&
          (r =
            t.version < 57
              ? -1 === e
                ? 16384
                : 2147483637
              : t.version < 60
                ? 57 === t.version
                  ? 65535
                  : 65536
                : 2147483637),
        r
      );
    },
    i = function (e, r) {
      let i = 65536;
      "firefox" === t.browser && 57 === t.version && (i = 65535);
      const n = ji.matchPrefix(e.sdp, "a=max-message-size:");
      return (
        n.length > 0
          ? (i = parseInt(n[0].substr(19), 10))
          : "firefox" === t.browser && -1 !== r && (i = 2147483637),
        i
      );
    },
    n = e.RTCPeerConnection.prototype.setRemoteDescription;
  e.RTCPeerConnection.prototype.setRemoteDescription = function () {
    if (((this._sctp = null), "chrome" === t.browser && t.version >= 76)) {
      const { sdpSemantics: e } = this.getConfiguration();
      "plan-b" === e &&
        Object.defineProperty(this, "sctp", {
          get() {
            return void 0 === this._sctp ? null : this._sctp;
          },
          enumerable: !0,
          configurable: !0,
        });
    }
    if (
      (function (e) {
        if (!e || !e.sdp) return !1;
        const t = ji.splitSections(e.sdp);
        return (
          t.shift(),
          t.some((e) => {
            const t = ji.parseMLine(e);
            return (
              t && "application" === t.kind && -1 !== t.protocol.indexOf("SCTP")
            );
          })
        );
      })(arguments[0])
    ) {
      const e = (function (e) {
          const t = e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);
          if (null === t || t.length < 2) return -1;
          const r = parseInt(t[1], 10);
          return r != r ? -1 : r;
        })(arguments[0]),
        t = r(e),
        n = i(arguments[0], e);
      let o;
      o =
        0 === t && 0 === n
          ? Number.POSITIVE_INFINITY
          : 0 === t || 0 === n
            ? Math.max(t, n)
            : Math.min(t, n);
      const a = {};
      (Object.defineProperty(a, "maxMessageSize", { get: () => o }),
        (this._sctp = a));
    }
    return n.apply(this, arguments);
  };
}
function Gi(e) {
  if (
    !e.RTCPeerConnection ||
    !("createDataChannel" in e.RTCPeerConnection.prototype)
  )
    return;
  function t(e, t) {
    const r = e.send;
    e.send = function () {
      const i = arguments[0],
        n = i.length || i.size || i.byteLength;
      if ("open" === e.readyState && t.sctp && n > t.sctp.maxMessageSize)
        throw new TypeError(
          "Message too large (can send a maximum of " +
            t.sctp.maxMessageSize +
            " bytes)",
        );
      return r.apply(e, arguments);
    };
  }
  const r = e.RTCPeerConnection.prototype.createDataChannel;
  ((e.RTCPeerConnection.prototype.createDataChannel = function () {
    const e = r.apply(this, arguments);
    return (t(e, this), e);
  }),
    Xr(e, "datachannel", (e) => (t(e.channel, e.target), e)));
}
function Hi(e) {
  if (
    !e.RTCPeerConnection ||
    "connectionState" in e.RTCPeerConnection.prototype
  )
    return;
  const t = e.RTCPeerConnection.prototype;
  (Object.defineProperty(t, "connectionState", {
    get() {
      return (
        { completed: "connected", checking: "connecting" }[
          this.iceConnectionState
        ] || this.iceConnectionState
      );
    },
    enumerable: !0,
    configurable: !0,
  }),
    Object.defineProperty(t, "onconnectionstatechange", {
      get() {
        return this._onconnectionstatechange || null;
      },
      set(e) {
        (this._onconnectionstatechange &&
          (this.removeEventListener(
            "connectionstatechange",
            this._onconnectionstatechange,
          ),
          delete this._onconnectionstatechange),
          e &&
            this.addEventListener(
              "connectionstatechange",
              (this._onconnectionstatechange = e),
            ));
      },
      enumerable: !0,
      configurable: !0,
    }),
    ["setLocalDescription", "setRemoteDescription"].forEach((e) => {
      const r = t[e];
      t[e] = function () {
        return (
          this._connectionstatechangepoly ||
            ((this._connectionstatechangepoly = (e) => {
              const t = e.target;
              if (t._lastConnectionState !== t.connectionState) {
                t._lastConnectionState = t.connectionState;
                const r = new Event("connectionstatechange", e);
                t.dispatchEvent(r);
              }
              return e;
            }),
            this.addEventListener(
              "iceconnectionstatechange",
              this._connectionstatechangepoly,
            )),
          r.apply(this, arguments)
        );
      };
    }));
}
function Ji(e, t) {
  if (!e.RTCPeerConnection) return;
  if ("chrome" === t.browser && t.version >= 71) return;
  if ("safari" === t.browser && t.version >= 605) return;
  const r = e.RTCPeerConnection.prototype.setRemoteDescription;
  e.RTCPeerConnection.prototype.setRemoteDescription = function (t) {
    if (t && t.sdp && -1 !== t.sdp.indexOf("\na=extmap-allow-mixed")) {
      const r = t.sdp
        .split("\n")
        .filter((e) => "a=extmap-allow-mixed" !== e.trim())
        .join("\n");
      e.RTCSessionDescription && t instanceof e.RTCSessionDescription
        ? (arguments[0] = new e.RTCSessionDescription({ type: t.type, sdp: r }))
        : (t.sdp = r);
    }
    return r.apply(this, arguments);
  };
}
function zi(e, t) {
  if (!e.RTCPeerConnection || !e.RTCPeerConnection.prototype) return;
  const r = e.RTCPeerConnection.prototype.addIceCandidate;
  r &&
    0 !== r.length &&
    (e.RTCPeerConnection.prototype.addIceCandidate = function () {
      return arguments[0]
        ? (("chrome" === t.browser && t.version < 78) ||
            ("firefox" === t.browser && t.version < 68) ||
            "safari" === t.browser) &&
          arguments[0] &&
          "" === arguments[0].candidate
          ? Promise.resolve()
          : r.apply(this, arguments)
        : (arguments[1] && arguments[1].apply(null), Promise.resolve());
    });
}
function Ki(e, t) {
  if (!e.RTCPeerConnection || !e.RTCPeerConnection.prototype) return;
  const r = e.RTCPeerConnection.prototype.setLocalDescription;
  r &&
    0 !== r.length &&
    (e.RTCPeerConnection.prototype.setLocalDescription = function () {
      let e = arguments[0] || {};
      if ("object" != typeof e || (e.type && e.sdp))
        return r.apply(this, arguments);
      if (((e = { type: e.type, sdp: e.sdp }), !e.type))
        switch (this.signalingState) {
          case "stable":
          case "have-local-offer":
          case "have-remote-pranswer":
            e.type = "offer";
            break;
          default:
            e.type = "answer";
        }
      if (e.sdp || ("offer" !== e.type && "answer" !== e.type))
        return r.apply(this, [e]);
      return ("offer" === e.type ? this.createOffer : this.createAnswer)
        .apply(this)
        .then((e) => r.apply(this, [e]));
    });
}
var Yi = Object.freeze({
  __proto__: null,
  shimRTCIceCandidate: Bi,
  shimMaxMessageSize: Wi,
  shimSendThrowTypeError: Gi,
  shimConnectionState: Hi,
  removeExtmapAllowMixed: Ji,
  shimAddIceCandidateNullOrEmpty: zi,
  shimParameterlessSetLocalDescription: Ki,
});
const qi = (function (
  { window: e } = {},
  t = { shimChrome: !0, shimFirefox: !0, shimSafari: !0 },
) {
  const r = Zr,
    i = (function (e) {
      const t = { browser: null, version: null };
      if (void 0 === e || !e.navigator)
        return ((t.browser = "Not a browser."), t);
      const { navigator: r } = e;
      if (r.mozGetUserMedia)
        ((t.browser = "firefox"),
          (t.version = qr(r.userAgent, /Firefox\/(\d+)\./, 1)));
      else if (
        r.webkitGetUserMedia ||
        (!1 === e.isSecureContext &&
          e.webkitRTCPeerConnection &&
          !e.RTCIceGatherer)
      )
        ((t.browser = "chrome"),
          (t.version = qr(r.userAgent, /Chrom(e|ium)\/(\d+)\./, 2)));
      else {
        if (!e.RTCPeerConnection || !r.userAgent.match(/AppleWebKit\/(\d+)\./))
          return ((t.browser = "Not a supported browser."), t);
        ((t.browser = "safari"),
          (t.version = qr(r.userAgent, /AppleWebKit\/(\d+)\./, 1)),
          (t.supportsUnifiedPlan =
            e.RTCRtpTransceiver &&
            "currentDirection" in e.RTCRtpTransceiver.prototype));
      }
      return t;
    })(e),
    n = {
      browserDetails: i,
      commonShim: Yi,
      extractVersion: qr,
      disableLog: Qr,
      disableWarnings: $r,
      sdp: Fi,
    };
  switch (i.browser) {
    case "chrome":
      if (!vi || !fi || !t.shimChrome)
        return (r("Chrome shim is not included in this adapter release."), n);
      if (null === i.version)
        return (r("Chrome shim can not determine version, not shimming."), n);
      (r("adapter.js shimming chrome."),
        (n.browserShim = vi),
        zi(e, i),
        Ki(e),
        ai(e, i),
        si(e),
        fi(e, i),
        ci(e),
        pi(e, i),
        ui(e),
        di(e),
        li(e),
        mi(e, i),
        Bi(e),
        Hi(e),
        Wi(e, i),
        Gi(e),
        Ji(e, i));
      break;
    case "firefox":
      if (!wi || !bi || !t.shimFirefox)
        return (r("Firefox shim is not included in this adapter release."), n);
      (r("adapter.js shimming firefox."),
        (n.browserShim = wi),
        zi(e, i),
        Ki(e),
        gi(e, i),
        bi(e, i),
        yi(e),
        Ci(e),
        Si(e),
        Ei(e),
        Ti(e),
        Ri(e),
        Ii(e),
        _i(e),
        ki(e),
        Bi(e),
        Hi(e),
        Wi(e, i),
        Gi(e));
      break;
    case "safari":
      if (!Vi || !t.shimSafari)
        return (r("Safari shim is not included in this adapter release."), n);
      (r("adapter.js shimming safari."),
        (n.browserShim = Vi),
        zi(e, i),
        Ki(e),
        Di(e),
        Ui(e),
        Ai(e),
        Oi(e),
        Pi(e),
        Mi(e),
        Li(e),
        Ni(e),
        Bi(e),
        Wi(e, i),
        Gi(e),
        Ji(e, i));
      break;
    default:
      r("Unsupported browser!");
  }
  return n;
})({ window: "undefined" == typeof window ? void 0 : window });
var Xi;
(Xi = (Xi = window) || self).RTCBeautyPlugin = (function (e) {
  function t(e, t) {
    if (!(e instanceof t))
      throw new TypeError("Cannot call a class as a function");
  }
  function r(e, t) {
    for (var r = 0; r < t.length; r++) {
      var i = t[r];
      ((i.enumerable = i.enumerable || !1),
        (i.configurable = !0),
        "value" in i && (i.writable = !0),
        Object.defineProperty(e, i.key, i));
    }
  }
  function i(e, t, i) {
    return (t && r(e.prototype, t), i && r(e, i), e);
  }
  e = e && Object.prototype.hasOwnProperty.call(e, "default") ? e.default : e;
  var n =
    "undefined" != typeof globalThis
      ? globalThis
      : "undefined" != typeof window
        ? window
        : "undefined" != typeof global
          ? global
          : "undefined" != typeof self
            ? self
            : {};
  function o(e, t) {
    return (e((t = { exports: {} }), t.exports), t.exports);
  }
  var a,
    s,
    c = function (e) {
      return e && e.Math == Math && e;
    },
    u =
      c(
        "object" ==
          ("undefined" == typeof globalThis ? "undefined" : ne(globalThis)) &&
          globalThis,
      ) ||
      c(
        "object" == ("undefined" == typeof window ? "undefined" : ne(window)) &&
          window,
      ) ||
      c(
        "object" == ("undefined" == typeof self ? "undefined" : ne(self)) &&
          self,
      ) ||
      c("object" == ne(n) && n) ||
      (function () {
        return this;
      })() ||
      Function("return this")(),
    d = function (e) {
      try {
        return !!e();
      } catch (e) {
        return !0;
      }
    },
    l = !d(function () {
      return (
        7 !=
        Object.defineProperty({}, 1, {
          get: function () {
            return 7;
          },
        })[1]
      );
    }),
    h = {}.propertyIsEnumerable,
    p = Object.getOwnPropertyDescriptor,
    f = {
      f:
        p && !h.call({ 1: 2 }, 1)
          ? function (e) {
              var t = p(this, e);
              return !!t && t.enumerable;
            }
          : h,
    },
    m = function (e, t) {
      return {
        enumerable: !(1 & e),
        configurable: !(2 & e),
        writable: !(4 & e),
        value: t,
      };
    },
    v = {}.toString,
    g = function (e) {
      return v.call(e).slice(8, -1);
    },
    y = "".split,
    b = d(function () {
      return !Object("z").propertyIsEnumerable(0);
    })
      ? function (e) {
          return "String" == g(e) ? y.call(e, "") : Object(e);
        }
      : Object,
    S = function (e) {
      if (null == e) throw TypeError("Can't call method on " + e);
      return e;
    },
    E = function (e) {
      return b(S(e));
    },
    C = function (e) {
      return "object" == ne(e) ? null !== e : "function" == typeof e;
    },
    T = function (e, t) {
      return arguments.length < 2
        ? (function (e) {
            return "function" == typeof e ? e : void 0;
          })(u[e])
        : u[e] && u[e][t];
    },
    R = T("navigator", "userAgent") || "",
    I = u.process,
    _ = u.Deno,
    k = (I && I.versions) || (_ && _.version),
    w = k && k.v8;
  w
    ? (s = (a = w.split("."))[0] < 4 ? 1 : a[0] + a[1])
    : R &&
      (!(a = R.match(/Edge\/(\d+)/)) || a[1] >= 74) &&
      (a = R.match(/Chrome\/(\d+)/)) &&
      (s = a[1]);
  var O = s && +s,
    P =
      !!Object.getOwnPropertySymbols &&
      !d(function () {
        var e = Symbol();
        return (
          !String(e) ||
          !(Object(e) instanceof Symbol) ||
          (!Symbol.sham && O && O < 41)
        );
      }),
    A = P && !Symbol.sham && "symbol" == ne(Symbol.iterator),
    L = A
      ? function (e) {
          return "symbol" == ne(e);
        }
      : function (e) {
          var t = T("Symbol");
          return "function" == typeof t && Object(e) instanceof t;
        },
    x = function (e, t) {
      try {
        Object.defineProperty(u, e, {
          value: t,
          configurable: !0,
          writable: !0,
        });
      } catch (r) {
        u[e] = t;
      }
      return t;
    },
    D = u["__core-js_shared__"] || x("__core-js_shared__", {}),
    M = o(function (e) {
      (e.exports = function (e, t) {
        return D[e] || (D[e] = void 0 !== t ? t : {});
      })("versions", []).push({
        version: "3.16.0",
        mode: "global",
        copyright: "© 2021 Denis Pushkarev (zloirock.ru)",
      });
    }),
    U = function (e) {
      return Object(S(e));
    },
    N = {}.hasOwnProperty,
    V =
      Object.hasOwn ||
      function (e, t) {
        return N.call(U(e), t);
      },
    j = 0,
    F = Math.random(),
    B = function (e) {
      return (
        "Symbol(" +
        String(void 0 === e ? "" : e) +
        ")_" +
        (++j + F).toString(36)
      );
    },
    W = M("wks"),
    G = u.Symbol,
    H = A ? G : (G && G.withoutSetter) || B,
    J = function (e) {
      return (
        (V(W, e) && (P || "string" == typeof W[e])) ||
          (W[e] = P && V(G, e) ? G[e] : H("Symbol." + e)),
        W[e]
      );
    },
    z = J("toPrimitive"),
    K = function (e) {
      var t = (function (e, t) {
        if (!C(e) || L(e)) return e;
        var r,
          i = e[z];
        if (void 0 !== i) {
          if (
            (void 0 === t && (t = "default"), (r = i.call(e, t)), !C(r) || L(r))
          )
            return r;
          throw TypeError("Can't convert object to primitive value");
        }
        return (
          void 0 === t && (t = "number"),
          (function (e, t) {
            var r, i;
            if (
              "string" === t &&
              "function" == typeof (r = e.toString) &&
              !C((i = r.call(e)))
            )
              return i;
            if ("function" == typeof (r = e.valueOf) && !C((i = r.call(e))))
              return i;
            if (
              "string" !== t &&
              "function" == typeof (r = e.toString) &&
              !C((i = r.call(e)))
            )
              return i;
            throw TypeError("Can't convert object to primitive value");
          })(e, t)
        );
      })(e, "string");
      return L(t) ? t : String(t);
    },
    Y = u.document,
    q = C(Y) && C(Y.createElement),
    X = function (e) {
      return q ? Y.createElement(e) : {};
    },
    Q =
      !l &&
      !d(function () {
        return (
          7 !=
          Object.defineProperty(X("div"), "a", {
            get: function () {
              return 7;
            },
          }).a
        );
      }),
    $ = Object.getOwnPropertyDescriptor,
    Z = {
      f: l
        ? $
        : function (e, t) {
            if (((e = E(e)), (t = K(t)), Q))
              try {
                return $(e, t);
              } catch (e) {}
            if (V(e, t)) return m(!f.f.call(e, t), e[t]);
          },
    },
    ee = function (e) {
      if (!C(e)) throw TypeError(String(e) + " is not an object");
      return e;
    },
    te = Object.defineProperty,
    re = {
      f: l
        ? te
        : function (e, t, r) {
            if ((ee(e), (t = K(t)), ee(r), Q))
              try {
                return te(e, t, r);
              } catch (e) {}
            if ("get" in r || "set" in r)
              throw TypeError("Accessors not supported");
            return ("value" in r && (e[t] = r.value), e);
          },
    },
    ie = l
      ? function (e, t, r) {
          return re.f(e, t, m(1, r));
        }
      : function (e, t, r) {
          return ((e[t] = r), e);
        },
    oe = Function.toString;
  "function" != typeof D.inspectSource &&
    (D.inspectSource = function (e) {
      return oe.call(e);
    });
  var ae,
    se,
    ce,
    ue = D.inspectSource,
    de = u.WeakMap,
    le = "function" == typeof de && /native code/.test(ue(de)),
    he = M("keys"),
    pe = function (e) {
      return he[e] || (he[e] = B(e));
    },
    fe = {},
    me = u.WeakMap;
  if (le || D.state) {
    var ve = D.state || (D.state = new me()),
      ge = ve.get,
      ye = ve.has,
      be = ve.set;
    ((ae = function (e, t) {
      if (ye.call(ve, e)) throw new TypeError("Object already initialized");
      return ((t.facade = e), be.call(ve, e, t), t);
    }),
      (se = function (e) {
        return ge.call(ve, e) || {};
      }),
      (ce = function (e) {
        return ye.call(ve, e);
      }));
  } else {
    var Se = pe("state");
    ((fe[Se] = !0),
      (ae = function (e, t) {
        if (V(e, Se)) throw new TypeError("Object already initialized");
        return ((t.facade = e), ie(e, Se, t), t);
      }),
      (se = function (e) {
        return V(e, Se) ? e[Se] : {};
      }),
      (ce = function (e) {
        return V(e, Se);
      }));
  }
  var Ee = {
      set: ae,
      get: se,
      has: ce,
      enforce: function (e) {
        return ce(e) ? se(e) : ae(e, {});
      },
      getterFor: function (e) {
        return function (t) {
          var r;
          if (!C(t) || (r = se(t)).type !== e)
            throw TypeError("Incompatible receiver, " + e + " required");
          return r;
        };
      },
    },
    Ce = o(function (e) {
      var t = Ee.get,
        r = Ee.enforce,
        i = String(String).split("String");
      (e.exports = function (e, t, n, o) {
        var a,
          s = !!o && !!o.unsafe,
          c = !!o && !!o.enumerable,
          d = !!o && !!o.noTargetGet;
        ("function" == typeof n &&
          ("string" != typeof t || V(n, "name") || ie(n, "name", t),
          (a = r(n)).source ||
            (a.source = i.join("string" == typeof t ? t : ""))),
          e !== u
            ? (s ? !d && e[t] && (c = !0) : delete e[t],
              c ? (e[t] = n) : ie(e, t, n))
            : c
              ? (e[t] = n)
              : x(t, n));
      })(Function.prototype, "toString", function () {
        return ("function" == typeof this && t(this).source) || ue(this);
      });
    }),
    Te = Math.ceil,
    Re = Math.floor,
    Ie = function (e) {
      return isNaN((e = +e)) ? 0 : (e > 0 ? Re : Te)(e);
    },
    _e = Math.min,
    ke = function (e) {
      return e > 0 ? _e(Ie(e), 9007199254740991) : 0;
    },
    we = Math.max,
    Oe = Math.min,
    Pe = function (e, t) {
      var r = Ie(e);
      return r < 0 ? we(r + t, 0) : Oe(r, t);
    },
    Ae = function (e) {
      return function (t, r, i) {
        var n,
          o = E(t),
          a = ke(o.length),
          s = Pe(i, a);
        if (e && r != r) {
          for (; a > s; ) if ((n = o[s++]) != n) return !0;
        } else
          for (; a > s; s++)
            if ((e || s in o) && o[s] === r) return e || s || 0;
        return !e && -1;
      };
    },
    Le = { includes: Ae(!0), indexOf: Ae(!1) },
    xe = Le.indexOf,
    De = function (e, t) {
      var r,
        i = E(e),
        n = 0,
        o = [];
      for (r in i) !V(fe, r) && V(i, r) && o.push(r);
      for (; t.length > n; ) V(i, (r = t[n++])) && (~xe(o, r) || o.push(r));
      return o;
    },
    Me = [
      "constructor",
      "hasOwnProperty",
      "isPrototypeOf",
      "propertyIsEnumerable",
      "toLocaleString",
      "toString",
      "valueOf",
    ],
    Ue = Me.concat("length", "prototype"),
    Ne = {
      f:
        Object.getOwnPropertyNames ||
        function (e) {
          return De(e, Ue);
        },
    },
    Ve = { f: Object.getOwnPropertySymbols },
    je =
      T("Reflect", "ownKeys") ||
      function (e) {
        var t = Ne.f(ee(e)),
          r = Ve.f;
        return r ? t.concat(r(e)) : t;
      },
    Fe = function (e, t) {
      for (var r = je(t), i = re.f, n = Z.f, o = 0; o < r.length; o++) {
        var a = r[o];
        V(e, a) || i(e, a, n(t, a));
      }
    },
    Be = /#|\.prototype\./,
    We = function (e, t) {
      var r = He[Ge(e)];
      return r == ze || (r != Je && ("function" == typeof t ? d(t) : !!t));
    },
    Ge = (We.normalize = function (e) {
      return String(e).replace(Be, ".").toLowerCase();
    }),
    He = (We.data = {}),
    Je = (We.NATIVE = "N"),
    ze = (We.POLYFILL = "P"),
    Ke = We,
    Ye = Z.f,
    qe = function (e, t) {
      var r,
        i,
        n,
        o,
        a,
        s = e.target,
        c = e.global,
        d = e.stat;
      if ((r = c ? u : d ? u[s] || x(s, {}) : (u[s] || {}).prototype))
        for (i in t) {
          if (
            ((o = t[i]),
            (n = e.noTargetGet ? (a = Ye(r, i)) && a.value : r[i]),
            !Ke(c ? i : s + (d ? "." : "#") + i, e.forced) && void 0 !== n)
          ) {
            if (ne(o) == ne(n)) continue;
            Fe(o, n);
          }
          ((e.sham || (n && n.sham)) && ie(o, "sham", !0), Ce(r, i, o, e));
        }
    },
    Xe = function (e) {
      if ("function" != typeof e)
        throw TypeError(String(e) + " is not a function");
      return e;
    },
    Qe = function (e, t, r) {
      if ((Xe(e), void 0 === t)) return e;
      switch (r) {
        case 0:
          return function () {
            return e.call(t);
          };
        case 1:
          return function (r) {
            return e.call(t, r);
          };
        case 2:
          return function (r, i) {
            return e.call(t, r, i);
          };
        case 3:
          return function (r, i, n) {
            return e.call(t, r, i, n);
          };
      }
      return function () {
        return e.apply(t, arguments);
      };
    },
    $e =
      Array.isArray ||
      function (e) {
        return "Array" == g(e);
      },
    Ze = J("species"),
    et = function (e, t) {
      return new ((function (e) {
        var t;
        return (
          $e(e) &&
            ("function" != typeof (t = e.constructor) ||
            (t !== Array && !$e(t.prototype))
              ? C(t) && null === (t = t[Ze]) && (t = void 0)
              : (t = void 0)),
          void 0 === t ? Array : t
        );
      })(e))(0 === t ? 0 : t);
    },
    tt = [].push,
    rt = function (e) {
      var t = 1 == e,
        r = 2 == e,
        i = 3 == e,
        n = 4 == e,
        o = 6 == e,
        a = 7 == e,
        s = 5 == e || o;
      return function (c, u, d, l) {
        for (
          var h,
            p,
            f = U(c),
            m = b(f),
            v = Qe(u, d, 3),
            g = ke(m.length),
            y = 0,
            S = l || et,
            E = t ? S(c, g) : r || a ? S(c, 0) : void 0;
          g > y;
          y++
        )
          if ((s || y in m) && ((p = v((h = m[y]), y, f)), e))
            if (t) E[y] = p;
            else if (p)
              switch (e) {
                case 3:
                  return !0;
                case 5:
                  return h;
                case 6:
                  return y;
                case 2:
                  tt.call(E, h);
              }
            else
              switch (e) {
                case 4:
                  return !1;
                case 7:
                  tt.call(E, h);
              }
        return o ? -1 : i || n ? n : E;
      };
    },
    it = {
      forEach: rt(0),
      map: rt(1),
      filter: rt(2),
      some: rt(3),
      every: rt(4),
      find: rt(5),
      findIndex: rt(6),
      filterReject: rt(7),
    },
    nt = J("species"),
    ot = it.filter,
    at =
      O >= 51 ||
      !d(function () {
        var e = [];
        return (
          ((e.constructor = {})[nt] = function () {
            return { foo: 1 };
          }),
          1 !== e.filter(Boolean).foo
        );
      });
  qe(
    { target: "Array", proto: !0, forced: !at },
    {
      filter: function (e) {
        return ot(this, e, arguments.length > 1 ? arguments[1] : void 0);
      },
    },
  );
  var st = Date.prototype,
    ct = st.toString,
    ut = st.getTime;
  "Invalid Date" != String(new Date(NaN)) &&
    Ce(st, "toString", function () {
      var e = ut.call(this);
      return e == e ? ct.call(this) : "Invalid Date";
    });
  var dt = [].slice,
    lt = {};
  qe(
    { target: "Function", proto: !0 },
    {
      bind:
        Function.bind ||
        function (e) {
          var t = Xe(this),
            r = dt.call(arguments, 1),
            i = function i() {
              var n = r.concat(dt.call(arguments));
              return this instanceof i
                ? (function (e, t, r) {
                    if (!(t in lt)) {
                      for (var i = [], n = 0; n < t; n++) i[n] = "a[" + n + "]";
                      lt[t] = Function(
                        "C,a",
                        "return new C(" + i.join(",") + ")",
                      );
                    }
                    return lt[t](e, r);
                  })(t, n.length, n)
                : t.apply(e, n);
            };
          return (C(t.prototype) && (i.prototype = t.prototype), i);
        },
    },
  );
  var ht = [].slice,
    pt = /MSIE .\./.test(R),
    ft = function (e) {
      return function (t, r) {
        var i = arguments.length > 2,
          n = i ? ht.call(arguments, 2) : void 0;
        return e(
          i
            ? function () {
                ("function" == typeof t ? t : Function(t)).apply(this, n);
              }
            : t,
          r,
        );
      };
    };
  qe(
    { global: !0, bind: !0, forced: pt },
    { setTimeout: ft(u.setTimeout), setInterval: ft(u.setInterval) },
  );
  var mt,
    vt =
      Object.keys ||
      function (e) {
        return De(e, Me);
      },
    gt = l
      ? Object.defineProperties
      : function (e, t) {
          ee(e);
          for (var r, i = vt(t), n = i.length, o = 0; n > o; )
            re.f(e, (r = i[o++]), t[r]);
          return e;
        },
    yt = T("document", "documentElement"),
    bt = pe("IE_PROTO"),
    St = function () {},
    Et = function (e) {
      return "<script>" + e + "<\/script>";
    },
    Ct = function (e) {
      (e.write(Et("")), e.close());
      var t = e.parentWindow.Object;
      return ((e = null), t);
    },
    Tt = function () {
      try {
        mt = new ActiveXObject("htmlfile");
      } catch (e) {}
      Tt =
        document.domain && mt
          ? Ct(mt)
          : (function () {
              var e,
                t = X("iframe");
              if (t.style)
                return (
                  (t.style.display = "none"),
                  yt.appendChild(t),
                  (t.src = String("javascript:")),
                  (e = t.contentWindow.document).open(),
                  e.write(Et("document.F=Object")),
                  e.close(),
                  e.F
                );
            })() || Ct(mt);
      for (var e = Me.length; e--; ) delete Tt.prototype[Me[e]];
      return Tt();
    };
  fe[bt] = !0;
  var Rt =
      Object.create ||
      function (e, t) {
        var r;
        return (
          null !== e
            ? ((St.prototype = ee(e)),
              (r = new St()),
              (St.prototype = null),
              (r[bt] = e))
            : (r = Tt()),
          void 0 === t ? r : gt(r, t)
        );
      },
    It = J("unscopables"),
    _t = Array.prototype;
  null == _t[It] && re.f(_t, It, { configurable: !0, value: Rt(null) });
  var kt,
    wt,
    Ot,
    Pt = function (e) {
      _t[It][e] = !0;
    },
    At = {},
    Lt = !d(function () {
      function e() {}
      return (
        (e.prototype.constructor = null),
        Object.getPrototypeOf(new e()) !== e.prototype
      );
    }),
    xt = pe("IE_PROTO"),
    Dt = Object.prototype,
    Mt = Lt
      ? Object.getPrototypeOf
      : function (e) {
          return (
            (e = U(e)),
            V(e, xt)
              ? e[xt]
              : "function" == typeof e.constructor && e instanceof e.constructor
                ? e.constructor.prototype
                : e instanceof Object
                  ? Dt
                  : null
          );
        },
    Ut = J("iterator"),
    Nt = !1;
  ([].keys &&
    ("next" in (Ot = [].keys())
      ? (wt = Mt(Mt(Ot))) !== Object.prototype && (kt = wt)
      : (Nt = !0)),
    (null == kt ||
      d(function () {
        var e = {};
        return kt[Ut].call(e) !== e;
      })) &&
      (kt = {}),
    V(kt, Ut) ||
      ie(kt, Ut, function () {
        return this;
      }));
  var Vt = { IteratorPrototype: kt, BUGGY_SAFARI_ITERATORS: Nt },
    jt = re.f,
    Ft = J("toStringTag"),
    Bt = function (e, t, r) {
      e &&
        !V((e = r ? e : e.prototype), Ft) &&
        jt(e, Ft, { configurable: !0, value: t });
    },
    Wt = Vt.IteratorPrototype,
    Gt = function () {
      return this;
    },
    Ht =
      Object.setPrototypeOf ||
      ("__proto__" in {}
        ? (function () {
            var e,
              t = !1,
              r = {};
            try {
              ((e = Object.getOwnPropertyDescriptor(
                Object.prototype,
                "__proto__",
              ).set).call(r, []),
                (t = r instanceof Array));
            } catch (e) {}
            return function (r, i) {
              return (
                ee(r),
                (function (e) {
                  if (!C(e) && null !== e)
                    throw TypeError(
                      "Can't set " + String(e) + " as a prototype",
                    );
                })(i),
                t ? e.call(r, i) : (r.__proto__ = i),
                r
              );
            };
          })()
        : void 0),
    Jt = Vt.IteratorPrototype,
    zt = Vt.BUGGY_SAFARI_ITERATORS,
    Kt = J("iterator"),
    Yt = function () {
      return this;
    },
    qt = function (e, t, r, i, n, o, a) {
      !(function (e, t, r) {
        var i = t + " Iterator";
        ((e.prototype = Rt(Wt, { next: m(1, r) })), Bt(e, i, !1), (At[i] = Gt));
      })(r, t, i);
      var s,
        c,
        u,
        d = function (e) {
          if (e === n && v) return v;
          if (!zt && e in p) return p[e];
          switch (e) {
            case "keys":
            case "values":
            case "entries":
              return function () {
                return new r(this, e);
              };
          }
          return function () {
            return new r(this);
          };
        },
        l = t + " Iterator",
        h = !1,
        p = e.prototype,
        f = p[Kt] || p["@@iterator"] || (n && p[n]),
        v = (!zt && f) || d(n),
        g = ("Array" == t && p.entries) || f;
      if (
        (g &&
          ((s = Mt(g.call(new e()))),
          Jt !== Object.prototype &&
            s.next &&
            (Mt(s) !== Jt &&
              (Ht ? Ht(s, Jt) : "function" != typeof s[Kt] && ie(s, Kt, Yt)),
            Bt(s, l, !0))),
        "values" == n &&
          f &&
          "values" !== f.name &&
          ((h = !0),
          (v = function () {
            return f.call(this);
          })),
        p[Kt] !== v && ie(p, Kt, v),
        (At[t] = v),
        n)
      )
        if (
          ((c = {
            values: d("values"),
            keys: o ? v : d("keys"),
            entries: d("entries"),
          }),
          a)
        )
          for (u in c) (zt || h || !(u in p)) && Ce(p, u, c[u]);
        else qe({ target: t, proto: !0, forced: zt || h }, c);
      return c;
    },
    Xt = Ee.set,
    Qt = Ee.getterFor("Array Iterator"),
    $t = qt(
      Array,
      "Array",
      function (e, t) {
        Xt(this, { type: "Array Iterator", target: E(e), index: 0, kind: t });
      },
      function () {
        var e = Qt(this),
          t = e.target,
          r = e.kind,
          i = e.index++;
        return !t || i >= t.length
          ? ((e.target = void 0), { value: void 0, done: !0 })
          : "keys" == r
            ? { value: i, done: !1 }
            : "values" == r
              ? { value: t[i], done: !1 }
              : { value: [i, t[i]], done: !1 };
      },
      "values",
    );
  ((At.Arguments = At.Array), Pt("keys"), Pt("values"), Pt("entries"));
  var Zt = Ne.f,
    er = {}.toString,
    tr =
      "object" == ("undefined" == typeof window ? "undefined" : ne(window)) &&
      window &&
      Object.getOwnPropertyNames
        ? Object.getOwnPropertyNames(window)
        : [],
    rr = {
      f: function (e) {
        return tr && "[object Window]" == er.call(e)
          ? (function (e) {
              try {
                return Zt(e);
              } catch (e) {
                return tr.slice();
              }
            })(e)
          : Zt(E(e));
      },
    },
    ir = !d(function () {
      return Object.isExtensible(Object.preventExtensions({}));
    }),
    nr = o(function (e) {
      var t = re.f,
        r = !1,
        i = B("meta"),
        n = 0,
        o =
          Object.isExtensible ||
          function () {
            return !0;
          },
        a = function (e) {
          t(e, i, { value: { objectID: "O" + n++, weakData: {} } });
        },
        s = (e.exports = {
          enable: function () {
            ((s.enable = function () {}), (r = !0));
            var e = Ne.f,
              t = [].splice,
              n = {};
            ((n[i] = 1),
              e(n).length &&
                ((Ne.f = function (r) {
                  for (var n = e(r), o = 0, a = n.length; o < a; o++)
                    if (n[o] === i) {
                      t.call(n, o, 1);
                      break;
                    }
                  return n;
                }),
                qe(
                  { target: "Object", stat: !0, forced: !0 },
                  { getOwnPropertyNames: rr.f },
                )));
          },
          fastKey: function (e, t) {
            if (!C(e))
              return "symbol" == ne(e)
                ? e
                : ("string" == typeof e ? "S" : "P") + e;
            if (!V(e, i)) {
              if (!o(e)) return "F";
              if (!t) return "E";
              a(e);
            }
            return e[i].objectID;
          },
          getWeakData: function (e, t) {
            if (!V(e, i)) {
              if (!o(e)) return !0;
              if (!t) return !1;
              a(e);
            }
            return e[i].weakData;
          },
          onFreeze: function (e) {
            return (ir && r && o(e) && !V(e, i) && a(e), e);
          },
        });
      fe[i] = !0;
    }),
    or = J("iterator"),
    ar = Array.prototype,
    sr = function (e) {
      return void 0 !== e && (At.Array === e || ar[or] === e);
    },
    cr = {};
  cr[J("toStringTag")] = "z";
  var ur = "[object z]" === String(cr),
    dr = J("toStringTag"),
    lr =
      "Arguments" ==
      g(
        (function () {
          return arguments;
        })(),
      ),
    hr = ur
      ? g
      : function (e) {
          var t, r, i;
          return void 0 === e
            ? "Undefined"
            : null === e
              ? "Null"
              : "string" ==
                  typeof (r = (function (e, t) {
                    try {
                      return e[t];
                    } catch (e) {}
                  })((t = Object(e)), dr))
                ? r
                : lr
                  ? g(t)
                  : "Object" == (i = g(t)) && "function" == typeof t.callee
                    ? "Arguments"
                    : i;
        },
    pr = J("iterator"),
    fr = function (e) {
      if (null != e) return e[pr] || e["@@iterator"] || At[hr(e)];
    },
    mr = function (e) {
      var t = e.return;
      if (void 0 !== t) return ee(t.call(e)).value;
    },
    vr = function (e, t) {
      ((this.stopped = e), (this.result = t));
    },
    gr = function (e, t, r) {
      var i,
        n,
        o,
        a,
        s,
        c,
        u,
        d = !(!r || !r.AS_ENTRIES),
        l = !(!r || !r.IS_ITERATOR),
        h = !(!r || !r.INTERRUPTED),
        p = Qe(t, r && r.that, 1 + d + h),
        f = function (e) {
          return (i && mr(i), new vr(!0, e));
        },
        m = function (e) {
          return d
            ? (ee(e), h ? p(e[0], e[1], f) : p(e[0], e[1]))
            : h
              ? p(e, f)
              : p(e);
        };
      if (l) i = e;
      else {
        if ("function" != typeof (n = fr(e)))
          throw TypeError("Target is not iterable");
        if (sr(n)) {
          for (o = 0, a = ke(e.length); a > o; o++)
            if ((s = m(e[o])) && s instanceof vr) return s;
          return new vr(!1);
        }
        i = n.call(e);
      }
      for (c = i.next; !(u = c.call(i)).done; ) {
        try {
          s = m(u.value);
        } catch (e) {
          throw (mr(i), e);
        }
        if ("object" == ne(s) && s && s instanceof vr) return s;
      }
      return new vr(!1);
    },
    yr = function (e, t, r) {
      if (!(e instanceof t))
        throw TypeError("Incorrect " + (r ? r + " " : "") + "invocation");
      return e;
    },
    br = J("iterator"),
    Sr = !1;
  try {
    var Er = 0,
      Cr = {
        next: function () {
          return { done: !!Er++ };
        },
        return: function () {
          Sr = !0;
        },
      };
    ((Cr[br] = function () {
      return this;
    }),
      Array.from(Cr, function () {
        throw 2;
      }));
  } catch (e) {}
  var Tr = function (e, t) {
      if (!t && !Sr) return !1;
      var r = !1;
      try {
        var i = {};
        ((i[br] = function () {
          return {
            next: function () {
              return { done: (r = !0) };
            },
          };
        }),
          e(i));
      } catch (e) {}
      return r;
    },
    Rr = function (e, t, r) {
      var i, n;
      return (
        Ht &&
          "function" == typeof (i = t.constructor) &&
          i !== r &&
          C((n = i.prototype)) &&
          n !== r.prototype &&
          Ht(e, n),
        e
      );
    },
    Ir = function (e, t, r) {
      for (var i in t) Ce(e, i, t[i], r);
      return e;
    },
    _r = J("species"),
    kr = function (e) {
      var t = T(e);
      l &&
        t &&
        !t[_r] &&
        (0, re.f)(t, _r, {
          configurable: !0,
          get: function () {
            return this;
          },
        });
    },
    wr = re.f,
    Or = nr.fastKey,
    Pr = Ee.set,
    Ar = Ee.getterFor,
    Lr =
      ((function (e, t, r) {
        var i = -1 !== e.indexOf("Map"),
          n = -1 !== e.indexOf("Weak"),
          o = i ? "set" : "add",
          a = u[e],
          s = a && a.prototype,
          c = a,
          l = {},
          h = function (e) {
            var t = s[e];
            Ce(
              s,
              e,
              "add" == e
                ? function (e) {
                    return (t.call(this, 0 === e ? 0 : e), this);
                  }
                : "delete" == e
                  ? function (e) {
                      return !(n && !C(e)) && t.call(this, 0 === e ? 0 : e);
                    }
                  : "get" == e
                    ? function (e) {
                        return n && !C(e)
                          ? void 0
                          : t.call(this, 0 === e ? 0 : e);
                      }
                    : "has" == e
                      ? function (e) {
                          return !(n && !C(e)) && t.call(this, 0 === e ? 0 : e);
                        }
                      : function (e, r) {
                          return (t.call(this, 0 === e ? 0 : e, r), this);
                        },
            );
          };
        if (
          Ke(
            e,
            "function" != typeof a ||
              !(
                n ||
                (s.forEach &&
                  !d(function () {
                    new a().entries().next();
                  }))
              ),
          )
        )
          ((c = r.getConstructor(t, e, i, o)), nr.enable());
        else if (Ke(e, !0)) {
          var p = new c(),
            f = p[o](n ? {} : -0, 1) != p,
            m = d(function () {
              p.has(1);
            }),
            v = Tr(function (e) {
              new a(e);
            }),
            g =
              !n &&
              d(function () {
                for (var e = new a(), t = 5; t--; ) e[o](t, t);
                return !e.has(-0);
              });
          (v ||
            (((c = t(function (t, r) {
              yr(t, c, e);
              var n = Rr(new a(), t, c);
              return (null != r && gr(r, n[o], { that: n, AS_ENTRIES: i }), n);
            })).prototype = s),
            (s.constructor = c)),
            (m || g) && (h("delete"), h("has"), i && h("get")),
            (g || f) && h(o),
            n && s.clear && delete s.clear);
        }
        ((l[e] = c),
          qe({ global: !0, forced: c != a }, l),
          Bt(c, e),
          n || r.setStrong(c, e, i));
      })(
        "Map",
        function (e) {
          return function () {
            return e(this, arguments.length ? arguments[0] : void 0);
          };
        },
        {
          getConstructor: function (e, t, r, i) {
            var n = e(function (e, o) {
                (yr(e, n, t),
                  Pr(e, {
                    type: t,
                    index: Rt(null),
                    first: void 0,
                    last: void 0,
                    size: 0,
                  }),
                  l || (e.size = 0),
                  null != o && gr(o, e[i], { that: e, AS_ENTRIES: r }));
              }),
              o = Ar(t),
              a = function (e, t, r) {
                var i,
                  n,
                  a = o(e),
                  c = s(e, t);
                return (
                  c
                    ? (c.value = r)
                    : ((a.last = c =
                        {
                          index: (n = Or(t, !0)),
                          key: t,
                          value: r,
                          previous: (i = a.last),
                          next: void 0,
                          removed: !1,
                        }),
                      a.first || (a.first = c),
                      i && (i.next = c),
                      l ? a.size++ : e.size++,
                      "F" !== n && (a.index[n] = c)),
                  e
                );
              },
              s = function (e, t) {
                var r,
                  i = o(e),
                  n = Or(t);
                if ("F" !== n) return i.index[n];
                for (r = i.first; r; r = r.next) if (r.key == t) return r;
              };
            return (
              Ir(n.prototype, {
                clear: function () {
                  for (var e = o(this), t = e.index, r = e.first; r; )
                    ((r.removed = !0),
                      r.previous && (r.previous = r.previous.next = void 0),
                      delete t[r.index],
                      (r = r.next));
                  ((e.first = e.last = void 0),
                    l ? (e.size = 0) : (this.size = 0));
                },
                delete: function (e) {
                  var t = o(this),
                    r = s(this, e);
                  if (r) {
                    var i = r.next,
                      n = r.previous;
                    (delete t.index[r.index],
                      (r.removed = !0),
                      n && (n.next = i),
                      i && (i.previous = n),
                      t.first == r && (t.first = i),
                      t.last == r && (t.last = n),
                      l ? t.size-- : this.size--);
                  }
                  return !!r;
                },
                forEach: function (e) {
                  for (
                    var t,
                      r = o(this),
                      i = Qe(
                        e,
                        arguments.length > 1 ? arguments[1] : void 0,
                        3,
                      );
                    (t = t ? t.next : r.first);
                  )
                    for (i(t.value, t.key, this); t && t.removed; )
                      t = t.previous;
                },
                has: function (e) {
                  return !!s(this, e);
                },
              }),
              Ir(
                n.prototype,
                r
                  ? {
                      get: function (e) {
                        var t = s(this, e);
                        return t && t.value;
                      },
                      set: function (e, t) {
                        return a(this, 0 === e ? 0 : e, t);
                      },
                    }
                  : {
                      add: function (e) {
                        return a(this, (e = 0 === e ? 0 : e), e);
                      },
                    },
              ),
              l &&
                wr(n.prototype, "size", {
                  get: function () {
                    return o(this).size;
                  },
                }),
              n
            );
          },
          setStrong: function (e, t, r) {
            var i = t + " Iterator",
              n = Ar(t),
              o = Ar(i);
            (qt(
              e,
              t,
              function (e, t) {
                Pr(this, {
                  type: i,
                  target: e,
                  state: n(e),
                  kind: t,
                  last: void 0,
                });
              },
              function () {
                for (var e = o(this), t = e.kind, r = e.last; r && r.removed; )
                  r = r.previous;
                return e.target && (e.last = r = r ? r.next : e.state.first)
                  ? "keys" == t
                    ? { value: r.key, done: !1 }
                    : "values" == t
                      ? { value: r.value, done: !1 }
                      : { value: [r.key, r.value], done: !1 }
                  : ((e.target = void 0), { value: void 0, done: !0 });
              },
              r ? "entries" : "values",
              !r,
              !0,
            ),
              kr(t));
          },
        },
      ),
      ur
        ? {}.toString
        : function () {
            return "[object " + hr(this) + "]";
          });
  ur || Ce(Object.prototype, "toString", Lr, { unsafe: !0 });
  var xr = function (e) {
      if (L(e)) throw TypeError("Cannot convert a Symbol value to a string");
      return String(e);
    },
    Dr = function (e) {
      return function (t, r) {
        var i,
          n,
          o = xr(S(t)),
          a = Ie(r),
          s = o.length;
        return a < 0 || a >= s
          ? e
            ? ""
            : void 0
          : (i = o.charCodeAt(a)) < 55296 ||
              i > 56319 ||
              a + 1 === s ||
              (n = o.charCodeAt(a + 1)) < 56320 ||
              n > 57343
            ? e
              ? o.charAt(a)
              : i
            : e
              ? o.slice(a, a + 2)
              : n - 56320 + ((i - 55296) << 10) + 65536;
      };
    },
    Mr = { codeAt: Dr(!1), charAt: Dr(!0) },
    Ur = Mr.charAt,
    Nr = Ee.set,
    Vr = Ee.getterFor("String Iterator");
  qt(
    String,
    "String",
    function (e) {
      Nr(this, { type: "String Iterator", string: xr(e), index: 0 });
    },
    function () {
      var e,
        t = Vr(this),
        r = t.string,
        i = t.index;
      return i >= r.length
        ? { value: void 0, done: !0 }
        : ((e = Ur(r, i)), (t.index += e.length), { value: e, done: !1 });
    },
  );
  var jr = {
      CSSRuleList: 0,
      CSSStyleDeclaration: 0,
      CSSValueList: 0,
      ClientRectList: 0,
      DOMRectList: 0,
      DOMStringList: 0,
      DOMTokenList: 1,
      DataTransferItemList: 0,
      FileList: 0,
      HTMLAllCollection: 0,
      HTMLCollection: 0,
      HTMLFormElement: 0,
      HTMLSelectElement: 0,
      MediaList: 0,
      MimeTypeArray: 0,
      NamedNodeMap: 0,
      NodeList: 1,
      PaintRequestList: 0,
      Plugin: 0,
      PluginArray: 0,
      SVGLengthList: 0,
      SVGNumberList: 0,
      SVGPathSegList: 0,
      SVGPointList: 0,
      SVGStringList: 0,
      SVGTransformList: 0,
      SourceBufferList: 0,
      StyleSheetList: 0,
      TextTrackCueList: 0,
      TextTrackList: 0,
      TouchList: 0,
    },
    Fr = J("iterator"),
    Br = J("toStringTag"),
    Wr = $t.values;
  for (var Gr in jr) {
    var Hr = u[Gr],
      Jr = Hr && Hr.prototype;
    if (Jr) {
      if (Jr[Fr] !== Wr)
        try {
          ie(Jr, Fr, Wr);
        } catch (e) {
          Jr[Fr] = Wr;
        }
      if ((Jr[Br] || ie(Jr, Br, Gr), jr[Gr]))
        for (var zr in $t)
          if (Jr[zr] !== $t[zr])
            try {
              ie(Jr, zr, $t[zr]);
            } catch (e) {
              Jr[zr] = $t[zr];
            }
    }
  }
  var Kr = "undefined" != typeof ArrayBuffer && "undefined" != typeof DataView,
    Yr = function (e) {
      if (void 0 === e) return 0;
      var t = Ie(e),
        r = ke(t);
      if (t !== r) throw RangeError("Wrong length or index");
      return r;
    },
    qr = Math.abs,
    Xr = Math.pow,
    Qr = Math.floor,
    $r = Math.log,
    Zr = Math.LN2,
    ei = function (e) {
      for (
        var t = U(this),
          r = ke(t.length),
          i = arguments.length,
          n = Pe(i > 1 ? arguments[1] : void 0, r),
          o = i > 2 ? arguments[2] : void 0,
          a = void 0 === o ? r : Pe(o, r);
        a > n;
      )
        t[n++] = e;
      return t;
    },
    ti = Ne.f,
    ri = re.f,
    ii = Ee.get,
    ni = Ee.set,
    oi = u.ArrayBuffer,
    ai = oi,
    si = u.DataView,
    ci = si && si.prototype,
    ui = Object.prototype,
    di = u.RangeError,
    li = function (e, t, r) {
      var i,
        n,
        o,
        a = new Array(r),
        s = 8 * r - t - 1,
        c = (1 << s) - 1,
        u = c >> 1,
        d = 23 === t ? Xr(2, -24) - Xr(2, -77) : 0,
        l = e < 0 || (0 === e && 1 / e < 0) ? 1 : 0,
        h = 0;
      for (
        (e = qr(e)) != e || 1 / 0 === e
          ? ((n = e != e ? 1 : 0), (i = c))
          : ((i = Qr($r(e) / Zr)),
            e * (o = Xr(2, -i)) < 1 && (i--, (o *= 2)),
            (e += i + u >= 1 ? d / o : d * Xr(2, 1 - u)) * o >= 2 &&
              (i++, (o /= 2)),
            i + u >= c
              ? ((n = 0), (i = c))
              : i + u >= 1
                ? ((n = (e * o - 1) * Xr(2, t)), (i += u))
                : ((n = e * Xr(2, u - 1) * Xr(2, t)), (i = 0)));
        t >= 8;
        a[h++] = 255 & n, n /= 256, t -= 8
      );
      for (i = (i << t) | n, s += t; s > 0; a[h++] = 255 & i, i /= 256, s -= 8);
      return ((a[--h] |= 128 * l), a);
    },
    hi = function (e, t) {
      var r,
        i = e.length,
        n = 8 * i - t - 1,
        o = (1 << n) - 1,
        a = o >> 1,
        s = n - 7,
        c = i - 1,
        u = e[c--],
        d = 127 & u;
      for (u >>= 7; s > 0; d = 256 * d + e[c], c--, s -= 8);
      for (
        r = d & ((1 << -s) - 1), d >>= -s, s += t;
        s > 0;
        r = 256 * r + e[c], c--, s -= 8
      );
      if (0 === d) d = 1 - a;
      else {
        if (d === o) return r ? NaN : u ? -1 / 0 : 1 / 0;
        ((r += Xr(2, t)), (d -= a));
      }
      return (u ? -1 : 1) * r * Xr(2, d - t);
    },
    pi = function (e) {
      return [255 & e];
    },
    fi = function (e) {
      return [255 & e, (e >> 8) & 255];
    },
    mi = function (e) {
      return [255 & e, (e >> 8) & 255, (e >> 16) & 255, (e >> 24) & 255];
    },
    vi = function (e) {
      return (e[3] << 24) | (e[2] << 16) | (e[1] << 8) | e[0];
    },
    gi = function (e) {
      return li(e, 23, 4);
    },
    yi = function (e) {
      return li(e, 52, 8);
    },
    bi = function (e, t) {
      ri(e.prototype, t, {
        get: function () {
          return ii(this)[t];
        },
      });
    },
    Si = function (e, t, r, i) {
      var n = Yr(r),
        o = ii(e);
      if (n + t > o.byteLength) throw di("Wrong index");
      var a = ii(o.buffer).bytes,
        s = n + o.byteOffset,
        c = a.slice(s, s + t);
      return i ? c : c.reverse();
    },
    Ei = function (e, t, r, i, n, o) {
      var a = Yr(r),
        s = ii(e);
      if (a + t > s.byteLength) throw di("Wrong index");
      for (
        var c = ii(s.buffer).bytes, u = a + s.byteOffset, d = i(+n), l = 0;
        l < t;
        l++
      )
        c[u + l] = d[o ? l : t - l - 1];
    };
  if (Kr) {
    if (
      !d(function () {
        oi(1);
      }) ||
      !d(function () {
        new oi(-1);
      }) ||
      d(function () {
        return (new oi(), new oi(1.5), new oi(NaN), "ArrayBuffer" != oi.name);
      })
    ) {
      for (
        var Ci,
          Ti = ((ai = function (e) {
            return (yr(this, ai), new oi(Yr(e)));
          }).prototype = oi.prototype),
          Ri = ti(oi),
          Ii = 0;
        Ri.length > Ii;
      )
        (Ci = Ri[Ii++]) in ai || ie(ai, Ci, oi[Ci]);
      Ti.constructor = ai;
    }
    Ht && Mt(ci) !== ui && Ht(ci, ui);
    var _i = new si(new ai(2)),
      ki = ci.setInt8;
    (_i.setInt8(0, 2147483648),
      _i.setInt8(1, 2147483649),
      (!_i.getInt8(0) && _i.getInt8(1)) ||
        Ir(
          ci,
          {
            setInt8: function (e, t) {
              ki.call(this, e, (t << 24) >> 24);
            },
            setUint8: function (e, t) {
              ki.call(this, e, (t << 24) >> 24);
            },
          },
          { unsafe: !0 },
        ));
  } else
    ((ai = function (e) {
      yr(this, ai, "ArrayBuffer");
      var t = Yr(e);
      (ni(this, { bytes: ei.call(new Array(t), 0), byteLength: t }),
        l || (this.byteLength = t));
    }),
      (si = function (e, t, r) {
        (yr(this, si, "DataView"), yr(e, ai, "DataView"));
        var i = ii(e).byteLength,
          n = Ie(t);
        if (n < 0 || n > i) throw di("Wrong offset");
        if (n + (r = void 0 === r ? i - n : ke(r)) > i)
          throw di("Wrong length");
        (ni(this, { buffer: e, byteLength: r, byteOffset: n }),
          l ||
            ((this.buffer = e), (this.byteLength = r), (this.byteOffset = n)));
      }),
      l &&
        (bi(ai, "byteLength"),
        bi(si, "buffer"),
        bi(si, "byteLength"),
        bi(si, "byteOffset")),
      Ir(si.prototype, {
        getInt8: function (e) {
          return (Si(this, 1, e)[0] << 24) >> 24;
        },
        getUint8: function (e) {
          return Si(this, 1, e)[0];
        },
        getInt16: function (e) {
          var t = Si(this, 2, e, arguments.length > 1 ? arguments[1] : void 0);
          return (((t[1] << 8) | t[0]) << 16) >> 16;
        },
        getUint16: function (e) {
          var t = Si(this, 2, e, arguments.length > 1 ? arguments[1] : void 0);
          return (t[1] << 8) | t[0];
        },
        getInt32: function (e) {
          return vi(
            Si(this, 4, e, arguments.length > 1 ? arguments[1] : void 0),
          );
        },
        getUint32: function (e) {
          return (
            vi(Si(this, 4, e, arguments.length > 1 ? arguments[1] : void 0)) >>>
            0
          );
        },
        getFloat32: function (e) {
          return hi(
            Si(this, 4, e, arguments.length > 1 ? arguments[1] : void 0),
            23,
          );
        },
        getFloat64: function (e) {
          return hi(
            Si(this, 8, e, arguments.length > 1 ? arguments[1] : void 0),
            52,
          );
        },
        setInt8: function (e, t) {
          Ei(this, 1, e, pi, t);
        },
        setUint8: function (e, t) {
          Ei(this, 1, e, pi, t);
        },
        setInt16: function (e, t) {
          Ei(this, 2, e, fi, t, arguments.length > 2 ? arguments[2] : void 0);
        },
        setUint16: function (e, t) {
          Ei(this, 2, e, fi, t, arguments.length > 2 ? arguments[2] : void 0);
        },
        setInt32: function (e, t) {
          Ei(this, 4, e, mi, t, arguments.length > 2 ? arguments[2] : void 0);
        },
        setUint32: function (e, t) {
          Ei(this, 4, e, mi, t, arguments.length > 2 ? arguments[2] : void 0);
        },
        setFloat32: function (e, t) {
          Ei(this, 4, e, gi, t, arguments.length > 2 ? arguments[2] : void 0);
        },
        setFloat64: function (e, t) {
          Ei(this, 8, e, yi, t, arguments.length > 2 ? arguments[2] : void 0);
        },
      }));
  (Bt(ai, "ArrayBuffer"), Bt(si, "DataView"));
  var wi = { ArrayBuffer: ai, DataView: si },
    Oi = J("species"),
    Pi = function (e, t) {
      var r,
        i = ee(e).constructor;
      return void 0 === i || null == (r = ee(i)[Oi]) ? t : Xe(r);
    },
    Ai = wi.ArrayBuffer,
    Li = wi.DataView,
    xi = Ai.prototype.slice,
    Di = d(function () {
      return !new Ai(2).slice(1, void 0).byteLength;
    });
  qe(
    { target: "ArrayBuffer", proto: !0, unsafe: !0, forced: Di },
    {
      slice: function (e, t) {
        if (void 0 !== xi && void 0 === t) return xi.call(ee(this), e);
        for (
          var r = ee(this).byteLength,
            i = Pe(e, r),
            n = Pe(void 0 === t ? r : t, r),
            o = new (Pi(this, Ai))(ke(n - i)),
            a = new Li(this),
            s = new Li(o),
            c = 0;
          i < n;
        )
          s.setUint8(c++, a.getUint8(i++));
        return o;
      },
    },
  );
  var Mi,
    Ui,
    Ni,
    Vi = re.f,
    ji = u.Int8Array,
    Fi = ji && ji.prototype,
    Bi = u.Uint8ClampedArray,
    Wi = Bi && Bi.prototype,
    Gi = ji && Mt(ji),
    Hi = Fi && Mt(Fi),
    Ji = Object.prototype,
    zi = Ji.isPrototypeOf,
    Ki = J("toStringTag"),
    Yi = B("TYPED_ARRAY_TAG"),
    qi = B("TYPED_ARRAY_CONSTRUCTOR"),
    Xi = Kr && !!Ht && "Opera" !== hr(u.opera),
    Qi = !1,
    $i = {
      Int8Array: 1,
      Uint8Array: 1,
      Uint8ClampedArray: 1,
      Int16Array: 2,
      Uint16Array: 2,
      Int32Array: 4,
      Uint32Array: 4,
      Float32Array: 4,
      Float64Array: 8,
    },
    Zi = { BigInt64Array: 8, BigUint64Array: 8 },
    en = function (e) {
      if (!C(e)) return !1;
      var t = hr(e);
      return V($i, t) || V(Zi, t);
    };
  for (Mi in $i)
    (Ni = (Ui = u[Mi]) && Ui.prototype) ? ie(Ni, qi, Ui) : (Xi = !1);
  for (Mi in Zi) (Ni = (Ui = u[Mi]) && Ui.prototype) && ie(Ni, qi, Ui);
  if (
    (!Xi || "function" != typeof Gi || Gi === Function.prototype) &&
    ((Gi = function () {
      throw TypeError("Incorrect invocation");
    }),
    Xi)
  )
    for (Mi in $i) u[Mi] && Ht(u[Mi], Gi);
  if ((!Xi || !Hi || Hi === Ji) && ((Hi = Gi.prototype), Xi))
    for (Mi in $i) u[Mi] && Ht(u[Mi].prototype, Hi);
  if ((Xi && Mt(Wi) !== Hi && Ht(Wi, Hi), l && !V(Hi, Ki)))
    for (Mi in ((Qi = !0),
    Vi(Hi, Ki, {
      get: function () {
        return C(this) ? this[Yi] : void 0;
      },
    }),
    $i))
      u[Mi] && ie(u[Mi], Yi, Mi);
  var tn = {
      NATIVE_ARRAY_BUFFER_VIEWS: Xi,
      TYPED_ARRAY_CONSTRUCTOR: qi,
      TYPED_ARRAY_TAG: Qi && Yi,
      aTypedArray: function (e) {
        if (en(e)) return e;
        throw TypeError("Target is not a typed array");
      },
      aTypedArrayConstructor: function (e) {
        if (Ht && !zi.call(Gi, e))
          throw TypeError("Target is not a typed array constructor");
        return e;
      },
      exportTypedArrayMethod: function (e, t, r) {
        if (l) {
          if (r)
            for (var i in $i) {
              var n = u[i];
              if (n && V(n.prototype, e))
                try {
                  delete n.prototype[e];
                } catch (e) {}
            }
          (Hi[e] && !r) || Ce(Hi, e, r ? t : (Xi && Fi[e]) || t);
        }
      },
      exportTypedArrayStaticMethod: function (e, t, r) {
        var i, n;
        if (l) {
          if (Ht) {
            if (r)
              for (i in $i)
                if ((n = u[i]) && V(n, e))
                  try {
                    delete n[e];
                  } catch (e) {}
            if (Gi[e] && !r) return;
            try {
              return Ce(Gi, e, r ? t : (Xi && Gi[e]) || t);
            } catch (e) {}
          }
          for (i in $i) !(n = u[i]) || (n[e] && !r) || Ce(n, e, t);
        }
      },
      isView: function (e) {
        if (!C(e)) return !1;
        var t = hr(e);
        return "DataView" === t || V($i, t) || V(Zi, t);
      },
      isTypedArray: en,
      TypedArray: Gi,
      TypedArrayPrototype: Hi,
    },
    rn = u.ArrayBuffer,
    nn = u.Int8Array,
    on =
      !tn.NATIVE_ARRAY_BUFFER_VIEWS ||
      !d(function () {
        nn(1);
      }) ||
      !d(function () {
        new nn(-1);
      }) ||
      !Tr(function (e) {
        (new nn(), new nn(null), new nn(1.5), new nn(e));
      }, !0) ||
      d(function () {
        return 1 !== new nn(new rn(2), 1, void 0).length;
      }),
    an = Math.floor,
    sn = function (e, t) {
      var r = (function (e) {
        var t = Ie(e);
        if (t < 0) throw RangeError("The argument can't be less than 0");
        return t;
      })(e);
      if (r % t) throw RangeError("Wrong offset");
      return r;
    },
    cn = tn.aTypedArrayConstructor,
    un = function (e) {
      var t,
        r,
        i,
        n,
        o,
        a,
        s = U(e),
        c = arguments.length,
        u = c > 1 ? arguments[1] : void 0,
        d = void 0 !== u,
        l = fr(s);
      if (null != l && !sr(l))
        for (a = (o = l.call(s)).next, s = []; !(n = a.call(o)).done; )
          s.push(n.value);
      for (
        d && c > 2 && (u = Qe(u, arguments[2], 2)),
          r = ke(s.length),
          i = new (cn(this))(r),
          t = 0;
        r > t;
        t++
      )
        i[t] = d ? u(s[t], t) : s[t];
      return i;
    };
  o(function (e) {
    var t = Ne.f,
      r = it.forEach,
      i = Ee.get,
      n = Ee.set,
      o = re.f,
      a = Z.f,
      s = Math.round,
      c = u.RangeError,
      d = wi.ArrayBuffer,
      h = wi.DataView,
      p = tn.NATIVE_ARRAY_BUFFER_VIEWS,
      f = tn.TYPED_ARRAY_CONSTRUCTOR,
      v = tn.TYPED_ARRAY_TAG,
      g = tn.TypedArray,
      y = tn.TypedArrayPrototype,
      b = tn.aTypedArrayConstructor,
      S = tn.isTypedArray,
      E = function (e, t) {
        for (var r = 0, i = t.length, n = new (b(e))(i); i > r; ) n[r] = t[r++];
        return n;
      },
      T = function (e, t) {
        o(e, t, {
          get: function () {
            return i(this)[t];
          },
        });
      },
      R = function (e) {
        var t;
        return (
          e instanceof d ||
          "ArrayBuffer" == (t = hr(e)) ||
          "SharedArrayBuffer" == t
        );
      },
      I = function (e, t) {
        return (
          S(e) &&
          !L(t) &&
          t in e &&
          !C((r = +t)) &&
          isFinite(r) &&
          an(r) === r &&
          t >= 0
        );
        var r;
      },
      _ = function (e, t) {
        return ((t = K(t)), I(e, t) ? m(2, e[t]) : a(e, t));
      },
      k = function (e, t, r) {
        return (
          (t = K(t)),
          !(I(e, t) && C(r) && V(r, "value")) ||
          V(r, "get") ||
          V(r, "set") ||
          r.configurable ||
          (V(r, "writable") && !r.writable) ||
          (V(r, "enumerable") && !r.enumerable)
            ? o(e, t, r)
            : ((e[t] = r.value), e)
        );
      };
    l
      ? (p ||
          ((Z.f = _),
          (re.f = k),
          T(y, "buffer"),
          T(y, "byteOffset"),
          T(y, "byteLength"),
          T(y, "length")),
        qe(
          { target: "Object", stat: !0, forced: !p },
          { getOwnPropertyDescriptor: _, defineProperty: k },
        ),
        (e.exports = function (e, a, l) {
          var m = e.match(/\d+$/)[0] / 8,
            b = e + (l ? "Clamped" : "") + "Array",
            T = "get" + e,
            I = "set" + e,
            _ = u[b],
            k = _,
            w = k && k.prototype,
            O = {},
            P = function (e, t) {
              o(e, t, {
                get: function () {
                  return (function (e, t) {
                    var r = i(e);
                    return r.view[T](t * m + r.byteOffset, !0);
                  })(this, t);
                },
                set: function (e) {
                  return (function (e, t, r) {
                    var n = i(e);
                    (l && (r = (r = s(r)) < 0 ? 0 : r > 255 ? 255 : 255 & r),
                      n.view[I](t * m + n.byteOffset, r, !0));
                  })(this, t, e);
                },
                enumerable: !0,
              });
            };
          (p
            ? on &&
              ((k = a(function (e, t, r, i) {
                return (
                  yr(e, k, b),
                  Rr(
                    C(t)
                      ? R(t)
                        ? void 0 !== i
                          ? new _(t, sn(r, m), i)
                          : void 0 !== r
                            ? new _(t, sn(r, m))
                            : new _(t)
                        : S(t)
                          ? E(k, t)
                          : un.call(k, t)
                      : new _(Yr(t)),
                    e,
                    k,
                  )
                );
              })),
              Ht && Ht(k, g),
              r(t(_), function (e) {
                e in k || ie(k, e, _[e]);
              }),
              (k.prototype = w))
            : ((k = a(function (e, t, r, i) {
                yr(e, k, b);
                var o,
                  a,
                  s,
                  u = 0,
                  l = 0;
                if (C(t)) {
                  if (!R(t)) return S(t) ? E(k, t) : un.call(k, t);
                  ((o = t), (l = sn(r, m)));
                  var p = t.byteLength;
                  if (void 0 === i) {
                    if (p % m) throw c("Wrong length");
                    if ((a = p - l) < 0) throw c("Wrong length");
                  } else if ((a = ke(i) * m) + l > p) throw c("Wrong length");
                  s = a / m;
                } else ((s = Yr(t)), (o = new d((a = s * m))));
                for (
                  n(e, {
                    buffer: o,
                    byteOffset: l,
                    byteLength: a,
                    length: s,
                    view: new h(o),
                  });
                  u < s;
                )
                  P(e, u++);
              })),
              Ht && Ht(k, g),
              (w = k.prototype = Rt(y))),
            w.constructor !== k && ie(w, "constructor", k),
            ie(w, f, k),
            v && ie(w, v, b),
            (O[b] = k),
            qe({ global: !0, forced: k != _, sham: !p }, O),
            "BYTES_PER_ELEMENT" in k || ie(k, "BYTES_PER_ELEMENT", m),
            "BYTES_PER_ELEMENT" in w || ie(w, "BYTES_PER_ELEMENT", m),
            kr(b));
        }))
      : (e.exports = function () {});
  })("Float32", function (e) {
    return function (t, r, i) {
      return e(this, t, r, i);
    };
  });
  var dn = Math.min,
    ln =
      [].copyWithin ||
      function (e, t) {
        var r = U(this),
          i = ke(r.length),
          n = Pe(e, i),
          o = Pe(t, i),
          a = arguments.length > 2 ? arguments[2] : void 0,
          s = dn((void 0 === a ? i : Pe(a, i)) - o, i - n),
          c = 1;
        for (
          o < n && n < o + s && ((c = -1), (o += s - 1), (n += s - 1));
          s-- > 0;
        )
          (o in r ? (r[n] = r[o]) : delete r[n], (n += c), (o += c));
        return r;
      },
    hn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("copyWithin", function (e, t) {
    return ln.call(
      hn(this),
      e,
      t,
      arguments.length > 2 ? arguments[2] : void 0,
    );
  });
  var pn = it.every,
    fn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("every", function (e) {
    return pn(fn(this), e, arguments.length > 1 ? arguments[1] : void 0);
  });
  var mn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("fill", function (e) {
    return ei.apply(mn(this), arguments);
  });
  var vn = tn.TYPED_ARRAY_CONSTRUCTOR,
    gn = tn.aTypedArrayConstructor,
    yn = function (e) {
      return gn(Pi(e, e[vn]));
    },
    bn = it.filter,
    Sn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("filter", function (e) {
    return (function (e, t) {
      return (function (e, t) {
        for (var r = 0, i = t.length, n = new e(i); i > r; ) n[r] = t[r++];
        return n;
      })(yn(e), t);
    })(this, bn(Sn(this), e, arguments.length > 1 ? arguments[1] : void 0));
  });
  var En = it.find,
    Cn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("find", function (e) {
    return En(Cn(this), e, arguments.length > 1 ? arguments[1] : void 0);
  });
  var Tn = it.findIndex,
    Rn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("findIndex", function (e) {
    return Tn(Rn(this), e, arguments.length > 1 ? arguments[1] : void 0);
  });
  var In = it.forEach,
    _n = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("forEach", function (e) {
    In(_n(this), e, arguments.length > 1 ? arguments[1] : void 0);
  });
  var kn = Le.includes,
    wn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("includes", function (e) {
    return kn(wn(this), e, arguments.length > 1 ? arguments[1] : void 0);
  });
  var On = Le.indexOf,
    Pn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("indexOf", function (e) {
    return On(Pn(this), e, arguments.length > 1 ? arguments[1] : void 0);
  });
  var An = J("iterator"),
    Ln = u.Uint8Array,
    xn = $t.values,
    Dn = $t.keys,
    Mn = $t.entries,
    Un = tn.aTypedArray,
    Nn = tn.exportTypedArrayMethod,
    Vn = Ln && Ln.prototype[An],
    jn = !!Vn && ("values" == Vn.name || null == Vn.name),
    Fn = function () {
      return xn.call(Un(this));
    };
  (Nn("entries", function () {
    return Mn.call(Un(this));
  }),
    Nn("keys", function () {
      return Dn.call(Un(this));
    }),
    Nn("values", Fn, !jn),
    Nn(An, Fn, !jn));
  var Bn = tn.aTypedArray,
    Wn = [].join;
  (0, tn.exportTypedArrayMethod)("join", function (e) {
    return Wn.apply(Bn(this), arguments);
  });
  var Gn = function (e, t) {
      var r = [][e];
      return (
        !!r &&
        d(function () {
          r.call(
            null,
            t ||
              function () {
                throw 1;
              },
            1,
          );
        })
      );
    },
    Hn = Math.min,
    Jn = [].lastIndexOf,
    zn = !!Jn && 1 / [1].lastIndexOf(1, -0) < 0,
    Kn = Gn("lastIndexOf"),
    Yn =
      zn || !Kn
        ? function (e) {
            if (zn) return Jn.apply(this, arguments) || 0;
            var t = E(this),
              r = ke(t.length),
              i = r - 1;
            for (
              arguments.length > 1 && (i = Hn(i, Ie(arguments[1]))),
                i < 0 && (i = r + i);
              i >= 0;
              i--
            )
              if (i in t && t[i] === e) return i || 0;
            return -1;
          }
        : Jn,
    qn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("lastIndexOf", function (e) {
    return Yn.apply(qn(this), arguments);
  });
  var Xn = it.map,
    Qn = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("map", function (e) {
    return Xn(
      Qn(this),
      e,
      arguments.length > 1 ? arguments[1] : void 0,
      function (e, t) {
        return new (yn(e))(t);
      },
    );
  });
  var $n = function (e) {
      return function (t, r, i, n) {
        Xe(r);
        var o = U(t),
          a = b(o),
          s = ke(o.length),
          c = e ? s - 1 : 0,
          u = e ? -1 : 1;
        if (i < 2)
          for (;;) {
            if (c in a) {
              ((n = a[c]), (c += u));
              break;
            }
            if (((c += u), e ? c < 0 : s <= c))
              throw TypeError("Reduce of empty array with no initial value");
          }
        for (; e ? c >= 0 : s > c; c += u) c in a && (n = r(n, a[c], c, o));
        return n;
      };
    },
    Zn = { left: $n(!1), right: $n(!0) },
    eo = Zn.left,
    to = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("reduce", function (e) {
    return eo(
      to(this),
      e,
      arguments.length,
      arguments.length > 1 ? arguments[1] : void 0,
    );
  });
  var ro = Zn.right,
    io = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("reduceRight", function (e) {
    return ro(
      io(this),
      e,
      arguments.length,
      arguments.length > 1 ? arguments[1] : void 0,
    );
  });
  var no = tn.aTypedArray,
    oo = Math.floor;
  (0, tn.exportTypedArrayMethod)("reverse", function () {
    for (var e, t = no(this).length, r = oo(t / 2), i = 0; i < r; )
      ((e = this[i]), (this[i++] = this[--t]), (this[t] = e));
    return this;
  });
  var ao = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)(
    "set",
    function (e) {
      ao(this);
      var t = sn(arguments.length > 1 ? arguments[1] : void 0, 1),
        r = this.length,
        i = U(e),
        n = ke(i.length),
        o = 0;
      if (n + t > r) throw RangeError("Wrong length");
      for (; o < n; ) this[t + o] = i[o++];
    },
    d(function () {
      new Int8Array(1).set({});
    }),
  );
  var so = tn.aTypedArray,
    co = [].slice;
  (0, tn.exportTypedArrayMethod)(
    "slice",
    function (e, t) {
      for (
        var r = co.call(so(this), e, t),
          i = yn(this),
          n = 0,
          o = r.length,
          a = new i(o);
        o > n;
      )
        a[n] = r[n++];
      return a;
    },
    d(function () {
      new Int8Array(1).slice();
    }),
  );
  var uo = it.some,
    lo = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("some", function (e) {
    return uo(lo(this), e, arguments.length > 1 ? arguments[1] : void 0);
  });
  var ho = Math.floor,
    po = function (e, t) {
      for (var r, i, n = e.length, o = 1; o < n; ) {
        for (i = o, r = e[o]; i && t(e[i - 1], r) > 0; ) e[i] = e[--i];
        i !== o++ && (e[i] = r);
      }
      return e;
    },
    fo = function (e, t, r) {
      for (
        var i = e.length, n = t.length, o = 0, a = 0, s = [];
        o < i || a < n;
      )
        s.push(
          o < i && a < n
            ? r(e[o], t[a]) <= 0
              ? e[o++]
              : t[a++]
            : o < i
              ? e[o++]
              : t[a++],
        );
      return s;
    },
    mo = function e(t, r) {
      var i = t.length,
        n = ho(i / 2);
      return i < 8 ? po(t, r) : fo(e(t.slice(0, n), r), e(t.slice(n), r), r);
    },
    vo = R.match(/firefox\/(\d+)/i),
    go = !!vo && +vo[1],
    yo = /MSIE|Trident/.test(R),
    bo = R.match(/AppleWebKit\/(\d+)\./),
    So = !!bo && +bo[1],
    Eo = tn.aTypedArray,
    Co = tn.exportTypedArrayMethod,
    To = u.Uint16Array,
    Ro = To && To.prototype.sort,
    Io =
      !!Ro &&
      !d(function () {
        var e = new To(2);
        (e.sort(null), e.sort({}));
      }),
    _o =
      !!Ro &&
      !d(function () {
        if (O) return O < 74;
        if (go) return go < 67;
        if (yo) return !0;
        if (So) return So < 602;
        var e,
          t,
          r = new To(516),
          i = Array(516);
        for (e = 0; e < 516; e++)
          ((t = e % 4), (r[e] = 515 - e), (i[e] = e - 2 * t + 3));
        for (
          r.sort(function (e, t) {
            return ((e / 4) | 0) - ((t / 4) | 0);
          }),
            e = 0;
          e < 516;
          e++
        )
          if (r[e] !== i[e]) return !0;
      });
  Co(
    "sort",
    function (e) {
      if ((void 0 !== e && Xe(e), _o)) return Ro.call(this, e);
      Eo(this);
      var t,
        r = ke(this.length),
        i = Array(r);
      for (t = 0; t < r; t++) i[t] = this[t];
      for (
        i = mo(
          this,
          (function (e) {
            return function (t, r) {
              return void 0 !== e
                ? +e(t, r) || 0
                : r != r
                  ? -1
                  : t != t
                    ? 1
                    : 0 === t && 0 === r
                      ? 1 / t > 0 && 1 / r < 0
                        ? 1
                        : -1
                      : t > r;
            };
          })(e),
        ),
          t = 0;
        t < r;
        t++
      )
        this[t] = i[t];
      return this;
    },
    !_o || Io,
  );
  var ko = tn.aTypedArray;
  (0, tn.exportTypedArrayMethod)("subarray", function (e, t) {
    var r = ko(this),
      i = r.length,
      n = Pe(e, i);
    return new (yn(r))(
      r.buffer,
      r.byteOffset + n * r.BYTES_PER_ELEMENT,
      ke((void 0 === t ? i : Pe(t, i)) - n),
    );
  });
  var wo = u.Int8Array,
    Oo = tn.aTypedArray,
    Po = tn.exportTypedArrayMethod,
    Ao = [].toLocaleString,
    Lo = [].slice,
    xo =
      !!wo &&
      d(function () {
        Ao.call(new wo(1));
      });
  Po(
    "toLocaleString",
    function () {
      return Ao.apply(xo ? Lo.call(Oo(this)) : Oo(this), arguments);
    },
    d(function () {
      return [1, 2].toLocaleString() != new wo([1, 2]).toLocaleString();
    }) ||
      !d(function () {
        wo.prototype.toLocaleString.call([1, 2]);
      }),
  );
  var Do = tn.exportTypedArrayMethod,
    Mo = u.Uint8Array,
    Uo = (Mo && Mo.prototype) || {},
    No = [].toString,
    Vo = [].join;
  (d(function () {
    No.call({});
  }) &&
    (No = function () {
      return Vo.call(this);
    }),
    Do("toString", No, Uo.toString != No));
  var jo = function () {
      var e = ee(this),
        t = "";
      return (
        e.global && (t += "g"),
        e.ignoreCase && (t += "i"),
        e.multiline && (t += "m"),
        e.dotAll && (t += "s"),
        e.unicode && (t += "u"),
        e.sticky && (t += "y"),
        t
      );
    },
    Fo = function (e, t) {
      return RegExp(e, t);
    },
    Bo = {
      UNSUPPORTED_Y: d(function () {
        var e = Fo("a", "y");
        return ((e.lastIndex = 2), null != e.exec("abcd"));
      }),
      BROKEN_CARET: d(function () {
        var e = Fo("^r", "gy");
        return ((e.lastIndex = 2), null != e.exec("str"));
      }),
    },
    Wo = d(function () {
      var e = RegExp(".", "string".charAt(0));
      return !(e.dotAll && e.exec("\n") && "s" === e.flags);
    }),
    Go = d(function () {
      var e = RegExp("(?<a>b)", "string".charAt(5));
      return "b" !== e.exec("b").groups.a || "bc" !== "b".replace(e, "$<a>c");
    }),
    Ho = Ee.get,
    Jo = RegExp.prototype.exec,
    zo = M("native-string-replace", String.prototype.replace),
    Ko = Jo,
    Yo = (function () {
      var e = /a/,
        t = /b*/g;
      return (
        Jo.call(e, "a"),
        Jo.call(t, "a"),
        0 !== e.lastIndex || 0 !== t.lastIndex
      );
    })(),
    qo = Bo.UNSUPPORTED_Y || Bo.BROKEN_CARET,
    Xo = void 0 !== /()??/.exec("")[1];
  (Yo || Xo || qo || Wo || Go) &&
    (Ko = function (e) {
      var t,
        r,
        i,
        n,
        o,
        a,
        s,
        c = this,
        u = Ho(c),
        d = xr(e),
        l = u.raw;
      if (l)
        return (
          (l.lastIndex = c.lastIndex),
          (t = Ko.call(l, d)),
          (c.lastIndex = l.lastIndex),
          t
        );
      var h = u.groups,
        p = qo && c.sticky,
        f = jo.call(c),
        m = c.source,
        v = 0,
        g = d;
      if (
        (p &&
          (-1 === (f = f.replace("y", "")).indexOf("g") && (f += "g"),
          (g = d.slice(c.lastIndex)),
          c.lastIndex > 0 &&
            (!c.multiline ||
              (c.multiline && "\n" !== d.charAt(c.lastIndex - 1))) &&
            ((m = "(?: " + m + ")"), (g = " " + g), v++),
          (r = new RegExp("^(?:" + m + ")", f))),
        Xo && (r = new RegExp("^" + m + "$(?!\\s)", f)),
        Yo && (i = c.lastIndex),
        (n = Jo.call(p ? r : c, g)),
        p
          ? n
            ? ((n.input = n.input.slice(v)),
              (n[0] = n[0].slice(v)),
              (n.index = c.lastIndex),
              (c.lastIndex += n[0].length))
            : (c.lastIndex = 0)
          : Yo && n && (c.lastIndex = c.global ? n.index + n[0].length : i),
        Xo &&
          n &&
          n.length > 1 &&
          zo.call(n[0], r, function () {
            for (o = 1; o < arguments.length - 2; o++)
              void 0 === arguments[o] && (n[o] = void 0);
          }),
        n && h)
      )
        for (n.groups = a = Rt(null), o = 0; o < h.length; o++)
          a[(s = h[o])[0]] = n[s[1]];
      return n;
    });
  var Qo = Ko;
  qe({ target: "RegExp", proto: !0, forced: /./.exec !== Qo }, { exec: Qo });
  J("species");
  var $o = RegExp.prototype,
    Zo = Mr.charAt,
    ea = function (e, t, r) {
      return t + (r ? Zo(e, t).length : 1);
    },
    ta = Math.floor,
    ra = "".replace,
    ia = /\$([$&'`]|\d{1,2}|<[^>]*>)/g,
    na = /\$([$&'`]|\d{1,2})/g,
    oa = function (e, t, r, i, n, o) {
      var a = r + e.length,
        s = i.length,
        c = na;
      return (
        void 0 !== n && ((n = U(n)), (c = ia)),
        ra.call(o, c, function (o, c) {
          var u;
          switch (c.charAt(0)) {
            case "$":
              return "$";
            case "&":
              return e;
            case "`":
              return t.slice(0, r);
            case "'":
              return t.slice(a);
            case "<":
              u = n[c.slice(1, -1)];
              break;
            default:
              var d = +c;
              if (0 === d) return o;
              if (d > s) {
                var l = ta(d / 10);
                return 0 === l
                  ? o
                  : l <= s
                    ? void 0 === i[l - 1]
                      ? c.charAt(1)
                      : i[l - 1] + c.charAt(1)
                    : o;
              }
              u = i[d - 1];
          }
          return void 0 === u ? "" : u;
        })
      );
    },
    aa = function (e, t) {
      var r = e.exec;
      if ("function" == typeof r) {
        var i = r.call(e, t);
        if ("object" != ne(i))
          throw TypeError(
            "RegExp exec method returned something other than an Object or null",
          );
        return i;
      }
      if ("RegExp" !== g(e))
        throw TypeError("RegExp#exec called on incompatible receiver");
      return Qo.call(e, t);
    },
    sa = J("replace"),
    ca = Math.max,
    ua = Math.min,
    da = "$0" === "a".replace(/./, "$0"),
    la = !!/./[sa] && "" === /./[sa]("a", "$0");
  !(function (e, t, r, i) {
    var n = J(e),
      o = !d(function () {
        var t = {};
        return (
          (t[n] = function () {
            return 7;
          }),
          7 != ""[e](t)
        );
      }),
      a =
        o &&
        !d(function () {
          var e = !1,
            t = /a/;
          return (
            (t.exec = function () {
              return ((e = !0), null);
            }),
            t[n](""),
            !e
          );
        });
    if (!o || !a || r) {
      var s = /./[n],
        c = (function (e, t, r) {
          var i = la ? "$" : "$0";
          return [
            function (e, r) {
              var i = S(this),
                n = null == e ? void 0 : e[sa];
              return void 0 !== n ? n.call(e, i, r) : t.call(xr(i), e, r);
            },
            function (e, n) {
              var o = ee(this),
                a = xr(e);
              if (
                "string" == typeof n &&
                -1 === n.indexOf(i) &&
                -1 === n.indexOf("$<")
              ) {
                var s = r(t, o, a, n);
                if (s.done) return s.value;
              }
              var c = "function" == typeof n;
              c || (n = xr(n));
              var u = o.global;
              if (u) {
                var d = o.unicode;
                o.lastIndex = 0;
              }
              for (var l = []; ; ) {
                var h = aa(o, a);
                if (null === h) break;
                if ((l.push(h), !u)) break;
                "" === xr(h[0]) && (o.lastIndex = ea(a, ke(o.lastIndex), d));
              }
              for (var p, f = "", m = 0, v = 0; v < l.length; v++) {
                for (
                  var g = xr((h = l[v])[0]),
                    y = ca(ua(Ie(h.index), a.length), 0),
                    b = [],
                    S = 1;
                  S < h.length;
                  S++
                )
                  b.push(void 0 === (p = h[S]) ? p : String(p));
                var E = h.groups;
                if (c) {
                  var C = [g].concat(b, y, a);
                  void 0 !== E && C.push(E);
                  var T = xr(n.apply(void 0, C));
                } else T = oa(g, a, y, b, E, n);
                y >= m && ((f += a.slice(m, y) + T), (m = y + g.length));
              }
              return f + a.slice(m);
            },
          ];
        })(0, ""[e], function (e, t, r, i, n) {
          var a = t.exec;
          return a === Qo || a === $o.exec
            ? o && !n
              ? { done: !0, value: s.call(t, r, i) }
              : { done: !0, value: e.call(r, t, i) }
            : { done: !1 };
        });
      (Ce(String.prototype, e, c[0]), Ce($o, n, c[1]));
    }
  })(
    "replace",
    0,
    !!d(function () {
      var e = /./;
      return (
        (e.exec = function () {
          var e = [];
          return ((e.groups = { a: "7" }), e);
        }),
        "7" !== "".replace(e, "$<a>")
      );
    }) ||
      !da ||
      la,
  );
  var ha = RegExp.prototype,
    pa = ha.toString,
    fa = d(function () {
      return "/a/b" != pa.call({ source: "a", flags: "b" });
    }),
    ma = "toString" != pa.name;
  (fa || ma) &&
    Ce(
      RegExp.prototype,
      "toString",
      function () {
        var e = ee(this),
          t = xr(e.source),
          r = e.flags;
        return (
          "/" +
          t +
          "/" +
          xr(
            void 0 === r && e instanceof RegExp && !("flags" in ha)
              ? jo.call(e)
              : r,
          )
        );
      },
      { unsafe: !0 },
    );
  var va = J("match"),
    ga = re.f,
    ya = Ne.f,
    ba = Ee.enforce,
    Sa = J("match"),
    Ea = u.RegExp,
    Ca = Ea.prototype,
    Ta = /^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,
    Ra = /a/g,
    Ia = /a/g,
    _a = new Ea(Ra) !== Ra,
    ka = Bo.UNSUPPORTED_Y,
    wa =
      l &&
      (!_a ||
        ka ||
        Wo ||
        Go ||
        d(function () {
          return (
            (Ia[Sa] = !1),
            Ea(Ra) != Ra || Ea(Ia) == Ia || "/a/i" != Ea(Ra, "i")
          );
        }));
  if (Ke("RegExp", wa)) {
    for (
      var Oa = function e(t, r) {
          var i,
            n,
            o,
            a,
            s,
            c,
            u,
            d,
            l = this instanceof e,
            h = C((i = t)) && (void 0 !== (n = i[va]) ? !!n : "RegExp" == g(i)),
            p = void 0 === r,
            f = [],
            m = t;
          if (!l && h && p && t.constructor === e) return t;
          if (
            ((h || t instanceof e) &&
              ((t = t.source),
              p && (r = ("flags" in m) ? m.flags : jo.call(m))),
            (t = void 0 === t ? "" : xr(t)),
            (r = void 0 === r ? "" : xr(r)),
            (m = t),
            Wo &&
              ("dotAll" in Ra) &&
              (a = !!r && r.indexOf("s") > -1) &&
              (r = r.replace(/s/g, "")),
            (o = r),
            ka &&
              ("sticky" in Ra) &&
              (s = !!r && r.indexOf("y") > -1) &&
              (r = r.replace(/y/g, "")),
            Go &&
              ((t = (c = (function (e) {
                for (
                  var t,
                    r = e.length,
                    i = 0,
                    n = "",
                    o = [],
                    a = {},
                    s = !1,
                    c = !1,
                    u = 0,
                    d = "";
                  i <= r;
                  i++
                ) {
                  if ("\\" === (t = e.charAt(i))) t += e.charAt(++i);
                  else if ("]" === t) s = !1;
                  else if (!s)
                    switch (!0) {
                      case "[" === t:
                        s = !0;
                        break;
                      case "(" === t:
                        (Ta.test(e.slice(i + 1)) && ((i += 2), (c = !0)),
                          (n += t),
                          u++);
                        continue;
                      case ">" === t && c:
                        if ("" === d || V(a, d))
                          throw new SyntaxError("Invalid capture group name");
                        ((a[d] = !0), o.push([d, u]), (c = !1), (d = ""));
                        continue;
                    }
                  c ? (d += t) : (n += t);
                }
                return [n, o];
              })(t))[0]),
              (f = c[1])),
            (u = Rr(Ea(t, r), l ? this : Ca, e)),
            (a || s || f.length) &&
              ((d = ba(u)),
              a &&
                ((d.dotAll = !0),
                (d.raw = e(
                  (function (e) {
                    for (
                      var t, r = e.length, i = 0, n = "", o = !1;
                      i <= r;
                      i++
                    )
                      "\\" !== (t = e.charAt(i))
                        ? o || "." !== t
                          ? ("[" === t ? (o = !0) : "]" === t && (o = !1),
                            (n += t))
                          : (n += "[\\s\\S]")
                        : (n += t + e.charAt(++i));
                    return n;
                  })(t),
                  o,
                ))),
              s && (d.sticky = !0),
              f.length && (d.groups = f)),
            t !== m)
          )
            try {
              ie(u, "source", "" === m ? "(?:)" : m);
            } catch (e) {}
          return u;
        },
        Pa = function (e) {
          (e in Oa) ||
            ga(Oa, e, {
              configurable: !0,
              get: function () {
                return Ea[e];
              },
              set: function (t) {
                Ea[e] = t;
              },
            });
        },
        Aa = ya(Ea),
        La = 0;
      Aa.length > La;
    )
      Pa(Aa[La++]);
    ((Ca.constructor = Oa), (Oa.prototype = Ca), Ce(u, "RegExp", Oa));
  }
  kr("RegExp");
  var xa = [].join,
    Da = b != Object,
    Ma = Gn("join", ",");
  function Ua(e, t, r) {
    var i = function (e, t, r) {
        var i = new RegExp("\\b".concat(t, " \\w+ (\\w+)"), "ig");
        e.replace(i, function (e, t) {
          return ((r[t] = 0), e);
        });
      },
      n = function (e, t, r) {
        var i = e.createShader(r);
        return (
          e.shaderSource(i, t),
          e.compileShader(i),
          e.getShaderParameter(i, e.COMPILE_STATUS)
            ? i
            : (console.log(e.getShaderInfoLog(i)), null)
        );
      };
    ((this.uniform = {}), (this.attribute = {}));
    var o = n(e, t, e.VERTEX_SHADER),
      a = n(e, r, e.FRAGMENT_SHADER);
    for (var s in ((this.id = e.createProgram()),
    e.attachShader(this.id, o),
    e.attachShader(this.id, a),
    e.linkProgram(this.id),
    e.getProgramParameter(this.id, e.LINK_STATUS) ||
      console.log(e.getProgramInfoLog(this.id)),
    e.useProgram(this.id),
    i(t, "attribute", this.attribute),
    this.attribute))
      this.attribute[s] = e.getAttribLocation(this.id, s);
    for (var c in (i(t, "uniform", this.uniform),
    i(r, "uniform", this.uniform),
    this.uniform))
      this.uniform[c] = e.getUniformLocation(this.id, c);
  }
  qe(
    { target: "Array", proto: !0, forced: Da || !Ma },
    {
      join: function (e) {
        return xa.call(E(this), void 0 === e ? "," : e);
      },
    },
  );
  var Na = (function () {
      function e(r) {
        (t(this, e),
          (this.canvas = r.canvas),
          (this.width = r.width || 640),
          (this.height = r.height || 480),
          (this.gl = this.createGL(r.canvas)),
          (this.sourceTexture = this.gl.createTexture()),
          (this.vertexBuffer = null),
          (this.currentProgram = null),
          (this.applied = !1),
          (this.beautyParams = { beauty: 0.5, brightness: 0.5, ruddy: 0.5 }));
      }
      return (
        i(e, [
          {
            key: "setRect",
            value: function (e, t) {
              ((this.width = e), (this.height = t));
            },
          },
          {
            key: "apply",
            value: function (e) {
              if (!this.vertexBuffer) {
                var t = new Float32Array([
                  -1, -1, 0, 1, 1, -1, 1, 1, -1, 1, 0, 0, -1, 1, 0, 0, 1, -1, 1,
                  1, 1, 1, 1, 0,
                ]);
                ((this.vertexBuffer = this.gl.createBuffer()),
                  this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vertexBuffer),
                  this.gl.bufferData(
                    this.gl.ARRAY_BUFFER,
                    t,
                    this.gl.STATIC_DRAW,
                  ),
                  this.gl.pixelStorei(
                    this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
                    !0,
                  ));
              }
              (this.gl.viewport(0, 0, this.width, this.height),
                this.gl.bindTexture(this.gl.TEXTURE_2D, this.sourceTexture),
                this.gl.texParameteri(
                  this.gl.TEXTURE_2D,
                  this.gl.TEXTURE_WRAP_S,
                  this.gl.CLAMP_TO_EDGE,
                ),
                this.gl.texParameteri(
                  this.gl.TEXTURE_2D,
                  this.gl.TEXTURE_WRAP_T,
                  this.gl.CLAMP_TO_EDGE,
                ),
                this.gl.texParameteri(
                  this.gl.TEXTURE_2D,
                  this.gl.TEXTURE_MIN_FILTER,
                  this.gl.NEAREST,
                ),
                this.gl.texParameteri(
                  this.gl.TEXTURE_2D,
                  this.gl.TEXTURE_MAG_FILTER,
                  this.gl.NEAREST,
                ),
                this.applied
                  ? this.gl.texSubImage2D(
                      this.gl.TEXTURE_2D,
                      0,
                      0,
                      0,
                      this.gl.RGB,
                      this.gl.UNSIGNED_BYTE,
                      e,
                    )
                  : (this.gl.texImage2D(
                      this.gl.TEXTURE_2D,
                      0,
                      this.gl.RGB,
                      this.gl.RGB,
                      this.gl.UNSIGNED_BYTE,
                      e,
                    ),
                    (this.applied = !0)),
                this.beauty());
            },
          },
          {
            key: "beauty",
            value: function () {
              var e = this.beautyParams,
                t = e.beauty,
                r = e.brightness,
                i = e.ruddy,
                n = 2 / this.width,
                o = 2 / this.height,
                a = this.compileBeautyShader();
              this.gl.uniform2f(a.uniform.singleStepOffset, n, o);
              var s = new Float32Array([
                1 - 0.8 * t,
                1 - 0.6 * t,
                0.1 + 0.45 * i,
                0.1 + 0.45 * i,
              ]);
              (this.gl.uniform4fv(a.uniform.params, s),
                this.gl.uniform1f(a.uniform.brightness, 0.12 * r),
                this.draw());
            },
          },
          {
            key: "draw",
            value: function () {
              (this.gl.bindTexture(this.gl.TEXTURE_2D, this.sourceTexture),
                this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null),
                this.gl.uniform1f(this.currentProgram.uniform.flipY, 1),
                this.gl.drawArrays(this.gl.TRIANGLES, 0, 6));
            },
          },
          {
            key: "compileBeautyShader",
            value: function () {
              if (this.currentProgram) return this.currentProgram;
              this.currentProgram = new Ua(
                this.gl,
                [
                  "precision highp float;",
                  "attribute vec2 pos;",
                  "attribute vec2 uv;",
                  "varying vec2 vUv;",
                  "uniform float flipY;",
                  "void main(void) {",
                  "vUv = uv;",
                  "gl_Position = vec4(pos.x, pos.y*flipY, 0.0, 1.);",
                  "}",
                ].join("\n"),
                [
                  "precision highp float;",
                  "uniform vec2 singleStepOffset;",
                  "uniform sampler2D texture;",
                  "uniform vec4 params;",
                  "uniform float brightness;",
                  "varying vec2 vUv;",
                  "const highp vec3 W = vec3(0.299,0.587,0.114);",
                  "const mat3 saturateMatrix = mat3(1.1102,-0.0598,-0.061,-0.0774,1.0826,-0.1186,-0.0228,-0.0228,1.1772);",
                  "vec2 blurCoordinates[24];",
                  "float hardLight(float color){",
                  "if(color <= 0.5){",
                  "color = color * color * 2.0;",
                  "} else {",
                  "color = 1.0 - ((1.0 - color)*(1.0 - color) * 2.0);",
                  "}",
                  "return color;",
                  "}",
                  "void main(){",
                  "vec3 centralColor = texture2D(texture, vUv).rgb;",
                  "blurCoordinates[0] = vUv.xy + singleStepOffset * vec2(0.0, -10.0);",
                  "blurCoordinates[1] = vUv.xy + singleStepOffset * vec2(0.0, 10.0);",
                  "blurCoordinates[2] = vUv.xy + singleStepOffset * vec2(-10.0, 0.0);",
                  "blurCoordinates[3] = vUv.xy + singleStepOffset * vec2(10.0, 0.0);",
                  "blurCoordinates[4] = vUv.xy + singleStepOffset * vec2(5.0, -8.0);",
                  "blurCoordinates[5] = vUv.xy + singleStepOffset * vec2(5.0, 8.0);",
                  "blurCoordinates[6] = vUv.xy + singleStepOffset * vec2(-5.0, 8.0);",
                  "blurCoordinates[7] = vUv.xy + singleStepOffset * vec2(-5.0, -8.0);",
                  "blurCoordinates[8] = vUv.xy + singleStepOffset * vec2(8.0, -5.0);",
                  "blurCoordinates[9] = vUv.xy + singleStepOffset * vec2(8.0, 5.0);",
                  "blurCoordinates[10] = vUv.xy + singleStepOffset * vec2(-8.0, 5.0);",
                  "blurCoordinates[11] = vUv.xy + singleStepOffset * vec2(-8.0, -5.0);",
                  "blurCoordinates[12] = vUv.xy + singleStepOffset * vec2(0.0, -6.0);",
                  "blurCoordinates[13] = vUv.xy + singleStepOffset * vec2(0.0, 6.0);",
                  "blurCoordinates[14] = vUv.xy + singleStepOffset * vec2(6.0, 0.0);",
                  "blurCoordinates[15] = vUv.xy + singleStepOffset * vec2(-6.0, 0.0);",
                  "blurCoordinates[16] = vUv.xy + singleStepOffset * vec2(-4.0, -4.0);",
                  "blurCoordinates[17] = vUv.xy + singleStepOffset * vec2(-4.0, 4.0);",
                  "blurCoordinates[18] = vUv.xy + singleStepOffset * vec2(4.0, -4.0);",
                  "blurCoordinates[19] = vUv.xy + singleStepOffset * vec2(4.0, 4.0);",
                  "blurCoordinates[20] = vUv.xy + singleStepOffset * vec2(-2.0, -2.0);",
                  "blurCoordinates[21] = vUv.xy + singleStepOffset * vec2(-2.0, 2.0);",
                  "blurCoordinates[22] = vUv.xy + singleStepOffset * vec2(2.0, -2.0);",
                  "blurCoordinates[23] = vUv.xy + singleStepOffset * vec2(2.0, 2.0);",
                  "float sampleColor = centralColor.g * 22.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[0]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[1]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[2]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[3]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[4]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[5]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[6]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[7]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[8]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[9]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[10]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[11]).g;",
                  "sampleColor += texture2D(texture, blurCoordinates[12]).g * 2.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[13]).g * 2.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[14]).g * 2.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[15]).g * 2.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[16]).g * 2.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[17]).g * 2.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[18]).g * 2.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[19]).g * 2.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[20]).g * 3.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[21]).g * 3.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[22]).g * 3.0;",
                  "sampleColor += texture2D(texture, blurCoordinates[23]).g * 3.0;",
                  "sampleColor = sampleColor / 62.0;",
                  "float highPass = centralColor.g - sampleColor + 0.5;",
                  "for(int i = 0; i < 5;i++){",
                  "highPass = hardLight(highPass);",
                  "}",
                  "float luminance = dot(centralColor, W);",
                  "float alpha = pow(luminance, params.r);",
                  "vec3 smoothColor = centralColor + (centralColor-vec3(highPass))*alpha*0.1;",
                  "smoothColor.r = clamp(pow(smoothColor.r, params.g),0.0,1.0);",
                  "smoothColor.g = clamp(pow(smoothColor.g, params.g),0.0,1.0);",
                  "smoothColor.b = clamp(pow(smoothColor.b, params.g),0.0,1.0);",
                  "vec3 screen = vec3(1.0) - (vec3(1.0)-smoothColor) * (vec3(1.0)-centralColor);",
                  "vec3 lighten = max(smoothColor, centralColor);",
                  "vec3 softLight = 2.0 * centralColor*smoothColor + centralColor*centralColor - 2.0 * centralColor*centralColor * smoothColor;",
                  "gl_FragColor = vec4(mix(centralColor, screen, alpha), 1.0);",
                  "gl_FragColor.rgb = mix(gl_FragColor.rgb, lighten, alpha);",
                  "gl_FragColor.rgb = mix(gl_FragColor.rgb, softLight, params.b);",
                  "vec3 satColor = gl_FragColor.rgb * saturateMatrix;",
                  "gl_FragColor.rgb = mix(gl_FragColor.rgb, satColor, params.a);",
                  "gl_FragColor.rgb = vec3(gl_FragColor.rgb + vec3(brightness));",
                  "}",
                ].join("\n"),
              );
              var e = Float32Array.BYTES_PER_ELEMENT,
                t = 4 * e;
              return (
                this.gl.enableVertexAttribArray(
                  this.currentProgram.attribute.pos,
                ),
                this.gl.vertexAttribPointer(
                  this.currentProgram.attribute.pos,
                  2,
                  this.gl.FLOAT,
                  !1,
                  t,
                  0,
                ),
                this.gl.enableVertexAttribArray(
                  this.currentProgram.attribute.uv,
                ),
                this.gl.vertexAttribPointer(
                  this.currentProgram.attribute.uv,
                  2,
                  this.gl.FLOAT,
                  !1,
                  t,
                  2 * e,
                ),
                this.currentProgram
              );
            },
          },
          {
            key: "createGL",
            value: function (e) {
              var t = e.getContext("webgl");
              if (
                (t ||
                  e.getContext("experimental-webgl", {
                    preserveDrawingBuffer: !0,
                  }),
                !t)
              )
                throw "Couldn't get WebGL context";
              return t;
            },
          },
          {
            key: "setBeautyParams",
            value: function (e) {
              this.beautyParams = e;
            },
          },
          {
            key: "reset",
            value: function () {
              this.applied = !1;
            },
          },
        ]),
        e
      );
    })(),
    Va = function (e) {
      return "number" == typeof e;
    },
    ja = (function () {
      function r() {
        (t(this, r),
          (this.video = document.createElement("video")),
          (this.video.loop = !0),
          (this.video.autoplay = !0),
          (this.canvas = document.createElement("canvas")),
          (this.filter = new Na({ canvas: this.canvas })),
          (this.beautyParams = { beauty: 0.5, brightness: 0.5, ruddy: 0.5 }),
          (this.timeoutId = null),
          (this.rafId = null),
          (this.startTime = null),
          (this.originTrack = null),
          (this.beautyTrack = null),
          (this.localStream = null),
          (this.frameRate = null),
          (this.disableStatus = !1));
      }
      return (
        i(r, [
          {
            key: "generateBeautyStream",
            value: function (e) {
              var t = e.getVideoTrack();
              if (!t)
                throw new Error(
                  "Your localStream does not contain video track.",
                );
              var r = this.generateBeautyTrack(t);
              return (
                e.replaceTrack(r),
                (this.localStream = e),
                e.setBeautyStatus && e.setBeautyStatus(!0),
                e
              );
            },
          },
          {
            key: "generateBeautyTrack",
            value: function (e) {
              var t = this;
              this.reset();
              var r = e.getSettings();
              ((this.frameRate = r.frameRate),
                this.filter.setRect(r.width, r.height),
                this.setRect(r.width, r.height));
              var i = new MediaStream();
              (i.addTrack(e), (this.video.srcObject = i), this.video.play());
              var n = this.generateVideoTrackFromCanvasCapture(
                r.frameRate || 15,
              );
              return (
                this.rafId && cancelAnimationFrame(this.rafId),
                (this.rafId = requestAnimationFrame(function () {
                  ((t.startTime = new Date().getTime()), t.render());
                })),
                this.installEvents(),
                this.setBeautyTrack({ originTrack: e, beautyTrack: n }),
                (this.originTrack = e),
                (this.beautyTrack = n),
                n
              );
            },
          },
          {
            key: "draw",
            value: function () {
              this.video &&
                this.video.readyState === this.video.HAVE_ENOUGH_DATA &&
                this.filter.apply(this.video);
            },
          },
          {
            key: "render",
            value: function () {
              var e = this,
                t = new Date().getTime();
              (t - this.startTime > 1e3 / this.frameRate &&
                (this.draw(), (this.startTime = t)),
                document.hidden
                  ? (clearTimeout(this.timeoutId),
                    (this.timeoutId = setTimeout(function () {
                      e.render();
                    }, 1e3 / this.frameRate)))
                  : (this.timeoutId && clearTimeout(this.timeoutId),
                    this.rafId && cancelAnimationFrame(this.rafId),
                    requestAnimationFrame(this.render.bind(this))));
            },
          },
          {
            key: "setBeautyParam",
            value: function (e) {
              var t = e.beauty,
                r = e.brightness,
                i = e.ruddy;
              (Va(t) && (this.beautyParams.beauty = t),
                Va(r) && (this.beautyParams.brightness = r),
                Va(i) && (this.beautyParams.ruddy = i),
                this.filter.setBeautyParams(this.beautyParams),
                this.getClose() && !this.disableStatus && this.disable(),
                !this.getClose() && this.disableStatus && this.enable());
            },
          },
          {
            key: "setRect",
            value: function (e, t) {
              var r = e || 640,
                i = t || 480;
              ((this.video.height = i),
                (this.video.width = r),
                (this.canvas.height = i),
                (this.canvas.width = r));
            },
          },
          {
            key: "reset",
            value: function () {
              (cancelAnimationFrame(this.rafId),
                clearTimeout(this.timeoutId),
                this.video.pause(),
                this.filter.reset(),
                this.beautyTrack && this.beautyTrack.stop(),
                this.originTrack && this.originTrack.stop());
            },
          },
          {
            key: "destroy",
            value: function () {
              (cancelAnimationFrame(this.rafId),
                clearTimeout(this.timeoutId),
                this.canvas &&
                  ((this.canvas.width = 0),
                  (this.canvas.height = 0),
                  this.canvas.remove(),
                  delete this.canvas),
                this.video &&
                  (this.video.pause(),
                  this.video.removeAttribute("srcObject"),
                  this.video.removeAttribute("src"),
                  this.video.load(),
                  (this.video.width = 0),
                  (this.video.height = 0),
                  this.video.remove(),
                  delete this.video),
                this.beautyTrack && this.beautyTrack.stop(),
                this.originTrack && this.originTrack.stop(),
                this.uninstallEvents());
            },
          },
          {
            key: "generateVideoTrackFromCanvasCapture",
            value: function (e) {
              return this.canvas.captureStream(e).getVideoTracks()[0];
            },
          },
          {
            key: "setBeautyTrack",
            value: function (t) {
              var r = t.originTrack,
                i = t.beautyTrack;
              e &&
                (e.beautyTrackMap || (e.beautyTrackMap = new Map()),
                e.beautyTrackMap.set(i.id, {
                  originTrack: r,
                  beautyTrack: i,
                  param: this.beautyParams,
                  pluginInstance: this,
                }));
            },
          },
          {
            key: "disable",
            value: function () {
              this.localStream &&
                this.originTrack &&
                (this.localStream.replaceTrack(this.originTrack),
                cancelAnimationFrame(this.rafId),
                clearTimeout(this.timeoutId),
                (this.disableStatus = !0));
            },
          },
          {
            key: "enable",
            value: function () {
              this.localStream &&
                this.beautyTrack &&
                (this.localStream.replaceTrack(this.beautyTrack),
                this.render(),
                (this.disableStatus = !1));
            },
          },
          {
            key: "installEvents",
            value: function () {
              document.addEventListener(
                "visibilitychange",
                this.render.bind(this),
              );
            },
          },
          {
            key: "uninstallEvents",
            value: function () {
              document.removeEventListener(
                "visibilitychange",
                this.render.bind(this),
              );
            },
          },
          {
            key: "getClose",
            value: function () {
              return (
                0 === this.beautyParams.beauty &&
                0 === this.beautyParams.brightness &&
                0 === this.beautyParams.ruddy
              );
            },
          },
        ]),
        r
      );
    })();
  return (
    e &&
      (e.getRTCBeautyPlugin = function () {
        return new ja();
      }),
    ja
  );
})(Xi.XRTC);
var Qi = RTCBeautyPlugin,
  $i = (function () {
    function e(t) {
      (F(this, e),
        (this.logger = t),
        (this.beautyParams = { beauty: 0.5, brightness: 0.5, ruddy: 0.5 }),
        (this.isBeautyStreamSupported = ot()),
        this.isBeautyStreamSupported && (this.rtcBeautyPlugin = new Qi()));
    }
    return (
      W(e, [
        {
          key: "generateBeautyStream",
          value: function (e) {
            return (
              this.logger.info(
                "generate beauty stream ,streamId ".concat(e.streamId),
              ),
              this.isBeautyStreamSupported
                ? this.rtcBeautyPlugin.generateBeautyStream(e)
                : e
            );
          },
        },
        {
          key: "setBeautyParam",
          value: function (e) {
            var t, r;
            if (!this.isBeautyStreamSupported)
              return this.logger.warn(
                "The current browser does not support beauty",
              );
            var i =
              null === (t = this.rtcBeautyPlugin) ||
              void 0 === t ||
              null === (r = t.localStream) ||
              void 0 === r
                ? void 0
                : r.getVideoTrack();
            if (null == i || !i.enabled)
              return this.logger.warn(
                "cannot set beauty param when video track is muted",
              );
            var n,
              o = e.beauty,
              a = e.brightness,
              s = e.ruddy;
            return o >= 0 && o <= 1 && a >= 0 && a <= 1 && s >= 0 && s <= 1
              ? ((this.beautyParams = e),
                this.logger.info(
                  "set beauty param beauty:"
                    .concat(o, ",brightness:")
                    .concat(a, ",ruddy:")
                    .concat(s),
                ),
                o > 0.5 &&
                  (this.beautyParams.beauty = Number(
                    (0.6 * (o - 0.5) + 0.5).toFixed(2),
                  )),
                null === (n = this.rtcBeautyPlugin) || void 0 === n
                  ? void 0
                  : n.setBeautyParam(this.beautyParams))
              : void 0;
          },
        },
        {
          key: "destroy",
          value: function () {
            var e = this,
              t = setTimeout(function () {
                (clearTimeout(t),
                  (e.rtcBeautyPlugin = null),
                  (e.logger = null),
                  (e.beautyParams = null));
              }, 100);
            return (
              this.logger.info("destroy beauty"),
              this.rtcBeautyPlugin && this.rtcBeautyPlugin.destroy()
            );
          },
        },
        {
          key: "updateBeautyStream",
          value: function (e) {
            if (!this.isBeautyStreamSupported)
              return this.logger.warn(
                "The current browser does not support beauty",
              );
            (this.logger.info("update beauty stream"),
              this.rtcBeautyPlugin.reset());
            var t = e.getVideoTrack();
            ((t.enabled = !0),
              t &&
                (this.rtcBeautyPlugin.generateBeautyTrack(t),
                this.rtcBeautyPlugin.enable()));
          },
        },
      ]),
      e
    );
  })(),
  Zi = new zr();
(Zi.info("browserDetails.browser", qi.browserDetails), (window.Logger = Zi));
var en,
  tn,
  rn,
  nn,
  on,
  an,
  sn,
  cn,
  un,
  dn,
  ln,
  hn,
  pn,
  fn,
  mn,
  vn,
  gn,
  yn = {
    VERSION: "5.2024.5.0_00",
    Logger: Zi,
    checkSystemRequirements: Ze,
    isScreenShareSupported: function () {
      return !(
        !navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia
      );
    },
    isSmallStreamSupported: nt,
    isBeautyStreamSupported: ot,
    getDevices: et,
    getCameras: tt,
    getMicrophones: rt,
    getSpeakers: it,
    createClient: function (e) {
      return (
        Zi.info("create client with config", JSON.stringify(e)),
        new Gr(e, Zi)
      );
    },
    createStream: function (e) {
      return (
        Zi.info("create stream with config", JSON.stringify(e)),
        new yt(e, Zi)
      );
    },
    createBeauty: function () {
      return (Zi.info("create beauty"), new $i(Zi));
    },
  },
  bn = (function (r) {
    function n() {
      var r;
      return (
        t(this, n),
        (r = e(this, n)),
        en.set(r, !1),
        tn.set(r, !1),
        rn.set(r, 1),
        nn.set(r, void 0),
        on.set(r, void 0),
        an.set(r, void 0),
        sn.set(r, void 0),
        cn.set(r, void 0),
        un.set(r, !1),
        dn.set(r, void 0),
        ln.set(r, void 0),
        hn.set(r, void 0),
        pn.set(r, !1),
        fn.set(r, function (e) {
          var t;
          console.log(
            ""
              .concat(e.type, " player is ")
              .concat(e.state, " because of ")
              .concat(e.reason),
          );
          try {
            switch (e.state) {
              case "PLAYING":
                "unmute" === e.reason && "video" === e.type
                  ? r.emit(T.playing)
                  : "playing" === e.reason &&
                    (m(r, pn, "f") || (v(r, pn, !0, "f"), r.emit(T.play)),
                    "audio" === e.type && r.emit(T.playing));
                break;
              case "PAUSED":
                "mute" === e.reason && "video" === e.type
                  ? r.emit(T.waiting)
                  : "video" === e.type &&
                    (null === (t = m(r, an, "f")) ||
                      void 0 === t ||
                      t.resume());
            }
          } catch (e) {
            console.error(e);
          }
        }),
        mn.set(r, function () {
          r.emit(T.stop);
        }),
        vn.set(r, function () {
          var e, t, i, n;
          (null === (e = m(r, sn, "f")) ||
            void 0 === e ||
            e.off("error", m(r, dn, "f")),
            null === (t = m(r, sn, "f")) ||
              void 0 === t ||
              t.off("stream-added", m(r, ln, "f")),
            null === (i = m(r, sn, "f")) ||
              void 0 === i ||
              i.off("stream-subscribed", m(r, hn, "f")),
            m(r, un, "f") &&
              (null === (n = m(r, sn, "f")) ||
                void 0 === n ||
                n.leave().catch(function () {
                  return console.log("");
                })),
            m(r, gn, "f").call(r),
            yn.Logger.disableUploadLog());
        }),
        gn.set(r, function () {
          var e, t, i;
          (null === (e = m(r, an, "f")) || void 0 === e || e.stop(),
            m(r, sn, "f") &&
              m(r, an, "f") &&
              (null === (i = (t = m(r, sn, "f")).unsubscribe) ||
                void 0 === i ||
                i.call(t, m(r, an, "f"))));
        }),
        yn.Logger.setLogLevel(yn.Logger.LogLevel.WARN),
        r
      );
    }
    return (
      a(n, _),
      i(n, [
        {
          key: "muted",
          get: function () {
            var e = m(this, tn, "f");
            if (m(this, an, "f"))
              try {
                e = m(this, an, "f").getAudioMuted();
              } catch (e) {
                console.log(e);
              }
            return e;
          },
          set: function (e) {
            (v(this, tn, e, "f"),
              m(this, an, "f") &&
                (e
                  ? m(this, an, "f").muteAudio()
                  : (m(this, an, "f").resume(),
                    m(this, an, "f").unmuteAudio())));
          },
        },
        {
          key: "volume",
          get: function () {
            return m(this, rn, "f");
          },
          set: function (e) {
            (e > 1 && (e = 1),
              v(this, rn, e, "f"),
              m(this, an, "f") && m(this, an, "f").setAudioVolume(e));
          },
        },
        {
          key: "stream",
          set: function (e) {
            v(this, nn, e, "f");
          },
        },
        {
          key: "videoWrapper",
          set: function (e) {
            v(this, on, e, "f");
          },
        },
        {
          key: "play",
          value: function () {
            return f(
              this,
              void 0,
              void 0,
              c().mark(function e() {
                var t,
                  r,
                  i,
                  n,
                  o,
                  a,
                  s,
                  u,
                  d,
                  l,
                  h,
                  p,
                  g,
                  y,
                  b = this;
                return c().wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          if (m(this, nn, "f")) {
                            e.next = 2;
                            break;
                          }
                          return e.abrupt(
                            "return",
                            Promise.reject(
                              new k(O.message, O.code, R.MediaError),
                            ),
                          );
                        case 2:
                          return (
                            v(this, pn, !1, "f"),
                            (t = m(this, nn, "f")),
                            (r = t.server),
                            (i = t.auth),
                            (n = t.appid),
                            (o = t.userId),
                            (a = t.roomId),
                            (s = v(
                              this,
                              sn,
                              yn.createClient({
                                wsUrl: r,
                                mode: "live",
                                sdkAppId: n,
                                userId: o,
                                userSig: i,
                              }),
                              "f",
                            )),
                            (u = w()),
                            (d = u.promise),
                            (l = u.controller),
                            (h = !1),
                            (p = w()),
                            (g = p.promise),
                            (y = p.controller),
                            v(
                              this,
                              hn,
                              function (e) {
                                var t,
                                  r,
                                  i = e.stream,
                                  n = null;
                                (i.on("player-state-changed", function (e) {
                                  return f(
                                    b,
                                    void 0,
                                    void 0,
                                    c().mark(function t() {
                                      var r = this;
                                      return c().wrap(
                                        function (t) {
                                          for (;;)
                                            switch ((t.prev = t.next)) {
                                              case 0:
                                                return (
                                                  h ||
                                                    "PLAYING" !== e.state ||
                                                    n ||
                                                    (n = setTimeout(
                                                      function () {
                                                        var e;
                                                        ((h = !0),
                                                          null ===
                                                            (e = l.resolve) ||
                                                            void 0 === e ||
                                                            e.call(l, 16451));
                                                      },
                                                      500,
                                                    )),
                                                  (t.next = 3),
                                                  d
                                                );
                                              case 3:
                                                v(
                                                  this,
                                                  cn,
                                                  setTimeout(function () {
                                                    m(r, fn, "f").call(r, e);
                                                  }),
                                                  "f",
                                                );
                                              case 4:
                                              case "end":
                                                return t.stop();
                                            }
                                        },
                                        t,
                                        this,
                                      );
                                    }),
                                  );
                                }),
                                  null == i ||
                                    i.on("error", function (e) {
                                      var t,
                                        r,
                                        i = null == e ? void 0 : e.getCode();
                                      16451 === i
                                        ? h
                                          ? (b.emit(T.playNotAllowed, P.code),
                                            v(b, en, !0, "f"),
                                            (b.muted = !0))
                                          : ((h = !0),
                                            null === (t = l.resolve) ||
                                              void 0 === t ||
                                              t.call(l, 16451))
                                        : (h ||
                                            ((h = !0),
                                            null === (r = l.reject) ||
                                              void 0 === r ||
                                              r.call(l, i)),
                                          b.emit(
                                            T.play,
                                            new k(
                                              L.message +
                                                " ".concat(
                                                  null == e
                                                    ? void 0
                                                    : e.getCode(),
                                                ),
                                              L.code,
                                              R.MediaError,
                                            ),
                                          ));
                                    }),
                                  null ===
                                    (r =
                                      null ===
                                        (t =
                                          null == i
                                            ? void 0
                                            : i
                                                .play(m(b, on, "f"), {
                                                  isEleLisenter: !1,
                                                  objectFit: "cover",
                                                })
                                                .then(function () {
                                                  (i.setAudioVolume(
                                                    m(b, rn, "f"),
                                                  ),
                                                    i.resize(),
                                                    m(b, tn, "f")
                                                      ? i.muteAudio()
                                                      : i.unmuteAudio());
                                                })
                                                .then(function () {
                                                  var e;
                                                  ((h = !0),
                                                    null === (e = l.resolve) ||
                                                      void 0 === e ||
                                                      e.call(l, !0));
                                                })) || void 0 === t
                                        ? void 0
                                        : t.catch) ||
                                    void 0 === r ||
                                    r.call(t, function (e) {
                                      var t, r;
                                      ((h = !0),
                                        16451 === e.getCode()
                                          ? null === (t = l.resolve) ||
                                            void 0 === t ||
                                            t.call(l, 16451)
                                          : (m(b, vn, "f").call(b),
                                            null === (r = l.reject) ||
                                              void 0 === r ||
                                              r.call(l, e)));
                                    }));
                              },
                              "f",
                            ),
                            v(
                              this,
                              dn,
                              function (e) {
                                var t;
                                (console.error(
                                  "client error observed: ",
                                  e.getCode(),
                                ),
                                  257 === e.getCode() &&
                                    (null === (t = y.reject) ||
                                      void 0 === t ||
                                      t.call(
                                        y,
                                        new k(A.message, A.code, R.MediaError),
                                      ),
                                    b.emit(
                                      T.error,
                                      new k(A.message, A.code, R.MediaError),
                                    ),
                                    m(b, vn, "f").call(b)));
                              },
                              "f",
                            ),
                            s.on("stream-subscribed", m(this, hn, "f")),
                            s.on("error", m(this, dn, "f")),
                            v(
                              this,
                              ln,
                              function (e) {
                                var t = v(b, an, e.stream, "f");
                                (t.setPlayBackground("#00000000"),
                                  m(b, sn, "f")
                                    .subscribe(t, { audio: !0, video: !0 })
                                    .then(function () {
                                      var e;
                                      null === (e = y.resolve) ||
                                        void 0 === e ||
                                        e.call(y, void 0);
                                    })
                                    .catch(function (e) {
                                      var t;
                                      (m(b, vn, "f").call(b),
                                        null === (t = y.reject) ||
                                          void 0 === t ||
                                          t.call(y, e));
                                    }));
                              },
                              "f",
                            ),
                            s.on("stream-added", m(this, ln, "f")),
                            yn.Logger.enableUploadLog(),
                            (e.prev = 15),
                            this.emit(T.waiting),
                            (e.next = 19),
                            s
                              .join({ roomId: a, role: "audience" })
                              .then(function () {
                                v(b, un, !0, "f");
                              })
                              .catch(function (e) {
                                return (
                                  m(b, vn, "f").call(b),
                                  Promise.reject(e)
                                );
                              })
                          );
                        case 19:
                          return ((e.next = 21), g);
                        case 21:
                          return ((e.next = 23), d);
                        case 23:
                          (16451 === e.sent &&
                            (this.emit(T.playNotAllowed, P.code),
                            v(this, en, !0, "f"),
                            (this.muted = !0)),
                            (e.next = 32));
                          break;
                        case 27:
                          throw (
                            (e.prev = 27),
                            (e.t0 = e.catch(15)),
                            this.emit(T.stop),
                            clearTimeout(m(this, cn, "f")),
                            e.t0
                          );
                        case 32:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                  [[15, 27]],
                );
              }),
            );
          },
        },
        {
          key: "resume",
          value: function () {
            m(this, an, "f") &&
              (m(this, en, "f") && ((this.muted = !1), v(this, en, !1, "f")),
              m(this, an, "f").resume());
          },
        },
        {
          key: "stop",
          value: function () {
            (clearTimeout(m(this, cn, "f")),
              m(this, mn, "f").call(this),
              m(this, vn, "f").call(this),
              v(this, un, !1, "f"),
              v(this, tn, !1, "f"),
              v(this, pn, !1, "f"),
              v(this, en, !1, "f"));
          },
        },
        {
          key: "setSinkId",
          value: function (e) {
            return f(
              this,
              void 0,
              void 0,
              c().mark(function t() {
                var r;
                return c().wrap(
                  function (t) {
                    for (;;)
                      switch ((t.prev = t.next)) {
                        case 0:
                          return (
                            (t.next = 2),
                            null === (r = m(this, an, "f")) || void 0 === r
                              ? void 0
                              : r.setAudioOutput(e)
                          );
                        case 2:
                        case "end":
                          return t.stop();
                      }
                  },
                  t,
                  this,
                );
              }),
            );
          },
        },
        {
          key: "getSinkId",
          value: function () {
            return f(
              this,
              void 0,
              void 0,
              c().mark(function e() {
                var t, r, i;
                return c().wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          return (
                            (e.next = 2),
                            null === (t = m(this, an, "f")) || void 0 === t
                              ? void 0
                              : t.getInuseSpeaker()
                          );
                        case 2:
                          return (
                            (i = e.sent),
                            e.abrupt(
                              "return",
                              (null === (r = null == i ? void 0 : i.speaker) ||
                              void 0 === r
                                ? void 0
                                : r.deviceId) || "",
                            )
                          );
                        case 4:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            );
          },
        },
        {
          key: "destroy",
          value: function () {
            (this.stop(), d(n, "destroy", this, 3)([]));
          },
        },
        {
          key: "resize",
          value: function () {
            m(this, an, "f") && m(this, an, "f").resize();
          },
        },
      ])
    );
  })();
function Sn(e) {
  throw new Error(
    'Could not dynamically require "' +
      e +
      '". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.',
  );
}
((en = new WeakMap()),
  (tn = new WeakMap()),
  (rn = new WeakMap()),
  (nn = new WeakMap()),
  (on = new WeakMap()),
  (an = new WeakMap()),
  (sn = new WeakMap()),
  (cn = new WeakMap()),
  (un = new WeakMap()),
  (dn = new WeakMap()),
  (ln = new WeakMap()),
  (hn = new WeakMap()),
  (pn = new WeakMap()),
  (fn = new WeakMap()),
  (mn = new WeakMap()),
  (vn = new WeakMap()),
  (gn = new WeakMap()));
var En, Cn;
!(function e(t, r, i) {
  function n(a, s) {
    if (!r[a]) {
      if (!t[a]) {
        if (!s && Sn) return Sn(a);
        if (o) return o(a, !0);
        var c = new Error("Cannot find module '" + a + "'");
        throw ((c.code = "MODULE_NOT_FOUND"), c);
      }
      var u = (r[a] = { exports: {} });
      t[a][0].call(
        u.exports,
        function (e) {
          return n(t[a][1][e] || e);
        },
        u,
        u.exports,
        e,
        t,
        r,
        i,
      );
    }
    return r[a].exports;
  }
  for (var o = Sn, a = 0; a < i.length; a++) n(i[a]);
  return n;
})(
  {
    1: [
      function (e, t, r) {
        var i = (0, e("./adapter_factory.js").adapterFactory)({
          window: window,
        });
        t.exports = i;
      },
      { "./adapter_factory.js": 2 },
    ],
    2: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.adapterFactory = function () {
            var e = (
                arguments.length > 0 && void 0 !== arguments[0]
                  ? arguments[0]
                  : {}
              ).window,
              t =
                arguments.length > 1 && void 0 !== arguments[1]
                  ? arguments[1]
                  : {
                      shimChrome: !0,
                      shimFirefox: !0,
                      shimEdge: !0,
                      shimSafari: !0,
                    },
              r = i.log,
              u = i.detectBrowser(e),
              d = {
                browserDetails: u,
                commonShim: c,
                extractVersion: i.extractVersion,
                disableLog: i.disableLog,
                disableWarnings: i.disableWarnings,
              };
            switch (u.browser) {
              case "chrome":
                if (!n || !n.shimPeerConnection || !t.shimChrome)
                  return (
                    r("Chrome shim is not included in this adapter release."),
                    d
                  );
                (r("adapter.js shimming chrome."),
                  (d.browserShim = n),
                  n.shimGetUserMedia(e),
                  n.shimMediaStream(e),
                  n.shimPeerConnection(e),
                  n.shimOnTrack(e),
                  n.shimAddTrackRemoveTrack(e),
                  n.shimGetSendersWithDtmf(e),
                  n.shimGetStats(e),
                  n.shimSenderReceiverGetStats(e),
                  n.fixNegotiationNeeded(e),
                  c.shimRTCIceCandidate(e),
                  c.shimConnectionState(e),
                  c.shimMaxMessageSize(e),
                  c.shimSendThrowTypeError(e),
                  c.removeAllowExtmapMixed(e));
                break;
              case "firefox":
                if (!a || !a.shimPeerConnection || !t.shimFirefox)
                  return (
                    r("Firefox shim is not included in this adapter release."),
                    d
                  );
                (r("adapter.js shimming firefox."),
                  (d.browserShim = a),
                  a.shimGetUserMedia(e),
                  a.shimPeerConnection(e),
                  a.shimOnTrack(e),
                  a.shimRemoveStream(e),
                  a.shimSenderGetStats(e),
                  a.shimReceiverGetStats(e),
                  a.shimRTCDataChannel(e),
                  a.shimAddTransceiver(e),
                  a.shimCreateOffer(e),
                  a.shimCreateAnswer(e),
                  c.shimRTCIceCandidate(e),
                  c.shimConnectionState(e),
                  c.shimMaxMessageSize(e),
                  c.shimSendThrowTypeError(e));
                break;
              case "edge":
                if (!o || !o.shimPeerConnection || !t.shimEdge)
                  return (
                    r("MS edge shim is not included in this adapter release."),
                    d
                  );
                (r("adapter.js shimming edge."),
                  (d.browserShim = o),
                  o.shimGetUserMedia(e),
                  o.shimGetDisplayMedia(e),
                  o.shimPeerConnection(e),
                  o.shimReplaceTrack(e),
                  c.shimMaxMessageSize(e),
                  c.shimSendThrowTypeError(e));
                break;
              case "safari":
                if (!s || !t.shimSafari)
                  return (
                    r("Safari shim is not included in this adapter release."),
                    d
                  );
                (r("adapter.js shimming safari."),
                  (d.browserShim = s),
                  s.shimRTCIceServerUrls(e),
                  s.shimCreateOfferLegacy(e),
                  s.shimCallbacksAPI(e),
                  s.shimLocalStreamsAPI(e),
                  s.shimRemoteStreamsAPI(e),
                  s.shimTrackEventTransceiver(e),
                  s.shimGetUserMedia(e),
                  c.shimRTCIceCandidate(e),
                  c.shimMaxMessageSize(e),
                  c.shimSendThrowTypeError(e),
                  c.removeAllowExtmapMixed(e));
                break;
              default:
                r("Unsupported browser!");
            }
            return d;
          }));
        var i = u(e("./utils")),
          n = u(e("./chrome/chrome_shim")),
          o = u(e("./edge/edge_shim")),
          a = u(e("./firefox/firefox_shim")),
          s = u(e("./safari/safari_shim")),
          c = u(e("./common_shim"));
        function u(e) {
          if (e && e.__esModule) return e;
          var t = {};
          if (null != e)
            for (var r in e)
              Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
          return ((t.default = e), t);
        }
      },
      {
        "./chrome/chrome_shim": 3,
        "./common_shim": 6,
        "./edge/edge_shim": 7,
        "./firefox/firefox_shim": 11,
        "./safari/safari_shim": 14,
        "./utils": 15,
      },
    ],
    3: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.shimGetDisplayMedia = r.shimGetUserMedia = void 0));
        var i =
            "function" == typeof Symbol && "symbol" == h(Symbol.iterator)
              ? function (e) {
                  return h(e);
                }
              : function (e) {
                  return e &&
                    "function" == typeof Symbol &&
                    e.constructor === Symbol &&
                    e !== Symbol.prototype
                    ? "symbol"
                    : h(e);
                },
          n = e("./getusermedia");
        Object.defineProperty(r, "shimGetUserMedia", {
          enumerable: !0,
          get: function () {
            return n.shimGetUserMedia;
          },
        });
        var o = e("./getdisplaymedia");
        (Object.defineProperty(r, "shimGetDisplayMedia", {
          enumerable: !0,
          get: function () {
            return o.shimGetDisplayMedia;
          },
        }),
          (r.shimMediaStream = function (e) {
            e.MediaStream = e.MediaStream || e.webkitMediaStream;
          }),
          (r.shimOnTrack = function (e) {
            if (
              "object" !== (void 0 === e ? "undefined" : i(e)) ||
              !e.RTCPeerConnection ||
              "ontrack" in e.RTCPeerConnection.prototype
            )
              a.wrapPeerConnectionEvent(e, "track", function (e) {
                return (
                  e.transceiver ||
                    Object.defineProperty(e, "transceiver", {
                      value: { receiver: e.receiver },
                    }),
                  e
                );
              });
            else {
              Object.defineProperty(e.RTCPeerConnection.prototype, "ontrack", {
                get: function () {
                  return this._ontrack;
                },
                set: function (e) {
                  (this._ontrack &&
                    this.removeEventListener("track", this._ontrack),
                    this.addEventListener("track", (this._ontrack = e)));
                },
                enumerable: !0,
                configurable: !0,
              });
              var t = e.RTCPeerConnection.prototype.setRemoteDescription;
              e.RTCPeerConnection.prototype.setRemoteDescription = function () {
                var r = this;
                return (
                  this._ontrackpoly ||
                    ((this._ontrackpoly = function (t) {
                      (t.stream.addEventListener("addtrack", function (i) {
                        var n = void 0;
                        n = e.RTCPeerConnection.prototype.getReceivers
                          ? r.getReceivers().find(function (e) {
                              return e.track && e.track.id === i.track.id;
                            })
                          : { track: i.track };
                        var o = new Event("track");
                        ((o.track = i.track),
                          (o.receiver = n),
                          (o.transceiver = { receiver: n }),
                          (o.streams = [t.stream]),
                          r.dispatchEvent(o));
                      }),
                        t.stream.getTracks().forEach(function (i) {
                          var n = void 0;
                          n = e.RTCPeerConnection.prototype.getReceivers
                            ? r.getReceivers().find(function (e) {
                                return e.track && e.track.id === i.id;
                              })
                            : { track: i };
                          var o = new Event("track");
                          ((o.track = i),
                            (o.receiver = n),
                            (o.transceiver = { receiver: n }),
                            (o.streams = [t.stream]),
                            r.dispatchEvent(o));
                        }));
                    }),
                    this.addEventListener("addstream", this._ontrackpoly)),
                  t.apply(this, arguments)
                );
              };
            }
          }),
          (r.shimGetSendersWithDtmf = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection &&
              !("getSenders" in e.RTCPeerConnection.prototype) &&
              "createDTMFSender" in e.RTCPeerConnection.prototype
            ) {
              var t = function (e, t) {
                return {
                  track: t,
                  get dtmf() {
                    return (
                      void 0 === this._dtmf &&
                        ("audio" === t.kind
                          ? (this._dtmf = e.createDTMFSender(t))
                          : (this._dtmf = null)),
                      this._dtmf
                    );
                  },
                  _pc: e,
                };
              };
              if (!e.RTCPeerConnection.prototype.getSenders) {
                e.RTCPeerConnection.prototype.getSenders = function () {
                  return (
                    (this._senders = this._senders || []),
                    this._senders.slice()
                  );
                };
                var r = e.RTCPeerConnection.prototype.addTrack;
                e.RTCPeerConnection.prototype.addTrack = function (e, i) {
                  var n = r.apply(this, arguments);
                  return (n || ((n = t(this, e)), this._senders.push(n)), n);
                };
                var n = e.RTCPeerConnection.prototype.removeTrack;
                e.RTCPeerConnection.prototype.removeTrack = function (e) {
                  n.apply(this, arguments);
                  var t = this._senders.indexOf(e);
                  -1 !== t && this._senders.splice(t, 1);
                };
              }
              var o = e.RTCPeerConnection.prototype.addStream;
              e.RTCPeerConnection.prototype.addStream = function (e) {
                var r = this;
                ((this._senders = this._senders || []),
                  o.apply(this, [e]),
                  e.getTracks().forEach(function (e) {
                    r._senders.push(t(r, e));
                  }));
              };
              var a = e.RTCPeerConnection.prototype.removeStream;
              e.RTCPeerConnection.prototype.removeStream = function (e) {
                var t = this;
                ((this._senders = this._senders || []),
                  a.apply(this, [e]),
                  e.getTracks().forEach(function (e) {
                    var r = t._senders.find(function (t) {
                      return t.track === e;
                    });
                    r && t._senders.splice(t._senders.indexOf(r), 1);
                  }));
              };
            } else if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection &&
              "getSenders" in e.RTCPeerConnection.prototype &&
              "createDTMFSender" in e.RTCPeerConnection.prototype &&
              e.RTCRtpSender &&
              !("dtmf" in e.RTCRtpSender.prototype)
            ) {
              var s = e.RTCPeerConnection.prototype.getSenders;
              ((e.RTCPeerConnection.prototype.getSenders = function () {
                var e = this,
                  t = s.apply(this, []);
                return (
                  t.forEach(function (t) {
                    return (t._pc = e);
                  }),
                  t
                );
              }),
                Object.defineProperty(e.RTCRtpSender.prototype, "dtmf", {
                  get: function () {
                    return (
                      void 0 === this._dtmf &&
                        ("audio" === this.track.kind
                          ? (this._dtmf = this._pc.createDTMFSender(this.track))
                          : (this._dtmf = null)),
                      this._dtmf
                    );
                  },
                }));
            }
          }),
          (r.shimGetStats = function (e) {
            if (e.RTCPeerConnection) {
              var t = e.RTCPeerConnection.prototype.getStats;
              e.RTCPeerConnection.prototype.getStats = function () {
                var e = this,
                  r = Array.prototype.slice.call(arguments),
                  i = r[0],
                  n = r[1],
                  o = r[2];
                if (arguments.length > 0 && "function" == typeof i)
                  return t.apply(this, arguments);
                if (
                  0 === t.length &&
                  (0 === arguments.length || "function" != typeof i)
                )
                  return t.apply(this, []);
                var a = function (e) {
                    var t = {};
                    return (
                      e.result().forEach(function (e) {
                        var r = {
                          id: e.id,
                          timestamp: e.timestamp,
                          type:
                            {
                              localcandidate: "local-candidate",
                              remotecandidate: "remote-candidate",
                            }[e.type] || e.type,
                        };
                        (e.names().forEach(function (t) {
                          r[t] = e.stat(t);
                        }),
                          (t[r.id] = r));
                      }),
                      t
                    );
                  },
                  s = function (e) {
                    return new Map(
                      Object.keys(e).map(function (t) {
                        return [t, e[t]];
                      }),
                    );
                  };
                if (arguments.length >= 2) {
                  var c = function (e) {
                    n(s(a(e)));
                  };
                  return t.apply(this, [c, i]);
                }
                return new Promise(function (r, i) {
                  t.apply(e, [
                    function (e) {
                      r(s(a(e)));
                    },
                    i,
                  ]);
                }).then(n, o);
              };
            }
          }),
          (r.shimSenderReceiverGetStats = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection &&
              e.RTCRtpSender &&
              e.RTCRtpReceiver
            ) {
              if (!("getStats" in e.RTCRtpSender.prototype)) {
                var t = e.RTCPeerConnection.prototype.getSenders;
                t &&
                  (e.RTCPeerConnection.prototype.getSenders = function () {
                    var e = this,
                      r = t.apply(this, []);
                    return (
                      r.forEach(function (t) {
                        return (t._pc = e);
                      }),
                      r
                    );
                  });
                var r = e.RTCPeerConnection.prototype.addTrack;
                (r &&
                  (e.RTCPeerConnection.prototype.addTrack = function () {
                    var e = r.apply(this, arguments);
                    return ((e._pc = this), e);
                  }),
                  (e.RTCRtpSender.prototype.getStats = function () {
                    var e = this;
                    return this._pc.getStats().then(function (t) {
                      return a.filterStats(t, e.track, !0);
                    });
                  }));
              }
              if (!("getStats" in e.RTCRtpReceiver.prototype)) {
                var n = e.RTCPeerConnection.prototype.getReceivers;
                (n &&
                  (e.RTCPeerConnection.prototype.getReceivers = function () {
                    var e = this,
                      t = n.apply(this, []);
                    return (
                      t.forEach(function (t) {
                        return (t._pc = e);
                      }),
                      t
                    );
                  }),
                  a.wrapPeerConnectionEvent(e, "track", function (e) {
                    return ((e.receiver._pc = e.srcElement), e);
                  }),
                  (e.RTCRtpReceiver.prototype.getStats = function () {
                    var e = this;
                    return this._pc.getStats().then(function (t) {
                      return a.filterStats(t, e.track, !1);
                    });
                  }));
              }
              if (
                "getStats" in e.RTCRtpSender.prototype &&
                "getStats" in e.RTCRtpReceiver.prototype
              ) {
                var o = e.RTCPeerConnection.prototype.getStats;
                e.RTCPeerConnection.prototype.getStats = function () {
                  if (
                    arguments.length > 0 &&
                    arguments[0] instanceof e.MediaStreamTrack
                  ) {
                    var t = arguments[0],
                      r = void 0,
                      i = void 0,
                      n = void 0;
                    return (
                      this.getSenders().forEach(function (e) {
                        e.track === t && (r ? (n = !0) : (r = e));
                      }),
                      this.getReceivers().forEach(function (e) {
                        return (
                          e.track === t && (i ? (n = !0) : (i = e)),
                          e.track === t
                        );
                      }),
                      n || (r && i)
                        ? Promise.reject(
                            new DOMException(
                              "There are more than one sender or receiver for the track.",
                              "InvalidAccessError",
                            ),
                          )
                        : r
                          ? r.getStats()
                          : i
                            ? i.getStats()
                            : Promise.reject(
                                new DOMException(
                                  "There is no sender or receiver for the track.",
                                  "InvalidAccessError",
                                ),
                              )
                    );
                  }
                  return o.apply(this, arguments);
                };
              }
            }
          }),
          (r.shimAddTrackRemoveTrackWithNative = c),
          (r.shimAddTrackRemoveTrack = function (e) {
            if (e.RTCPeerConnection) {
              var t = a.detectBrowser(e);
              if (e.RTCPeerConnection.prototype.addTrack && t.version >= 65)
                return c(e);
              var r = e.RTCPeerConnection.prototype.getLocalStreams;
              e.RTCPeerConnection.prototype.getLocalStreams = function () {
                var e = this,
                  t = r.apply(this);
                return (
                  (this._reverseStreams = this._reverseStreams || {}),
                  t.map(function (t) {
                    return e._reverseStreams[t.id];
                  })
                );
              };
              var i = e.RTCPeerConnection.prototype.addStream;
              e.RTCPeerConnection.prototype.addStream = function (t) {
                var r = this;
                if (
                  ((this._streams = this._streams || {}),
                  (this._reverseStreams = this._reverseStreams || {}),
                  t.getTracks().forEach(function (e) {
                    if (
                      r.getSenders().find(function (t) {
                        return t.track === e;
                      })
                    )
                      throw new DOMException(
                        "Track already exists.",
                        "InvalidAccessError",
                      );
                  }),
                  !this._reverseStreams[t.id])
                ) {
                  var n = new e.MediaStream(t.getTracks());
                  ((this._streams[t.id] = n),
                    (this._reverseStreams[n.id] = t),
                    (t = n));
                }
                i.apply(this, [t]);
              };
              var n = e.RTCPeerConnection.prototype.removeStream;
              ((e.RTCPeerConnection.prototype.removeStream = function (e) {
                ((this._streams = this._streams || {}),
                  (this._reverseStreams = this._reverseStreams || {}),
                  n.apply(this, [this._streams[e.id] || e]),
                  delete this._reverseStreams[
                    this._streams[e.id] ? this._streams[e.id].id : e.id
                  ],
                  delete this._streams[e.id]);
              }),
                (e.RTCPeerConnection.prototype.addTrack = function (t, r) {
                  var i = this;
                  if ("closed" === this.signalingState)
                    throw new DOMException(
                      "The RTCPeerConnection's signalingState is 'closed'.",
                      "InvalidStateError",
                    );
                  var n = [].slice.call(arguments, 1);
                  if (
                    1 !== n.length ||
                    !n[0].getTracks().find(function (e) {
                      return e === t;
                    })
                  )
                    throw new DOMException(
                      "The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.",
                      "NotSupportedError",
                    );
                  var o = this.getSenders().find(function (e) {
                    return e.track === t;
                  });
                  if (o)
                    throw new DOMException(
                      "Track already exists.",
                      "InvalidAccessError",
                    );
                  ((this._streams = this._streams || {}),
                    (this._reverseStreams = this._reverseStreams || {}));
                  var a = this._streams[r.id];
                  if (a)
                    (a.addTrack(t),
                      Promise.resolve().then(function () {
                        i.dispatchEvent(new Event("negotiationneeded"));
                      }));
                  else {
                    var s = new e.MediaStream([t]);
                    ((this._streams[r.id] = s),
                      (this._reverseStreams[s.id] = r),
                      this.addStream(s));
                  }
                  return this.getSenders().find(function (e) {
                    return e.track === t;
                  });
                }),
                ["createOffer", "createAnswer"].forEach(function (t) {
                  var r = e.RTCPeerConnection.prototype[t],
                    i = s({}, t, function () {
                      var e = this,
                        t = arguments;
                      return arguments.length &&
                        "function" == typeof arguments[0]
                        ? r.apply(this, [
                            function (r) {
                              var i = d(e, r);
                              t[0].apply(null, [i]);
                            },
                            function (e) {
                              t[1] && t[1].apply(null, e);
                            },
                            arguments[2],
                          ])
                        : r.apply(this, arguments).then(function (t) {
                            return d(e, t);
                          });
                    });
                  e.RTCPeerConnection.prototype[t] = i[t];
                }));
              var o = e.RTCPeerConnection.prototype.setLocalDescription;
              e.RTCPeerConnection.prototype.setLocalDescription = function () {
                return arguments.length && arguments[0].type
                  ? ((arguments[0] = l(this, arguments[0])),
                    o.apply(this, arguments))
                  : o.apply(this, arguments);
              };
              var u = Object.getOwnPropertyDescriptor(
                e.RTCPeerConnection.prototype,
                "localDescription",
              );
              (Object.defineProperty(
                e.RTCPeerConnection.prototype,
                "localDescription",
                {
                  get: function () {
                    var e = u.get.apply(this);
                    return "" === e.type ? e : d(this, e);
                  },
                },
              ),
                (e.RTCPeerConnection.prototype.removeTrack = function (e) {
                  var t = this;
                  if ("closed" === this.signalingState)
                    throw new DOMException(
                      "The RTCPeerConnection's signalingState is 'closed'.",
                      "InvalidStateError",
                    );
                  if (!e._pc)
                    throw new DOMException(
                      "Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.",
                      "TypeError",
                    );
                  if (e._pc !== this)
                    throw new DOMException(
                      "Sender was not created by this connection.",
                      "InvalidAccessError",
                    );
                  this._streams = this._streams || {};
                  var r = void 0;
                  (Object.keys(this._streams).forEach(function (i) {
                    t._streams[i].getTracks().find(function (t) {
                      return e.track === t;
                    }) && (r = t._streams[i]);
                  }),
                    r &&
                      (1 === r.getTracks().length
                        ? this.removeStream(this._reverseStreams[r.id])
                        : r.removeTrack(e.track),
                      this.dispatchEvent(new Event("negotiationneeded"))));
                }));
            }
            function d(e, t) {
              var r = t.sdp;
              return (
                Object.keys(e._reverseStreams || []).forEach(function (t) {
                  var i = e._reverseStreams[t],
                    n = e._streams[i.id];
                  r = r.replace(new RegExp(n.id, "g"), i.id);
                }),
                new RTCSessionDescription({ type: t.type, sdp: r })
              );
            }
            function l(e, t) {
              var r = t.sdp;
              return (
                Object.keys(e._reverseStreams || []).forEach(function (t) {
                  var i = e._reverseStreams[t],
                    n = e._streams[i.id];
                  r = r.replace(new RegExp(i.id, "g"), n.id);
                }),
                new RTCSessionDescription({ type: t.type, sdp: r })
              );
            }
          }),
          (r.shimPeerConnection = function (e) {
            var t = a.detectBrowser(e);
            if (
              (!e.RTCPeerConnection &&
                e.webkitRTCPeerConnection &&
                (e.RTCPeerConnection = e.webkitRTCPeerConnection),
              e.RTCPeerConnection)
            ) {
              t.version < 53 &&
                [
                  "setLocalDescription",
                  "setRemoteDescription",
                  "addIceCandidate",
                ].forEach(function (t) {
                  var r = e.RTCPeerConnection.prototype[t],
                    i = s({}, t, function () {
                      return (
                        (arguments[0] = new (
                          "addIceCandidate" === t
                            ? e.RTCIceCandidate
                            : e.RTCSessionDescription
                        )(arguments[0])),
                        r.apply(this, arguments)
                      );
                    });
                  e.RTCPeerConnection.prototype[t] = i[t];
                });
              var r = e.RTCPeerConnection.prototype.addIceCandidate;
              e.RTCPeerConnection.prototype.addIceCandidate = function () {
                return arguments[0]
                  ? t.version < 78 &&
                    arguments[0] &&
                    "" === arguments[0].candidate
                    ? Promise.resolve()
                    : r.apply(this, arguments)
                  : (arguments[1] && arguments[1].apply(null),
                    Promise.resolve());
              };
            }
          }),
          (r.fixNegotiationNeeded = function (e) {
            a.wrapPeerConnectionEvent(e, "negotiationneeded", function (e) {
              if ("stable" === e.target.signalingState) return e;
            });
          }));
        var a = (function (e) {
          if (e && e.__esModule) return e;
          var t = {};
          if (null != e)
            for (var r in e)
              Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
          return ((t.default = e), t);
        })(e("../utils.js"));
        function s(e, t, r) {
          return (
            t in e
              ? Object.defineProperty(e, t, {
                  value: r,
                  enumerable: !0,
                  configurable: !0,
                  writable: !0,
                })
              : (e[t] = r),
            e
          );
        }
        function c(e) {
          e.RTCPeerConnection.prototype.getLocalStreams = function () {
            var e = this;
            return (
              (this._shimmedLocalStreams = this._shimmedLocalStreams || {}),
              Object.keys(this._shimmedLocalStreams).map(function (t) {
                return e._shimmedLocalStreams[t][0];
              })
            );
          };
          var t = e.RTCPeerConnection.prototype.addTrack;
          e.RTCPeerConnection.prototype.addTrack = function (e, r) {
            if (!r) return t.apply(this, arguments);
            this._shimmedLocalStreams = this._shimmedLocalStreams || {};
            var i = t.apply(this, arguments);
            return (
              this._shimmedLocalStreams[r.id]
                ? -1 === this._shimmedLocalStreams[r.id].indexOf(i) &&
                  this._shimmedLocalStreams[r.id].push(i)
                : (this._shimmedLocalStreams[r.id] = [r, i]),
              i
            );
          };
          var r = e.RTCPeerConnection.prototype.addStream;
          e.RTCPeerConnection.prototype.addStream = function (e) {
            var t = this;
            ((this._shimmedLocalStreams = this._shimmedLocalStreams || {}),
              e.getTracks().forEach(function (e) {
                if (
                  t.getSenders().find(function (t) {
                    return t.track === e;
                  })
                )
                  throw new DOMException(
                    "Track already exists.",
                    "InvalidAccessError",
                  );
              }));
            var i = this.getSenders();
            r.apply(this, arguments);
            var n = this.getSenders().filter(function (e) {
              return -1 === i.indexOf(e);
            });
            this._shimmedLocalStreams[e.id] = [e].concat(n);
          };
          var i = e.RTCPeerConnection.prototype.removeStream;
          e.RTCPeerConnection.prototype.removeStream = function (e) {
            return (
              (this._shimmedLocalStreams = this._shimmedLocalStreams || {}),
              delete this._shimmedLocalStreams[e.id],
              i.apply(this, arguments)
            );
          };
          var n = e.RTCPeerConnection.prototype.removeTrack;
          e.RTCPeerConnection.prototype.removeTrack = function (e) {
            var t = this;
            return (
              (this._shimmedLocalStreams = this._shimmedLocalStreams || {}),
              e &&
                Object.keys(this._shimmedLocalStreams).forEach(function (r) {
                  var i = t._shimmedLocalStreams[r].indexOf(e);
                  (-1 !== i && t._shimmedLocalStreams[r].splice(i, 1),
                    1 === t._shimmedLocalStreams[r].length &&
                      delete t._shimmedLocalStreams[r]);
                }),
              n.apply(this, arguments)
            );
          };
        }
      },
      { "../utils.js": 15, "./getdisplaymedia": 4, "./getusermedia": 5 },
    ],
    4: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.shimGetDisplayMedia = function (e, t) {
            (e.navigator.mediaDevices &&
              "getDisplayMedia" in e.navigator.mediaDevices) ||
              (e.navigator.mediaDevices &&
                ("function" == typeof t
                  ? (e.navigator.mediaDevices.getDisplayMedia = function (r) {
                      return t(r).then(function (t) {
                        var i = r.video && r.video.width,
                          n = r.video && r.video.height,
                          o = r.video && r.video.frameRate;
                        return (
                          (r.video = {
                            mandatory: {
                              chromeMediaSource: "desktop",
                              chromeMediaSourceId: t,
                              maxFrameRate: o || 3,
                            },
                          }),
                          i && (r.video.mandatory.maxWidth = i),
                          n && (r.video.mandatory.maxHeight = n),
                          e.navigator.mediaDevices.getUserMedia(r)
                        );
                      });
                    })
                  : console.error(
                      "shimGetDisplayMedia: getSourceId argument is not a function",
                    )));
          }));
      },
      {},
    ],
    5: [
      function (e, t, r) {
        Object.defineProperty(r, "__esModule", { value: !0 });
        var i =
          "function" == typeof Symbol && "symbol" == h(Symbol.iterator)
            ? function (e) {
                return h(e);
              }
            : function (e) {
                return e &&
                  "function" == typeof Symbol &&
                  e.constructor === Symbol &&
                  e !== Symbol.prototype
                  ? "symbol"
                  : h(e);
              };
        r.shimGetUserMedia = function (e) {
          var t = e && e.navigator;
          if (t.mediaDevices) {
            var r = n.detectBrowser(e),
              a = function (e) {
                if (
                  "object" !== (void 0 === e ? "undefined" : i(e)) ||
                  e.mandatory ||
                  e.optional
                )
                  return e;
                var t = {};
                return (
                  Object.keys(e).forEach(function (r) {
                    if (
                      "require" !== r &&
                      "advanced" !== r &&
                      "mediaSource" !== r
                    ) {
                      var n = "object" === i(e[r]) ? e[r] : { ideal: e[r] };
                      void 0 !== n.exact &&
                        "number" == typeof n.exact &&
                        (n.min = n.max = n.exact);
                      var o = function (e, t) {
                        return e
                          ? e + t.charAt(0).toUpperCase() + t.slice(1)
                          : "deviceId" === t
                            ? "sourceId"
                            : t;
                      };
                      if (void 0 !== n.ideal) {
                        t.optional = t.optional || [];
                        var a = {};
                        "number" == typeof n.ideal
                          ? ((a[o("min", r)] = n.ideal),
                            t.optional.push(a),
                            ((a = {})[o("max", r)] = n.ideal),
                            t.optional.push(a))
                          : ((a[o("", r)] = n.ideal), t.optional.push(a));
                      }
                      void 0 !== n.exact && "number" != typeof n.exact
                        ? ((t.mandatory = t.mandatory || {}),
                          (t.mandatory[o("", r)] = n.exact))
                        : ["min", "max"].forEach(function (e) {
                            void 0 !== n[e] &&
                              ((t.mandatory = t.mandatory || {}),
                              (t.mandatory[o(e, r)] = n[e]));
                          });
                    }
                  }),
                  e.advanced &&
                    (t.optional = (t.optional || []).concat(e.advanced)),
                  t
                );
              },
              s = function (e, n) {
                if (r.version >= 61) return n(e);
                if (
                  (e = JSON.parse(JSON.stringify(e))) &&
                  "object" === i(e.audio)
                ) {
                  var s = function (e, t, r) {
                    t in e && !(r in e) && ((e[r] = e[t]), delete e[t]);
                  };
                  (s(
                    (e = JSON.parse(JSON.stringify(e))).audio,
                    "autoGainControl",
                    "googAutoGainControl",
                  ),
                    s(e.audio, "noiseSuppression", "googNoiseSuppression"),
                    (e.audio = a(e.audio)));
                }
                if (e && "object" === i(e.video)) {
                  var c = e.video.facingMode;
                  c =
                    c &&
                    ("object" === (void 0 === c ? "undefined" : i(c))
                      ? c
                      : { ideal: c });
                  var u = r.version < 66;
                  if (
                    c &&
                    ("user" === c.exact ||
                      "environment" === c.exact ||
                      "user" === c.ideal ||
                      "environment" === c.ideal) &&
                    (!t.mediaDevices.getSupportedConstraints ||
                      !t.mediaDevices.getSupportedConstraints().facingMode ||
                      u)
                  ) {
                    delete e.video.facingMode;
                    var d = void 0;
                    if (
                      ("environment" === c.exact || "environment" === c.ideal
                        ? (d = ["back", "rear"])
                        : ("user" !== c.exact && "user" !== c.ideal) ||
                          (d = ["front"]),
                      d)
                    )
                      return t.mediaDevices
                        .enumerateDevices()
                        .then(function (t) {
                          var r = (t = t.filter(function (e) {
                            return "videoinput" === e.kind;
                          })).find(function (e) {
                            return d.some(function (t) {
                              return e.label.toLowerCase().includes(t);
                            });
                          });
                          return (
                            !r &&
                              t.length &&
                              d.includes("back") &&
                              (r = t[t.length - 1]),
                            r &&
                              (e.video.deviceId = c.exact
                                ? { exact: r.deviceId }
                                : { ideal: r.deviceId }),
                            (e.video = a(e.video)),
                            o("chrome: " + JSON.stringify(e)),
                            n(e)
                          );
                        });
                  }
                  e.video = a(e.video);
                }
                return (o("chrome: " + JSON.stringify(e)), n(e));
              },
              c = function (e) {
                return r.version >= 64
                  ? e
                  : {
                      name:
                        {
                          PermissionDeniedError: "NotAllowedError",
                          PermissionDismissedError: "NotAllowedError",
                          InvalidStateError: "NotAllowedError",
                          DevicesNotFoundError: "NotFoundError",
                          ConstraintNotSatisfiedError: "OverconstrainedError",
                          TrackStartError: "NotReadableError",
                          MediaDeviceFailedDueToShutdown: "NotAllowedError",
                          MediaDeviceKillSwitchOn: "NotAllowedError",
                          TabCaptureError: "AbortError",
                          ScreenCaptureError: "AbortError",
                          DeviceCaptureError: "AbortError",
                        }[e.name] || e.name,
                      message: e.message,
                      constraint: e.constraint || e.constraintName,
                      toString: function () {
                        return (
                          this.name + (this.message && ": ") + this.message
                        );
                      },
                    };
              };
            if (
              ((t.getUserMedia = function (e, r, i) {
                s(e, function (e) {
                  t.webkitGetUserMedia(e, r, function (e) {
                    i && i(c(e));
                  });
                });
              }.bind(t)),
              t.mediaDevices.getUserMedia)
            ) {
              var u = t.mediaDevices.getUserMedia.bind(t.mediaDevices);
              t.mediaDevices.getUserMedia = function (e) {
                return s(e, function (e) {
                  return u(e).then(
                    function (t) {
                      if (
                        (e.audio && !t.getAudioTracks().length) ||
                        (e.video && !t.getVideoTracks().length)
                      )
                        throw (
                          t.getTracks().forEach(function (e) {
                            e.stop();
                          }),
                          new DOMException("", "NotFoundError")
                        );
                      return t;
                    },
                    function (e) {
                      return Promise.reject(c(e));
                    },
                  );
                });
              };
            }
          }
        };
        var n = (function (e) {
            if (e && e.__esModule) return e;
            var t = {};
            if (null != e)
              for (var r in e)
                Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
            return ((t.default = e), t);
          })(e("../utils.js")),
          o = n.log;
      },
      { "../utils.js": 15 },
    ],
    6: [
      function (e, t, r) {
        Object.defineProperty(r, "__esModule", { value: !0 });
        var i =
          "function" == typeof Symbol && "symbol" == h(Symbol.iterator)
            ? function (e) {
                return h(e);
              }
            : function (e) {
                return e &&
                  "function" == typeof Symbol &&
                  e.constructor === Symbol &&
                  e !== Symbol.prototype
                  ? "symbol"
                  : h(e);
              };
        ((r.shimRTCIceCandidate = function (e) {
          if (
            !(
              !e.RTCIceCandidate ||
              (e.RTCIceCandidate && "foundation" in e.RTCIceCandidate.prototype)
            )
          ) {
            var t = e.RTCIceCandidate;
            ((e.RTCIceCandidate = function (e) {
              if (
                ("object" === (void 0 === e ? "undefined" : i(e)) &&
                  e.candidate &&
                  0 === e.candidate.indexOf("a=") &&
                  ((e = JSON.parse(JSON.stringify(e))).candidate =
                    e.candidate.substr(2)),
                e.candidate && e.candidate.length)
              ) {
                var r = new t(e),
                  n = o.default.parseCandidate(e.candidate),
                  a = Object.assign(r, n);
                return (
                  (a.toJSON = function () {
                    return {
                      candidate: a.candidate,
                      sdpMid: a.sdpMid,
                      sdpMLineIndex: a.sdpMLineIndex,
                      usernameFragment: a.usernameFragment,
                    };
                  }),
                  a
                );
              }
              return new t(e);
            }),
              (e.RTCIceCandidate.prototype = t.prototype),
              a.wrapPeerConnectionEvent(e, "icecandidate", function (t) {
                return (
                  t.candidate &&
                    Object.defineProperty(t, "candidate", {
                      value: new e.RTCIceCandidate(t.candidate),
                      writable: "false",
                    }),
                  t
                );
              }));
          }
        }),
          (r.shimMaxMessageSize = function (e) {
            if (e.RTCPeerConnection) {
              var t = a.detectBrowser(e);
              "sctp" in e.RTCPeerConnection.prototype ||
                Object.defineProperty(e.RTCPeerConnection.prototype, "sctp", {
                  get: function () {
                    return void 0 === this._sctp ? null : this._sctp;
                  },
                });
              var r = function (e) {
                  if (!e || !e.sdp) return !1;
                  var t = o.default.splitSections(e.sdp);
                  return (
                    t.shift(),
                    t.some(function (e) {
                      var t = o.default.parseMLine(e);
                      return (
                        t &&
                        "application" === t.kind &&
                        -1 !== t.protocol.indexOf("SCTP")
                      );
                    })
                  );
                },
                i = function (e) {
                  var t = e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);
                  if (null === t || t.length < 2) return -1;
                  var r = parseInt(t[1], 10);
                  return r != r ? -1 : r;
                },
                n = function (e) {
                  var r = 65536;
                  return (
                    "firefox" === t.browser &&
                      (r =
                        t.version < 57
                          ? -1 === e
                            ? 16384
                            : 2147483637
                          : t.version < 60
                            ? 57 === t.version
                              ? 65535
                              : 65536
                            : 2147483637),
                    r
                  );
                },
                s = function (e, r) {
                  var i = 65536;
                  "firefox" === t.browser && 57 === t.version && (i = 65535);
                  var n = o.default.matchPrefix(e.sdp, "a=max-message-size:");
                  return (
                    n.length > 0
                      ? (i = parseInt(n[0].substr(19), 10))
                      : "firefox" === t.browser && -1 !== r && (i = 2147483637),
                    i
                  );
                },
                c = e.RTCPeerConnection.prototype.setRemoteDescription;
              e.RTCPeerConnection.prototype.setRemoteDescription = function () {
                if (
                  ((this._sctp = null),
                  "chrome" === t.browser &&
                    t.version >= 76 &&
                    "plan-b" === this.getConfiguration().sdpSemantics &&
                    Object.defineProperty(this, "sctp", {
                      get: function () {
                        return void 0 === this._sctp ? null : this._sctp;
                      },
                      enumerable: !0,
                      configurable: !0,
                    }),
                  r(arguments[0]))
                ) {
                  var e = i(arguments[0]),
                    o = n(e),
                    a = s(arguments[0], e),
                    u = void 0;
                  u =
                    0 === o && 0 === a
                      ? Number.POSITIVE_INFINITY
                      : 0 === o || 0 === a
                        ? Math.max(o, a)
                        : Math.min(o, a);
                  var d = {};
                  (Object.defineProperty(d, "maxMessageSize", {
                    get: function () {
                      return u;
                    },
                  }),
                    (this._sctp = d));
                }
                return c.apply(this, arguments);
              };
            }
          }),
          (r.shimSendThrowTypeError = function (e) {
            if (
              e.RTCPeerConnection &&
              "createDataChannel" in e.RTCPeerConnection.prototype
            ) {
              var t = e.RTCPeerConnection.prototype.createDataChannel;
              ((e.RTCPeerConnection.prototype.createDataChannel = function () {
                var e = t.apply(this, arguments);
                return (r(e, this), e);
              }),
                a.wrapPeerConnectionEvent(e, "datachannel", function (e) {
                  return (r(e.channel, e.target), e);
                }));
            }
            function r(e, t) {
              var r = e.send;
              e.send = function () {
                var i = arguments[0],
                  n = i.length || i.size || i.byteLength;
                if (
                  "open" === e.readyState &&
                  t.sctp &&
                  n > t.sctp.maxMessageSize
                )
                  throw new TypeError(
                    "Message too large (can send a maximum of " +
                      t.sctp.maxMessageSize +
                      " bytes)",
                  );
                return r.apply(e, arguments);
              };
            }
          }),
          (r.shimConnectionState = function (e) {
            if (
              e.RTCPeerConnection &&
              !("connectionState" in e.RTCPeerConnection.prototype)
            ) {
              var t = e.RTCPeerConnection.prototype;
              (Object.defineProperty(t, "connectionState", {
                get: function () {
                  return (
                    { completed: "connected", checking: "connecting" }[
                      this.iceConnectionState
                    ] || this.iceConnectionState
                  );
                },
                enumerable: !0,
                configurable: !0,
              }),
                Object.defineProperty(t, "onconnectionstatechange", {
                  get: function () {
                    return this._onconnectionstatechange || null;
                  },
                  set: function (e) {
                    (this._onconnectionstatechange &&
                      (this.removeEventListener(
                        "connectionstatechange",
                        this._onconnectionstatechange,
                      ),
                      delete this._onconnectionstatechange),
                      e &&
                        this.addEventListener(
                          "connectionstatechange",
                          (this._onconnectionstatechange = e),
                        ));
                  },
                  enumerable: !0,
                  configurable: !0,
                }),
                ["setLocalDescription", "setRemoteDescription"].forEach(
                  function (e) {
                    var r = t[e];
                    t[e] = function () {
                      return (
                        this._connectionstatechangepoly ||
                          ((this._connectionstatechangepoly = function (e) {
                            var t = e.target;
                            if (t._lastConnectionState !== t.connectionState) {
                              t._lastConnectionState = t.connectionState;
                              var r = new Event("connectionstatechange", e);
                              t.dispatchEvent(r);
                            }
                            return e;
                          }),
                          this.addEventListener(
                            "iceconnectionstatechange",
                            this._connectionstatechangepoly,
                          )),
                        r.apply(this, arguments)
                      );
                    };
                  },
                ));
            }
          }),
          (r.removeAllowExtmapMixed = function (e) {
            if (e.RTCPeerConnection) {
              var t = a.detectBrowser(e);
              if (!("chrome" === t.browser && t.version >= 71)) {
                var r = e.RTCPeerConnection.prototype.setRemoteDescription;
                e.RTCPeerConnection.prototype.setRemoteDescription = function (
                  e,
                ) {
                  return (
                    e &&
                      e.sdp &&
                      -1 !== e.sdp.indexOf("\na=extmap-allow-mixed") &&
                      (e.sdp = e.sdp
                        .split("\n")
                        .filter(function (e) {
                          return "a=extmap-allow-mixed" !== e.trim();
                        })
                        .join("\n")),
                    r.apply(this, arguments)
                  );
                };
              }
            }
          }));
        var n,
          o = (n = e("sdp")) && n.__esModule ? n : { default: n },
          a = (function (e) {
            if (e && e.__esModule) return e;
            var t = {};
            if (null != e)
              for (var r in e)
                Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
            return ((t.default = e), t);
          })(e("./utils"));
      },
      { "./utils": 15, sdp: 17 },
    ],
    7: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.shimGetDisplayMedia = r.shimGetUserMedia = void 0));
        var i = e("./getusermedia");
        Object.defineProperty(r, "shimGetUserMedia", {
          enumerable: !0,
          get: function () {
            return i.shimGetUserMedia;
          },
        });
        var n = e("./getdisplaymedia");
        (Object.defineProperty(r, "shimGetDisplayMedia", {
          enumerable: !0,
          get: function () {
            return n.shimGetDisplayMedia;
          },
        }),
          (r.shimPeerConnection = function (e) {
            var t = a.detectBrowser(e);
            if (
              e.RTCIceGatherer &&
              (e.RTCIceCandidate ||
                (e.RTCIceCandidate = function (e) {
                  return e;
                }),
              e.RTCSessionDescription ||
                (e.RTCSessionDescription = function (e) {
                  return e;
                }),
              t.version < 15025)
            ) {
              var r = Object.getOwnPropertyDescriptor(
                e.MediaStreamTrack.prototype,
                "enabled",
              );
              Object.defineProperty(e.MediaStreamTrack.prototype, "enabled", {
                set: function (e) {
                  r.set.call(this, e);
                  var t = new Event("enabled");
                  ((t.enabled = e), this.dispatchEvent(t));
                },
              });
            }
            (!e.RTCRtpSender ||
              "dtmf" in e.RTCRtpSender.prototype ||
              Object.defineProperty(e.RTCRtpSender.prototype, "dtmf", {
                get: function () {
                  return (
                    void 0 === this._dtmf &&
                      ("audio" === this.track.kind
                        ? (this._dtmf = new e.RTCDtmfSender(this))
                        : "video" === this.track.kind && (this._dtmf = null)),
                    this._dtmf
                  );
                },
              }),
              e.RTCDtmfSender &&
                !e.RTCDTMFSender &&
                (e.RTCDTMFSender = e.RTCDtmfSender));
            var i = (0, c.default)(e, t.version);
            ((e.RTCPeerConnection = function (e) {
              return (
                e &&
                  e.iceServers &&
                  ((e.iceServers = (0, s.filterIceServers)(
                    e.iceServers,
                    t.version,
                  )),
                  a.log("ICE servers after filtering:", e.iceServers)),
                new i(e)
              );
            }),
              (e.RTCPeerConnection.prototype = i.prototype));
          }),
          (r.shimReplaceTrack = function (e) {
            !e.RTCRtpSender ||
              "replaceTrack" in e.RTCRtpSender.prototype ||
              (e.RTCRtpSender.prototype.replaceTrack =
                e.RTCRtpSender.prototype.setTrack);
          }));
        var o,
          a = (function (e) {
            if (e && e.__esModule) return e;
            var t = {};
            if (null != e)
              for (var r in e)
                Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
            return ((t.default = e), t);
          })(e("../utils")),
          s = e("./filtericeservers"),
          c =
            (o = e("rtcpeerconnection-shim")) && o.__esModule
              ? o
              : { default: o };
      },
      {
        "../utils": 15,
        "./filtericeservers": 8,
        "./getdisplaymedia": 9,
        "./getusermedia": 10,
        "rtcpeerconnection-shim": 16,
      },
    ],
    8: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.filterIceServers = function (e, t) {
            var r = !1;
            return (e = JSON.parse(JSON.stringify(e))).filter(function (e) {
              if (e && (e.urls || e.url)) {
                var t = e.urls || e.url;
                e.url &&
                  !e.urls &&
                  i.deprecated("RTCIceServer.url", "RTCIceServer.urls");
                var n = "string" == typeof t;
                return (
                  n && (t = [t]),
                  (t = t.filter(function (e) {
                    if (0 === e.indexOf("stun:")) return !1;
                    var t =
                      e.startsWith("turn") &&
                      !e.startsWith("turn:[") &&
                      e.includes("transport=udp");
                    return t && !r ? ((r = !0), !0) : t && !r;
                  })),
                  delete e.url,
                  (e.urls = n ? t[0] : t),
                  !!t.length
                );
              }
            });
          }));
        var i = (function (e) {
          if (e && e.__esModule) return e;
          var t = {};
          if (null != e)
            for (var r in e)
              Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
          return ((t.default = e), t);
        })(e("../utils"));
      },
      { "../utils": 15 },
    ],
    9: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.shimGetDisplayMedia = function (e) {
            "getDisplayMedia" in e.navigator &&
              e.navigator.mediaDevices &&
              ((e.navigator.mediaDevices &&
                "getDisplayMedia" in e.navigator.mediaDevices) ||
                (e.navigator.mediaDevices.getDisplayMedia =
                  e.navigator.getDisplayMedia.bind(e.navigator)));
          }));
      },
      {},
    ],
    10: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.shimGetUserMedia = function (e) {
            var t = e && e.navigator,
              r = t.mediaDevices.getUserMedia.bind(t.mediaDevices);
            t.mediaDevices.getUserMedia = function (e) {
              return r(e).catch(function (e) {
                return Promise.reject(
                  (function (e) {
                    return {
                      name:
                        { PermissionDeniedError: "NotAllowedError" }[e.name] ||
                        e.name,
                      message: e.message,
                      constraint: e.constraint,
                      toString: function () {
                        return this.name;
                      },
                    };
                  })(e),
                );
              });
            };
          }));
      },
      {},
    ],
    11: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.shimGetDisplayMedia = r.shimGetUserMedia = void 0));
        var i =
            "function" == typeof Symbol && "symbol" == h(Symbol.iterator)
              ? function (e) {
                  return h(e);
                }
              : function (e) {
                  return e &&
                    "function" == typeof Symbol &&
                    e.constructor === Symbol &&
                    e !== Symbol.prototype
                    ? "symbol"
                    : h(e);
                },
          n = e("./getusermedia");
        Object.defineProperty(r, "shimGetUserMedia", {
          enumerable: !0,
          get: function () {
            return n.shimGetUserMedia;
          },
        });
        var o = e("./getdisplaymedia");
        (Object.defineProperty(r, "shimGetDisplayMedia", {
          enumerable: !0,
          get: function () {
            return o.shimGetDisplayMedia;
          },
        }),
          (r.shimOnTrack = function (e) {
            "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCTrackEvent &&
              "receiver" in e.RTCTrackEvent.prototype &&
              !("transceiver" in e.RTCTrackEvent.prototype) &&
              Object.defineProperty(e.RTCTrackEvent.prototype, "transceiver", {
                get: function () {
                  return { receiver: this.receiver };
                },
              });
          }),
          (r.shimPeerConnection = function (e) {
            var t = a.detectBrowser(e);
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              (e.RTCPeerConnection || e.mozRTCPeerConnection)
            ) {
              if (
                (!e.RTCPeerConnection &&
                  e.mozRTCPeerConnection &&
                  (e.RTCPeerConnection = e.mozRTCPeerConnection),
                t.version < 53 &&
                  [
                    "setLocalDescription",
                    "setRemoteDescription",
                    "addIceCandidate",
                  ].forEach(function (t) {
                    var r = e.RTCPeerConnection.prototype[t],
                      i = (function (e, t, r) {
                        return (
                          t in e
                            ? Object.defineProperty(e, t, {
                                value: r,
                                enumerable: !0,
                                configurable: !0,
                                writable: !0,
                              })
                            : (e[t] = r),
                          e
                        );
                      })({}, t, function () {
                        return (
                          (arguments[0] = new (
                            "addIceCandidate" === t
                              ? e.RTCIceCandidate
                              : e.RTCSessionDescription
                          )(arguments[0])),
                          r.apply(this, arguments)
                        );
                      });
                    e.RTCPeerConnection.prototype[t] = i[t];
                  }),
                t.version < 68)
              ) {
                var r = e.RTCPeerConnection.prototype.addIceCandidate;
                e.RTCPeerConnection.prototype.addIceCandidate = function () {
                  return arguments[0]
                    ? arguments[0] && "" === arguments[0].candidate
                      ? Promise.resolve()
                      : r.apply(this, arguments)
                    : (arguments[1] && arguments[1].apply(null),
                      Promise.resolve());
                };
              }
              var n = {
                  inboundrtp: "inbound-rtp",
                  outboundrtp: "outbound-rtp",
                  candidatepair: "candidate-pair",
                  localcandidate: "local-candidate",
                  remotecandidate: "remote-candidate",
                },
                o = e.RTCPeerConnection.prototype.getStats;
              e.RTCPeerConnection.prototype.getStats = function () {
                var e = Array.prototype.slice.call(arguments),
                  r = e[0],
                  i = e[1],
                  a = e[2];
                return o
                  .apply(this, [r || null])
                  .then(function (e) {
                    if (t.version < 53 && !i)
                      try {
                        e.forEach(function (e) {
                          e.type = n[e.type] || e.type;
                        });
                      } catch (t) {
                        if ("TypeError" !== t.name) throw t;
                        e.forEach(function (t, r) {
                          e.set(
                            r,
                            Object.assign({}, t, { type: n[t.type] || t.type }),
                          );
                        });
                      }
                    return e;
                  })
                  .then(i, a);
              };
            }
          }),
          (r.shimSenderGetStats = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection &&
              e.RTCRtpSender &&
              (!e.RTCRtpSender || !("getStats" in e.RTCRtpSender.prototype))
            ) {
              var t = e.RTCPeerConnection.prototype.getSenders;
              t &&
                (e.RTCPeerConnection.prototype.getSenders = function () {
                  var e = this,
                    r = t.apply(this, []);
                  return (
                    r.forEach(function (t) {
                      return (t._pc = e);
                    }),
                    r
                  );
                });
              var r = e.RTCPeerConnection.prototype.addTrack;
              (r &&
                (e.RTCPeerConnection.prototype.addTrack = function () {
                  var e = r.apply(this, arguments);
                  return ((e._pc = this), e);
                }),
                (e.RTCRtpSender.prototype.getStats = function () {
                  return this.track
                    ? this._pc.getStats(this.track)
                    : Promise.resolve(new Map());
                }));
            }
          }),
          (r.shimReceiverGetStats = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection &&
              e.RTCRtpSender &&
              (!e.RTCRtpSender || !("getStats" in e.RTCRtpReceiver.prototype))
            ) {
              var t = e.RTCPeerConnection.prototype.getReceivers;
              (t &&
                (e.RTCPeerConnection.prototype.getReceivers = function () {
                  var e = this,
                    r = t.apply(this, []);
                  return (
                    r.forEach(function (t) {
                      return (t._pc = e);
                    }),
                    r
                  );
                }),
                a.wrapPeerConnectionEvent(e, "track", function (e) {
                  return ((e.receiver._pc = e.srcElement), e);
                }),
                (e.RTCRtpReceiver.prototype.getStats = function () {
                  return this._pc.getStats(this.track);
                }));
            }
          }),
          (r.shimRemoveStream = function (e) {
            e.RTCPeerConnection &&
              !("removeStream" in e.RTCPeerConnection.prototype) &&
              (e.RTCPeerConnection.prototype.removeStream = function (e) {
                var t = this;
                (a.deprecated("removeStream", "removeTrack"),
                  this.getSenders().forEach(function (r) {
                    r.track &&
                      e.getTracks().includes(r.track) &&
                      t.removeTrack(r);
                  }));
              });
          }),
          (r.shimRTCDataChannel = function (e) {
            e.DataChannel &&
              !e.RTCDataChannel &&
              (e.RTCDataChannel = e.DataChannel);
          }),
          (r.shimAddTransceiver = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection
            ) {
              var t = e.RTCPeerConnection.prototype.addTransceiver;
              t &&
                (e.RTCPeerConnection.prototype.addTransceiver = function () {
                  this.setParametersPromises = [];
                  var e = arguments[1],
                    r = e && "sendEncodings" in e;
                  r &&
                    e.sendEncodings.forEach(function (e) {
                      if ("rid" in e && !/^[a-z0-9]{0,16}$/i.test(e.rid))
                        throw new TypeError("Invalid RID value provided.");
                      if (
                        "scaleResolutionDownBy" in e &&
                        !(parseFloat(e.scaleResolutionDownBy) >= 1)
                      )
                        throw new RangeError(
                          "scale_resolution_down_by must be >= 1.0",
                        );
                      if (
                        "maxFramerate" in e &&
                        !(parseFloat(e.maxFramerate) >= 0)
                      )
                        throw new RangeError("max_framerate must be >= 0.0");
                    });
                  var i = t.apply(this, arguments);
                  if (r) {
                    var n = i.sender,
                      o = n.getParameters();
                    "encodings" in o ||
                      ((o.encodings = e.sendEncodings),
                      this.setParametersPromises.push(
                        n.setParameters(o).catch(function () {}),
                      ));
                  }
                  return i;
                });
            }
          }),
          (r.shimCreateOffer = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection
            ) {
              var t = e.RTCPeerConnection.prototype.createOffer;
              e.RTCPeerConnection.prototype.createOffer = function () {
                var e = this,
                  r = arguments;
                return this.setParametersPromises &&
                  this.setParametersPromises.length
                  ? Promise.all(this.setParametersPromises)
                      .then(function () {
                        return t.apply(e, r);
                      })
                      .finally(function () {
                        e.setParametersPromises = [];
                      })
                  : t.apply(this, arguments);
              };
            }
          }),
          (r.shimCreateAnswer = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection
            ) {
              var t = e.RTCPeerConnection.prototype.createAnswer;
              e.RTCPeerConnection.prototype.createAnswer = function () {
                var e = this,
                  r = arguments;
                return this.setParametersPromises &&
                  this.setParametersPromises.length
                  ? Promise.all(this.setParametersPromises)
                      .then(function () {
                        return t.apply(e, r);
                      })
                      .finally(function () {
                        e.setParametersPromises = [];
                      })
                  : t.apply(this, arguments);
              };
            }
          }));
        var a = (function (e) {
          if (e && e.__esModule) return e;
          var t = {};
          if (null != e)
            for (var r in e)
              Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
          return ((t.default = e), t);
        })(e("../utils"));
      },
      { "../utils": 15, "./getdisplaymedia": 12, "./getusermedia": 13 },
    ],
    12: [
      function (e, t, r) {
        (Object.defineProperty(r, "__esModule", { value: !0 }),
          (r.shimGetDisplayMedia = function (e, t) {
            (e.navigator.mediaDevices &&
              "getDisplayMedia" in e.navigator.mediaDevices) ||
              (e.navigator.mediaDevices &&
                (e.navigator.mediaDevices.getDisplayMedia = function (r) {
                  if (!r || !r.video) {
                    var i = new DOMException(
                      "getDisplayMedia without video constraints is undefined",
                    );
                    return (
                      (i.name = "NotFoundError"),
                      (i.code = 8),
                      Promise.reject(i)
                    );
                  }
                  return (
                    !0 === r.video
                      ? (r.video = { mediaSource: t })
                      : (r.video.mediaSource = t),
                    e.navigator.mediaDevices.getUserMedia(r)
                  );
                }));
          }));
      },
      {},
    ],
    13: [
      function (e, t, r) {
        Object.defineProperty(r, "__esModule", { value: !0 });
        var i =
          "function" == typeof Symbol && "symbol" == h(Symbol.iterator)
            ? function (e) {
                return h(e);
              }
            : function (e) {
                return e &&
                  "function" == typeof Symbol &&
                  e.constructor === Symbol &&
                  e !== Symbol.prototype
                  ? "symbol"
                  : h(e);
              };
        r.shimGetUserMedia = function (e) {
          var t = n.detectBrowser(e),
            r = e && e.navigator,
            o = e && e.MediaStreamTrack;
          if (
            ((r.getUserMedia = function (e, t, i) {
              (n.deprecated(
                "navigator.getUserMedia",
                "navigator.mediaDevices.getUserMedia",
              ),
                r.mediaDevices.getUserMedia(e).then(t, i));
            }),
            !(
              t.version > 55 &&
              "autoGainControl" in r.mediaDevices.getSupportedConstraints()
            ))
          ) {
            var a = function (e, t, r) {
                t in e && !(r in e) && ((e[r] = e[t]), delete e[t]);
              },
              s = r.mediaDevices.getUserMedia.bind(r.mediaDevices);
            if (
              ((r.mediaDevices.getUserMedia = function (e) {
                return (
                  "object" === (void 0 === e ? "undefined" : i(e)) &&
                    "object" === i(e.audio) &&
                    ((e = JSON.parse(JSON.stringify(e))),
                    a(e.audio, "autoGainControl", "mozAutoGainControl"),
                    a(e.audio, "noiseSuppression", "mozNoiseSuppression")),
                  s(e)
                );
              }),
              o && o.prototype.getSettings)
            ) {
              var c = o.prototype.getSettings;
              o.prototype.getSettings = function () {
                var e = c.apply(this, arguments);
                return (
                  a(e, "mozAutoGainControl", "autoGainControl"),
                  a(e, "mozNoiseSuppression", "noiseSuppression"),
                  e
                );
              };
            }
            if (o && o.prototype.applyConstraints) {
              var u = o.prototype.applyConstraints;
              o.prototype.applyConstraints = function (e) {
                return (
                  "audio" === this.kind &&
                    "object" === (void 0 === e ? "undefined" : i(e)) &&
                    ((e = JSON.parse(JSON.stringify(e))),
                    a(e, "autoGainControl", "mozAutoGainControl"),
                    a(e, "noiseSuppression", "mozNoiseSuppression")),
                  u.apply(this, [e])
                );
              };
            }
          }
        };
        var n = (function (e) {
          if (e && e.__esModule) return e;
          var t = {};
          if (null != e)
            for (var r in e)
              Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
          return ((t.default = e), t);
        })(e("../utils"));
      },
      { "../utils": 15 },
    ],
    14: [
      function (e, t, r) {
        Object.defineProperty(r, "__esModule", { value: !0 });
        var i =
          "function" == typeof Symbol && "symbol" == h(Symbol.iterator)
            ? function (e) {
                return h(e);
              }
            : function (e) {
                return e &&
                  "function" == typeof Symbol &&
                  e.constructor === Symbol &&
                  e !== Symbol.prototype
                  ? "symbol"
                  : h(e);
              };
        ((r.shimLocalStreamsAPI = function (e) {
          if (
            "object" === (void 0 === e ? "undefined" : i(e)) &&
            e.RTCPeerConnection
          ) {
            if (
              ("getLocalStreams" in e.RTCPeerConnection.prototype ||
                (e.RTCPeerConnection.prototype.getLocalStreams = function () {
                  return (
                    this._localStreams || (this._localStreams = []),
                    this._localStreams
                  );
                }),
              !("addStream" in e.RTCPeerConnection.prototype))
            ) {
              var t = e.RTCPeerConnection.prototype.addTrack;
              ((e.RTCPeerConnection.prototype.addStream = function (e) {
                var r = this;
                (this._localStreams || (this._localStreams = []),
                  this._localStreams.includes(e) || this._localStreams.push(e),
                  e.getAudioTracks().forEach(function (i) {
                    return t.call(r, i, e);
                  }),
                  e.getVideoTracks().forEach(function (i) {
                    return t.call(r, i, e);
                  }));
              }),
                (e.RTCPeerConnection.prototype.addTrack = function (e) {
                  var r = arguments[1];
                  return (
                    r &&
                      (this._localStreams
                        ? this._localStreams.includes(r) ||
                          this._localStreams.push(r)
                        : (this._localStreams = [r])),
                    t.apply(this, arguments)
                  );
                }));
            }
            "removeStream" in e.RTCPeerConnection.prototype ||
              (e.RTCPeerConnection.prototype.removeStream = function (e) {
                var t = this;
                this._localStreams || (this._localStreams = []);
                var r = this._localStreams.indexOf(e);
                if (-1 !== r) {
                  this._localStreams.splice(r, 1);
                  var i = e.getTracks();
                  this.getSenders().forEach(function (e) {
                    i.includes(e.track) && t.removeTrack(e);
                  });
                }
              });
          }
        }),
          (r.shimRemoteStreamsAPI = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection &&
              ("getRemoteStreams" in e.RTCPeerConnection.prototype ||
                (e.RTCPeerConnection.prototype.getRemoteStreams = function () {
                  return this._remoteStreams ? this._remoteStreams : [];
                }),
              !("onaddstream" in e.RTCPeerConnection.prototype))
            ) {
              Object.defineProperty(
                e.RTCPeerConnection.prototype,
                "onaddstream",
                {
                  get: function () {
                    return this._onaddstream;
                  },
                  set: function (e) {
                    var t = this;
                    (this._onaddstream &&
                      (this.removeEventListener("addstream", this._onaddstream),
                      this.removeEventListener("track", this._onaddstreampoly)),
                      this.addEventListener(
                        "addstream",
                        (this._onaddstream = e),
                      ),
                      this.addEventListener(
                        "track",
                        (this._onaddstreampoly = function (e) {
                          e.streams.forEach(function (e) {
                            if (
                              (t._remoteStreams || (t._remoteStreams = []),
                              !t._remoteStreams.includes(e))
                            ) {
                              t._remoteStreams.push(e);
                              var r = new Event("addstream");
                              ((r.stream = e), t.dispatchEvent(r));
                            }
                          });
                        }),
                      ));
                  },
                },
              );
              var t = e.RTCPeerConnection.prototype.setRemoteDescription;
              e.RTCPeerConnection.prototype.setRemoteDescription = function () {
                var e = this;
                return (
                  this._onaddstreampoly ||
                    this.addEventListener(
                      "track",
                      (this._onaddstreampoly = function (t) {
                        t.streams.forEach(function (t) {
                          if (
                            (e._remoteStreams || (e._remoteStreams = []),
                            !(e._remoteStreams.indexOf(t) >= 0))
                          ) {
                            e._remoteStreams.push(t);
                            var r = new Event("addstream");
                            ((r.stream = t), e.dispatchEvent(r));
                          }
                        });
                      }),
                    ),
                  t.apply(e, arguments)
                );
              };
            }
          }),
          (r.shimCallbacksAPI = function (e) {
            if (
              "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCPeerConnection
            ) {
              var t = e.RTCPeerConnection.prototype,
                r = t.createOffer,
                n = t.createAnswer,
                o = t.setLocalDescription,
                a = t.setRemoteDescription,
                s = t.addIceCandidate;
              ((t.createOffer = function (e, t) {
                var i = arguments.length >= 2 ? arguments[2] : arguments[0],
                  n = r.apply(this, [i]);
                return t ? (n.then(e, t), Promise.resolve()) : n;
              }),
                (t.createAnswer = function (e, t) {
                  var r = arguments.length >= 2 ? arguments[2] : arguments[0],
                    i = n.apply(this, [r]);
                  return t ? (i.then(e, t), Promise.resolve()) : i;
                }));
              var c = function (e, t, r) {
                var i = o.apply(this, [e]);
                return r ? (i.then(t, r), Promise.resolve()) : i;
              };
              ((t.setLocalDescription = c),
                (c = function (e, t, r) {
                  var i = a.apply(this, [e]);
                  return r ? (i.then(t, r), Promise.resolve()) : i;
                }),
                (t.setRemoteDescription = c),
                (c = function (e, t, r) {
                  var i = s.apply(this, [e]);
                  return r ? (i.then(t, r), Promise.resolve()) : i;
                }),
                (t.addIceCandidate = c));
            }
          }),
          (r.shimGetUserMedia = function (e) {
            var t = e && e.navigator;
            if (t.mediaDevices && t.mediaDevices.getUserMedia) {
              var r = t.mediaDevices,
                i = r.getUserMedia.bind(r);
              t.mediaDevices.getUserMedia = function (e) {
                return i(o(e));
              };
            }
            !t.getUserMedia &&
              t.mediaDevices &&
              t.mediaDevices.getUserMedia &&
              (t.getUserMedia = function (e, r, i) {
                t.mediaDevices.getUserMedia(e).then(r, i);
              }.bind(t));
          }),
          (r.shimConstraints = o),
          (r.shimRTCIceServerUrls = function (e) {
            var t = e.RTCPeerConnection;
            ((e.RTCPeerConnection = function (e, r) {
              if (e && e.iceServers) {
                for (var i = [], o = 0; o < e.iceServers.length; o++) {
                  var a = e.iceServers[o];
                  !a.hasOwnProperty("urls") && a.hasOwnProperty("url")
                    ? (n.deprecated("RTCIceServer.url", "RTCIceServer.urls"),
                      ((a = JSON.parse(JSON.stringify(a))).urls = a.url),
                      delete a.url,
                      i.push(a))
                    : i.push(e.iceServers[o]);
                }
                e.iceServers = i;
              }
              return new t(e, r);
            }),
              (e.RTCPeerConnection.prototype = t.prototype),
              "generateCertificate" in e.RTCPeerConnection &&
                Object.defineProperty(
                  e.RTCPeerConnection,
                  "generateCertificate",
                  {
                    get: function () {
                      return t.generateCertificate;
                    },
                  },
                ));
          }),
          (r.shimTrackEventTransceiver = function (e) {
            "object" === (void 0 === e ? "undefined" : i(e)) &&
              e.RTCTrackEvent &&
              "receiver" in e.RTCTrackEvent.prototype &&
              !("transceiver" in e.RTCTrackEvent.prototype) &&
              Object.defineProperty(e.RTCTrackEvent.prototype, "transceiver", {
                get: function () {
                  return { receiver: this.receiver };
                },
              });
          }),
          (r.shimCreateOfferLegacy = function (e) {
            var t = e.RTCPeerConnection.prototype.createOffer;
            e.RTCPeerConnection.prototype.createOffer = function (e) {
              if (e) {
                void 0 !== e.offerToReceiveAudio &&
                  (e.offerToReceiveAudio = !!e.offerToReceiveAudio);
                var r = this.getTransceivers().find(function (e) {
                  return "audio" === e.receiver.track.kind;
                });
                (!1 === e.offerToReceiveAudio && r
                  ? "sendrecv" === r.direction
                    ? r.setDirection
                      ? r.setDirection("sendonly")
                      : (r.direction = "sendonly")
                    : "recvonly" === r.direction &&
                      (r.setDirection
                        ? r.setDirection("inactive")
                        : (r.direction = "inactive"))
                  : !0 !== e.offerToReceiveAudio ||
                    r ||
                    this.addTransceiver("audio"),
                  void 0 !== e.offerToReceiveVideo &&
                    (e.offerToReceiveVideo = !!e.offerToReceiveVideo));
                var i = this.getTransceivers().find(function (e) {
                  return "video" === e.receiver.track.kind;
                });
                !1 === e.offerToReceiveVideo && i
                  ? "sendrecv" === i.direction
                    ? i.setDirection
                      ? i.setDirection("sendonly")
                      : (i.direction = "sendonly")
                    : "recvonly" === i.direction &&
                      (i.setDirection
                        ? i.setDirection("inactive")
                        : (i.direction = "inactive"))
                  : !0 !== e.offerToReceiveVideo ||
                    i ||
                    this.addTransceiver("video");
              }
              return t.apply(this, arguments);
            };
          }));
        var n = (function (e) {
          if (e && e.__esModule) return e;
          var t = {};
          if (null != e)
            for (var r in e)
              Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
          return ((t.default = e), t);
        })(e("../utils"));
        function o(e) {
          return e && void 0 !== e.video
            ? Object.assign({}, e, { video: n.compactObject(e.video) })
            : e;
        }
      },
      { "../utils": 15 },
    ],
    15: [
      function (e, t, r) {
        Object.defineProperty(r, "__esModule", { value: !0 });
        var i =
          "function" == typeof Symbol && "symbol" == h(Symbol.iterator)
            ? function (e) {
                return h(e);
              }
            : function (e) {
                return e &&
                  "function" == typeof Symbol &&
                  e.constructor === Symbol &&
                  e !== Symbol.prototype
                  ? "symbol"
                  : h(e);
              };
        ((r.extractVersion = a),
          (r.wrapPeerConnectionEvent = function (e, t, r) {
            if (e.RTCPeerConnection) {
              var i = e.RTCPeerConnection.prototype,
                n = i.addEventListener;
              i.addEventListener = function (e, i) {
                if (e !== t) return n.apply(this, arguments);
                var o = function (e) {
                  var t = r(e);
                  t && i(t);
                };
                return (
                  (this._eventMap = this._eventMap || {}),
                  (this._eventMap[i] = o),
                  n.apply(this, [e, o])
                );
              };
              var o = i.removeEventListener;
              ((i.removeEventListener = function (e, r) {
                if (e !== t || !this._eventMap || !this._eventMap[r])
                  return o.apply(this, arguments);
                var i = this._eventMap[r];
                return (delete this._eventMap[r], o.apply(this, [e, i]));
              }),
                Object.defineProperty(i, "on" + t, {
                  get: function () {
                    return this["_on" + t];
                  },
                  set: function (e) {
                    (this["_on" + t] &&
                      (this.removeEventListener(t, this["_on" + t]),
                      delete this["_on" + t]),
                      e && this.addEventListener(t, (this["_on" + t] = e)));
                  },
                  enumerable: !0,
                  configurable: !0,
                }));
            }
          }),
          (r.disableLog = function (e) {
            return "boolean" != typeof e
              ? new Error(
                  "Argument type: " +
                    (void 0 === e ? "undefined" : i(e)) +
                    ". Please use a boolean.",
                )
              : ((n = e),
                e
                  ? "adapter.js logging disabled"
                  : "adapter.js logging enabled");
          }),
          (r.disableWarnings = function (e) {
            return "boolean" != typeof e
              ? new Error(
                  "Argument type: " +
                    (void 0 === e ? "undefined" : i(e)) +
                    ". Please use a boolean.",
                )
              : ((o = !e),
                "adapter.js deprecation warnings " +
                  (e ? "disabled" : "enabled"));
          }),
          (r.log = function () {
            if (
              "object" ===
              ("undefined" == typeof window ? "undefined" : i(window))
            ) {
              if (n) return;
              "undefined" != typeof console &&
                "function" == typeof console.log &&
                console.log.apply(console, arguments);
            }
          }),
          (r.deprecated = function (e, t) {
            o &&
              console.warn(e + " is deprecated, please use " + t + " instead.");
          }),
          (r.detectBrowser = function (e) {
            var t = e.navigator,
              r = { browser: null, version: null };
            if (void 0 === e || !e.navigator)
              return ((r.browser = "Not a browser."), r);
            if (t.mozGetUserMedia)
              ((r.browser = "firefox"),
                (r.version = a(t.userAgent, /Firefox\/(\d+)\./, 1)));
            else if (
              t.webkitGetUserMedia ||
              (!1 === e.isSecureContext &&
                e.webkitRTCPeerConnection &&
                !e.RTCIceGatherer)
            )
              ((r.browser = "chrome"),
                (r.version = a(t.userAgent, /Chrom(e|ium)\/(\d+)\./, 2)));
            else if (t.mediaDevices && t.userAgent.match(/Edge\/(\d+).(\d+)$/))
              ((r.browser = "edge"),
                (r.version = a(t.userAgent, /Edge\/(\d+).(\d+)$/, 2)));
            else {
              if (
                !e.RTCPeerConnection ||
                !t.userAgent.match(/AppleWebKit\/(\d+)\./)
              )
                return ((r.browser = "Not a supported browser."), r);
              ((r.browser = "safari"),
                (r.version = a(t.userAgent, /AppleWebKit\/(\d+)\./, 1)),
                (r.supportsUnifiedPlan =
                  e.RTCRtpTransceiver &&
                  "currentDirection" in e.RTCRtpTransceiver.prototype));
            }
            return r;
          }),
          (r.compactObject = function e(t) {
            return s(t)
              ? Object.keys(t).reduce(function (r, i) {
                  var n = s(t[i]),
                    o = n ? e(t[i]) : t[i],
                    a = n && !Object.keys(o).length;
                  return void 0 === o || a
                    ? r
                    : Object.assign(
                        r,
                        (function (e, t, r) {
                          return (
                            t in e
                              ? Object.defineProperty(e, t, {
                                  value: r,
                                  enumerable: !0,
                                  configurable: !0,
                                  writable: !0,
                                })
                              : (e[t] = r),
                            e
                          );
                        })({}, i, o),
                      );
                }, {})
              : t;
          }),
          (r.walkStats = c),
          (r.filterStats = function (e, t, r) {
            var i = r ? "outbound-rtp" : "inbound-rtp",
              n = new Map();
            if (null === t) return n;
            var o = [];
            return (
              e.forEach(function (e) {
                "track" === e.type && e.trackIdentifier === t.id && o.push(e);
              }),
              o.forEach(function (t) {
                e.forEach(function (r) {
                  r.type === i && r.trackId === t.id && c(e, r, n);
                });
              }),
              n
            );
          }));
        var n = !0,
          o = !0;
        function a(e, t, r) {
          var i = e.match(t);
          return i && i.length >= r && parseInt(i[r], 10);
        }
        function s(e) {
          return "[object Object]" === Object.prototype.toString.call(e);
        }
        function c(e, t, r) {
          t &&
            !r.has(t.id) &&
            (r.set(t.id, t),
            Object.keys(t).forEach(function (i) {
              i.endsWith("Id")
                ? c(e, e.get(t[i]), r)
                : i.endsWith("Ids") &&
                  t[i].forEach(function (t) {
                    c(e, e.get(t), r);
                  });
            }));
        }
      },
      {},
    ],
    16: [
      function (e, t, r) {
        var i = e("sdp");
        function n(e, t, r, n, o) {
          var a = i.writeRtpDescription(e.kind, t);
          if (
            ((a += i.writeIceParameters(e.iceGatherer.getLocalParameters())),
            (a += i.writeDtlsParameters(
              e.dtlsTransport.getLocalParameters(),
              "offer" === r ? "actpass" : o || "active",
            )),
            (a += "a=mid:" + e.mid + "\r\n"),
            e.rtpSender && e.rtpReceiver
              ? (a += "a=sendrecv\r\n")
              : e.rtpSender
                ? (a += "a=sendonly\r\n")
                : e.rtpReceiver
                  ? (a += "a=recvonly\r\n")
                  : (a += "a=inactive\r\n"),
            e.rtpSender)
          ) {
            var s = e.rtpSender._initialTrackId || e.rtpSender.track.id;
            e.rtpSender._initialTrackId = s;
            var c = "msid:" + (n ? n.id : "-") + " " + s + "\r\n";
            ((a += "a=" + c),
              (a += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " " + c),
              e.sendEncodingParameters[0].rtx &&
                ((a +=
                  "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " " + c),
                (a +=
                  "a=ssrc-group:FID " +
                  e.sendEncodingParameters[0].ssrc +
                  " " +
                  e.sendEncodingParameters[0].rtx.ssrc +
                  "\r\n")));
          }
          return (
            (a +=
              "a=ssrc:" +
              e.sendEncodingParameters[0].ssrc +
              " cname:" +
              i.localCName +
              "\r\n"),
            e.rtpSender &&
              e.sendEncodingParameters[0].rtx &&
              (a +=
                "a=ssrc:" +
                e.sendEncodingParameters[0].rtx.ssrc +
                " cname:" +
                i.localCName +
                "\r\n"),
            a
          );
        }
        function o(e, t) {
          var r = { codecs: [], headerExtensions: [], fecMechanisms: [] },
            i = function (e, t) {
              e = parseInt(e, 10);
              for (var r = 0; r < t.length; r++)
                if (t[r].payloadType === e || t[r].preferredPayloadType === e)
                  return t[r];
            },
            n = function (e, t, r, n) {
              var o = i(e.parameters.apt, r),
                a = i(t.parameters.apt, n);
              return o && a && o.name.toLowerCase() === a.name.toLowerCase();
            };
          return (
            e.codecs.forEach(function (i) {
              for (var o = 0; o < t.codecs.length; o++) {
                var a = t.codecs[o];
                if (
                  i.name.toLowerCase() === a.name.toLowerCase() &&
                  i.clockRate === a.clockRate
                ) {
                  if (
                    "rtx" === i.name.toLowerCase() &&
                    i.parameters &&
                    a.parameters.apt &&
                    !n(i, a, e.codecs, t.codecs)
                  )
                    continue;
                  (((a = JSON.parse(JSON.stringify(a))).numChannels = Math.min(
                    i.numChannels,
                    a.numChannels,
                  )),
                    r.codecs.push(a),
                    (a.rtcpFeedback = a.rtcpFeedback.filter(function (e) {
                      for (var t = 0; t < i.rtcpFeedback.length; t++)
                        if (
                          i.rtcpFeedback[t].type === e.type &&
                          i.rtcpFeedback[t].parameter === e.parameter
                        )
                          return !0;
                      return !1;
                    })));
                  break;
                }
              }
            }),
            e.headerExtensions.forEach(function (e) {
              for (var i = 0; i < t.headerExtensions.length; i++) {
                var n = t.headerExtensions[i];
                if (e.uri === n.uri) {
                  r.headerExtensions.push(n);
                  break;
                }
              }
            }),
            r
          );
        }
        function a(e, t, r) {
          return (
            -1 !==
            {
              offer: {
                setLocalDescription: ["stable", "have-local-offer"],
                setRemoteDescription: ["stable", "have-remote-offer"],
              },
              answer: {
                setLocalDescription: [
                  "have-remote-offer",
                  "have-local-pranswer",
                ],
                setRemoteDescription: [
                  "have-local-offer",
                  "have-remote-pranswer",
                ],
              },
            }[t][e].indexOf(r)
          );
        }
        function s(e, t) {
          var r = e.getRemoteCandidates().find(function (e) {
            return (
              t.foundation === e.foundation &&
              t.ip === e.ip &&
              t.port === e.port &&
              t.priority === e.priority &&
              t.protocol === e.protocol &&
              t.type === e.type
            );
          });
          return (r || e.addRemoteCandidate(t), !r);
        }
        function c(e, t) {
          var r = new Error(t);
          return (
            (r.name = e),
            (r.code = {
              NotSupportedError: 9,
              InvalidStateError: 11,
              InvalidAccessError: 15,
              TypeError: void 0,
              OperationError: void 0,
            }[e]),
            r
          );
        }
        t.exports = function (e, t) {
          function r(t, r) {
            (r.addTrack(t),
              r.dispatchEvent(
                new e.MediaStreamTrackEvent("addtrack", { track: t }),
              ));
          }
          function u(t, r, i, n) {
            var o = new Event("track");
            ((o.track = r),
              (o.receiver = i),
              (o.transceiver = { receiver: i }),
              (o.streams = n),
              e.setTimeout(function () {
                t._dispatchEvent("track", o);
              }));
          }
          var d = function (r) {
            var n = this,
              o = document.createDocumentFragment();
            if (
              ([
                "addEventListener",
                "removeEventListener",
                "dispatchEvent",
              ].forEach(function (e) {
                n[e] = o[e].bind(o);
              }),
              (this.canTrickleIceCandidates = null),
              (this.needNegotiation = !1),
              (this.localStreams = []),
              (this.remoteStreams = []),
              (this._localDescription = null),
              (this._remoteDescription = null),
              (this.signalingState = "stable"),
              (this.iceConnectionState = "new"),
              (this.connectionState = "new"),
              (this.iceGatheringState = "new"),
              (r = JSON.parse(JSON.stringify(r || {}))),
              (this.usingBundle = "max-bundle" === r.bundlePolicy),
              "negotiate" === r.rtcpMuxPolicy)
            )
              throw c(
                "NotSupportedError",
                "rtcpMuxPolicy 'negotiate' is not supported",
              );
            switch (
              (r.rtcpMuxPolicy || (r.rtcpMuxPolicy = "require"),
              r.iceTransportPolicy)
            ) {
              case "all":
              case "relay":
                break;
              default:
                r.iceTransportPolicy = "all";
            }
            switch (r.bundlePolicy) {
              case "balanced":
              case "max-compat":
              case "max-bundle":
                break;
              default:
                r.bundlePolicy = "balanced";
            }
            if (
              ((r.iceServers = (function (e, t) {
                var r = !1;
                return (e = JSON.parse(JSON.stringify(e))).filter(function (e) {
                  if (e && (e.urls || e.url)) {
                    var i = e.urls || e.url;
                    e.url &&
                      !e.urls &&
                      console.warn(
                        "RTCIceServer.url is deprecated! Use urls instead.",
                      );
                    var n = "string" == typeof i;
                    return (
                      n && (i = [i]),
                      (i = i.filter(function (e) {
                        return 0 !== e.indexOf("turn:") ||
                          -1 === e.indexOf("transport=udp") ||
                          -1 !== e.indexOf("turn:[") ||
                          r
                          ? 0 === e.indexOf("stun:") &&
                              t >= 14393 &&
                              -1 === e.indexOf("?transport=udp")
                          : ((r = !0), !0);
                      })),
                      delete e.url,
                      (e.urls = n ? i[0] : i),
                      !!i.length
                    );
                  }
                });
              })(r.iceServers || [], t)),
              (this._iceGatherers = []),
              r.iceCandidatePoolSize)
            )
              for (var a = r.iceCandidatePoolSize; a > 0; a--)
                this._iceGatherers.push(
                  new e.RTCIceGatherer({
                    iceServers: r.iceServers,
                    gatherPolicy: r.iceTransportPolicy,
                  }),
                );
            else r.iceCandidatePoolSize = 0;
            ((this._config = r),
              (this.transceivers = []),
              (this._sdpSessionId = i.generateSessionId()),
              (this._sdpSessionVersion = 0),
              (this._dtlsRole = void 0),
              (this._isClosed = !1));
          };
          (Object.defineProperty(d.prototype, "localDescription", {
            configurable: !0,
            get: function () {
              return this._localDescription;
            },
          }),
            Object.defineProperty(d.prototype, "remoteDescription", {
              configurable: !0,
              get: function () {
                return this._remoteDescription;
              },
            }),
            (d.prototype.onicecandidate = null),
            (d.prototype.onaddstream = null),
            (d.prototype.ontrack = null),
            (d.prototype.onremovestream = null),
            (d.prototype.onsignalingstatechange = null),
            (d.prototype.oniceconnectionstatechange = null),
            (d.prototype.onconnectionstatechange = null),
            (d.prototype.onicegatheringstatechange = null),
            (d.prototype.onnegotiationneeded = null),
            (d.prototype.ondatachannel = null),
            (d.prototype._dispatchEvent = function (e, t) {
              this._isClosed ||
                (this.dispatchEvent(t),
                "function" == typeof this["on" + e] && this["on" + e](t));
            }),
            (d.prototype._emitGatheringStateChange = function () {
              var e = new Event("icegatheringstatechange");
              this._dispatchEvent("icegatheringstatechange", e);
            }),
            (d.prototype.getConfiguration = function () {
              return this._config;
            }),
            (d.prototype.getLocalStreams = function () {
              return this.localStreams;
            }),
            (d.prototype.getRemoteStreams = function () {
              return this.remoteStreams;
            }),
            (d.prototype._createTransceiver = function (e, t) {
              var r = this.transceivers.length > 0,
                i = {
                  track: null,
                  iceGatherer: null,
                  iceTransport: null,
                  dtlsTransport: null,
                  localCapabilities: null,
                  remoteCapabilities: null,
                  rtpSender: null,
                  rtpReceiver: null,
                  kind: e,
                  mid: null,
                  sendEncodingParameters: null,
                  recvEncodingParameters: null,
                  stream: null,
                  associatedRemoteMediaStreams: [],
                  wantReceive: !0,
                };
              if (this.usingBundle && r)
                ((i.iceTransport = this.transceivers[0].iceTransport),
                  (i.dtlsTransport = this.transceivers[0].dtlsTransport));
              else {
                var n = this._createIceAndDtlsTransports();
                ((i.iceTransport = n.iceTransport),
                  (i.dtlsTransport = n.dtlsTransport));
              }
              return (t || this.transceivers.push(i), i);
            }),
            (d.prototype.addTrack = function (t, r) {
              if (this._isClosed)
                throw c(
                  "InvalidStateError",
                  "Attempted to call addTrack on a closed peerconnection.",
                );
              var i;
              if (
                this.transceivers.find(function (e) {
                  return e.track === t;
                })
              )
                throw c("InvalidAccessError", "Track already exists.");
              for (var n = 0; n < this.transceivers.length; n++)
                this.transceivers[n].track ||
                  this.transceivers[n].kind !== t.kind ||
                  (i = this.transceivers[n]);
              return (
                i || (i = this._createTransceiver(t.kind)),
                this._maybeFireNegotiationNeeded(),
                -1 === this.localStreams.indexOf(r) &&
                  this.localStreams.push(r),
                (i.track = t),
                (i.stream = r),
                (i.rtpSender = new e.RTCRtpSender(t, i.dtlsTransport)),
                i.rtpSender
              );
            }),
            (d.prototype.addStream = function (e) {
              var r = this;
              if (t >= 15025)
                e.getTracks().forEach(function (t) {
                  r.addTrack(t, e);
                });
              else {
                var i = e.clone();
                (e.getTracks().forEach(function (e, t) {
                  var r = i.getTracks()[t];
                  e.addEventListener("enabled", function (e) {
                    r.enabled = e.enabled;
                  });
                }),
                  i.getTracks().forEach(function (e) {
                    r.addTrack(e, i);
                  }));
              }
            }),
            (d.prototype.removeTrack = function (t) {
              if (this._isClosed)
                throw c(
                  "InvalidStateError",
                  "Attempted to call removeTrack on a closed peerconnection.",
                );
              if (!(t instanceof e.RTCRtpSender))
                throw new TypeError(
                  "Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.",
                );
              var r = this.transceivers.find(function (e) {
                return e.rtpSender === t;
              });
              if (!r)
                throw c(
                  "InvalidAccessError",
                  "Sender was not created by this connection.",
                );
              var i = r.stream;
              (r.rtpSender.stop(),
                (r.rtpSender = null),
                (r.track = null),
                (r.stream = null),
                -1 ===
                  this.transceivers
                    .map(function (e) {
                      return e.stream;
                    })
                    .indexOf(i) &&
                  this.localStreams.indexOf(i) > -1 &&
                  this.localStreams.splice(this.localStreams.indexOf(i), 1),
                this._maybeFireNegotiationNeeded());
            }),
            (d.prototype.removeStream = function (e) {
              var t = this;
              e.getTracks().forEach(function (e) {
                var r = t.getSenders().find(function (t) {
                  return t.track === e;
                });
                r && t.removeTrack(r);
              });
            }),
            (d.prototype.getSenders = function () {
              return this.transceivers
                .filter(function (e) {
                  return !!e.rtpSender;
                })
                .map(function (e) {
                  return e.rtpSender;
                });
            }),
            (d.prototype.getReceivers = function () {
              return this.transceivers
                .filter(function (e) {
                  return !!e.rtpReceiver;
                })
                .map(function (e) {
                  return e.rtpReceiver;
                });
            }),
            (d.prototype._createIceGatherer = function (t, r) {
              var i = this;
              if (r && t > 0) return this.transceivers[0].iceGatherer;
              if (this._iceGatherers.length) return this._iceGatherers.shift();
              var n = new e.RTCIceGatherer({
                iceServers: this._config.iceServers,
                gatherPolicy: this._config.iceTransportPolicy,
              });
              return (
                Object.defineProperty(n, "state", {
                  value: "new",
                  writable: !0,
                }),
                (this.transceivers[t].bufferedCandidateEvents = []),
                (this.transceivers[t].bufferCandidates = function (e) {
                  var r = !e.candidate || 0 === Object.keys(e.candidate).length;
                  ((n.state = r ? "completed" : "gathering"),
                    null !== i.transceivers[t].bufferedCandidateEvents &&
                      i.transceivers[t].bufferedCandidateEvents.push(e));
                }),
                n.addEventListener(
                  "localcandidate",
                  this.transceivers[t].bufferCandidates,
                ),
                n
              );
            }),
            (d.prototype._gather = function (t, r) {
              var n = this,
                o = this.transceivers[r].iceGatherer;
              if (!o.onlocalcandidate) {
                var a = this.transceivers[r].bufferedCandidateEvents;
                ((this.transceivers[r].bufferedCandidateEvents = null),
                  o.removeEventListener(
                    "localcandidate",
                    this.transceivers[r].bufferCandidates,
                  ),
                  (o.onlocalcandidate = function (e) {
                    if (!(n.usingBundle && r > 0)) {
                      var a = new Event("icecandidate");
                      a.candidate = { sdpMid: t, sdpMLineIndex: r };
                      var s = e.candidate,
                        c = !s || 0 === Object.keys(s).length;
                      if (c)
                        ("new" !== o.state && "gathering" !== o.state) ||
                          (o.state = "completed");
                      else {
                        ("new" === o.state && (o.state = "gathering"),
                          (s.component = 1),
                          (s.ufrag = o.getLocalParameters().usernameFragment));
                        var u = i.writeCandidate(s);
                        ((a.candidate = Object.assign(
                          a.candidate,
                          i.parseCandidate(u),
                        )),
                          (a.candidate.candidate = u),
                          (a.candidate.toJSON = function () {
                            return {
                              candidate: a.candidate.candidate,
                              sdpMid: a.candidate.sdpMid,
                              sdpMLineIndex: a.candidate.sdpMLineIndex,
                              usernameFragment: a.candidate.usernameFragment,
                            };
                          }));
                      }
                      var d = i.getMediaSections(n._localDescription.sdp);
                      ((d[a.candidate.sdpMLineIndex] += c
                        ? "a=end-of-candidates\r\n"
                        : "a=" + a.candidate.candidate + "\r\n"),
                        (n._localDescription.sdp =
                          i.getDescription(n._localDescription.sdp) +
                          d.join("")));
                      var l = n.transceivers.every(function (e) {
                        return (
                          e.iceGatherer && "completed" === e.iceGatherer.state
                        );
                      });
                      ("gathering" !== n.iceGatheringState &&
                        ((n.iceGatheringState = "gathering"),
                        n._emitGatheringStateChange()),
                        c || n._dispatchEvent("icecandidate", a),
                        l &&
                          (n._dispatchEvent(
                            "icecandidate",
                            new Event("icecandidate"),
                          ),
                          (n.iceGatheringState = "complete"),
                          n._emitGatheringStateChange()));
                    }
                  }),
                  e.setTimeout(function () {
                    a.forEach(function (e) {
                      o.onlocalcandidate(e);
                    });
                  }, 0));
              }
            }),
            (d.prototype._createIceAndDtlsTransports = function () {
              var t = this,
                r = new e.RTCIceTransport(null);
              r.onicestatechange = function () {
                (t._updateIceConnectionState(), t._updateConnectionState());
              };
              var i = new e.RTCDtlsTransport(r);
              return (
                (i.ondtlsstatechange = function () {
                  t._updateConnectionState();
                }),
                (i.onerror = function () {
                  (Object.defineProperty(i, "state", {
                    value: "failed",
                    writable: !0,
                  }),
                    t._updateConnectionState());
                }),
                { iceTransport: r, dtlsTransport: i }
              );
            }),
            (d.prototype._disposeIceAndDtlsTransports = function (e) {
              var t = this.transceivers[e].iceGatherer;
              t &&
                (delete t.onlocalcandidate,
                delete this.transceivers[e].iceGatherer);
              var r = this.transceivers[e].iceTransport;
              r &&
                (delete r.onicestatechange,
                delete this.transceivers[e].iceTransport);
              var i = this.transceivers[e].dtlsTransport;
              i &&
                (delete i.ondtlsstatechange,
                delete i.onerror,
                delete this.transceivers[e].dtlsTransport);
            }),
            (d.prototype._transceive = function (e, r, n) {
              var a = o(e.localCapabilities, e.remoteCapabilities);
              (r &&
                e.rtpSender &&
                ((a.encodings = e.sendEncodingParameters),
                (a.rtcp = {
                  cname: i.localCName,
                  compound: e.rtcpParameters.compound,
                }),
                e.recvEncodingParameters.length &&
                  (a.rtcp.ssrc = e.recvEncodingParameters[0].ssrc),
                e.rtpSender.send(a)),
                n &&
                  e.rtpReceiver &&
                  a.codecs.length > 0 &&
                  ("video" === e.kind &&
                    e.recvEncodingParameters &&
                    t < 15019 &&
                    e.recvEncodingParameters.forEach(function (e) {
                      delete e.rtx;
                    }),
                  e.recvEncodingParameters.length
                    ? (a.encodings = e.recvEncodingParameters)
                    : (a.encodings = [{}]),
                  (a.rtcp = { compound: e.rtcpParameters.compound }),
                  e.rtcpParameters.cname &&
                    (a.rtcp.cname = e.rtcpParameters.cname),
                  e.sendEncodingParameters.length &&
                    (a.rtcp.ssrc = e.sendEncodingParameters[0].ssrc),
                  e.rtpReceiver.receive(a)));
            }),
            (d.prototype.setLocalDescription = function (e) {
              var t,
                r,
                n = this;
              if (-1 === ["offer", "answer"].indexOf(e.type))
                return Promise.reject(
                  c("TypeError", 'Unsupported type "' + e.type + '"'),
                );
              if (
                !a("setLocalDescription", e.type, n.signalingState) ||
                n._isClosed
              )
                return Promise.reject(
                  c(
                    "InvalidStateError",
                    "Can not set local " +
                      e.type +
                      " in state " +
                      n.signalingState,
                  ),
                );
              if ("offer" === e.type)
                ((t = i.splitSections(e.sdp)),
                  (r = t.shift()),
                  t.forEach(function (e, t) {
                    var r = i.parseRtpParameters(e);
                    n.transceivers[t].localCapabilities = r;
                  }),
                  n.transceivers.forEach(function (e, t) {
                    n._gather(e.mid, t);
                  }));
              else if ("answer" === e.type) {
                ((t = i.splitSections(n._remoteDescription.sdp)),
                  (r = t.shift()));
                var s = i.matchPrefix(r, "a=ice-lite").length > 0;
                t.forEach(function (e, t) {
                  var a = n.transceivers[t],
                    c = a.iceGatherer,
                    u = a.iceTransport,
                    d = a.dtlsTransport,
                    l = a.localCapabilities,
                    h = a.remoteCapabilities;
                  if (
                    !(
                      (i.isRejected(e) &&
                        0 === i.matchPrefix(e, "a=bundle-only").length) ||
                      a.rejected
                    )
                  ) {
                    var p = i.getIceParameters(e, r),
                      f = i.getDtlsParameters(e, r);
                    (s && (f.role = "server"),
                      (n.usingBundle && 0 !== t) ||
                        (n._gather(a.mid, t),
                        "new" === u.state &&
                          u.start(c, p, s ? "controlling" : "controlled"),
                        "new" === d.state && d.start(f)));
                    var m = o(l, h);
                    n._transceive(a, m.codecs.length > 0, !1);
                  }
                });
              }
              return (
                (n._localDescription = { type: e.type, sdp: e.sdp }),
                "offer" === e.type
                  ? n._updateSignalingState("have-local-offer")
                  : n._updateSignalingState("stable"),
                Promise.resolve()
              );
            }),
            (d.prototype.setRemoteDescription = function (n) {
              var d = this;
              if (-1 === ["offer", "answer"].indexOf(n.type))
                return Promise.reject(
                  c("TypeError", 'Unsupported type "' + n.type + '"'),
                );
              if (
                !a("setRemoteDescription", n.type, d.signalingState) ||
                d._isClosed
              )
                return Promise.reject(
                  c(
                    "InvalidStateError",
                    "Can not set remote " +
                      n.type +
                      " in state " +
                      d.signalingState,
                  ),
                );
              var l = {};
              d.remoteStreams.forEach(function (e) {
                l[e.id] = e;
              });
              var h = [],
                p = i.splitSections(n.sdp),
                f = p.shift(),
                m = i.matchPrefix(f, "a=ice-lite").length > 0,
                v = i.matchPrefix(f, "a=group:BUNDLE ").length > 0;
              d.usingBundle = v;
              var g = i.matchPrefix(f, "a=ice-options:")[0];
              return (
                (d.canTrickleIceCandidates =
                  !!g && g.substr(14).split(" ").indexOf("trickle") >= 0),
                p.forEach(function (a, c) {
                  var u = i.splitLines(a),
                    p = i.getKind(a),
                    g =
                      i.isRejected(a) &&
                      0 === i.matchPrefix(a, "a=bundle-only").length,
                    y = u[0].substr(2).split(" ")[2],
                    b = i.getDirection(a, f),
                    S = i.parseMsid(a),
                    E = i.getMid(a) || i.generateIdentifier();
                  if (
                    g ||
                    ("application" === p &&
                      ("DTLS/SCTP" === y || "UDP/DTLS/SCTP" === y))
                  )
                    d.transceivers[c] = {
                      mid: E,
                      kind: p,
                      protocol: y,
                      rejected: !0,
                    };
                  else {
                    var C, T, R, I, _, k, w, O, P;
                    !g &&
                      d.transceivers[c] &&
                      d.transceivers[c].rejected &&
                      (d.transceivers[c] = d._createTransceiver(p, !0));
                    var A,
                      L,
                      x = i.parseRtpParameters(a);
                    (g ||
                      ((A = i.getIceParameters(a, f)),
                      ((L = i.getDtlsParameters(a, f)).role = "client")),
                      (w = i.parseRtpEncodingParameters(a)));
                    var D = i.parseRtcpParameters(a),
                      M = i.matchPrefix(a, "a=end-of-candidates", f).length > 0,
                      U = i
                        .matchPrefix(a, "a=candidate:")
                        .map(function (e) {
                          return i.parseCandidate(e);
                        })
                        .filter(function (e) {
                          return 1 === e.component;
                        });
                    if (
                      (("offer" === n.type || "answer" === n.type) &&
                        !g &&
                        v &&
                        c > 0 &&
                        d.transceivers[c] &&
                        (d._disposeIceAndDtlsTransports(c),
                        (d.transceivers[c].iceGatherer =
                          d.transceivers[0].iceGatherer),
                        (d.transceivers[c].iceTransport =
                          d.transceivers[0].iceTransport),
                        (d.transceivers[c].dtlsTransport =
                          d.transceivers[0].dtlsTransport),
                        d.transceivers[c].rtpSender &&
                          d.transceivers[c].rtpSender.setTransport(
                            d.transceivers[0].dtlsTransport,
                          ),
                        d.transceivers[c].rtpReceiver &&
                          d.transceivers[c].rtpReceiver.setTransport(
                            d.transceivers[0].dtlsTransport,
                          )),
                      "offer" !== n.type || g)
                    )
                      "answer" !== n.type ||
                        g ||
                        ((T = (C = d.transceivers[c]).iceGatherer),
                        (R = C.iceTransport),
                        (I = C.dtlsTransport),
                        (_ = C.rtpReceiver),
                        (k = C.sendEncodingParameters),
                        (O = C.localCapabilities),
                        (d.transceivers[c].recvEncodingParameters = w),
                        (d.transceivers[c].remoteCapabilities = x),
                        (d.transceivers[c].rtcpParameters = D),
                        U.length &&
                          "new" === R.state &&
                          ((!m && !M) || (v && 0 !== c)
                            ? U.forEach(function (e) {
                                s(C.iceTransport, e);
                              })
                            : R.setRemoteCandidates(U)),
                        (v && 0 !== c) ||
                          ("new" === R.state && R.start(T, A, "controlling"),
                          "new" === I.state && I.start(L)),
                        !o(
                          C.localCapabilities,
                          C.remoteCapabilities,
                        ).codecs.filter(function (e) {
                          return "rtx" === e.name.toLowerCase();
                        }).length &&
                          C.sendEncodingParameters[0].rtx &&
                          delete C.sendEncodingParameters[0].rtx,
                        d._transceive(
                          C,
                          "sendrecv" === b || "recvonly" === b,
                          "sendrecv" === b || "sendonly" === b,
                        ),
                        !_ || ("sendrecv" !== b && "sendonly" !== b)
                          ? delete C.rtpReceiver
                          : ((P = _.track),
                            S
                              ? (l[S.stream] ||
                                  (l[S.stream] = new e.MediaStream()),
                                r(P, l[S.stream]),
                                h.push([P, _, l[S.stream]]))
                              : (l.default || (l.default = new e.MediaStream()),
                                r(P, l.default),
                                h.push([P, _, l.default]))));
                    else {
                      (((C = d.transceivers[c] || d._createTransceiver(p)).mid =
                        E),
                        C.iceGatherer ||
                          (C.iceGatherer = d._createIceGatherer(c, v)),
                        U.length &&
                          "new" === C.iceTransport.state &&
                          (!M || (v && 0 !== c)
                            ? U.forEach(function (e) {
                                s(C.iceTransport, e);
                              })
                            : C.iceTransport.setRemoteCandidates(U)),
                        (O = e.RTCRtpReceiver.getCapabilities(p)),
                        t < 15019 &&
                          (O.codecs = O.codecs.filter(function (e) {
                            return "rtx" !== e.name;
                          })),
                        (k = C.sendEncodingParameters || [
                          { ssrc: 1001 * (2 * c + 2) },
                        ]));
                      var N,
                        V = !1;
                      ("sendrecv" === b || "sendonly" === b
                        ? ((V = !C.rtpReceiver),
                          (_ =
                            C.rtpReceiver ||
                            new e.RTCRtpReceiver(C.dtlsTransport, p)),
                          V &&
                            ((P = _.track),
                            (S && "-" === S.stream) ||
                              (S
                                ? (l[S.stream] ||
                                    ((l[S.stream] = new e.MediaStream()),
                                    Object.defineProperty(l[S.stream], "id", {
                                      get: function () {
                                        return S.stream;
                                      },
                                    })),
                                  Object.defineProperty(P, "id", {
                                    get: function () {
                                      return S.track;
                                    },
                                  }),
                                  (N = l[S.stream]))
                                : (l.default ||
                                    (l.default = new e.MediaStream()),
                                  (N = l.default))),
                            N &&
                              (r(P, N), C.associatedRemoteMediaStreams.push(N)),
                            h.push([P, _, N])))
                        : C.rtpReceiver &&
                          C.rtpReceiver.track &&
                          (C.associatedRemoteMediaStreams.forEach(function (t) {
                            var r = t.getTracks().find(function (e) {
                              return e.id === C.rtpReceiver.track.id;
                            });
                            r &&
                              (function (t, r) {
                                (r.removeTrack(t),
                                  r.dispatchEvent(
                                    new e.MediaStreamTrackEvent("removetrack", {
                                      track: t,
                                    }),
                                  ));
                              })(r, t);
                          }),
                          (C.associatedRemoteMediaStreams = [])),
                        (C.localCapabilities = O),
                        (C.remoteCapabilities = x),
                        (C.rtpReceiver = _),
                        (C.rtcpParameters = D),
                        (C.sendEncodingParameters = k),
                        (C.recvEncodingParameters = w),
                        d._transceive(d.transceivers[c], !1, V));
                    }
                  }
                }),
                void 0 === d._dtlsRole &&
                  (d._dtlsRole = "offer" === n.type ? "active" : "passive"),
                (d._remoteDescription = { type: n.type, sdp: n.sdp }),
                "offer" === n.type
                  ? d._updateSignalingState("have-remote-offer")
                  : d._updateSignalingState("stable"),
                Object.keys(l).forEach(function (t) {
                  var r = l[t];
                  if (r.getTracks().length) {
                    if (-1 === d.remoteStreams.indexOf(r)) {
                      d.remoteStreams.push(r);
                      var i = new Event("addstream");
                      ((i.stream = r),
                        e.setTimeout(function () {
                          d._dispatchEvent("addstream", i);
                        }));
                    }
                    h.forEach(function (e) {
                      var t = e[0],
                        i = e[1];
                      r.id === e[2].id && u(d, t, i, [r]);
                    });
                  }
                }),
                h.forEach(function (e) {
                  e[2] || u(d, e[0], e[1], []);
                }),
                e.setTimeout(function () {
                  d &&
                    d.transceivers &&
                    d.transceivers.forEach(function (e) {
                      e.iceTransport &&
                        "new" === e.iceTransport.state &&
                        e.iceTransport.getRemoteCandidates().length > 0 &&
                        (console.warn(
                          "Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification",
                        ),
                        e.iceTransport.addRemoteCandidate({}));
                    });
                }, 4e3),
                Promise.resolve()
              );
            }),
            (d.prototype.close = function () {
              (this.transceivers.forEach(function (e) {
                (e.iceTransport && e.iceTransport.stop(),
                  e.dtlsTransport && e.dtlsTransport.stop(),
                  e.rtpSender && e.rtpSender.stop(),
                  e.rtpReceiver && e.rtpReceiver.stop());
              }),
                (this._isClosed = !0),
                this._updateSignalingState("closed"));
            }),
            (d.prototype._updateSignalingState = function (e) {
              this.signalingState = e;
              var t = new Event("signalingstatechange");
              this._dispatchEvent("signalingstatechange", t);
            }),
            (d.prototype._maybeFireNegotiationNeeded = function () {
              var t = this;
              "stable" === this.signalingState &&
                !0 !== this.needNegotiation &&
                ((this.needNegotiation = !0),
                e.setTimeout(function () {
                  if (t.needNegotiation) {
                    t.needNegotiation = !1;
                    var e = new Event("negotiationneeded");
                    t._dispatchEvent("negotiationneeded", e);
                  }
                }, 0));
            }),
            (d.prototype._updateIceConnectionState = function () {
              var e,
                t = {
                  new: 0,
                  closed: 0,
                  checking: 0,
                  connected: 0,
                  completed: 0,
                  disconnected: 0,
                  failed: 0,
                };
              if (
                (this.transceivers.forEach(function (e) {
                  e.iceTransport && !e.rejected && t[e.iceTransport.state]++;
                }),
                (e = "new"),
                t.failed > 0
                  ? (e = "failed")
                  : t.checking > 0
                    ? (e = "checking")
                    : t.disconnected > 0
                      ? (e = "disconnected")
                      : t.new > 0
                        ? (e = "new")
                        : t.connected > 0
                          ? (e = "connected")
                          : t.completed > 0 && (e = "completed"),
                e !== this.iceConnectionState)
              ) {
                this.iceConnectionState = e;
                var r = new Event("iceconnectionstatechange");
                this._dispatchEvent("iceconnectionstatechange", r);
              }
            }),
            (d.prototype._updateConnectionState = function () {
              var e,
                t = {
                  new: 0,
                  closed: 0,
                  connecting: 0,
                  connected: 0,
                  completed: 0,
                  disconnected: 0,
                  failed: 0,
                };
              if (
                (this.transceivers.forEach(function (e) {
                  e.iceTransport &&
                    e.dtlsTransport &&
                    !e.rejected &&
                    (t[e.iceTransport.state]++, t[e.dtlsTransport.state]++);
                }),
                (t.connected += t.completed),
                (e = "new"),
                t.failed > 0
                  ? (e = "failed")
                  : t.connecting > 0
                    ? (e = "connecting")
                    : t.disconnected > 0
                      ? (e = "disconnected")
                      : t.new > 0
                        ? (e = "new")
                        : t.connected > 0 && (e = "connected"),
                e !== this.connectionState)
              ) {
                this.connectionState = e;
                var r = new Event("connectionstatechange");
                this._dispatchEvent("connectionstatechange", r);
              }
            }),
            (d.prototype.createOffer = function () {
              var r = this;
              if (r._isClosed)
                return Promise.reject(
                  c(
                    "InvalidStateError",
                    "Can not call createOffer after close",
                  ),
                );
              var o = r.transceivers.filter(function (e) {
                  return "audio" === e.kind;
                }).length,
                a = r.transceivers.filter(function (e) {
                  return "video" === e.kind;
                }).length,
                s = arguments[0];
              if (s) {
                if (s.mandatory || s.optional)
                  throw new TypeError(
                    "Legacy mandatory/optional constraints not supported.",
                  );
                (void 0 !== s.offerToReceiveAudio &&
                  (o =
                    !0 === s.offerToReceiveAudio
                      ? 1
                      : !1 === s.offerToReceiveAudio
                        ? 0
                        : s.offerToReceiveAudio),
                  void 0 !== s.offerToReceiveVideo &&
                    (a =
                      !0 === s.offerToReceiveVideo
                        ? 1
                        : !1 === s.offerToReceiveVideo
                          ? 0
                          : s.offerToReceiveVideo));
              }
              for (
                r.transceivers.forEach(function (e) {
                  "audio" === e.kind
                    ? --o < 0 && (e.wantReceive = !1)
                    : "video" === e.kind && --a < 0 && (e.wantReceive = !1);
                });
                o > 0 || a > 0;
              )
                (o > 0 && (r._createTransceiver("audio"), o--),
                  a > 0 && (r._createTransceiver("video"), a--));
              var u = i.writeSessionBoilerplate(
                r._sdpSessionId,
                r._sdpSessionVersion++,
              );
              (r.transceivers.forEach(function (n, o) {
                var a = n.track,
                  s = n.kind,
                  c = n.mid || i.generateIdentifier();
                ((n.mid = c),
                  n.iceGatherer ||
                    (n.iceGatherer = r._createIceGatherer(o, r.usingBundle)));
                var u = e.RTCRtpSender.getCapabilities(s);
                (t < 15019 &&
                  (u.codecs = u.codecs.filter(function (e) {
                    return "rtx" !== e.name;
                  })),
                  u.codecs.forEach(function (e) {
                    ("H264" === e.name &&
                      void 0 === e.parameters["level-asymmetry-allowed"] &&
                      (e.parameters["level-asymmetry-allowed"] = "1"),
                      n.remoteCapabilities &&
                        n.remoteCapabilities.codecs &&
                        n.remoteCapabilities.codecs.forEach(function (t) {
                          e.name.toLowerCase() === t.name.toLowerCase() &&
                            e.clockRate === t.clockRate &&
                            (e.preferredPayloadType = t.payloadType);
                        }));
                  }),
                  u.headerExtensions.forEach(function (e) {
                    (
                      (n.remoteCapabilities &&
                        n.remoteCapabilities.headerExtensions) ||
                      []
                    ).forEach(function (t) {
                      e.uri === t.uri && (e.id = t.id);
                    });
                  }));
                var d = n.sendEncodingParameters || [
                  { ssrc: 1001 * (2 * o + 1) },
                ];
                (a &&
                  t >= 15019 &&
                  "video" === s &&
                  !d[0].rtx &&
                  (d[0].rtx = { ssrc: d[0].ssrc + 1 }),
                  n.wantReceive &&
                    (n.rtpReceiver = new e.RTCRtpReceiver(n.dtlsTransport, s)),
                  (n.localCapabilities = u),
                  (n.sendEncodingParameters = d));
              }),
                "max-compat" !== r._config.bundlePolicy &&
                  (u +=
                    "a=group:BUNDLE " +
                    r.transceivers
                      .map(function (e) {
                        return e.mid;
                      })
                      .join(" ") +
                    "\r\n"),
                (u += "a=ice-options:trickle\r\n"),
                r.transceivers.forEach(function (e, t) {
                  ((u += n(
                    e,
                    e.localCapabilities,
                    "offer",
                    e.stream,
                    r._dtlsRole,
                  )),
                    (u += "a=rtcp-rsize\r\n"),
                    !e.iceGatherer ||
                      "new" === r.iceGatheringState ||
                      (0 !== t && r.usingBundle) ||
                      (e.iceGatherer.getLocalCandidates().forEach(function (e) {
                        ((e.component = 1),
                          (u += "a=" + i.writeCandidate(e) + "\r\n"));
                      }),
                      "completed" === e.iceGatherer.state &&
                        (u += "a=end-of-candidates\r\n")));
                }));
              var d = new e.RTCSessionDescription({ type: "offer", sdp: u });
              return Promise.resolve(d);
            }),
            (d.prototype.createAnswer = function () {
              var r = this;
              if (r._isClosed)
                return Promise.reject(
                  c(
                    "InvalidStateError",
                    "Can not call createAnswer after close",
                  ),
                );
              if (
                "have-remote-offer" !== r.signalingState &&
                "have-local-pranswer" !== r.signalingState
              )
                return Promise.reject(
                  c(
                    "InvalidStateError",
                    "Can not call createAnswer in signalingState " +
                      r.signalingState,
                  ),
                );
              var a = i.writeSessionBoilerplate(
                r._sdpSessionId,
                r._sdpSessionVersion++,
              );
              (r.usingBundle &&
                (a +=
                  "a=group:BUNDLE " +
                  r.transceivers
                    .map(function (e) {
                      return e.mid;
                    })
                    .join(" ") +
                  "\r\n"),
                (a += "a=ice-options:trickle\r\n"));
              var s = i.getMediaSections(r._remoteDescription.sdp).length;
              r.transceivers.forEach(function (e, i) {
                if (!(i + 1 > s)) {
                  if (e.rejected)
                    return (
                      "application" === e.kind
                        ? "DTLS/SCTP" === e.protocol
                          ? (a += "m=application 0 DTLS/SCTP 5000\r\n")
                          : (a +=
                              "m=application 0 " +
                              e.protocol +
                              " webrtc-datachannel\r\n")
                        : "audio" === e.kind
                          ? (a +=
                              "m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n")
                          : "video" === e.kind &&
                            (a +=
                              "m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),
                      void (a +=
                        "c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:" +
                        e.mid +
                        "\r\n")
                    );
                  var c;
                  e.stream &&
                    ("audio" === e.kind
                      ? (c = e.stream.getAudioTracks()[0])
                      : "video" === e.kind &&
                        (c = e.stream.getVideoTracks()[0]),
                    c &&
                      t >= 15019 &&
                      "video" === e.kind &&
                      !e.sendEncodingParameters[0].rtx &&
                      (e.sendEncodingParameters[0].rtx = {
                        ssrc: e.sendEncodingParameters[0].ssrc + 1,
                      }));
                  var u = o(e.localCapabilities, e.remoteCapabilities);
                  (!u.codecs.filter(function (e) {
                    return "rtx" === e.name.toLowerCase();
                  }).length &&
                    e.sendEncodingParameters[0].rtx &&
                    delete e.sendEncodingParameters[0].rtx,
                    (a += n(e, u, "answer", e.stream, r._dtlsRole)),
                    e.rtcpParameters &&
                      e.rtcpParameters.reducedSize &&
                      (a += "a=rtcp-rsize\r\n"));
                }
              });
              var u = new e.RTCSessionDescription({ type: "answer", sdp: a });
              return Promise.resolve(u);
            }),
            (d.prototype.addIceCandidate = function (e) {
              var t,
                r = this;
              return e && void 0 === e.sdpMLineIndex && !e.sdpMid
                ? Promise.reject(
                    new TypeError("sdpMLineIndex or sdpMid required"),
                  )
                : new Promise(function (n, o) {
                    if (!r._remoteDescription)
                      return o(
                        c(
                          "InvalidStateError",
                          "Can not add ICE candidate without a remote description",
                        ),
                      );
                    if (e && "" !== e.candidate) {
                      var a = e.sdpMLineIndex;
                      if (e.sdpMid)
                        for (var u = 0; u < r.transceivers.length; u++)
                          if (r.transceivers[u].mid === e.sdpMid) {
                            a = u;
                            break;
                          }
                      var d = r.transceivers[a];
                      if (!d)
                        return o(
                          c("OperationError", "Can not add ICE candidate"),
                        );
                      if (d.rejected) return n();
                      var l =
                        Object.keys(e.candidate).length > 0
                          ? i.parseCandidate(e.candidate)
                          : {};
                      if (
                        "tcp" === l.protocol &&
                        (0 === l.port || 9 === l.port)
                      )
                        return n();
                      if (l.component && 1 !== l.component) return n();
                      if (
                        (0 === a ||
                          (a > 0 &&
                            d.iceTransport !==
                              r.transceivers[0].iceTransport)) &&
                        !s(d.iceTransport, l)
                      )
                        return o(
                          c("OperationError", "Can not add ICE candidate"),
                        );
                      var h = e.candidate.trim();
                      (0 === h.indexOf("a=") && (h = h.substr(2)),
                        ((t = i.getMediaSections(r._remoteDescription.sdp))[
                          a
                        ] +=
                          "a=" + (l.type ? h : "end-of-candidates") + "\r\n"),
                        (r._remoteDescription.sdp =
                          i.getDescription(r._remoteDescription.sdp) +
                          t.join("")));
                    } else
                      for (
                        var p = 0;
                        p < r.transceivers.length &&
                        (r.transceivers[p].rejected ||
                          (r.transceivers[p].iceTransport.addRemoteCandidate(
                            {},
                          ),
                          ((t = i.getMediaSections(r._remoteDescription.sdp))[
                            p
                          ] += "a=end-of-candidates\r\n"),
                          (r._remoteDescription.sdp =
                            i.getDescription(r._remoteDescription.sdp) +
                            t.join("")),
                          !r.usingBundle));
                        p++
                      );
                    n();
                  });
            }),
            (d.prototype.getStats = function (t) {
              if (t && t instanceof e.MediaStreamTrack) {
                var r = null;
                if (
                  (this.transceivers.forEach(function (e) {
                    e.rtpSender && e.rtpSender.track === t
                      ? (r = e.rtpSender)
                      : e.rtpReceiver &&
                        e.rtpReceiver.track === t &&
                        (r = e.rtpReceiver);
                  }),
                  !r)
                )
                  throw c("InvalidAccessError", "Invalid selector.");
                return r.getStats();
              }
              var i = [];
              return (
                this.transceivers.forEach(function (e) {
                  [
                    "rtpSender",
                    "rtpReceiver",
                    "iceGatherer",
                    "iceTransport",
                    "dtlsTransport",
                  ].forEach(function (t) {
                    e[t] && i.push(e[t].getStats());
                  });
                }),
                Promise.all(i).then(function (e) {
                  var t = new Map();
                  return (
                    e.forEach(function (e) {
                      e.forEach(function (e) {
                        t.set(e.id, e);
                      });
                    }),
                    t
                  );
                })
              );
            }),
            [
              "RTCRtpSender",
              "RTCRtpReceiver",
              "RTCIceGatherer",
              "RTCIceTransport",
              "RTCDtlsTransport",
            ].forEach(function (t) {
              var r = e[t];
              if (r && r.prototype && r.prototype.getStats) {
                var i = r.prototype.getStats;
                r.prototype.getStats = function () {
                  return i.apply(this).then(function (e) {
                    var t = new Map();
                    return (
                      Object.keys(e).forEach(function (r) {
                        var i;
                        ((e[r].type =
                          {
                            inboundrtp: "inbound-rtp",
                            outboundrtp: "outbound-rtp",
                            candidatepair: "candidate-pair",
                            localcandidate: "local-candidate",
                            remotecandidate: "remote-candidate",
                          }[(i = e[r]).type] || i.type),
                          t.set(r, e[r]));
                      }),
                      t
                    );
                  });
                };
              }
            }));
          var l = ["createOffer", "createAnswer"];
          return (
            l.forEach(function (e) {
              var t = d.prototype[e];
              d.prototype[e] = function () {
                var e = arguments;
                return "function" == typeof e[0] || "function" == typeof e[1]
                  ? t.apply(this, [arguments[2]]).then(
                      function (t) {
                        "function" == typeof e[0] && e[0].apply(null, [t]);
                      },
                      function (t) {
                        "function" == typeof e[1] && e[1].apply(null, [t]);
                      },
                    )
                  : t.apply(this, arguments);
              };
            }),
            (l = [
              "setLocalDescription",
              "setRemoteDescription",
              "addIceCandidate",
            ]).forEach(function (e) {
              var t = d.prototype[e];
              d.prototype[e] = function () {
                var e = arguments;
                return "function" == typeof e[1] || "function" == typeof e[2]
                  ? t.apply(this, arguments).then(
                      function () {
                        "function" == typeof e[1] && e[1].apply(null);
                      },
                      function (t) {
                        "function" == typeof e[2] && e[2].apply(null, [t]);
                      },
                    )
                  : t.apply(this, arguments);
              };
            }),
            ["getStats"].forEach(function (e) {
              var t = d.prototype[e];
              d.prototype[e] = function () {
                var e = arguments;
                return "function" == typeof e[1]
                  ? t.apply(this, arguments).then(function () {
                      "function" == typeof e[1] && e[1].apply(null);
                    })
                  : t.apply(this, arguments);
              };
            }),
            d
          );
        };
      },
      { sdp: 17 },
    ],
    17: [
      function (e, t, r) {
        var i = {
          generateIdentifier: function () {
            return Math.random().toString(36).substr(2, 10);
          },
        };
        ((i.localCName = i.generateIdentifier()),
          (i.splitLines = function (e) {
            return e
              .trim()
              .split("\n")
              .map(function (e) {
                return e.trim();
              });
          }),
          (i.splitSections = function (e) {
            return e.split("\nm=").map(function (e, t) {
              return (t > 0 ? "m=" + e : e).trim() + "\r\n";
            });
          }),
          (i.getDescription = function (e) {
            var t = i.splitSections(e);
            return t && t[0];
          }),
          (i.getMediaSections = function (e) {
            var t = i.splitSections(e);
            return (t.shift(), t);
          }),
          (i.matchPrefix = function (e, t) {
            return i.splitLines(e).filter(function (e) {
              return 0 === e.indexOf(t);
            });
          }),
          (i.parseCandidate = function (e) {
            for (
              var t,
                r = {
                  foundation: (t =
                    0 === e.indexOf("a=candidate:")
                      ? e.substring(12).split(" ")
                      : e.substring(10).split(" "))[0],
                  component: parseInt(t[1], 10),
                  protocol: t[2].toLowerCase(),
                  priority: parseInt(t[3], 10),
                  ip: t[4],
                  address: t[4],
                  port: parseInt(t[5], 10),
                  type: t[7],
                },
                i = 8;
              i < t.length;
              i += 2
            )
              switch (t[i]) {
                case "raddr":
                  r.relatedAddress = t[i + 1];
                  break;
                case "rport":
                  r.relatedPort = parseInt(t[i + 1], 10);
                  break;
                case "tcptype":
                  r.tcpType = t[i + 1];
                  break;
                case "ufrag":
                  ((r.ufrag = t[i + 1]), (r.usernameFragment = t[i + 1]));
                  break;
                default:
                  r[t[i]] = t[i + 1];
              }
            return r;
          }),
          (i.writeCandidate = function (e) {
            var t = [];
            (t.push(e.foundation),
              t.push(e.component),
              t.push(e.protocol.toUpperCase()),
              t.push(e.priority),
              t.push(e.address || e.ip),
              t.push(e.port));
            var r = e.type;
            return (
              t.push("typ"),
              t.push(r),
              "host" !== r &&
                e.relatedAddress &&
                e.relatedPort &&
                (t.push("raddr"),
                t.push(e.relatedAddress),
                t.push("rport"),
                t.push(e.relatedPort)),
              e.tcpType &&
                "tcp" === e.protocol.toLowerCase() &&
                (t.push("tcptype"), t.push(e.tcpType)),
              (e.usernameFragment || e.ufrag) &&
                (t.push("ufrag"), t.push(e.usernameFragment || e.ufrag)),
              "candidate:" + t.join(" ")
            );
          }),
          (i.parseIceOptions = function (e) {
            return e.substr(14).split(" ");
          }),
          (i.parseRtpMap = function (e) {
            var t = e.substr(9).split(" "),
              r = { payloadType: parseInt(t.shift(), 10) };
            return (
              (t = t[0].split("/")),
              (r.name = t[0]),
              (r.clockRate = parseInt(t[1], 10)),
              (r.channels = 3 === t.length ? parseInt(t[2], 10) : 1),
              (r.numChannels = r.channels),
              r
            );
          }),
          (i.writeRtpMap = function (e) {
            var t = e.payloadType;
            void 0 !== e.preferredPayloadType && (t = e.preferredPayloadType);
            var r = e.channels || e.numChannels || 1;
            return (
              "a=rtpmap:" +
              t +
              " " +
              e.name +
              "/" +
              e.clockRate +
              (1 !== r ? "/" + r : "") +
              "\r\n"
            );
          }),
          (i.parseExtmap = function (e) {
            var t = e.substr(9).split(" ");
            return {
              id: parseInt(t[0], 10),
              direction:
                t[0].indexOf("/") > 0 ? t[0].split("/")[1] : "sendrecv",
              uri: t[1],
            };
          }),
          (i.writeExtmap = function (e) {
            return (
              "a=extmap:" +
              (e.id || e.preferredId) +
              (e.direction && "sendrecv" !== e.direction
                ? "/" + e.direction
                : "") +
              " " +
              e.uri +
              "\r\n"
            );
          }),
          (i.parseFmtp = function (e) {
            for (
              var t, r = {}, i = e.substr(e.indexOf(" ") + 1).split(";"), n = 0;
              n < i.length;
              n++
            )
              r[(t = i[n].trim().split("="))[0].trim()] = t[1];
            return r;
          }),
          (i.writeFmtp = function (e) {
            var t = "",
              r = e.payloadType;
            if (
              (void 0 !== e.preferredPayloadType &&
                (r = e.preferredPayloadType),
              e.parameters && Object.keys(e.parameters).length)
            ) {
              var i = [];
              (Object.keys(e.parameters).forEach(function (t) {
                e.parameters[t] ? i.push(t + "=" + e.parameters[t]) : i.push(t);
              }),
                (t += "a=fmtp:" + r + " " + i.join(";") + "\r\n"));
            }
            return t;
          }),
          (i.parseRtcpFb = function (e) {
            var t = e.substr(e.indexOf(" ") + 1).split(" ");
            return { type: t.shift(), parameter: t.join(" ") };
          }),
          (i.writeRtcpFb = function (e) {
            var t = "",
              r = e.payloadType;
            return (
              void 0 !== e.preferredPayloadType && (r = e.preferredPayloadType),
              e.rtcpFeedback &&
                e.rtcpFeedback.length &&
                e.rtcpFeedback.forEach(function (e) {
                  t +=
                    "a=rtcp-fb:" +
                    r +
                    " " +
                    e.type +
                    (e.parameter && e.parameter.length
                      ? " " + e.parameter
                      : "") +
                    "\r\n";
                }),
              t
            );
          }),
          (i.parseSsrcMedia = function (e) {
            var t = e.indexOf(" "),
              r = { ssrc: parseInt(e.substr(7, t - 7), 10) },
              i = e.indexOf(":", t);
            return (
              i > -1
                ? ((r.attribute = e.substr(t + 1, i - t - 1)),
                  (r.value = e.substr(i + 1)))
                : (r.attribute = e.substr(t + 1)),
              r
            );
          }),
          (i.parseSsrcGroup = function (e) {
            var t = e.substr(13).split(" ");
            return {
              semantics: t.shift(),
              ssrcs: t.map(function (e) {
                return parseInt(e, 10);
              }),
            };
          }),
          (i.getMid = function (e) {
            var t = i.matchPrefix(e, "a=mid:")[0];
            if (t) return t.substr(6);
          }),
          (i.parseFingerprint = function (e) {
            var t = e.substr(14).split(" ");
            return { algorithm: t[0].toLowerCase(), value: t[1] };
          }),
          (i.getDtlsParameters = function (e, t) {
            return {
              role: "auto",
              fingerprints: i
                .matchPrefix(e + t, "a=fingerprint:")
                .map(i.parseFingerprint),
            };
          }),
          (i.writeDtlsParameters = function (e, t) {
            var r = "a=setup:" + t + "\r\n";
            return (
              e.fingerprints.forEach(function (e) {
                r += "a=fingerprint:" + e.algorithm + " " + e.value + "\r\n";
              }),
              r
            );
          }),
          (i.parseCryptoLine = function (e) {
            var t = e.substr(9).split(" ");
            return {
              tag: parseInt(t[0], 10),
              cryptoSuite: t[1],
              keyParams: t[2],
              sessionParams: t.slice(3),
            };
          }),
          (i.writeCryptoLine = function (e) {
            return (
              "a=crypto:" +
              e.tag +
              " " +
              e.cryptoSuite +
              " " +
              ("object" == h(e.keyParams)
                ? i.writeCryptoKeyParams(e.keyParams)
                : e.keyParams) +
              (e.sessionParams ? " " + e.sessionParams.join(" ") : "") +
              "\r\n"
            );
          }),
          (i.parseCryptoKeyParams = function (e) {
            if (0 !== e.indexOf("inline:")) return null;
            var t = e.substr(7).split("|");
            return {
              keyMethod: "inline",
              keySalt: t[0],
              lifeTime: t[1],
              mkiValue: t[2] ? t[2].split(":")[0] : void 0,
              mkiLength: t[2] ? t[2].split(":")[1] : void 0,
            };
          }),
          (i.writeCryptoKeyParams = function (e) {
            return (
              e.keyMethod +
              ":" +
              e.keySalt +
              (e.lifeTime ? "|" + e.lifeTime : "") +
              (e.mkiValue && e.mkiLength
                ? "|" + e.mkiValue + ":" + e.mkiLength
                : "")
            );
          }),
          (i.getCryptoParameters = function (e, t) {
            return i.matchPrefix(e + t, "a=crypto:").map(i.parseCryptoLine);
          }),
          (i.getIceParameters = function (e, t) {
            var r = i.matchPrefix(e + t, "a=ice-ufrag:")[0],
              n = i.matchPrefix(e + t, "a=ice-pwd:")[0];
            return r && n
              ? { usernameFragment: r.substr(12), password: n.substr(10) }
              : null;
          }),
          (i.writeIceParameters = function (e) {
            return (
              "a=ice-ufrag:" +
              e.usernameFragment +
              "\r\na=ice-pwd:" +
              e.password +
              "\r\n"
            );
          }),
          (i.parseRtpParameters = function (e) {
            for (
              var t = {
                  codecs: [],
                  headerExtensions: [],
                  fecMechanisms: [],
                  rtcp: [],
                },
                r = i.splitLines(e)[0].split(" "),
                n = 3;
              n < r.length;
              n++
            ) {
              var o = r[n],
                a = i.matchPrefix(e, "a=rtpmap:" + o + " ")[0];
              if (a) {
                var s = i.parseRtpMap(a),
                  c = i.matchPrefix(e, "a=fmtp:" + o + " ");
                switch (
                  ((s.parameters = c.length ? i.parseFmtp(c[0]) : {}),
                  (s.rtcpFeedback = i
                    .matchPrefix(e, "a=rtcp-fb:" + o + " ")
                    .map(i.parseRtcpFb)),
                  t.codecs.push(s),
                  s.name.toUpperCase())
                ) {
                  case "RED":
                  case "ULPFEC":
                    t.fecMechanisms.push(s.name.toUpperCase());
                }
              }
            }
            return (
              i.matchPrefix(e, "a=extmap:").forEach(function (e) {
                t.headerExtensions.push(i.parseExtmap(e));
              }),
              t
            );
          }),
          (i.writeRtpDescription = function (e, t) {
            var r = "";
            ((r += "m=" + e + " "),
              (r += t.codecs.length > 0 ? "9" : "0"),
              (r += " UDP/TLS/RTP/SAVPF "),
              (r +=
                t.codecs
                  .map(function (e) {
                    return void 0 !== e.preferredPayloadType
                      ? e.preferredPayloadType
                      : e.payloadType;
                  })
                  .join(" ") + "\r\n"),
              (r += "c=IN IP4 0.0.0.0\r\n"),
              (r += "a=rtcp:9 IN IP4 0.0.0.0\r\n"),
              t.codecs.forEach(function (e) {
                ((r += i.writeRtpMap(e)),
                  (r += i.writeFmtp(e)),
                  (r += i.writeRtcpFb(e)));
              }));
            var n = 0;
            return (
              t.codecs.forEach(function (e) {
                e.maxptime > n && (n = e.maxptime);
              }),
              n > 0 && (r += "a=maxptime:" + n + "\r\n"),
              (r += "a=rtcp-mux\r\n"),
              t.headerExtensions &&
                t.headerExtensions.forEach(function (e) {
                  r += i.writeExtmap(e);
                }),
              r
            );
          }),
          (i.parseRtpEncodingParameters = function (e) {
            var t,
              r = [],
              n = i.parseRtpParameters(e),
              o = -1 !== n.fecMechanisms.indexOf("RED"),
              a = -1 !== n.fecMechanisms.indexOf("ULPFEC"),
              s = i
                .matchPrefix(e, "a=ssrc:")
                .map(function (e) {
                  return i.parseSsrcMedia(e);
                })
                .filter(function (e) {
                  return "cname" === e.attribute;
                }),
              c = s.length > 0 && s[0].ssrc,
              u = i.matchPrefix(e, "a=ssrc-group:FID").map(function (e) {
                return e
                  .substr(17)
                  .split(" ")
                  .map(function (e) {
                    return parseInt(e, 10);
                  });
              });
            (u.length > 0 && u[0].length > 1 && u[0][0] === c && (t = u[0][1]),
              n.codecs.forEach(function (e) {
                if ("RTX" === e.name.toUpperCase() && e.parameters.apt) {
                  var i = {
                    ssrc: c,
                    codecPayloadType: parseInt(e.parameters.apt, 10),
                  };
                  (c && t && (i.rtx = { ssrc: t }),
                    r.push(i),
                    o &&
                      (((i = JSON.parse(JSON.stringify(i))).fec = {
                        ssrc: c,
                        mechanism: a ? "red+ulpfec" : "red",
                      }),
                      r.push(i)));
                }
              }),
              0 === r.length && c && r.push({ ssrc: c }));
            var d = i.matchPrefix(e, "b=");
            return (
              d.length &&
                ((d =
                  0 === d[0].indexOf("b=TIAS:")
                    ? parseInt(d[0].substr(7), 10)
                    : 0 === d[0].indexOf("b=AS:")
                      ? 1e3 * parseInt(d[0].substr(5), 10) * 0.95 - 16e3
                      : void 0),
                r.forEach(function (e) {
                  e.maxBitrate = d;
                })),
              r
            );
          }),
          (i.parseRtcpParameters = function (e) {
            var t = {},
              r = i
                .matchPrefix(e, "a=ssrc:")
                .map(function (e) {
                  return i.parseSsrcMedia(e);
                })
                .filter(function (e) {
                  return "cname" === e.attribute;
                })[0];
            r && ((t.cname = r.value), (t.ssrc = r.ssrc));
            var n = i.matchPrefix(e, "a=rtcp-rsize");
            ((t.reducedSize = n.length > 0), (t.compound = 0 === n.length));
            var o = i.matchPrefix(e, "a=rtcp-mux");
            return ((t.mux = o.length > 0), t);
          }),
          (i.parseMsid = function (e) {
            var t,
              r = i.matchPrefix(e, "a=msid:");
            if (1 === r.length)
              return {
                stream: (t = r[0].substr(7).split(" "))[0],
                track: t[1],
              };
            var n = i
              .matchPrefix(e, "a=ssrc:")
              .map(function (e) {
                return i.parseSsrcMedia(e);
              })
              .filter(function (e) {
                return "msid" === e.attribute;
              });
            return n.length > 0
              ? { stream: (t = n[0].value.split(" "))[0], track: t[1] }
              : void 0;
          }),
          (i.parseSctpDescription = function (e) {
            var t,
              r = i.parseMLine(e),
              n = i.matchPrefix(e, "a=max-message-size:");
            (n.length > 0 && (t = parseInt(n[0].substr(19), 10)),
              isNaN(t) && (t = 65536));
            var o = i.matchPrefix(e, "a=sctp-port:");
            if (o.length > 0)
              return {
                port: parseInt(o[0].substr(12), 10),
                protocol: r.fmt,
                maxMessageSize: t,
              };
            if (i.matchPrefix(e, "a=sctpmap:").length > 0) {
              var a = i.matchPrefix(e, "a=sctpmap:")[0].substr(10).split(" ");
              return {
                port: parseInt(a[0], 10),
                protocol: a[1],
                maxMessageSize: t,
              };
            }
          }),
          (i.writeSctpDescription = function (e, t) {
            var r = [];
            return (
              (r =
                "DTLS/SCTP" !== e.protocol
                  ? [
                      "m=" +
                        e.kind +
                        " 9 " +
                        e.protocol +
                        " " +
                        t.protocol +
                        "\r\n",
                      "c=IN IP4 0.0.0.0\r\n",
                      "a=sctp-port:" + t.port + "\r\n",
                    ]
                  : [
                      "m=" +
                        e.kind +
                        " 9 " +
                        e.protocol +
                        " " +
                        t.port +
                        "\r\n",
                      "c=IN IP4 0.0.0.0\r\n",
                      "a=sctpmap:" + t.port + " " + t.protocol + " 65535\r\n",
                    ]),
              void 0 !== t.maxMessageSize &&
                r.push("a=max-message-size:" + t.maxMessageSize + "\r\n"),
              r.join("")
            );
          }),
          (i.generateSessionId = function () {
            return Math.random().toString().substr(2, 21);
          }),
          (i.writeSessionBoilerplate = function (e, t, r) {
            var n = void 0 !== t ? t : 2;
            return (
              "v=0\r\no=" +
              (r || "thisisadapterortc") +
              " " +
              (e || i.generateSessionId()) +
              " " +
              n +
              " IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"
            );
          }),
          (i.writeMediaSection = function (e, t, r, n) {
            var o = i.writeRtpDescription(e.kind, t);
            if (
              ((o += i.writeIceParameters(e.iceGatherer.getLocalParameters())),
              (o += i.writeDtlsParameters(
                e.dtlsTransport.getLocalParameters(),
                "offer" === r ? "actpass" : "active",
              )),
              (o += "a=mid:" + e.mid + "\r\n"),
              e.direction
                ? (o += "a=" + e.direction + "\r\n")
                : e.rtpSender && e.rtpReceiver
                  ? (o += "a=sendrecv\r\n")
                  : e.rtpSender
                    ? (o += "a=sendonly\r\n")
                    : e.rtpReceiver
                      ? (o += "a=recvonly\r\n")
                      : (o += "a=inactive\r\n"),
              e.rtpSender)
            ) {
              var a = "msid:" + n.id + " " + e.rtpSender.track.id + "\r\n";
              ((o += "a=" + a),
                (o += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " " + a),
                e.sendEncodingParameters[0].rtx &&
                  ((o +=
                    "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " " + a),
                  (o +=
                    "a=ssrc-group:FID " +
                    e.sendEncodingParameters[0].ssrc +
                    " " +
                    e.sendEncodingParameters[0].rtx.ssrc +
                    "\r\n")));
            }
            return (
              (o +=
                "a=ssrc:" +
                e.sendEncodingParameters[0].ssrc +
                " cname:" +
                i.localCName +
                "\r\n"),
              e.rtpSender &&
                e.sendEncodingParameters[0].rtx &&
                (o +=
                  "a=ssrc:" +
                  e.sendEncodingParameters[0].rtx.ssrc +
                  " cname:" +
                  i.localCName +
                  "\r\n"),
              o
            );
          }),
          (i.getDirection = function (e, t) {
            for (var r = i.splitLines(e), n = 0; n < r.length; n++)
              switch (r[n]) {
                case "a=sendrecv":
                case "a=sendonly":
                case "a=recvonly":
                case "a=inactive":
                  return r[n].substr(2);
              }
            return t ? i.getDirection(t) : "sendrecv";
          }),
          (i.getKind = function (e) {
            return i.splitLines(e)[0].split(" ")[0].substr(2);
          }),
          (i.isRejected = function (e) {
            return "0" === e.split(" ", 2)[1];
          }),
          (i.parseMLine = function (e) {
            var t = i.splitLines(e)[0].substr(2).split(" ");
            return {
              kind: t[0],
              port: parseInt(t[1], 10),
              protocol: t[2],
              fmt: t.slice(3).join(" "),
            };
          }),
          (i.parseOLine = function (e) {
            var t = i.matchPrefix(e, "o=")[0].substr(2).split(" ");
            return {
              username: t[0],
              sessionId: t[1],
              sessionVersion: parseInt(t[2], 10),
              netType: t[3],
              addressType: t[4],
              address: t[5],
            };
          }),
          (i.isValidSDP = function (e) {
            if ("string" != typeof e || 0 === e.length) return !1;
            for (var t = i.splitLines(e), r = 0; r < t.length; r++)
              if (t[r].length < 2 || "=" !== t[r].charAt(1)) return !1;
            return !0;
          }),
          "object" == h(t) && (t.exports = i));
      },
      {},
    ],
  },
  {},
  [1],
)(1);
var Tn,
  Rn,
  In,
  _n,
  kn,
  wn,
  On,
  Pn,
  An,
  Ln,
  xn,
  Dn,
  Mn,
  Un,
  Nn,
  Vn,
  jn,
  Fn,
  Bn = (function () {
    return i(
      function e(r) {
        var i = this;
        (t(this, e),
          En.set(this, void 0),
          Cn.set(this, void 0),
          v(this, En, new RTCPeerConnection(), "f"),
          v(this, Cn, r, "f"),
          (m(this, En, "f").onaddstream = function (e) {
            m(i, Cn, "f") &&
              Promise.resolve().then(function () {
                var t;
                null === (t = m(i, Cn, "f")) || void 0 === t || t.call(i, e);
              });
          }),
          (m(this, En, "f").ontrack = function (e) {
            m(i, Cn, "f") &&
              Promise.resolve().then(function () {
                var t;
                null === (t = m(i, Cn, "f")) || void 0 === t || t.call(i, e);
              });
          }));
      },
      [
        {
          key: "play",
          value: function (e, t) {
            return f(
              this,
              void 0,
              void 0,
              c().mark(function r() {
                var i, n, o, a, s, u, d;
                return c().wrap(
                  function (r) {
                    for (;;)
                      switch ((r.prev = r.next)) {
                        case 0:
                          return (
                            (r.next = 2),
                            null === (i = m(this, En, "f")) || void 0 === i
                              ? void 0
                              : i.createOffer({
                                  offerToReceiveAudio: !0,
                                  offerToReceiveVideo: !0,
                                })
                          );
                        case 2:
                          return (
                            (a = r.sent),
                            (r.next = 5),
                            null === (n = m(this, En, "f")) || void 0 === n
                              ? void 0
                              : n.setLocalDescription(a)
                          );
                        case 5:
                          return (
                            (s = {
                              api: e,
                              streamurl: t,
                              clientip: null,
                              sdp: null == a ? void 0 : a.sdp,
                            }),
                            (r.next = 8),
                            fetch(e, {
                              method: "post",
                              body: JSON.stringify(s),
                              headers: { "Content-Type": "application/json" },
                            }).then(function (e) {
                              return e.json();
                            })
                          );
                        case 8:
                          return (
                            (u = r.sent),
                            (d = u.sdp),
                            (u.sdp = d.replace(
                              "a=rtpmap:102 H264/90000",
                              "a=rtpmap:102 H264/90000\na=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f",
                            )),
                            (r.next = 13),
                            null === (o = m(this, En, "f")) || void 0 === o
                              ? void 0
                              : o.setRemoteDescription(
                                  new RTCSessionDescription({
                                    type: "answer",
                                    sdp: u.sdp,
                                  }),
                                )
                          );
                        case 13:
                          return r.abrupt("return", u);
                        case 14:
                        case "end":
                          return r.stop();
                      }
                  },
                  r,
                  this,
                );
              }),
            );
          },
        },
        {
          key: "close",
          value: function () {
            var e;
            null === (e = m(this, En, "f")) || void 0 === e || e.close();
          },
        },
      ],
      [
        {
          key: "parseRtcUrl",
          value: function (e) {
            var t = (function (e) {
                var t = document.createElement("a");
                t.href = e
                  .replace("rtmp://", "http://")
                  .replace("webrtc://", "http://")
                  .replace("rtc://", "http://");
                var r = t.hostname,
                  i = t.pathname.substr(1, t.pathname.lastIndexOf("/") - 1),
                  n = t.pathname.substr(t.pathname.lastIndexOf("/") + 1);
                if (
                  (i = i.replace("...vhost...", "?vhost=")).indexOf("?") >= 0
                ) {
                  var o = i.substr(i.indexOf("?"));
                  ((i = i.substr(0, i.indexOf("?"))),
                    o.indexOf("vhost=") > 0 &&
                      (r = o.substr(o.indexOf("vhost=") + 6)).indexOf("&") >
                        0 &&
                      (r = r.substr(0, r.indexOf("&"))));
                }
                t.hostname === r &&
                  /^(\d+)\.(\d+)\.(\d+)\.(\d+)$/.test(t.hostname) &&
                  (r = "__defaultVhost__");
                var a = "rtmp";
                e.indexOf("://") > 0 && (a = e.substr(0, e.indexOf("://")));
                var s = t.port;
                s ||
                  ("http" === a
                    ? (s = 80)
                    : "https" === a
                      ? (s = 443)
                      : "rtmp" === a && (s = 1935));
                var c = {
                  url: e,
                  schema: a,
                  server: t.hostname,
                  port: s,
                  vhost: r,
                  app: i,
                  stream: n,
                };
                return (
                  (function (e, t) {
                    if (((t.user_query = {}), 0 !== e.length)) {
                      e.indexOf("?") >= 0 && (e = e.split("?")[1]);
                      for (var r = e.split("&"), i = 0; i < r.length; i++) {
                        var n = r[i].split("=");
                        ((t[n[0]] = n[1]), (t.user_query[n[0]] = n[1]));
                      }
                      t.domain && (t.vhost = t.domain);
                    }
                  })(t.search, c),
                  c.port ||
                    ("webrtc" !== a && "rtc" !== a) ||
                    ("https" === c.user_query.schema ||
                    0 === window.location.href.indexOf("https://")
                      ? (c.port = 443)
                      : (c.port = 1985)),
                  c
                );
              })(e),
              r = t.user_query.schema,
              i = r ? r + ":" : window.location.protocol,
              n = t.port || ("https:" === i ? 443 : 1985),
              o = t.user_query.play || "/rtc/v1/play/",
              a = ""
                .concat(o)
                .concat(o.lastIndexOf("/") !== o.length - 1 ? "/" : ""),
              s = "".concat(i, "//").concat(t.server, ":").concat(n).concat(a);
            for (var c in t.user_query)
              "api" !== c &&
                "play" !== c &&
                (s += "&" + c + "=" + t.user_query[c]);
            return {
              apiUrl: (s = s.replace(a + "&", a + "?")),
              streamUrl: t.url,
              schema: i,
              urlObject: t,
              port: n,
            };
          },
        },
      ],
    );
  })();
((En = new WeakMap()), (Cn = new WeakMap()));
var Wn,
  Gn,
  Hn,
  Jn,
  zn,
  Kn,
  Yn,
  qn,
  Xn,
  Qn,
  $n,
  Zn,
  eo,
  to,
  ro,
  io,
  no,
  oo,
  ao,
  so = (function (r) {
    function n() {
      var r;
      return (
        t(this, n),
        (r = e(this, n)),
        Tn.set(r, 1),
        Rn.set(r, !1),
        In.set(r, !1),
        _n.set(r, void 0),
        kn.set(r, void 0),
        wn.set(r, void 0),
        On.set(r, void 0),
        Pn.set(r, !1),
        An.set(
          r,
          window.navigator.userAgent.match(/CPU.+Mac OS X/) &&
            window.navigator.userAgent.match(/(iPhone)|(iPad)/),
        ),
        Ln.set(r, !0),
        xn.set(r, function () {
          (m(r, Pn, "f") || r.emit(T.play),
            v(r, Pn, !0, "f"),
            m(r, An, "f") && m(r, Mn, "f").call(r, !1),
            r.emit(T.playing));
        }),
        Dn.set(r, function () {
          (m(r, Mn, "f").call(r, !1), r.emit(T.error));
        }),
        Mn.set(r, function (e) {
          e
            ? (v(r, Ln, !0, "f"), r.emit(T.waiting))
            : (v(r, Ln, !1, "f"), clearTimeout(m(r, On, "f")));
        }),
        Un.set(r, function () {
          v(
            r,
            On,
            setTimeout(function () {
              m(r, Mn, "f").call(r, !0);
            }, 300),
            "f",
          );
        }),
        Nn.set(r, function () {
          (m(r, Mn, "f").call(r, !1),
            m(r, An, "f") ||
              (m(r, wn, "f") &&
                m(r, Ln, "f") &&
                (m(r, Mn, "f").call(r, !1), m(r, xn, "f").call(r))));
        }),
        Vn.set(r, function () {
          return f(
            r,
            void 0,
            void 0,
            c().mark(function e() {
              var t, r, i, n, o, a, s, u, d, l, h, p, f, v;
              return c().wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return (
                          (t = m(this, _n, "f")),
                          (r = t.sid),
                          (i = t.streamUrl),
                          (n = Bn.parseRtcUrl(i || "")),
                          (o = w()),
                          (a = o.promise),
                          (s = o.controller),
                          (u = w()),
                          (d = u.promise),
                          (l = u.controller),
                          (h = new Bn(function (e) {
                            (console.log("onaddstream emited"),
                              console.log(
                                "Start play, event: ",
                                e.stream || e.streams[0],
                              ),
                              d.then(function (t) {
                                var r, i;
                                e.stream || e.streams[0]
                                  ? null === (i = s.resolve) ||
                                    void 0 === i ||
                                    i.call(s, {
                                      stream: e.stream || e.streams[0],
                                      sessionid: t,
                                    })
                                  : null === (r = s.reject) ||
                                    void 0 === r ||
                                    r.call(s, new Error("no stream available"));
                              }));
                          })),
                          h
                            .play(n.apiUrl, n.streamUrl)
                            .then(function (e) {
                              var t;
                              (console.log("session.sessionid", e.sessionid),
                                null === (t = l.resolve) ||
                                  void 0 === t ||
                                  t.call(l, e.sessionid));
                            })
                            .catch(function (e) {
                              var t;
                              (console.error(
                                "rtc error",
                                null == e ? void 0 : e.message,
                              ),
                                h.close(),
                                null === (t = l.reject) ||
                                  void 0 === t ||
                                  t.call(l, e));
                            }),
                          (e.next = 8),
                          a
                        );
                      case 8:
                        return (
                          (p = e.sent),
                          (f = p.stream),
                          (v = p.sessionid),
                          e.abrupt("return", {
                            stream: f,
                            sessionid: v,
                            sid: r || "",
                          })
                        );
                      case 12:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          );
        }),
        jn.set(r, function (e) {
          return f(
            r,
            void 0,
            void 0,
            c().mark(function t() {
              var r,
                i,
                n = this;
              return c().wrap(
                function (t) {
                  for (;;)
                    switch ((t.prev = t.next)) {
                      case 0:
                        if (
                          (console.warn("rtc renderVideo"),
                          m(this, wn, "f") ||
                            ((i = v(
                              this,
                              wn,
                              document.createElement("video"),
                              "f",
                            )).setAttribute("x5-video-player-type", "h5"),
                            i.setAttribute(
                              "x5-video-player-fullscreen",
                              "true",
                            ),
                            i.setAttribute("x-webkit-airplay", "allow"),
                            i.setAttribute(
                              "webkit-playsinline",
                              "webkit-playsinline",
                            ),
                            i.setAttribute("playsinline", "playsinline"),
                            i.addEventListener("waiting", m(this, Un, "f")),
                            i.addEventListener("play", m(this, xn, "f")),
                            i.addEventListener("playing", m(this, xn, "f")),
                            i.addEventListener("error", m(this, Dn, "f")),
                            i.addEventListener("timeupdate", m(this, Nn, "f")),
                            (i.style.objectFit = "contain"),
                            null === (r = m(this, kn, "f")) ||
                              void 0 === r ||
                              r.appendChild(i)),
                          m(this, wn, "f") && m(this, kn, "f"))
                        ) {
                          t.next = 4;
                          break;
                        }
                        return t.abrupt("return");
                      case 4:
                        try {
                          m(this, wn, "f").srcObject = e;
                        } catch (t) {
                          (console.error("rtc src error", t),
                            (m(this, wn, "f").src =
                              window.URL.createObjectURL(e)),
                            window.URL.revokeObjectURL(m(this, wn, "f").src));
                        }
                        return (
                          console.warn("call rtc video play", m(this, wn, "f")),
                          (t.next = 8),
                          m(this, wn, "f")
                            .play()
                            .catch(function (e) {
                              return (
                                console.warn("call rtc video play catch", e),
                                "NotAllowedError" ===
                                  (null == e ? void 0 : e.name) && m(n, wn, "f")
                                  ? (n.emit(T.playNotAllowed, P.code),
                                    (n.muted = !0),
                                    v(n, Rn, !0, "f"),
                                    Promise.resolve())
                                  : Promise.reject(e)
                              );
                            })
                        );
                      case 8:
                      case "end":
                        return t.stop();
                    }
                },
                t,
                this,
              );
            }),
          );
        }),
        Fn.set(r, function () {
          var e;
          m(r, Mn, "f").call(r, !1);
          var t = m(r, wn, "f");
          (t &&
            (t.removeEventListener("waiting", m(r, Un, "f")),
            t.removeEventListener("play", m(r, xn, "f")),
            t.removeEventListener("playing", m(r, xn, "f")),
            t.removeEventListener("error", m(r, Dn, "f")),
            t.removeEventListener("timeupdate", m(r, Nn, "f"))),
            null === (e = m(r, wn, "f")) || void 0 === e || e.pause(),
            v(r, wn, void 0, "f"));
        }),
        r
      );
    }
    return (
      a(n, _),
      i(n, [
        {
          key: "muted",
          get: function () {
            var e = m(this, In, "f");
            if (m(this, wn, "f"))
              try {
                e = m(this, wn, "f").muted;
              } catch (e) {
                console.log(e);
              }
            return e;
          },
          set: function (e) {
            (v(this, In, e, "f"),
              m(this, wn, "f") &&
                (e
                  ? (m(this, wn, "f").muted = !0)
                  : (m(this, wn, "f")
                      .play()
                      .catch(function (e) {
                        console.log(e);
                      }),
                    (m(this, wn, "f").muted = !1))));
          },
        },
        {
          key: "volume",
          get: function () {
            return m(this, Tn, "f");
          },
          set: function (e) {
            (e > 1 && (e = 1),
              v(this, Tn, e, "f"),
              m(this, wn, "f") && (m(this, wn, "f").volume = e));
          },
        },
        {
          key: "stream",
          set: function (e) {
            v(this, _n, e, "f");
          },
        },
        {
          key: "videoWrapper",
          set: function (e) {
            v(this, kn, e, "f");
          },
        },
        {
          key: "play",
          value: function () {
            return f(
              this,
              void 0,
              void 0,
              c().mark(function e() {
                var t;
                return c().wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          return ((e.next = 2), m(this, Vn, "f").call(this));
                        case 2:
                          return (
                            (t = e.sent),
                            (e.next = 5),
                            m(this, jn, "f").call(this, t.stream)
                          );
                        case 5:
                          console.log(t);
                        case 6:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            );
          },
        },
        {
          key: "resume",
          value: function () {
            m(this, wn, "f") &&
              (m(this, Rn, "f") && ((this.muted = !1), v(this, Rn, !1, "f")),
              m(this, wn, "f")
                .play()
                .catch(function (e) {
                  console.log(e);
                }));
          },
        },
        {
          key: "stop",
          value: function () {
            (v(this, Rn, !1, "f"),
              this.emit(T.stop),
              m(this, Fn, "f").call(this));
          },
        },
        {
          key: "setSinkId",
          value: function (e) {
            return f(
              this,
              void 0,
              void 0,
              c().mark(function t() {
                var r;
                return c().wrap(
                  function (t) {
                    for (;;)
                      switch ((t.prev = t.next)) {
                        case 0:
                          return (
                            (t.next = 2),
                            null === (r = m(this, wn, "f")) || void 0 === r
                              ? void 0
                              : r.setSinkId(e)
                          );
                        case 2:
                        case "end":
                          return t.stop();
                      }
                  },
                  t,
                  this,
                );
              }),
            );
          },
        },
        {
          key: "getSinkId",
          value: function () {
            return f(
              this,
              void 0,
              void 0,
              c().mark(function e() {
                var t;
                return c().wrap(
                  function (e) {
                    for (;;)
                      switch ((e.prev = e.next)) {
                        case 0:
                          return e.abrupt(
                            "return",
                            (null === (t = m(this, wn, "f")) || void 0 === t
                              ? void 0
                              : t.sinkId) || "",
                          );
                        case 1:
                        case "end":
                          return e.stop();
                      }
                  },
                  e,
                  this,
                );
              }),
            );
          },
        },
        {
          key: "destroy",
          value: function () {
            (this.stop(), d(n, "destroy", this, 3)([]));
          },
        },
        { key: "resize", value: function () {} },
      ])
    );
  })();
((Tn = new WeakMap()),
  (Rn = new WeakMap()),
  (In = new WeakMap()),
  (_n = new WeakMap()),
  (kn = new WeakMap()),
  (wn = new WeakMap()),
  (On = new WeakMap()),
  (Pn = new WeakMap()),
  (An = new WeakMap()),
  (Ln = new WeakMap()),
  (xn = new WeakMap()),
  (Dn = new WeakMap()),
  (Mn = new WeakMap()),
  (Un = new WeakMap()),
  (Nn = new WeakMap()),
  (Vn = new WeakMap()),
  (jn = new WeakMap()),
  (Fn = new WeakMap()),
  (function (e) {
    ((e[(e.webrtc = 6)] = "webrtc"),
      (e[(e.xrtc = 12)] = "xrtc"),
      (e[(e.text = 99)] = "text"));
  })(Wn || (Wn = {})),
  (function (e) {
    ((e[(e.start = 0)] = "start"),
      (e[(e.intermediate = 1)] = "intermediate"),
      (e[(e.end = 2)] = "end"));
  })(Gn || (Gn = {})),
  (function (e) {
    ((e.init = "0"),
      (e.bs = "2"),
      (e.audio = "3"),
      (e.asr = "4"),
      (e.nlp = "5"),
      (e.frameBegin = "10"),
      (e.duration = "9"),
      (e.frameEnd = "11"),
      (e.actionBegin = "12"),
      (e.actionEnd = "13"),
      (e.commonError = "-9"),
      (e.seriousError = "-99"));
  })(Hn || (Hn = {})),
  (function (e) {
    ((e.ping = "-99"),
      (e.break = "-1"),
      (e.init = "0"),
      (e.nlpByVoice = "1"),
      (e.nlpByText = "2"),
      (e.repeatText = "3"),
      (e.repeatVoice = "4"),
      (e.repeatBigVoice = "5"),
      (e.actionPlay = "6"));
  })(Jn || (Jn = {})));
var co = (function (r) {
  function n() {
    var r;
    return (
      t(this, n),
      (r = e(this, n)),
      zn.set(r, void 0),
      Kn.set(r, Wn.xrtc),
      Yn.set(r, void 0),
      qn.set(r, !1),
      Xn.set(r, 1),
      Qn.set(r, void 0),
      $n.set(r, void 0),
      Zn.set(r, void 0),
      eo.set(r, void 0),
      to.set(r, { width: 1080, height: 1920 }),
      ro.set(r, 1),
      io.set(r, function () {
        var e;
        (m(r, zn, "f") && m(r, zn, "f").destroy(),
          m(r, Kn, "f") === Wn.xrtc
            ? v(r, zn, new bn(), "f")
            : m(r, Kn, "f") === Wn.webrtc && v(r, zn, new so(), "f"),
          null === (e = m(r, zn, "f")) ||
            void 0 === e ||
            e
              .on(T.play, function () {
                r.emit(T.play);
              })
              .on(T.waiting, function () {
                r.emit(T.waiting);
              })
              .on(T.playing, function () {
                r.emit(T.playing);
              })
              .on(T.playNotAllowed, function () {
                r.emit(T.playNotAllowed);
              })
              .on(T.stop, function () {
                r.emit(T.stop);
              })
              .on(T.error, function (e) {
                r.emit(T.error, e);
              }));
      }),
      no.set(r, function () {
        var e, t;
        if (!m(r, Zn, "f")) {
          var i = v(r, Zn, document.createElement("div"), "f");
          (i.setAttribute("id", "xvideo"),
            (i.style.position = "relative"),
            (i.style.width = "100%"),
            (i.style.height = "100%"),
            (i.style.minWidth = "100%"),
            (i.style.minHeight = "100%"),
            (i.style.pointerEvents = "none"),
            null === (e = m(r, $n, "f")) || void 0 === e || e.appendChild(i));
        }
        if (!m(r, eo, "f")) {
          var n = v(r, eo, document.createElement("div"), "f");
          ((n.style.position = "absolute"),
            r.resize(),
            m(r, Zn, "f").appendChild(n),
            window.addEventListener("resize", m(r, oo, "f")));
        }
        if (m(r, $n, "f"))
          try {
            null === (t = m(r, Yn, "f")) ||
              void 0 === t ||
              t.observe(m(r, $n, "f"));
          } catch (e) {}
      }),
      oo.set(r, function () {
        var e,
          t,
          i = m(r, to, "f"),
          n = i.width,
          o = i.height,
          a =
            (null === (e = m(r, Zn, "f")) || void 0 === e
              ? void 0
              : e.offsetWidth) || 0,
          s =
            (null === (t = m(r, Zn, "f")) || void 0 === t
              ? void 0
              : t.offsetHeight) || 0;
        if (m(r, eo, "f")) {
          var c = 1;
          ((c = a / s > n / o ? s / o : a / n),
            (m(r, eo, "f").style.left = "50%"),
            (m(r, eo, "f").style.top = "50%"));
          var u = m(r, ro, "f") * c;
          m(r, eo, "f").style.transform = "translate(-50%,-50%) scale("
            .concat(u, ", ")
            .concat(c, ")");
        }
      }),
      ao.set(r, function () {
        var e;
        if (m(r, $n, "f"))
          try {
            null === (e = m(r, Yn, "f")) ||
              void 0 === e ||
              e.unobserve(m(r, $n, "f"));
          } catch (e) {}
        (window.removeEventListener("resize", m(r, oo, "f")),
          m(r, eo, "f") && (m(r, eo, "f").remove(), v(r, eo, void 0, "f")),
          m(r, Zn, "f") && (m(r, Zn, "f").remove(), v(r, Zn, void 0, "f")));
      }),
      void 0 !== window.ResizeObserver &&
        v(
          r,
          Yn,
          new ResizeObserver(function (e) {
            e.forEach(function (e) {
              var t;
              null === (t = m(r, oo, "f")) || void 0 === t || t.call(r);
            });
          }),
          "f",
        ),
      r
    );
  }
  return (
    a(n, _),
    i(n, [
      {
        key: "playerType",
        set: function (e) {
          v(this, Kn, e, "f");
        },
      },
      {
        key: "muted",
        get: function () {
          var e,
            t = m(this, qn, "f");
          if (m(this, zn, "f"))
            try {
              t =
                null === (e = m(this, zn, "f")) || void 0 === e
                  ? void 0
                  : e.muted;
            } catch (e) {
              console.log(e);
            }
          return t;
        },
        set: function (e) {
          (v(this, qn, e, "f"),
            m(this, zn, "f") &&
              (e
                ? (m(this, zn, "f").muted = !0)
                : (m(this, zn, "f").resume(), (m(this, zn, "f").muted = !1))));
        },
      },
      {
        key: "volume",
        get: function () {
          var e;
          return (
            (null === (e = m(this, zn, "f")) || void 0 === e
              ? void 0
              : e.volume) || m(this, Xn, "f")
          );
        },
        set: function (e) {
          (e > 1 && (e = 1),
            v(this, Xn, e, "f"),
            m(this, zn, "f") && (m(this, zn, "f").volume = e));
        },
      },
      {
        key: "stream",
        set: function (e) {
          (v(this, Qn, e, "f"),
            m(this, zn, "f") && (m(this, zn, "f").stream = e));
        },
      },
      {
        key: "container",
        set: function (e) {
          var t;
          if (m(this, $n, "f"))
            try {
              null === (t = m(this, Yn, "f")) ||
                void 0 === t ||
                t.unobserve(m(this, $n, "f"));
            } catch (e) {}
          v(this, $n, e, "f");
        },
      },
      {
        key: "videoSize",
        set: function (e) {
          v(this, to, e, "f");
        },
      },
      {
        key: "play",
        value: function () {
          return f(
            this,
            void 0,
            void 0,
            c().mark(function e() {
              var t;
              return c().wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return (
                          m(this, no, "f").call(this),
                          m(this, io, "f").call(this),
                          m(this, zn, "f") &&
                            (m(this, Qn, "f") &&
                              (m(this, zn, "f").stream = m(this, Qn, "f")),
                            (m(this, zn, "f").videoWrapper = m(this, eo, "f"))),
                          (e.prev = 3),
                          (e.next = 6),
                          null === (t = m(this, zn, "f")) || void 0 === t
                            ? void 0
                            : t.play()
                        );
                      case 6:
                        e.next = 12;
                        break;
                      case 8:
                        ((e.prev = 8),
                          (e.t0 = e.catch(3)),
                          console.error(
                            "[player] error, auto destroy:::",
                            null === e.t0 || void 0 === e.t0
                              ? void 0
                              : e.t0.message,
                            e.t0,
                          ),
                          this.stop());
                      case 12:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
                [[3, 8]],
              );
            }),
          );
        },
      },
      {
        key: "resume",
        value: function () {
          m(this, zn, "f") && m(this, zn, "f").resume();
        },
      },
      {
        key: "stop",
        value: function () {
          var e;
          (m(this, ao, "f").call(this),
            null === (e = m(this, zn, "f")) || void 0 === e || e.stop());
        },
      },
      {
        key: "scaleX",
        get: function () {
          return m(this, ro, "f") || 1;
        },
        set: function (e) {
          (v(this, ro, e, "f"), m(this, oo, "f").call(this));
        },
      },
      {
        key: "setSinkId",
        value: function (e) {
          return f(
            this,
            void 0,
            void 0,
            c().mark(function t() {
              var r;
              return c().wrap(
                function (t) {
                  for (;;)
                    switch ((t.prev = t.next)) {
                      case 0:
                        return (
                          (t.next = 2),
                          null === (r = m(this, zn, "f")) || void 0 === r
                            ? void 0
                            : r.setSinkId(e)
                        );
                      case 2:
                      case "end":
                        return t.stop();
                    }
                },
                t,
                this,
              );
            }),
          );
        },
      },
      {
        key: "getSinkId",
        value: function () {
          return f(
            this,
            void 0,
            void 0,
            c().mark(function e() {
              var t;
              return c().wrap(
                function (e) {
                  for (;;)
                    switch ((e.prev = e.next)) {
                      case 0:
                        return e.abrupt(
                          "return",
                          (null === (t = m(this, zn, "f")) || void 0 === t
                            ? void 0
                            : t.getSinkId()) || "",
                        );
                      case 1:
                      case "end":
                        return e.stop();
                    }
                },
                e,
                this,
              );
            }),
          );
        },
      },
      {
        key: "destroy",
        value: function () {
          var e;
          try {
            null === (e = m(this, Yn, "f")) || void 0 === e || e.disconnect();
          } catch (e) {}
          (v(this, Yn, void 0, "f"), this.stop(), d(n, "destroy", this, 3)([]));
        },
      },
      {
        key: "resize",
        value: function () {
          var e;
          (m(this, eo, "f") &&
            ((m(this, eo, "f").style.width = "".concat(
              m(this, to, "f").width,
              "px",
            )),
            (m(this, eo, "f").style.height = "".concat(
              m(this, to, "f").height,
              "px",
            ))),
            null === (e = m(this, zn, "f")) || void 0 === e || e.resize(),
            m(this, oo, "f").call(this));
        },
      },
    ])
  );
})();
((zn = new WeakMap()),
  (Kn = new WeakMap()),
  (Yn = new WeakMap()),
  (qn = new WeakMap()),
  (Xn = new WeakMap()),
  (Qn = new WeakMap()),
  ($n = new WeakMap()),
  (Zn = new WeakMap()),
  (eo = new WeakMap()),
  (to = new WeakMap()),
  (ro = new WeakMap()),
  (io = new WeakMap()),
  (no = new WeakMap()),
  (oo = new WeakMap()),
  (ao = new WeakMap()));
export { co as RTCPlayer };
